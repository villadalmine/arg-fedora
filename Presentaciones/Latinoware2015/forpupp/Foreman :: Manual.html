<!DOCTYPE html>
<html itemscope="" itemtype="http://schema.org/Organization" lang="en"><head>
    <!-- base href="http://theforeman.org/" -->
    
    
    

    
    
    
  <title>Foreman :: Manual</title>

  <script src="Foreman%20::%20Manual_archivos/ga.js" async="" type="text/javascript"></script><script type="text/javascript" src="Foreman%20::%20Manual_archivos/jquery.js"></script>
  <script type="text/javascript" src="Foreman%20::%20Manual_archivos/bootstrap.js"></script>
  <script type="text/javascript" src="Foreman%20::%20Manual_archivos/jquery-ui-1.js"></script>
  <script type="text/javascript" src="Foreman%20::%20Manual_archivos/jquery_002.js"></script>
  <script type="text/javascript" src="Foreman%20::%20Manual_archivos/scroll.js"></script>

  <link rel="stylesheet" media="all" href="Foreman%20::%20Manual_archivos/bootstrap.css">
  <link rel="stylesheet" media="all" href="Foreman%20::%20Manual_archivos/bootstrap-responsive.css">
  <link rel="stylesheet" media="all" href="Foreman%20::%20Manual_archivos/jquery.css">
  <link rel="stylesheet" media="all" href="Foreman%20::%20Manual_archivos/syntax.css">
	<link rel="stylesheet" media="all" href="Foreman%20::%20Manual_archivos/style.css">
	<link rel="stylesheet" href="Foreman%20::%20Manual_archivos/font-awesome.css">
	<link rel="stylesheet" type="text/css" href="Foreman%20::%20Manual_archivos/css.css">
	<meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0;">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
</head>

<body>
 
    <header id="page-header" style="padding: 0">
	
		<div class="container">
      
		    <nav class="navbar navbar-default navbar-static-top" role="navigation">
	    
				<ul class="nav navbar-nav nav-justified">
          
 						<li class="visible-xs"><a class="index-link" href="http://theforeman.org/">Home</a></li>
						<li class="hidden-xs"><a class="index-link" href="http://theforeman.org/">
							<i class="logo"><img style="width: 90px" src="Foreman%20::%20Manual_archivos/foremanhelmet.svg" alt="Foreman home"></i>
						</a></li>
          
					
			  		<li><a href="http://theforeman.org/introduction.html"> Introduction </a></li>
					
			  		<li><a href="http://theforeman.org/manuals/1.9/quickstart_guide.html#QuickstartGuide"> Quickstart </a></li>
					
			  		<li><a href="http://theforeman.org/documentation.html"> Documentation </a></li>
					
			  		<li><a href="http://theforeman.org/contribute.html"> Community </a></li>
					
			  		<li><a href="http://theforeman.org/media.html"> Videos </a></li>
					
					
				</ul>
			</nav>
      
		</div>
  </header>
<script>
$(function(){
  $('.nav > li a[href="'+window.location.pathname+'"]').parents('.nav > li').addClass('active')
})
</script>

<div id="wrap">
	<div class="container">
	  <div class="row">
			
			<div class="col-md-3">
				<div id="toc" class="sidebar-nav-fixed pull-right hidden-sm hidden-xs bs-docs-sidenav affix-top" data-spy="affix" data-offset-top="60" data-offset-bottom="300">
					
					
					
					
					
					
				<ul class="header nav nav-list bs-docs-sidenav" id="Header0"><li data-unique="1.Foreman1.9Manual" class="item"><a>1. Foreman 1.9 Manual<i class="icon-chevron-right"></i></a></li><ul style="display: block;" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="ForemanArchitecture" class="item"><a>Foreman Architecture<i class="icon-chevron-right"></i></a></li><li data-unique="Smart-Proxy" class="item"><a>Smart-Proxy<i class="icon-chevron-right"></i></a></li><li data-unique="Releasenotesfor1.9" class="item active"><a>Release notes for 1.9<i class="icon-chevron-right"></i></a></li><ul style="display: block;" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="Headlinefeatures" class="item"><a>Headline features<i class="icon-chevron-right"></i></a></li><li data-unique="Releasenotesfor1.9.2" class="item"><a>Release notes for 1.9.2<i class="icon-chevron-right"></i></a></li><li data-unique="Releasenotesfor1.9.1" class="item"><a>Release notes for 1.9.1<i class="icon-chevron-right"></i></a></li><li data-unique="Releasenotesfor1.9.0" class="item"><a>Release notes for 1.9.0<i class="icon-chevron-right"></i></a></li><li data-unique="Upgradewarnings" class="item"><a>Upgrade warnings<i class="icon-chevron-right"></i></a></li><li data-unique="Deprecations" class="item"><a>Deprecations<i class="icon-chevron-right"></i></a></li><li data-unique="Contributors" class="item"><a>Contributors<i class="icon-chevron-right"></i></a></li></ul></ul></ul><ul class="header nav nav-list bs-docs-sidenav" id="Header1"><li data-unique="2.Quickstart" class="item"><a>2. Quickstart<i class="icon-chevron-right"></i></a></li><ul style="display: none;" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="2.1Installation" class="item"><a>2.1 Installation<i class="icon-chevron-right"></i></a></li><li data-unique="2.2PuppetManagement" class="item"><a>2.2 Puppet Management<i class="icon-chevron-right"></i></a></li></ul></ul><ul class="header nav nav-list bs-docs-sidenav" id="Header2"><li data-unique="3.InstallingForeman" class="item"><a>3. Installing Foreman<i class="icon-chevron-right"></i></a></li><ul style="display: none;" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="3.1SystemRequirements" class="item"><a>3.1 System Requirements<i class="icon-chevron-right"></i></a></li><ul style="display: none;" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="3.1.1SupportedPlatforms" class="item"><a>3.1.1 Supported Platforms<i class="icon-chevron-right"></i></a></li><li data-unique="3.1.2PuppetCompatibility" class="item"><a>3.1.2 Puppet Compatibility<i class="icon-chevron-right"></i></a></li><li data-unique="3.1.3FirewallConfiguration" class="item"><a>3.1.3 Firewall Configuration<i class="icon-chevron-right"></i></a></li></ul><li data-unique="3.2ForemanInstaller" class="item"><a>3.2 Foreman Installer<i class="icon-chevron-right"></i></a></li><ul style="" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="3.2.1Installation" class="item"><a>3.2.1 Installation<i class="icon-chevron-right"></i></a></li><li data-unique="3.2.2InstallerOptions" class="item"><a>3.2.2 Installer Options<i class="icon-chevron-right"></i></a></li><li data-unique="3.2.3InstallationScenarios" class="item"><a>3.2.3 Installation Scenarios<i class="icon-chevron-right"></i></a></li></ul><li data-unique="3.3InstallFromPackages" class="item"><a>3.3 Install From Packages<i class="icon-chevron-right"></i></a></li><ul style="" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="3.3.1RPMPackages" class="item"><a>3.3.1 RPM Packages<i class="icon-chevron-right"></i></a></li><li data-unique="3.3.2SoftwareCollections" class="item"><a>3.3.2 Software Collections<i class="icon-chevron-right"></i></a></li><li data-unique="3.3.3DebianPackages" class="item"><a>3.3.3 Debian Packages<i class="icon-chevron-right"></i></a></li></ul><li data-unique="3.4InstallFromSource" class="item"><a>3.4 Install From Source<i class="icon-chevron-right"></i></a></li><ul style="" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="Lateststableversion" class="item"><a>Latest stable version<i class="icon-chevron-right"></i></a></li><li data-unique="CLI(Hammer)" class="item"><a>CLI (Hammer)<i class="icon-chevron-right"></i></a></li></ul><li data-unique="3.5Configuration" class="item"><a>3.5 Configuration<i class="icon-chevron-right"></i></a></li><ul style="display: none;" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="3.5.1InitialSetup" class="item"><a>3.5.1 Initial Setup<i class="icon-chevron-right"></i></a></li><li data-unique="3.5.2ConfigurationOptions" class="item"><a>3.5.2 Configuration Options<i class="icon-chevron-right"></i></a></li><li data-unique="3.5.3DatabaseSetup" class="item"><a>3.5.3 Database Setup<i class="icon-chevron-right"></i></a></li><li data-unique="3.5.4PuppetReports" class="item"><a>3.5.4 Puppet Reports<i class="icon-chevron-right"></i></a></li><li data-unique="3.5.5FactsandtheENC" class="item"><a>3.5.5 Facts and the ENC<i class="icon-chevron-right"></i></a></li><li data-unique="3.5.6CLI" class="item"><a>3.5.6 CLI<i class="icon-chevron-right"></i></a></li></ul><li data-unique="3.6Upgrade" class="item"><a>3.6 Upgrade<i class="icon-chevron-right"></i></a></li><ul style="" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="UpgradingtoForeman1.9" class="item"><a>Upgrading to Foreman 1.9<i class="icon-chevron-right"></i></a></li></ul></ul></ul><ul class="header nav nav-list bs-docs-sidenav" id="Header3"><li data-unique="4.GeneralForeman" class="item"><a>4. General Foreman<i class="icon-chevron-right"></i></a></li><ul style="display: none;" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="4.1WebInterface" class="item"><a>4.1 Web Interface<i class="icon-chevron-right"></i></a></li><ul style="" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="4.1.1LDAPAuthentication" class="item"><a>4.1.1 LDAP Authentication<i class="icon-chevron-right"></i></a></li><li data-unique="4.1.2RolesandPermissions" class="item"><a>4.1.2 Roles and Permissions<i class="icon-chevron-right"></i></a></li><li data-unique="4.1.3Trends" class="item"><a>4.1.3 Trends<i class="icon-chevron-right"></i></a></li><li data-unique="4.1.4Auditing" class="item"><a>4.1.4 Auditing<i class="icon-chevron-right"></i></a></li><li data-unique="4.1.5Searching" class="item"><a>4.1.5 Searching<i class="icon-chevron-right"></i></a></li></ul><li data-unique="4.2ManagingPuppet" class="item"><a>4.2 Managing Puppet<i class="icon-chevron-right"></i></a></li><ul style="" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="4.2.1Environments" class="item"><a>4.2.1 Environments<i class="icon-chevron-right"></i></a></li><li data-unique="4.2.2Classes" class="item"><a>4.2.2 Classes<i class="icon-chevron-right"></i></a></li><li data-unique="4.2.3Parameters" class="item"><a>4.2.3 Parameters<i class="icon-chevron-right"></i></a></li><li data-unique="4.2.4SmartVariables" class="item"><a>4.2.4 Smart Variables<i class="icon-chevron-right"></i></a></li><li data-unique="4.2.5ParameterizedClasses" class="item"><a>4.2.5 Parameterized Classes<i class="icon-chevron-right"></i></a></li><li data-unique="4.2.6SmartMatchers" class="item"><a>4.2.6 Smart Matchers<i class="icon-chevron-right"></i></a></li></ul><li data-unique="4.3SmartProxies" class="item"><a>4.3 Smart Proxies<i class="icon-chevron-right"></i></a></li><ul style="" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="4.3.1SmartProxyInstallation" class="item"><a>4.3.1 Smart Proxy Installation<i class="icon-chevron-right"></i></a></li><li data-unique="4.3.2SmartProxySettings" class="item"><a>4.3.2 Smart Proxy Settings<i class="icon-chevron-right"></i></a></li><li data-unique="4.3.3BMC" class="item"><a>4.3.3 BMC<i class="icon-chevron-right"></i></a></li><li data-unique="4.3.4DHCP" class="item"><a>4.3.4 DHCP<i class="icon-chevron-right"></i></a></li><li data-unique="4.3.5DNS" class="item"><a>4.3.5 DNS<i class="icon-chevron-right"></i></a></li><li data-unique="4.3.6Puppet" class="item"><a>4.3.6 Puppet<i class="icon-chevron-right"></i></a></li><li data-unique="4.3.7PuppetCA" class="item"><a>4.3.7 Puppet CA<i class="icon-chevron-right"></i></a></li><li data-unique="4.3.8Realm" class="item"><a>4.3.8 Realm<i class="icon-chevron-right"></i></a></li><li data-unique="4.3.9TFTP" class="item"><a>4.3.9 TFTP<i class="icon-chevron-right"></i></a></li><li data-unique="4.3.10SSL" class="item"><a>4.3.10 SSL<i class="icon-chevron-right"></i></a></li><li data-unique="4.3.11Libvirt" class="item"><a>4.3.11 Libvirt<i class="icon-chevron-right"></i></a></li></ul><li data-unique="4.4Provisioning" class="item"><a>4.4 Provisioning<i class="icon-chevron-right"></i></a></li><ul style="display: none;" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="4.4.1OperatingSystems" class="item"><a>4.4.1 Operating Systems<i class="icon-chevron-right"></i></a></li><li data-unique="4.4.2InstallationMedia" class="item"><a>4.4.2 Installation Media<i class="icon-chevron-right"></i></a></li><li data-unique="4.4.3ProvisioningTemplates" class="item"><a>4.4.3 Provisioning Templates<i class="icon-chevron-right"></i></a></li><li data-unique="4.4.4PartitionTables" class="item"><a>4.4.4 Partition Tables<i class="icon-chevron-right"></i></a></li><li data-unique="4.4.5Architectures" class="item"><a>4.4.5 Architectures<i class="icon-chevron-right"></i></a></li><li data-unique="4.4.6Workflow" class="item"><a>4.4.6 Workflow<i class="icon-chevron-right"></i></a></li><li data-unique="4.4.7Networking" class="item"><a>4.4.7 Networking<i class="icon-chevron-right"></i></a></li><li data-unique="4.4.8OSSpecificNotes" class="item"><a>4.4.8 OS Specific Notes<i class="icon-chevron-right"></i></a></li><li data-unique="4.4.8.1FreeBSD" class="item"><a>4.4.8.1 FreeBSD<i class="icon-chevron-right"></i></a></li><li data-unique="4.4.8.2SLES" class="item"><a>4.4.8.2 SLES<i class="icon-chevron-right"></i></a></li></ul><li data-unique="4.5CommandLineInterface" class="item"><a>4.5 Command Line Interface<i class="icon-chevron-right"></i></a></li><ul style="" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="4.5.1UsageExamples" class="item"><a>4.5.1 Usage Examples<i class="icon-chevron-right"></i></a></li><li data-unique="4.5.2SuccessStory" class="item"><a>4.5.2 Success Story<i class="icon-chevron-right"></i></a></li></ul><li data-unique="4.6EmailManagement" class="item"><a>4.6 Email Management<i class="icon-chevron-right"></i></a></li><ul style="" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="4.6.1EmailPreferences" class="item"><a>4.6.1 Email Preferences<i class="icon-chevron-right"></i></a></li><li data-unique="4.6.2AccountNotifications" class="item"><a>4.6.2 Account Notifications<i class="icon-chevron-right"></i></a></li><li data-unique="4.6.3HostNotifications" class="item"><a>4.6.3 Host Notifications<i class="icon-chevron-right"></i></a></li><li data-unique="4.6.4ScheduledEmails" class="item"><a>4.6.4 Scheduled Emails<i class="icon-chevron-right"></i></a></li></ul><li data-unique="4.7ManagingSalt" class="item"><a>4.7 Managing Salt<i class="icon-chevron-right"></i></a></li><li data-unique="4.8ManagingChef" class="item"><a>4.8 Managing Chef<i class="icon-chevron-right"></i></a></li></ul></ul><ul class="header nav nav-list bs-docs-sidenav" id="Header4"><li data-unique="5.AdvancedForeman" class="item"><a>5. Advanced Foreman<i class="icon-chevron-right"></i></a></li><ul style="display: none;" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="5.1API" class="item"><a>5.1 API<i class="icon-chevron-right"></i></a></li><ul style="display: none;" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="5.1.1CRUDRequestExamples" class="item"><a>5.1.1 CRUD Request Examples<i class="icon-chevron-right"></i></a></li><li data-unique="5.1.2JSONResponseFormatforCollections" class="item"><a>5.1.2 JSON Response Format for Collections<i class="icon-chevron-right"></i></a></li><li data-unique="5.1.3JSONResponseFormatforSingleObjects" class="item"><a>5.1.3 JSON Response Format for Single Objects<i class="icon-chevron-right"></i></a></li><li data-unique="5.1.4CustomizeJSONResponses" class="item"><a>5.1.4 Customize JSON Responses<i class="icon-chevron-right"></i></a></li><li data-unique="5.1.5NestedAPIroutes" class="item"><a>5.1.5 Nested API routes<i class="icon-chevron-right"></i></a></li><li data-unique="5.1.6APIVersioning" class="item"><a>5.1.6 API Versioning<i class="icon-chevron-right"></i></a></li><li data-unique="5.1.7HandlingAssociations" class="item"><a>5.1.7 Handling Associations<i class="icon-chevron-right"></i></a></li></ul><li data-unique="5.2ComputeResources" class="item"><a>5.2 Compute Resources<i class="icon-chevron-right"></i></a></li><ul style="" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="5.2.1UsingComputeResources" class="item"><a>5.2.1 Using Compute Resources<i class="icon-chevron-right"></i></a></li><li data-unique="5.2.2UsingComputeProfiles" class="item"><a>5.2.2 Using Compute Profiles<i class="icon-chevron-right"></i></a></li><li data-unique="5.2.3EC2Notes" class="item"><a>5.2.3 EC2 Notes<i class="icon-chevron-right"></i></a></li><li data-unique="5.2.4GoogleComputeEngineNotes" class="item"><a>5.2.4 Google Compute Engine Notes<i class="icon-chevron-right"></i></a></li><li data-unique="5.2.5LibvirtNotes" class="item"><a>5.2.5 Libvirt Notes<i class="icon-chevron-right"></i></a></li><li data-unique="5.2.6OpenStackNotes" class="item"><a>5.2.6 OpenStack Notes<i class="icon-chevron-right"></i></a></li><li data-unique="5.2.7oVirt/RHEVNotes" class="item"><a>5.2.7 oVirt / RHEV Notes<i class="icon-chevron-right"></i></a></li><li data-unique="5.2.8RackspaceNotes" class="item"><a>5.2.8 Rackspace Notes<i class="icon-chevron-right"></i></a></li><li data-unique="5.2.9VMwareNotes" class="item"><a>5.2.9 VMware Notes<i class="icon-chevron-right"></i></a></li><li data-unique="5.2.10PasswordEncryption" class="item"><a>5.2.10 Password Encryption<i class="icon-chevron-right"></i></a></li></ul><li data-unique="5.3InstallLocations" class="item"><a>5.3 Install Locations<i class="icon-chevron-right"></i></a></li><li data-unique="5.4SecuringCommunicationswithSSL" class="item"><a>5.4 Securing Communications with SSL<i class="icon-chevron-right"></i></a></li><ul style="" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="5.4.1SecuringPuppetMasterRequests" class="item"><a>5.4.1 Securing Puppet Master Requests<i class="icon-chevron-right"></i></a></li><li data-unique="5.4.2SecuringSmartProxyRequests" class="item"><a>5.4.2 Securing Smart Proxy Requests<i class="icon-chevron-right"></i></a></li></ul><li data-unique="5.5Backup,RecoveryandMigration" class="item"><a>5.5 Backup, Recovery and Migration<i class="icon-chevron-right"></i></a></li><ul style="" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="5.5.1Backup" class="item"><a>5.5.1 Backup<i class="icon-chevron-right"></i></a></li><li data-unique="Database" class="item"><a>Database<i class="icon-chevron-right"></i></a></li><li data-unique="Configuration" class="item"><a>Configuration<i class="icon-chevron-right"></i></a></li><li data-unique="Puppetmaster" class="item"><a>Puppet master<i class="icon-chevron-right"></i></a></li><li data-unique="DHCP,DNSandTFTPservices" class="item"><a>DHCP, DNS and TFTP services<i class="icon-chevron-right"></i></a></li><li data-unique="5.5.2Recovery" class="item"><a>5.5.2 Recovery<i class="icon-chevron-right"></i></a></li><li data-unique="Configuration117" class="item"><a>Configuration<i class="icon-chevron-right"></i></a></li><li data-unique="Puppetmaster118" class="item"><a>Puppet master<i class="icon-chevron-right"></i></a></li><li data-unique="DHCP,DNSandTFTPservices119" class="item"><a>DHCP, DNS and TFTP services<i class="icon-chevron-right"></i></a></li></ul><li data-unique="5.6RailsConsole" class="item"><a>5.6 Rails Console<i class="icon-chevron-right"></i></a></li><li data-unique="5.7ExternalAuthentication" class="item"><a>5.7 External Authentication<i class="icon-chevron-right"></i></a></li><ul style="" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="5.7.1ConfigurationviaForemaninstaller" class="item"><a>5.7.1 Configuration via Foreman installer<i class="icon-chevron-right"></i></a></li><li data-unique="5.7.2HBACconfiguration" class="item"><a>5.7.2 HBAC configuration<i class="icon-chevron-right"></i></a></li><li data-unique="5.7.3KerberosSingleSign-On" class="item"><a>5.7.3 Kerberos Single Sign-On<i class="icon-chevron-right"></i></a></li><li data-unique="5.7.4PAMAuthentication" class="item"><a>5.7.4 PAM Authentication<i class="icon-chevron-right"></i></a></li><li data-unique="5.7.5Populateusersandattributes" class="item"><a>5.7.5 Populate users and attributes<i class="icon-chevron-right"></i></a></li><li data-unique="5.7.6Namespaceseparation" class="item"><a>5.7.6 Namespace separation<i class="icon-chevron-right"></i></a></li></ul></ul></ul><ul class="header nav nav-list bs-docs-sidenav" id="Header5"><li data-unique="6.Plugins" class="item"><a>6. Plugins<i class="icon-chevron-right"></i></a></li></ul><ul class="header nav nav-list bs-docs-sidenav" id="Header6"><li data-unique="7.Troubleshooting" class="item"><a>7. Troubleshooting<i class="icon-chevron-right"></i></a></li><ul style="display: none;" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="7.1NoVNC" class="item"><a>7.1 NoVNC<i class="icon-chevron-right"></i></a></li><ul style="display: none;" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="Requirements" class="item"><a>Requirements<i class="icon-chevron-right"></i></a></li><li data-unique="EncryptedWebSockets" class="item"><a>Encrypted Web Sockets<i class="icon-chevron-right"></i></a></li><li data-unique="Knownissues" class="item"><a>Known issues<i class="icon-chevron-right"></i></a></li><li data-unique="TroubleshootingSteps" class="item"><a>Troubleshooting Steps<i class="icon-chevron-right"></i></a></li></ul><li data-unique="7.2Debugging" class="item"><a>7.2 Debugging<i class="icon-chevron-right"></i></a></li><ul style="display: none;" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="Foremandebugging" class="item"><a>Foreman debugging<i class="icon-chevron-right"></i></a></li><li data-unique="Smartproxydebugging" class="item"><a>Smart proxy debugging<i class="icon-chevron-right"></i></a></li></ul><li data-unique="7.3GettingHelp" class="item"><a>7.3 Getting Help<i class="icon-chevron-right"></i></a></li><ul style="display: none;" class="sub-header nav nav-list bs-docs-sidenav"><li data-unique="IRC" class="item"><a>IRC<i class="icon-chevron-right"></i></a></li><li data-unique="Mailinglists" class="item"><a>Mailing lists<i class="icon-chevron-right"></i></a></li><li data-unique="Gatheringinformation" class="item"><a>Gathering information<i class="icon-chevron-right"></i></a></li></ul></ul></ul></div>
			</div>
			
			
			<div id="doc" class="col-md-9">
			
				<div data-unique="1.Foreman1.9Manual" name="1.Foreman1.9Manual"></div><h1>1. Foreman 1.9 Manual</h1>

<div data-unique="ForemanArchitecture" name="ForemanArchitecture"></div><h2>Foreman Architecture</h2>

<p>A Foreman installation will always contain a central foreman instance
that is responsible for providing the Web based GUI, node
configurations, initial host configuration files, etc. However, if the
foreman installation supports unattended installations then other
operations need to be performed to fully automate this process. The
smart proxy manages remote services and is generally installed with all
Foreman installations to manage TFTP, DHCP, DNS, Puppet, Puppet CA, Salt,
and Chef.</p>

<div data-unique="Smart-Proxy" name="Smart-Proxy"></div><h2>Smart-Proxy</h2>

<p>A <a href="http://theforeman.org/manuals/1.9/index.html#4.3SmartProxies">Smart-Proxy</a>
 is located on or near a machine that performs a specific function and 
helps foreman orchestrate the process of commissioning a new host. 
Placing the proxy on or near to the actual service will also help reduce
 latencies in large distributed organizations.</p>

<p><img src="Foreman%20::%20Manual_archivos/foreman_architecture.png" alt="Foreman Architecture"></p>

<div data-unique="Releasenotesfor1.9" name="Releasenotesfor1.9"></div><h2>Release notes for 1.9</h2>

<div data-unique="Headlinefeatures" name="Headlinefeatures"></div><h3>Headline features</h3>

<h4>Web UI enhancements</h4>

<p>Foreman 1.9 adds a few small quality-of-life enhancements to the user
 interface.  Click any of the video links for a short, 30-second demo.</p>

<p>New dropdown menus are now used throughout the application, which 
allow you to quickly filter and search for available entries on every 
field.</p>

<ul>
<li><a href="https://www.youtube.com/watch?v=E2PSCFsa9yM">YouTube video: dropdown menus</a></li>
</ul>


<p>Parameters with large amounts of text, such as JSON or YAML, have 
been hard to edit before now as the text boxes are usually quite small. 
 A new button has been added next to them to instantly open a 
full-screen editor, just like template editing.</p>

<ul>
<li><a href="https://www.youtube.com/watch?v=ETzNfGTqc00">YouTube video: full-screen parameter editing</a></li>
</ul>


<p>Large fact values were truncated before, so SSH public keys and other
 long pieces of data couldn't be copied out of Foreman.  A new link next
 to each fact now shows the full value.</p>

<ul>
<li><a href="https://www.youtube.com/watch?v=EQVakzL49rQ">YouTube video: copying fact values</a></li>
</ul>


<p>Template editing has a new preview button, showing a rendered view of
 the unsaved template to help edit templates quickly and efficiencly.</p>

<ul>
<li><a href="https://www.youtube.com/watch?v=KQnaRAI8rf4">YouTube video: template previews</a></li>
</ul>


<p>Partition tables are also now a type of provisioning template, 
enabling the same editing, auditing and revision control that templates 
have available.</p>

<h4>Enhanced logging</h4>

<p>Logging in the Foreman application has been overhauled, with more 
granular logs and new configuration directives to control which type of 
messages are logged.</p>

<p>Using /etc/foreman/settings.yaml, the log level can now easily be 
changed (e.g. to debug) or specific types of logs enabled.  See <a href="http://theforeman.org/manuals/1.9/index.html#3.5.2ConfigurationOptions">Configuration Options</a> and <a href="http://theforeman.org/manuals/1.9/index.html#7.2Debugging">Debugging</a> for more information.</p>

<h4>Image provisioning with Libvirt</h4>

<p>When provisioning from images with Libvirt (KVM), Foreman only 
supported SSH-based provisioning by running a finish against the running
 VM with predetermined credentials.  With Foreman 1.9, support for 
cloud-init has been added, using a cloud-init disk.</p>

<p>To enable, set up a user_data template associated to the operating 
system and enable "user data" on the image under the compute resource.  
The template will be added to a temporary disk attached to the VM for 
cloud-init to consume on boot.</p>

<h4>New email notifications</h4>

<p>Administrators can now subscribe to a summary email of audit events, 
which track any changes by users to stored records (e.g. hosts) in 
Foreman.</p>

<p>Users building hosts can now subscribe to a notification when a host build completes, which is sent to the host's owner(s).</p>

<p>See <a href="http://theforeman.org/manuals/1.9/index.html#4.6EmailManagement">Email Management</a> for more information on changing notification settings.</p>

<div data-unique="Releasenotesfor1.9.2" name="Releasenotesfor1.9.2"></div><h3>Release notes for 1.9.2</h3>

<h4>Authentication and Authorization</h4>

<ul>
<li>Fix case insensitivity of LDAP usernames during user group sync (<a href="http://projects.theforeman.org/issues/11407">#11407</a>)</li>
</ul>


<h4>Compute resources and Hosts creation</h4>

<ul>
<li>Fix console connection error when SELinux is enforcing (<a href="http://projects.theforeman.org/issues/11608">#11608</a>)</li>
<li>Fix re-encoding of Base64 root passwords on host save (<a href="http://projects.theforeman.org/issues/11715">#11715</a>)</li>
</ul>


<h4>Puppet and Puppet integration</h4>

<ul>
<li>Fix updating of smart class parameter overrides from host form (<a href="http://projects.theforeman.org/issues/11807">#11807</a>)</li>
<li>Fix VLAN interface on bond being parsed as a bond interface (<a href="http://projects.theforeman.org/issues/10805">#10805</a>)</li>
<li>Fix error when importing environment named 'new' (<a href="http://projects.theforeman.org/issues/11037">#11037</a>)</li>
</ul>


<h4>Web Interface</h4>

<ul>
<li>Fix N+1 query when changing host group in bulk (<a href="http://projects.theforeman.org/issues/10589">#10589</a>)</li>
</ul>


<h4>Various fixes and features</h4>

<ul>
<li>Fix association of partition tables to default org/location (<a href="http://projects.theforeman.org/issues/11263">#11263</a>)</li>
<li>Fix error using foreman_url in default PXE template (<a href="http://projects.theforeman.org/issues/11723">#11723</a>)</li>
</ul>


<p><em>A full list of changes in 1.9.2 is available via <a href="http://projects.theforeman.org/rb/release/88">Redmine</a></em></p>

<div data-unique="Releasenotesfor1.9.1" name="Releasenotesfor1.9.1"></div><h3>Release notes for 1.9.1</h3>

<h4>API</h4>

<ul>
<li>Permit access to status API to all users (<a href="http://projects.theforeman.org/issues/6854">#6854</a>)</li>
<li>Fix update of BMC interface without specifying provider (<a href="http://projects.theforeman.org/issues/11258">#11258</a>)</li>
<li>Fix update of settings with unquoted integer values (<a href="http://projects.theforeman.org/issues/11673">#11673</a>)</li>
</ul>


<h4>Authentication and Authorization</h4>

<ul>
<li>Fix inefficient group searching on Active Directory (<a href="http://projects.theforeman.org/issues/10340">#10340</a>)</li>
<li>Fix case insensitivity of LDAP group names during user group sync (<a href="http://projects.theforeman.org/issues/11428">#11428</a>)</li>
</ul>


<h5>foreman-debug</h5>

<ul>
<li>Collect Apache config files in foreman.d directories (<a href="http://projects.theforeman.org/issues/11149">#11149</a>)</li>
</ul>


<h4>Compute resources and Hosts creation</h4>

<ul>
<li>Fix ability to remove interfaces with duplicate identifiers (<a href="http://projects.theforeman.org/issues/11031">#11031</a>)</li>
<li>Fix non-responsive domain dropdown menu after selecting Puppet environment (<a href="http://projects.theforeman.org/issues/11473">#11473</a>)</li>
<li>Fix ambiguous column error for non-admin users under orgs/locations (<a href="http://projects.theforeman.org/issues/11220">#11220</a>)</li>
<li>Fix display of parameters inherited from parent orgs/locations (<a href="http://projects.theforeman.org/issues/11650">#11650</a>)</li>
</ul>


<h4>Installer and packaging</h4>

<ul>
<li>Fix missing i386 ruby-rkerberos package on Debian/Ubuntu (<a href="http://projects.theforeman.org/issues/11438">#11438</a>)</li>
<li>Fix compatibility with mysql2 and Rails gem versions (<a href="http://projects.theforeman.org/issues/11719">#11719</a>)</li>
</ul>


<h4>Proxy and Services</h4>

<ul>
<li>Fix Puppet customrun provider errors on newer Ruby versions (<a href="http://projects.theforeman.org/issues/10940">#10940</a>)</li>
</ul>


<h4>Puppet and Puppet integration</h4>

<ul>
<li>Fix validation error on empty smart matcher when "Use Puppet default" is enabled (<a href="http://projects.theforeman.org/issues/11663">#11663</a>)</li>
</ul>


<h4>Security</h4>

<ul>
<li>Restrict users with view/destroy_reports permissions to view/delete reports only from hosts that are visible to them (<a href="http://theforeman.org/security.html#2015-5233">CVE-2015-5233</a>, <a href="http://projects.theforeman.org/issues/11579">#11579</a>)</li>
</ul>


<h4>Web Interface</h4>

<ul>
<li>Add ability to add widgets to the dashboard (<a href="http://projects.theforeman.org/issues/10929">#10929</a>)</li>
<li>Fix dashboard template error when a plugin is removed (<a href="http://projects.theforeman.org/issues/10850">#10850</a>)</li>
<li>Fix premature saving of class overrides when editing host or host group classes (<a href="http://projects.theforeman.org/issues/11095">#11095</a>)</li>
<li>Fix error accessing global parameters page with parameter containing "." (<a href="http://projects.theforeman.org/issues/11231">#11231</a>)</li>
<li>Fix missing translation extraction for email enabled checkbox (<a href="http://projects.theforeman.org/issues/11727">#11727</a>)</li>
<li>Fix host reports dropdown menu to include reports from the last day (<a href="http://projects.theforeman.org/issues/4468">#4468</a>)</li>
<li>Fix closing of org/location dropdown menu (<a href="http://projects.theforeman.org/issues/9293">#9293</a>)</li>
<li>Fix alignment of Select Action dropdown menu (<a href="http://projects.theforeman.org/issues/11111">#11111</a>)</li>
<li>Fix layout of subnet and domain association (<a href="http://projects.theforeman.org/issues/11014">#11014</a>)</li>
<li>Fix N+1 SQL query on user group list (<a href="http://projects.theforeman.org/issues/11621">#11621</a>)</li>
</ul>


<h4>Various fixes and features</h4>

<ul>
<li>Add hostgroup_title/os_title searches to audit search keywords (<a href="http://projects.theforeman.org/issues/11379">#11379</a>)</li>
<li>Fix overriding of global parameters from a parent host group (<a href="http://projects.theforeman.org/issues/9108">#9108</a>)</li>
<li>Fix database deadlock from host counter updates (<a href="http://projects.theforeman.org/issues/10133">#10133</a>)</li>
<li>Fix unique parameters database migration to rename duplicate data (<a href="http://projects.theforeman.org/issues/11339">#11339</a>)</li>
<li>Fix ability for plugins to extend the API view search paths (<a href="http://projects.theforeman.org/issues/11312">#11312</a>)</li>
<li>Fix passing of JSON settings through foreman-rake command (<a href="http://projects.theforeman.org/issues/11170">#11170</a>)</li>
<li>Fix ability to seed locked templates from plugins (<a href="http://projects.theforeman.org/issues/11619">#11619</a>)</li>
</ul>


<p><em>A full list of changes in 1.9.1 is available via <a href="http://projects.theforeman.org/rb/release/72">Redmine</a></em></p>

<div data-unique="Releasenotesfor1.9.0" name="Releasenotesfor1.9.0"></div><h3>Release notes for 1.9.0</h3>

<h4>API</h4>

<ul>
<li>Add vm_compute_attributes API call to retrieve compute attributes for a host (<a href="http://projects.theforeman.org/issues/10720">#10720</a>)</li>
<li>Add template_combinations API calls beneath host groups and environments (<a href="http://projects.theforeman.org/issues/9031">#9031</a>)</li>
<li>Add FOREMAN_APIPIE_LANGS languages override for development environments (<a href="http://projects.theforeman.org/issues/10815">#10815</a>)</li>
<li>Change unversioned API access from version 1 to version 2 (<a href="http://projects.theforeman.org/issues/10167">#10167</a>)</li>
<li>Change build_pxe_default API call method to POST from GET (<a href="http://projects.theforeman.org/issues/6976">#6976</a>)</li>
<li>Accept lowercase BMC provider names in host interfaces API (<a href="http://projects.theforeman.org/issues/10382">#10382</a>)</li>
<li>Fix validation and requirement for override_values to have a match and value (<a href="http://projects.theforeman.org/issues/9812">#9812</a>)</li>
<li>Fix build_pxe_default API call to return JSON response (<a href="http://projects.theforeman.org/issues/10715">#10715</a>)</li>
<li>Fix fact_values API call with a non-admin user (<a href="http://projects.theforeman.org/issues/9793">#9793</a>)</li>
<li>Fix compute resource brand names in compute resource documentation (<a href="http://projects.theforeman.org/issues/9632">#9632</a>)</li>
<li>Fix missing parameters in LDAP auth source documentation (<a href="http://projects.theforeman.org/issues/11033">#11033</a>)</li>
</ul>


<h4>Authentication and Authorization</h4>

<ul>
<li>Add debug logging to authorized resource lookups under <code>permissions</code> logger (<a href="http://projects.theforeman.org/issues/10736">#10736</a>)</li>
<li>Collect Foreman access log from Apache in foreman-debug (<a href="http://projects.theforeman.org/issues/10945">#10945</a>)</li>
<li>Fix authorization check for viewing compute resource VMs (<a href="http://projects.theforeman.org/issues/10683">#10683</a>)</li>
<li>Fix org/location edit forms to only show authorized resources (<a href="http://projects.theforeman.org/issues/7337">#7337</a>)</li>
<li>Fix permission for "All users" checkbox to be displayed on org/location edit (<a href="http://projects.theforeman.org/issues/7335">#7335</a>)</li>
<li>Fix permission names to be globally unique (<a href="http://projects.theforeman.org/issues/10492">#10492</a>)</li>
</ul>


<h4>CLI</h4>

<p>Hammer CLI was updated to 0.3.0.</p>

<h5>hammer-cli</h5>

<ul>
<li>Add normalizer converting id parameter values to numbers (<a href="http://projects.theforeman.org/issues/11137">#11137</a>)</li>
<li>Set Enum normalizer on enumerated values (<a href="http://projects.theforeman.org/issues/11033">#11033</a>)</li>
<li>Add missing options to preparser (<a href="http://projects.theforeman.org/issues/10902">#10902</a>)</li>
<li>Added support for deprecated options (<a href="http://projects.theforeman.org/issues/10564">#10564</a>)</li>
</ul>


<h5>hammer-cli-foreman</h5>

<ul>
<li>Add normalizer converting id parameter values to numbers (<a href="http://projects.theforeman.org/issues/11137">#11137</a>)</li>
<li>Docs - updated information about host creation</li>
<li>Added some rough docs showing HammerCLIForeman::Command</li>
<li>Adding a command for building PXE default (<a href="http://projects.theforeman.org/issues/3968">#3968</a>)</li>
<li>Turn off pagination by default (<a href="http://projects.theforeman.org/issues/10534">#10534</a>)</li>
<li>Can't set array parameters on hosts (<a href="http://projects.theforeman.org/issues/10547">#10547</a>)</li>
</ul>


<h5>foreman-debug</h5>

<ul>
<li>Add foreman-debug configuration file (<a href="http://projects.theforeman.org/issues/10701">#10701</a>)</li>
<li>Change foreman-debug to be non-interactive (<a href="http://projects.theforeman.org/issues/10284">#10284</a>)</li>
<li>Fix foreman-debug options -u and -a to be exclusive (<a href="http://projects.theforeman.org/issues/10699">#10699</a>)</li>
</ul>


<h4>Compute resources and Hosts creation</h4>

<ul>
<li>Add support for image provisioning on Libvirt with userdata and cloud-init disk (<a href="http://projects.theforeman.org/issues/10072">#10072</a>)</li>
<li>Add Cisco NX-OS POAP provisioning support (<a href="http://projects.theforeman.org/issues/10526">#10526</a>)</li>
<li>Change Windows installation media handling to use wimboot (<a href="http://projects.theforeman.org/issues/9299">#9299</a>)</li>
<li>Update fog to 1.32.0 (<a href="http://projects.theforeman.org/issues/10470">#10470</a>)</li>
<li>Change websockify proxy port to be randomized within 5910-5930 (<a href="http://projects.theforeman.org/issues/10703">#10703</a>)</li>
<li>Check presence of and restore DHCP records on host build (<a href="http://projects.theforeman.org/issues/1536">#1536</a>)</li>
<li>Validate presence of BMC smart proxy when adding managed BMC interface (<a href="http://projects.theforeman.org/issues/10727">#10727</a>)</li>
<li>Change root password and partition table to optional on hosts not in build mode (<a href="http://projects.theforeman.org/issues/9993">#9993</a>)</li>
<li>Fix creation of hosts with volumes on Google Compute Engine (<a href="http://projects.theforeman.org/issues/4551">#4551</a>)</li>
<li>Fix vSphere resource pool retrieval when cluster name and path differ (<a href="http://projects.theforeman.org/issues/10151">#10151</a>)</li>
<li>Fix handling of translated vSphere labels during VM cloning (<a href="http://projects.theforeman.org/issues/5630">#5630</a>)</li>
<li>Fix disabled boot from volume checkbox on OpenStack VMs (<a href="http://projects.theforeman.org/issues/10867">#10867</a>)</li>
<li>Fix configuration of alias interfaces during provisioning (<a href="http://projects.theforeman.org/issues/10666">#10666</a>)</li>
<li>Fix matching of virtual interfaces on compute resources, only match physicals (<a href="http://projects.theforeman.org/issues/10664">#10664</a>)</li>
</ul>


<h4>Installer and packaging</h4>

<ul>
<li>Improve error message generated by smart proxy registration failure (<a href="http://projects.theforeman.org/issues/10466">#10466</a>)</li>
<li>Update to scoped_search 3.x (<a href="http://projects.theforeman.org/issues/8502">#8502</a>)</li>
<li>Fix configuration of Brightbox PPA for Passenger packages on Ubuntu 12.04 (<a href="http://projects.theforeman.org/issues/11069">#11069</a>)</li>
</ul>


<p>Installer modules have been updated, see their respective changelogs for more detailed notes:</p>

<ul>
<li>puppet-dhcp, version 2.0.0 (<a href="https://github.com/theforeman/puppet-dhcp/blob/2.0.0/CHANGELOG.md#changelog">CHANGELOG</a>)</li>
<li>puppet-dns, version 3.0.0 (<a href="https://github.com/theforeman/puppet-dns/blob/3.0.0/CHANGELOG.md#changelog">CHANGELOG</a>)</li>
<li>puppet-git, version 1.4.1 (<a href="https://github.com/theforeman/puppet-git/blob/1.4.1/CHANGELOG.md#changelog">CHANGELOG</a>)</li>
<li>puppet-foreman, version 4.0.1 (<a href="https://github.com/theforeman/puppet-foreman/blob/4.0.1/CHANGELOG.md#changelog">CHANGELOG</a>)</li>
<li>puppet-foreman_proxy, version 2.3.0 (<a href="https://github.com/theforeman/puppet-foreman_proxy/blob/2.3.0/CHANGELOG.md#changelog">CHANGELOG</a>)</li>
<li>puppet-puppet, version 4.0.1 (<a href="https://github.com/theforeman/puppet-puppet/blob/4.0.1/CHANGELOG.md#changelog">CHANGELOG</a>)</li>
<li>puppet-tftp, version 1.5.1 (<a href="https://github.com/theforeman/puppet-tftp/blob/1.5.1/CHANGELOG.md#changelog">CHANGELOG</a>)</li>
</ul>


<h4>Proxy and Services</h4>

<ul>
<li>Add debug logging to all IPMI calls (<a href="http://projects.theforeman.org/issues/9709">#9709</a>)</li>
<li>Add API call to test BMC connection to IPMI (<a href="http://projects.theforeman.org/issues/9710">#9710</a>)</li>
<li>Extend BMC API to show available providers etc. (<a href="http://projects.theforeman.org/issues/9711">#9711</a>)</li>
<li>Add new startup script for the service under Windows (<a href="http://projects.theforeman.org/issues/9713">#9713</a>)</li>
<li>Add mechanism to support config file migrations (<a href="http://projects.theforeman.org/issues/10003">#10003</a>)</li>
<li>Add TFTP and DHCP options support for provisioning Cisco POAP (<a href="http://projects.theforeman.org/issues/10527">#10527</a>)</li>
<li>Add dhcp_omapi_port setting to change ISC dhcpd OMAPI port (<a href="http://projects.theforeman.org/issues/10264">#10264</a>)</li>
<li>Add smart proxy project README (<a href="http://projects.theforeman.org/issues/9121">#9121</a>)</li>
<li>Move smart_proxy_chef request classes to the plugin itself (<a href="http://projects.theforeman.org/issues/10895">#10895</a>)</li>
<li>Fix missing Windows gem dependencies in bundler (<a href="http://projects.theforeman.org/issues/10320">#10320</a>)</li>
<li>Fix Puppet module cache to compare timestamps to prevent immediate invalidation (<a href="http://projects.theforeman.org/issues/10941">#10941</a>)</li>
<li>Fix BMC API to respond with 501 when provider API is not implemented (<a href="http://projects.theforeman.org/issues/9840">#9840</a>)</li>
<li>Fix parsing of request body in BMC API to pass additional options (<a href="http://projects.theforeman.org/issues/10116">#10116</a>)</li>
<li>Fix error handler to print stacktrace at debug level (<a href="http://projects.theforeman.org/issues/10639">#10639</a>)</li>
<li>Fix logging of template proxy operations (<a href="http://projects.theforeman.org/issues/10769">#10769</a>)</li>
<li>Pin Puppet to 3.x due to incompatibility with 4.x (<a href="http://projects.theforeman.org/issues/10877">#10877</a>)</li>
<li>Fix spelling of "nonexistent" in messages (<a href="http://projects.theforeman.org/issues/10801">#10801</a>)</li>
<li>Fix DNS lookup hang during trusted host tests (<a href="http://projects.theforeman.org/issues/9919">#9919</a>)</li>
</ul>


<h4>Puppet and Puppet integration</h4>

<ul>
<li>Add outofsync_interval setting to control expected out of sync duration of reports (<a href="http://projects.theforeman.org/issues/10337">#10337</a>)</li>
<li>Change Puppet environment field on hosts to be optional (<a href="http://projects.theforeman.org/issues/9301">#9301</a>)</li>
<li>Prevent validation of default values when a class parameter uses the Puppet default (<a href="http://projects.theforeman.org/issues/9187">#9187</a>)</li>
<li>Fix association of OS and architecture during facts import (<a href="http://projects.theforeman.org/issues/10633">#10633</a>)</li>
<li>Fix duplicate interfaces created during import with bond interfaces (<a href="http://projects.theforeman.org/issues/10607">#10607</a>)</li>
<li>Fix assignment of bond interfaces with blank identifiers on import (<a href="http://projects.theforeman.org/issues/10888">#10888</a>)</li>
</ul>


<h4>Security</h4>

<ul>
<li>Disallow users with edit_users permission to change admin user passwords (<a href="http://theforeman.org/security.html#2015-3155">CVE-2015-3235</a>, <a href="http://projects.theforeman.org/issues/10829">#10829</a>)</li>
<li>Redirect HTTP requests to API to HTTPS when require_ssl is set (<a href="http://theforeman.org/security.html#2015-5152">CVE-2015-5152</a>, <a href="http://projects.theforeman.org/issues/11119">#11119</a>)</li>
<li>Add audits email summary for a regular report of audit events (<a href="http://projects.theforeman.org/issues/1213">#1213</a>)</li>
<li>Add host build completion email notification (<a href="http://projects.theforeman.org/issues/1510">#1510</a>)</li>
<li>Encrypt LDAP auth source passwords when stored at rest in database (<a href="http://projects.theforeman.org/issues/10263">#10263</a>)</li>
<li>Change default root password hash from MD5 to SHA256 (<a href="http://projects.theforeman.org/issues/10289">#10289</a>)</li>
<li>Fix SELinux module building on EL7.1 with apache_content_template macro (<a href="http://projects.theforeman.org/issues/9791">#9791</a>)</li>
<li>Refactor require_ssl code to use Rails force_ssl feature (<a href="http://projects.theforeman.org/issues/10471">#10471</a>)</li>
</ul>


<h4>Web Interface</h4>

<ul>
<li>Add new select box styling to enable searching on every dropdown menu (<a href="http://projects.theforeman.org/issues/10641">#10641</a>)</li>
<li>Change dashboard to store widgets in the DB and support minimizing (<a href="http://projects.theforeman.org/issues/8106">#8106</a>)</li>
<li>Add full screen edit button to parameter override text boxes (<a href="http://projects.theforeman.org/issues/3856">#3856</a>)</li>
<li>Add button to show full fact values for easy copying (<a href="http://projects.theforeman.org/issues/9194">#9194</a>)</li>
<li>Add axis labels and reposition legends on charts (<a href="http://projects.theforeman.org/issues/9454">#9454</a>)</li>
<li>Add preview tab to template editing form for live rendering of edits (<a href="http://projects.theforeman.org/issues/11035">#11035</a>)</li>
<li>Add caps lock warning to password fields (<a href="http://projects.theforeman.org/issues/8898">#8898</a>)</li>
<li>Rearrange overrides section in smart class parameters and host parameters pages (<a href="http://projects.theforeman.org/issues/8214">#8214</a>, <a href="http://projects.theforeman.org/issues/8217">#8217</a>)</li>
<li>Rearrange hosts and provisioning menus to follow usual configuration order (<a href="http://projects.theforeman.org/issues/9334">#9334</a>)</li>
<li>Reorganize setting categories to be more logical (<a href="http://projects.theforeman.org/issues/8566">#8566</a>)</li>
<li>Fix host delete confirmation box to include hostname and VM deletion warning (<a href="http://projects.theforeman.org/issues/9879">#9879</a>)</li>
<li>Fix error during second run of orchestration from Discovery (<a href="http://projects.theforeman.org/issues/9424">#9424</a>)</li>
<li>Fix display of long org/location names in current context (<a href="http://projects.theforeman.org/issues/8861">#8861</a>)</li>
<li>Fix display of messages on smart proxy errors on Certificates pages (<a href="http://projects.theforeman.org/issues/9674">#9674</a>)</li>
<li>Fix highlight of error message when Puppet classes are not available in environment (<a href="http://projects.theforeman.org/issues/10738">#10738</a>)</li>
<li>Fix ambiguity in token_duration setting help text (<a href="http://projects.theforeman.org/issues/10194">#10194</a>)</li>
<li>Rename "mail" to "email" across the user interface for consistency (<a href="http://projects.theforeman.org/issues/8525">#8525</a>)</li>
<li>Fix sending of template parameters in form submissions (<a href="http://projects.theforeman.org/issues/10849">#10849</a>)</li>
<li>Fix activation of second autocomplete field on pages (<a href="http://projects.theforeman.org/issues/10817">#10817</a>)</li>
<li>Fix failed login notification from remaining on login screen (<a href="http://projects.theforeman.org/issues/10729">#10729</a>)</li>
<li>Fix natural ordering of log messages in reports (<a href="http://projects.theforeman.org/issues/10216">#10216</a>)</li>
<li>Fix quickstart URL in README (<a href="http://projects.theforeman.org/issues/10518">#10518</a>)</li>
<li>Fix parameter name "spaces" error message to be consistent (<a href="http://projects.theforeman.org/issues/9439">#9439</a>)</li>
<li>Fix typo in build PXE default confirmation box (<a href="http://projects.theforeman.org/issues/9806">#9806</a>)</li>
<li>Fix 404 error when selecting Puppet environment on host group form (<a href="http://projects.theforeman.org/issues/9444">#9444</a>)</li>
<li>Refactor template full screen mode for reusability (<a href="http://projects.theforeman.org/issues/10638">#10638</a>)</li>
</ul>


<h4>Various fixes and features</h4>

<ul>
<li>Add custom logger capabilities and extended logging configuration (<a href="http://projects.theforeman.org/issues/10487">#10487</a>)</li>
<li>Add debug-level logging of LDAP calls and queries (<a href="http://projects.theforeman.org/issues/10406">#10406</a>)</li>
<li>Add consistent deprecation warnings for internal and external APIs (<a href="http://projects.theforeman.org/issues/10635">#10635</a>)</li>
<li>Change trends to aggregate and reduce data points (<a href="http://projects.theforeman.org/issues/10439">#10439</a>)</li>
<li>Change logging of backtraces to regular log levels and remove truncation (<a href="http://projects.theforeman.org/issues/10713">#10713</a>)</li>
<li>Change Fog library loading to only load providers in active use (<a href="http://projects.theforeman.org/issues/8516">#8516</a>)</li>
<li>Allow locations and organizations with the same names (<a href="http://projects.theforeman.org/issues/10660">#10660</a>)</li>
<li>Update documentation for reports expiry rake task (<a href="http://projects.theforeman.org/issues/10513">#10513</a>)</li>
<li>Allow configuration of logging level from settings.yaml (<a href="http://projects.theforeman.org/issues/6524">#6524</a>)</li>
<li>Add helper for plugins to access data about created roles (<a href="http://projects.theforeman.org/issues/11206">#11206</a>)</li>
<li>Fix audit records being created on counter updates (<a href="http://projects.theforeman.org/issues/10656">#10656</a>)</li>
<li>Fix audit records being created on Puppet class host changes (<a href="http://projects.theforeman.org/issues/10288">#10288</a>)</li>
<li>Fix deletion of smart class parameter overrides on host deletion (<a href="http://projects.theforeman.org/issues/10915">#10915</a>)</li>
<li>Fix slow report fetch SQL query under PostgreSQL on dashboard (<a href="http://projects.theforeman.org/issues/10879">#10879</a>)</li>
<li>Fix unnecessary SQL queries when orgs/locations are disabled (<a href="http://projects.theforeman.org/issues/6332">#6332</a>)</li>
<li>Fix N+1 SQL query on host and host group forms (<a href="http://projects.theforeman.org/issues/9969">#9969</a>)</li>
<li>Fix uniq calls to run in database (<a href="http://projects.theforeman.org/issues/10583">#10583</a>)</li>
<li>Fix sort.uniq call ordering to improve performance (<a href="http://projects.theforeman.org/issues/10584">#10584</a>)</li>
<li>Fix accessible host groups to remove unnecessary sorting (<a href="http://projects.theforeman.org/issues/3016">#3016</a>)</li>
<li>Fix in-memory attribute fetches with more specific database calls (<a href="http://projects.theforeman.org/issues/9593">#9593</a>)</li>
<li>Fix wrapping of host parameter table headers in Japanese (<a href="http://projects.theforeman.org/issues/7532">#7532</a>)</li>
<li>Fix unlocalized period in org/locations help page (<a href="http://projects.theforeman.org/issues/7454">#7454</a>)</li>
<li>Fix formatting of Puppet error email notifications (<a href="http://projects.theforeman.org/issues/9998">#9998</a>)</li>
<li>Fix foreman_url setting to be mandatory (<a href="http://projects.theforeman.org/issues/9613">#9613</a>)</li>
<li>Fix validation of unattended_url field to check protocols (<a href="http://projects.theforeman.org/issues/5649">#5649</a>)</li>
<li>Fix user groups to disallow empty names (<a href="http://projects.theforeman.org/issues/3711">#3711</a>)</li>
<li>Fix grammatical mistakes in foreman-rake man page (<a href="http://projects.theforeman.org/issues/10921">#10921</a>)</li>
<li>Fix seeding of org/locations when one already exists (<a href="http://projects.theforeman.org/issues/10695">#10695</a>)</li>
<li>Fix Ruby deprecation warning in LDAP auth source (<a href="http://projects.theforeman.org/issues/4769">#4769</a>)</li>
<li>Fix warnings from duplicate keys in hashes (<a href="http://projects.theforeman.org/issues/10437">#10437</a>)</li>
<li>Fix intermittent database deadlock during integration tests (<a href="http://projects.theforeman.org/issues/10507">#10507</a>)</li>
<li>Fix running of auth source tests (<a href="http://projects.theforeman.org/issues/9957">#9957</a>)</li>
<li>Fix password crypt tests when running on OS X (<a href="http://projects.theforeman.org/issues/9551">#9551</a>)</li>
</ul>


<h4>Various internal refactorings</h4>

<ul>
<li>Add test to check trends reduce task idempotency (<a href="http://projects.theforeman.org/issues/10439">#10439</a>)</li>
<li>Add helper method to check if a smart proxy has a feature (<a href="http://projects.theforeman.org/issues/10287">#10287</a>)</li>
<li>Add helper factory for host group provisioning (<a href="http://projects.theforeman.org/issues/10780">#10780</a>)</li>
<li>Change partition tables to be a type of provisioning template (<a href="http://projects.theforeman.org/issues/7096">#7096</a>)</li>
<li>Refactorings for Rails 4 compatibility (<a href="http://projects.theforeman.org/issues/10409">#10409</a>)</li>
<li>Refactor link_to confirm option for Rails 4 compatibility (<a href="http://projects.theforeman.org/issues/7574">#7574</a>)</li>
<li>Refactor boolean conversion logic into common class (<a href="http://projects.theforeman.org/issues/10402">#10402</a>)</li>
<li>Refactor host managed logic in NIC models (<a href="http://projects.theforeman.org/issues/10442">#10442</a>)</li>
<li>Refactor host OS access for consistency (<a href="http://projects.theforeman.org/issues/9397">#9397</a>)</li>
<li>Remove deprecated smart proxy scopes (<a href="http://projects.theforeman.org/issues/10899">#10899</a>)</li>
<li>Remove unused columns from hosts table (<a href="http://projects.theforeman.org/issues/10861">#10861</a>)</li>
<li>Remove setting cache clear debug logging (<a href="http://projects.theforeman.org/issues/10887">#10887</a>)</li>
</ul>


<p><em>A full list of changes in 1.9.0 is available via <a href="http://projects.theforeman.org/rb/release/35">Redmine</a></em></p>

<div data-unique="Upgradewarnings" name="Upgradewarnings"></div><h3>Upgrade warnings</h3>

<ul>
<li>IPMI BMC support now defaults to the lan20 driver, but this is not configurable (<a href="http://projects.theforeman.org/issues/10112">#10112</a>)</li>
<li>Virtual machine consoles now use ports between 5910 and 5930 (inclusive) randomly rather than sequentially,
so ensure all ports in this range are open in firewalls between Foreman and web browsers (<a href="http://projects.theforeman.org/issues/10703">#10703</a>)</li>
</ul>


<div data-unique="Deprecations" name="Deprecations"></div><h3>Deprecations</h3>

<p>The following deprecations may affect API users, plugin authors or advanced users.</p>

<ul>
<li>GET build_pxe_default API call is deprecated, API users should use POST instead</li>
<li>Unversioned API access now uses APIv2, APIv1 users should see <a href="http://theforeman.org/manuals/1.9/index.html#5.1.6APIVersioning">section 5.1.6</a></li>
<li>"Config templates" in the API were renamed to "provisioning 
templates" - both work in APIv2, but future API versions will only use 
provisioning templates</li>
<li>Deprecated <code>SmartProxy.*_proxies</code> accessors were removed</li>
<li>Internal APIs now have an explicit "deadline" version at which they'll be removed, starting with Foreman 1.11 (<a href="http://projects.theforeman.org/projects/foreman/wiki/How_to_Create_a_Plugin#Foreman-compatibility">more info</a>)</li>
<li><code>MS</code> provider in Smart-Proxy DHCP module is deprecated and will be removed in future releases</li>
</ul>


<div data-unique="Contributors" name="Contributors"></div><h3>Contributors</h3>

<p>We'd like to thank the following people who contributed to the Foreman 1.9 release:</p>

<p>Aaron Stone, Adam Price, Adam Ruzicka, Alejandro Ramirez, 
alongoldboim, Andreas Lindh, Arnold Bechtoldt, Ashay Humane, Ashton 
Davis, Avi Miller, Avi Tal, Baptiste AGASSE, Benjamin Papillon, bmerjil,
 Bryan Kearney, bse, Carmela Rubios, Chad Walstrom, Christian Arnold, 
Christina Gurski, Christine Fouant, Corey Osman, Craig Parker, Cristian 
Falcas, Dan Foster, Daniel Lobato Garcia, David Blaisonneau, David 
Davis, David O'Brien, dazole, Derek, Dmitri Dolguikh, Dmitry Kireev, 
Dominic Cleal, Dustin Morgan, Dustin Tsang, Eddie Hurtig, Eike Stehr, 
Eric D. Helms, Eric-Olivier Lamey, Ettore Atalan, Ewoud Kohl van 
Wijngaarden, Federico Voges, Fernando Carolo, Flamarion Jorge, Florian 
Maier, Florian Mueller, Francois Herbert, Gerwin Krist, gottaloveit, 
Greg Potts, Greg Sutcliffe, Ivan Neas, Jan Pazdziora, Joey D, Johan 
Swensson, John Kim, John McCabe, johscheuer, Jon McKenzie, Joseph 
Mitchell Magen, jslatten, Julien Pivotto, Justin Sherrill, karmab, 
Keenan Brock, Klaas Demter, Konstantin Manna, krizzo, Kyle Gordon, Lucas
 Yamanishi, Luk Zapletal, Marek Huln, Martin Baovsk, Martin Lariz, 
Martin Matuska, Martin Pfeifer, Mathieu Parent, Matt Chesler, Mattias 
Giese, Michael Moll, Mickal Canvet, Mike Burns, Ohad Levy, Ondrej 
Prazak, Ori Rabin, Partha Aji, Pavel Moravec, Phirince Philip, 
ripcurld00d, Sana Khan, Sergio Ocn, Sherif Nagy, Shimon Shtein, Shlomi 
Zadok, Shuji Yamada, Silvia Perez, stefanlasiewski, Stefan Meyer, 
Stephen Benjamin, Steve Milner, Steven Bambling, Timo Goebel, Tomas 
Strachota, Tom Caspy, Tomer Brisker, Tom McKay, Trey Dockendorf, 
untsakas, Vanya Jauhal, Vladimir Pavlov, Walden Raines, Walter Huf, 
William Hefter, xenlo, Zdenek Janda.</p>

<p>As well as all users who helped test releases, report bugs and provide feedback on the project.</p>

<div data-unique="2.Quickstart" name="2.Quickstart"></div><h1>2. Quickstart</h1>

<p>The Foreman installer is a collection of Puppet modules that installs
 everything required for a full working Foreman setup.  It uses native 
OS packaging (e.g. RPM and .deb packages) and adds necessary 
configuration for the complete installation.</p>

<p>Components include the Foreman web UI, Smart Proxy, Passenger (for 
the puppet master and Foreman itself), and optionally TFTP, DNS and DHCP
 servers.  It is configurable and the Puppet modules can be read or run 
in "no-op" mode to see what changes it will make.</p>

<h4>Supported platforms</h4>

<ul>
<li>CentOS, Scientific Linux or Oracle Linux 6 or 7</li>
<li>Debian 8 (Jessie) or 7 (Wheezy)</li>
<li>Fedora 19</li>
<li>Red Hat Enterprise Linux 6 or 7</li>
<li>Ubuntu 12.04 (Precise) or 14.04 (Trusty)</li>
</ul>


<p>Other operating systems will need to use alternative installation methods (see the manual).</p>

<div data-unique="2.1Installation" name="2.1Installation"></div><h2>2.1 Installation</h2>

<p><a href="http://theforeman.org/manuals/1.9/index.html#3.2ForemanInstaller">The Foreman installer</a>
 uses Puppet to install Foreman. This guide assumes that you have a 
newly installed operating system, on which the installer will setup 
Foreman, a Puppet master with Passenger and the <a href="http://theforeman.org/manuals/1.9/index.html#4.3SmartProxies">Smart Proxy</a> by default.</p>

<h4>Select operating system</h4>

<script type="text/javascript">
function update_quickstart_os(select) {
  var os = select.value;
  $(".quickstart_os").hide();
  if (os && os != 'none') {
    $(".quickstart_os_"+os).show();
  } else {
    $(".quickstart_os_none").show();
  }
}
</script>


<p>To provide specific installation instructions, please select your operating system:
<select onchange="update_quickstart_os(this);">
  <option selected="selected" value="none">-- select operating system --</option>
  <option value="el6">CentOS, Scientific Linux or Oracle Linux 6</option>
  <option value="el7">CentOS, Scientific Linux or Oracle Linux 7</option>
  <option value="debian8">Debian 8 (Jessie)</option>
  <option value="debian7">Debian 7 (Wheezy)</option>
  <option value="fedora19">Fedora 19</option>
  <option value="rhel6">Red Hat Enterprise Linux 6</option>
  <option value="rhel7">Red Hat Enterprise Linux 7</option>
  <option value="ubuntu1204">Ubuntu 12.04 (Precise)</option>
  <option value="ubuntu1404">Ubuntu 14.04 (Trusty)</option>
</select></p>

<h4>Repositories</h4>

<div class="quickstart_os quickstart_os_none">
  <i>No operating system selected.</i>
</div>




<div class="quickstart_os quickstart_os_rhel6">
  <p>First, enable the RHEL Optional and RHSCL repos:</p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash">yum-config-manager --enable rhel-6-server-optional-rpms rhel-server-rhscl-6-rpms</code></pre></div>


  <p>
    Check the repositories are enabled with <code>yum repolist</code> after running the above command, as it can silently fail when subscription does not provide it.
    More information about accessing RH Software Collections (RHSCL) is available from the <a href="https://access.redhat.com/solutions/472793">Customer Portal</a>.
  </p>

  <p>If you're using RH Satellite 5, you should instead sync and enable the channels there.</p>
</div>




<div class="quickstart_os quickstart_os_rhel7">
  <p>First, enable the RHEL Optional and RHSCL repos:</p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash">yum-config-manager --enable rhel-7-server-optional-rpms rhel-server-rhscl-7-rpms</code></pre></div>


  <p>
    Check the repositories are enabled with <code>yum repolist</code> after running the above command, as it can silently fail when subscription does not provide it.
    More information about accessing RH Software Collections (RHSCL) is available from the <a href="https://access.redhat.com/solutions/472793">Customer Portal</a>.
  </p>

  <p>If you're using RH Satellite 5, you should instead sync and enable the channels there.</p>
</div>




<div class="quickstart_os quickstart_os_fedora19 alert alert-info">
  Foreman on Fedora 19 has some known issues, and we'd recommend using a different distro instead.
</div>




<div class="quickstart_os quickstart_os_rhel6 quickstart_os_el6">
  <p>
    Using a recent version of Puppet is recommended, which is available from the Puppet Labs repository.
    You may skip this and use the older version from EPEL without a problem, however it has reduced community support.
  </p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash">rpm -ivh http://yum.puppetlabs.com/puppetlabs-release-el-6.noarch.rpm</code></pre></div>

</div>




<div class="quickstart_os quickstart_os_rhel6">
  <p>Enable the EPEL (Extra Packages for Enterprise Linux) and the Foreman repos:</p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash">rpm -ivh http://dl.fedoraproject.org/pub/epel/epel-release-latest-6.noarch.rpm
yum -y install http://yum.theforeman.org/releases/1.9/el6/x86_64/foreman-release.rpm</code></pre></div>

</div>




<div class="quickstart_os quickstart_os_el6">
  <p>Enable the EPEL (Extra Packages for Enterprise Linux) and the Foreman repos:</p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash">yum -y install epel-release http://yum.theforeman.org/releases/1.9/el6/x86_64/foreman-release.rpm</code></pre></div>

</div>




<div class="quickstart_os quickstart_os_rhel7 quickstart_os_el7">
  <p>
    Using a recent version of Puppet is recommended, which is available from the Puppet Labs repository.
    You may skip this and use the older version from EPEL without a problem, however it has reduced community support.
  </p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash">rpm -ivh http://yum.puppetlabs.com/puppetlabs-release-el-7.noarch.rpm</code></pre></div>

</div>




<div class="quickstart_os quickstart_os_rhel7">
  <p>Enable the EPEL (Extra Packages for Enterprise Linux) and the Foreman repos:</p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash">rpm -ivh http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
yum -y install http://yum.theforeman.org/releases/1.9/el7/x86_64/foreman-release.rpm</code></pre></div>

</div>




<div class="quickstart_os quickstart_os_el7">
  <p>Enable the EPEL (Extra Packages for Enterprise Linux) and the Foreman repos:</p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash">yum -y install epel-release http://yum.theforeman.org/releases/1.9/el7/x86_64/foreman-release.rpm</code></pre></div>

</div>




<div class="quickstart_os quickstart_os_fedora19">
  <p>
    You may optionally use the latest available version of Puppet from the Puppet Labs repositories, which is
    a bit newer than that provided by Fedora itself.
  </p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash">rpm -ivh http://yum.puppetlabs.com/puppetlabs-release-fedora-19.noarch.rpm</code></pre></div>


  <p>Enable the Foreman repo:</p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash">yum -y install http://yum.theforeman.org/releases/1.9/f19/x86_64/foreman-release.rpm</code></pre></div>

</div>




<div class="quickstart_os quickstart_os_debian8">
  <p>
    Note that Puppet Labs does not provide Puppet 3.x packages for jessie.
  </p>

  <p>Enable the Foreman repo:</p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">echo</span> <span class="s2">"deb http://deb.theforeman.org/ jessie 1.9"</span> &gt; /etc/apt/sources.list.d/foreman.list
<span class="nb">echo</span> <span class="s2">"deb http://deb.theforeman.org/ plugins 1.9"</span> &gt;&gt; /etc/apt/sources.list.d/foreman.list
wget -q http://deb.theforeman.org/pubkey.gpg -O- <span class="p">|</span> apt-key add -</code></pre></div>

</div>




<div class="quickstart_os quickstart_os_debian7">
  <p>
    Using a recent version of Puppet is recommended, which is available from the Puppet Labs repository.
    You may skip this and use the older version from Debian without a problem, however it has reduced community support.
  </p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash">apt-get -y install ca-certificates
wget https://apt.puppetlabs.com/puppetlabs-release-wheezy.deb
dpkg -i puppetlabs-release-wheezy.deb</code></pre></div>


  <p>Enable the Foreman repo:</p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">echo</span> <span class="s2">"deb http://deb.theforeman.org/ wheezy 1.9"</span> &gt; /etc/apt/sources.list.d/foreman.list
<span class="nb">echo</span> <span class="s2">"deb http://deb.theforeman.org/ plugins 1.9"</span> &gt;&gt; /etc/apt/sources.list.d/foreman.list
wget -q http://deb.theforeman.org/pubkey.gpg -O- <span class="p">|</span> apt-key add -</code></pre></div>

</div>




<div class="quickstart_os quickstart_os_ubuntu1204">
  <p>
    Using a recent version of Puppet is recommended, which is available from the Puppet Labs repository.
    You may skip this and use the older version from Ubuntu without a problem, however it has reduced community support.
  </p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash">apt-get -y install ca-certificates
wget https://apt.puppetlabs.com/puppetlabs-release-precise.deb
dpkg -i puppetlabs-release-precise.deb</code></pre></div>


  <p>Enable the Foreman repo:</p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">echo</span> <span class="s2">"deb http://deb.theforeman.org/ precise 1.9"</span> &gt; /etc/apt/sources.list.d/foreman.list
<span class="nb">echo</span> <span class="s2">"deb http://deb.theforeman.org/ plugins 1.9"</span> &gt;&gt; /etc/apt/sources.list.d/foreman.list
wget -q http://deb.theforeman.org/pubkey.gpg -O- <span class="p">|</span> apt-key add -</code></pre></div>

</div>




<div class="quickstart_os quickstart_os_ubuntu1404">
  <p>
    You may optionally use the latest available version of Puppet from the Puppet Labs repositories, which is
    a bit newer than that provided by Ubuntu itself.
  </p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash">apt-get -y install ca-certificates
wget https://apt.puppetlabs.com/puppetlabs-release-trusty.deb
dpkg -i puppetlabs-release-trusty.deb</code></pre></div>


  <p>Enable the Foreman repo:</p>


<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">echo</span> <span class="s2">"deb http://deb.theforeman.org/ trusty 1.9"</span> &gt; /etc/apt/sources.list.d/foreman.list
<span class="nb">echo</span> <span class="s2">"deb http://deb.theforeman.org/ plugins 1.9"</span> &gt;&gt; /etc/apt/sources.list.d/foreman.list
wget -q http://deb.theforeman.org/pubkey.gpg -O- <span class="p">|</span> apt-key add -</code></pre></div>

</div>


<h4>Downloading the installer</h4>

<div class="quickstart_os quickstart_os_none">
  <i>No operating system selected.</i>
</div>




<div class="quickstart_os quickstart_os_rhel6 quickstart_os_el6 quickstart_os_rhel7 quickstart_os_el7 quickstart_os_fedora19">

<div class="highlight"><pre><code class="language-bash" data-lang="bash">yum -y install foreman-installer</code></pre></div>

</div>




<div class="quickstart_os quickstart_os_debian8 quickstart_os_debian7 quickstart_os_ubuntu1204 quickstart_os_ubuntu1404">

<div class="highlight"><pre><code class="language-bash" data-lang="bash">apt-get update <span class="o">&amp;&amp;</span> apt-get -y install foreman-installer</code></pre></div>

</div>


<h4>Running the installer</h4>

<div class="quickstart_os quickstart_os_ubuntu1204 quickstart_os_ubuntu1404 alert alert-info">
  Ensure that <code>ping $(hostname -f)</code> shows the real IP address, not 127.0.1.1.  Change or remove this entry from /etc/hosts if present.
</div>


<p>The installation run is non-interactive, but the configuration can be customized by supplying any of the options listed in <code>foreman-installer --help</code>, or by running <code>foreman-installer -i</code> for interactive mode.  More examples are given in the <a href="http://theforeman.org/manuals/1.9/index.html#3.2.2InstallerOptions">Installation Options</a> section.  Adding <code>-v</code> will disable the progress bar and display all changes.  To run the installer, execute:</p>

<div class="quickstart_os quickstart_os_none quickstart_os_el6 quickstart_os_el7 quickstart_os_rhel6 quickstart_os_rhel7 quickstart_os_debian8 quickstart_os_debian7 quickstart_os_ubuntu1204 quickstart_os_ubuntu1404">

<div class="highlight"><pre><code class="language-bash" data-lang="bash">foreman-installer</code></pre></div>

</div>


<p>After it completes, the installer will print some details about where
 to find Foreman and the Smart Proxy and Puppet master if they were 
installed along Foreman. Output should be similar to this:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">* Foreman is running at https://theforeman.example.com
      Initial credentials are admin / 3ekw5xtyXCoXxS29
  * Foreman Proxy is running at https://theforeman.example.com:8443
  * Puppetmaster is running at port 8140
  The full log is at /var/log/foreman-installer/foreman-installer.log</code></pre></div>


<div data-unique="2.2PuppetManagement" name="2.2PuppetManagement"></div><h2>2.2 Puppet Management</h2>

<p>After installation, the Foreman installer will have set up a puppet 
master on the host, fully integrated with Foreman.  First run the Puppet
 agent on the Foreman host which will send the first Puppet report to 
Foreman, automatically creating the host in Foreman's database.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">puppet agent --test</code></pre></div>




<div class="alert alert-info">Puppet 3+ will show a warning the first time that the node can't be found, this can be ignored.</div>


<p>In Foreman, click on the <em>Hosts</em> tab and your Foreman host 
should be visible in the list with an "O" status.  This indicates its 
status is OK, with no changes made on the last Puppet run.</p>

<h4>Downloading a Puppet module</h4>

<p>Next, we'll install a Puppet module for managing the NTP service.  If
 you have Puppet 2.7.14 or higher, install the module automatically from
 <a href="http://forge.puppetlabs.com/">Puppet Forge</a> to our "production" environment (the default):</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">puppet module install -i /etc/puppet/environments/production/modules saz/ntp</code></pre></div>


<p>On older versions, <a href="http://forge.puppetlabs.com/saz/ntp">download the tar.gz</a> and unpack to <code>/etc/puppet/environments/production/modules/</code>.  Rename the directory to "ntp", removing the author and version number.</p>

<p>In Foreman, go to <em>Configure &gt; Puppet Classes</em> and click <em>Import from hostname</em>
 (top right) to read the available Puppet classes from the puppet master
 and populate Foreman's database.  The "ntp" class will appear in the 
Puppet class list if installed correctly.</p>

<h4>Using the Puppet module</h4>

<p>Click on the "ntp" class in the list, change to the <em>Smart Class Parameters</em> tab and select the <em>server_list</em> parameter on the left hand side.  Tick the <em>Override</em>
 checkbox so Foreman manages the "server_list" parameter of the class 
and change the default value if desired, before submitting the page.</p>

<ul>
<li>More info: <a href="http://theforeman.org/manuals/1.9/index.html#4.2.5ParameterizedClasses">Parameterized classes documentation</a></li>
<li>Screencast: <a href="http://www.youtube.com/watch?v=Ksr0tilbmcc">Parameterized class support in Foreman</a></li>
</ul>


<p>Change back to the <em>Hosts</em> tab and click <em>Edit</em> on the Foreman host.  On the <em>Puppet Classes</em> tab, expand the <em>ntp</em> module and click the + icon to add the <em>ntp</em> class to the host, then save the host.</p>

<div class="alert alert-info">Managed parameters can be overridden when editing an individual host from its <i>Parameters</i> tab.</div>


<p>Clicking the <em>YAML</em> button when back on the host page will show the <em>ntp</em> class and the server_list parameter, as passed to Puppet via the ENC (external node classifier) interface.  Re-run <code>puppet agent --test</code> on the Foreman host to see the NTP service automatically reconfigured by Puppet and the NTP module.</p>

<h4>Adding more Puppet-managed hosts</h4>

<p>Other hosts with Puppet agents installed can use this puppet master by setting <code>server = foreman.example.com</code> in puppet.conf.  Sign their certificates in Foreman by going to <em>Infrastructure &gt; Smart Proxies &gt; Certificates</em> or using <code>puppet cert list</code> and <code>puppet cert sign</code> on the puppet master.</p>

<p>Puppet classes can be added to host groups in Foreman instead of 
individual hosts, enabling a standard configuration of many hosts 
simultaneously.  Host groups are typically used to represent server 
roles.</p>

<div data-unique="3.InstallingForeman" name="3.InstallingForeman"></div><h1>3. Installing Foreman</h1>

<p>There are several different methods of installing Foreman. The 
recommended way
is with the puppet based Foreman Installer but you may also use your 
distribution's package manager or install directly from source.</p>

<div data-unique="3.1SystemRequirements" name="3.1SystemRequirements"></div><h2>3.1 System Requirements</h2>

<p>This sections outlines the system requirements for an installation of
 Foreman.  This will cover the hardware requirements, OS requirements 
and firewall requirements.  This includes variations for all supported 
database types.</p>

<div data-unique="3.1.1SupportedPlatforms" name="3.1.1SupportedPlatforms"></div><h3>3.1.1 Supported Platforms</h3>

<p>The following operating systems are supported by the installer, have packages and are tested for deploying Foreman:</p>

<ul>
<li>Red Hat Enterprise Linux 6 or 7

<ul>
<li><a href="http://fedoraproject.org/wiki/EPEL/FAQ#How_can_I_install_the_packages_from_the_EPEL_software_repository.3F">EPEL</a> is required</li>
<li>Enable the Optional and RHSCL 1 repositories/channels:

<ul>
<li><code>yum-config-manager --enable rhel-6-server-optional-rpms rhel-server-rhscl-6-rpms</code></li>
<li>check the above repositories because the command can silently fail when subscription does not provide it: <code>yum repolist</code></li>
</ul>
</li>
<li>Apply all SELinux-related erratas.</li>
</ul>
</li>
<li>CentOS, Scientific Linux or Oracle Linux 6 or 7

<ul>
<li><a href="http://fedoraproject.org/wiki/EPEL/FAQ#How_can_I_install_the_packages_from_the_EPEL_software_repository.3F">EPEL</a> is required</li>
</ul>
</li>
<li>Fedora 19</li>
<li>Debian 8 (Jessie)</li>
<li>Debian 7 (Wheezy)</li>
<li>Ubuntu 14.04 (Trusty)</li>
<li>Ubuntu 12.04 (Precise)</li>
</ul>


<p>It is recommended to apply all OS updates if possible.</p>

<p>All platforms will require Puppet 2.7 or higher. Puppet 3.x is supported and may be installed from the Puppet Labs repositories.</p>

<p>Other operating systems will need to use alternative installation methods, such as from source.</p>

<p>The following operating systems are known to install successfully from Foreman:</p>

<ul>
<li>RHEL and derivatives (CentOS, Scientific Linux, Oracle Linux) 3+</li>
<li>Fedora</li>
<li>Ubuntu</li>
<li>Debian</li>
<li>OpenSUSE</li>
<li>SLES</li>
<li>CoreOS</li>
<li>Solaris</li>
<li>FreeBSD</li>
<li>Juniper Junos</li>
<li>Cisco NX-OS</li>
</ul>


<div data-unique="3.1.2PuppetCompatibility" name="3.1.2PuppetCompatibility"></div><h3>3.1.2 Puppet Compatibility</h3>

<p>Foreman integrates with Puppet and Facter in a few places, but 
generally using a recent, stable version will be fine.  The exact 
versions of Puppet and Facter that Foreman is compatible with are listed
 below.</p>

<table class="table table-bordered table-condensed">
  <tbody><tr>
    <th>Puppet version</th>
    <th>Foreman installer</th>
    <th>Smart proxy</th>
    <th><a href="http://theforeman.org/manuals/1.9/index.html#3.5.4PuppetReports">Report/fact processors</a></th>
    <th><a href="http://theforeman.org/manuals/1.9/index.html#3.5.5FactsandtheENC">External node classifier</a></th>
  </tr>
  <tr>
    <td>0.25.x</td>
    <td>Not supported</td>
    <td>Untested</td>
    <td>Untested</td>
    <td>Supported <span class="footnote">*</span></td>
  </tr>
  <tr>
    <td>2.6.0 - 2.6.5</td>
    <td>Not supported</td>
    <td>Untested</td>
    <td>Untested</td>
    <td>Supported <span class="footnote">*</span></td>
  </tr>
  <tr>
    <td>2.6.5+</td>
    <td>Not supported</td>
    <td>Supported</td>
    <td>Supported</td>
    <td>Supported</td>
  </tr>
  <tr>
    <td>2.7.x</td>
    <td>Supported</td>
    <td>Supported</td>
    <td>Supported</td>
    <td>Supported</td>
  </tr>
  <tr>
    <td>3.0.x</td>
    <td>Limited support</td>
    <td>1.1 or higher</td>
    <td>Supported</td>
    <td>Supported</td>
  </tr>
  <tr>
    <td>3.1.x - 3.4.x</td>
    <td>1.1 or higher</td>
    <td>1.1 or higher</td>
    <td>Supported</td>
    <td>Supported</td>
  </tr>
  <tr>
    <td>3.5.x</td>
    <td>1.4.3 or higher</td>
    <td>1.4.2 or higher</td>
    <td>Supported</td>
    <td>Supported</td>
  </tr>
  <tr>
    <td>3.6.0+</td>
    <td>1.4.3 or higher</td>
    <td>1.5.1 or higher</td>
    <td>Supported</td>
    <td>Supported</td>
  </tr>
  <tr>
    <td>4.x</td>
    <td>Not supported</td>
    <td>Not supported</td>
    <td>Untested</td>
    <td>Untested</td>
  </tr>
</tbody></table>


<p>Lines indicated with <span class="footnote">*</span> require <code>Parametrized_Classes_in_ENC</code> in Foreman to be disabled.</p>

<p>The Foreman installer and packages are generally incompatible with 
Puppet Enterprise, however with some manual reconfiguration, individual 
Foreman components such as the smart proxy should work if needed (some 
further unsupported documentation can be found on the wiki).  The 
installer in particular will conflict with a Puppet Enterprise 
installation.  It is recommended that Foreman is installed using <a href="http://docs.puppetlabs.com/guides/installation.html">Puppet "open source"</a>.</p>

<h4>Facter compatibility</h4>

<p>Foreman is known to be compatible with all Facter 1.x releases.</p>

<p>For Facter 2.x, both Foreman installer and Foreman 1.4.2 or higher are required.</p>

<p>Compatibility with structured facts in Facter 2.x is being introduced via <a href="http://projects.theforeman.org/issues/4528">#4528</a>.</p>

<div data-unique="3.1.3FirewallConfiguration" name="3.1.3FirewallConfiguration"></div><h3>3.1.3 Firewall Configuration</h3>

<p>Protect your Foreman environment by blocking all unnecessary and unused ports.</p>

<table class="table table-bordered table-condensed">
  <tbody><tr>
    <th>Port</th>
    <th>Protocol</th>
    <th>Required For</th>
  </tr>
  <tr>
    <td>53</td>
    <td>TCP &amp; UDP</td>
    <td>DNS Server</td>
  </tr>
  <tr>
    <td>67, 68</td>
    <td>UDP</td>
    <td>DHCP Server</td>
  </tr>
  <tr>
    <td>69</td>
    <td>UDP</td>
    <td><span class="footnote">*</span> TFTP Server</td>
  </tr>
  <tr>
    <td>80, 443</td>
    <td>TCP</td>
    <td><span class="footnote">*</span> HTTP &amp; HTTPS access to Foreman web UI - using Apache + Passenger</td>
  </tr>
  <tr>
    <td>3000</td>
    <td>TCP</td>
    <td>HTTP access to Foreman web UI - using standalone WEBrick service</td>
  </tr>
  <tr>
    <td>3306</td>
    <td>TCP</td>
    <td>Separate MySQL database</td>
  </tr>
  <tr>
    <td>5910 - 5930</td>
    <td>TCP</td>
    <td>Server VNC Consoles</td>
  </tr>
  <tr>
    <td>5432</td>
    <td>TCP</td>
    <td>Separate PostgreSQL database</td>
  </tr>
  <tr>
    <td>8140</td>
    <td>TCP</td>
    <td><span class="footnote">*</span> Puppet Master</td>
  </tr>
  <tr>
    <td>8443</td>
    <td>TCP</td>
    <td>Smart Proxy, open only to Foreman</td>
  </tr>
</tbody></table>


<p>Ports indicated with <span class="footnote">*</span> are running by default on a Foreman all-in-one installation and should be open.</p>

<div data-unique="3.2ForemanInstaller" name="3.2ForemanInstaller"></div><h2>3.2 Foreman Installer</h2>

<p>The Foreman installer is a collection of Puppet modules that installs
 everything required for a full working Foreman setup.  It uses native 
OS packaging (e.g. RPM and .deb packages) and adds necessary 
configuration for the complete installation.</p>

<p>Components include the Foreman web UI, Smart Proxy, Passenger (for 
the puppet master and Foreman itself), and optionally TFTP, DNS and DHCP
 servers.  It is configurable and the Puppet modules can be read or run 
in "no-op" mode to see what changes it will make.</p>

<p>It's strongly recommended to use the installer instead of only 
installing packages, as the installer uses OS packages and it saves a 
lot of time otherwise spent replicating configuration by hand.</p>

<p>By default it will configure:</p>

<ul>
<li>Apache HTTP with SSL (using a Puppet-signed certificate)</li>
<li>Foreman running under mod_passenger</li>
<li>Smart Proxy configured for Puppet, TFTP and SSL</li>
<li>Puppet master running under mod_passenger</li>
<li>Puppet agent configured</li>
<li>TFTP server (under xinetd on Red Hat platforms)</li>
</ul>


<p>Other modules can be enabled, which will also configure:</p>

<ul>
<li>ISC DHCP server</li>
<li>BIND DNS server</li>
</ul>


<div data-unique="3.2.1Installation" name="3.2.1Installation"></div><h3>3.2.1 Installation</h3>

<h4>Downloading the installer</h4>

<p>Follow the instructions in section <a href="http://theforeman.org/manuals/1.9/index.html#2.1Installation">2.1 Quickstart installation</a></p>

<h4>Running the installer</h4>

<p>The installation run is non-interactive, but the configuration can be customized by supplying any of the options listed in <code>foreman-installer --help</code>, or by running <code>foreman-installer -i</code> for interactive mode.  More examples are given in the <a href="http://theforeman.org/manuals/1.9/index.html#3.2.2InstallerOptions">Installation Options</a> section.  Adding <code>-v</code> will disable the progress bar and display all changes, while <code>--noop</code> will run without making any changes.  To run the installer, execute:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">foreman-installer</code></pre></div>


<p>After it completes, the installer will print some details about where
 to find Foreman and the Smart Proxy and Puppet master if they were 
installed along Foreman. Output should be similar to this:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">* Foreman is running at https://theforeman.example.com
      Initial credentials are admin / 3ekw5xtyXCoXxS29
  * Foreman Proxy is running at https://theforeman.example.com:8443
  * Puppetmaster is running at port 8140
  * The full log is at /var/log/foreman-installer/foreman-installer.log</code></pre></div>


<div data-unique="3.2.2InstallerOptions" name="3.2.2InstallerOptions"></div><h3>3.2.2 Installer Options</h3>

<p>The installer is a collection of Puppet modules, which have a large 
number of parameters available to customize the configuration.  
Parameters can be set by running <code>foreman-installer</code> with arguments, e.g. <code>--foreman-db-type</code>, changing settings in interactive mode or by setting up an answers file.</p>

<p>The precedence for settings is for those set by arguments to 
foreman-installer or interactive mode, then the answers file, then the 
Puppet manifest defaults.</p>

<h4>foreman-installer arguments</h4>

<p>Every parameter available in the installer can be set using command line arguments to <code>foreman-installer</code>.  Run <code>foreman-installer --help</code> for a list of every available option.</p>

<p>When running the installer, all arguments passed on the command line 
will be persisted by default to /etc/foreman/foreman-installer.yaml and 
used automatically on subsequent runs, without needing to specify those 
arguments again.  This persistence can be disabled with the <code>-b</code> option.</p>

<h4>Interactive mode</h4>

<p>The installer also provides a text driven interface to customize configuration parameters, and can be run by executing:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">foreman-installer -i</code></pre></div>


<h4>Plugins and compute resources</h4>

<p>The installer contains a number of high level modules (e.g. 
"foreman", "puppet") and additionally a number of smaller modules for 
additional functionality, such as plugins and compute resource support. 
 These can be added with the "--enable" switches, or the default options
 can be disabled with "--no-enable" switches.</p>

<p>More information about compute resources can be found in the <a href="http://theforeman.org/manuals/1.9/index.html#5.2ComputeResources">Compute Resources section</a> and plugins in the <a href="http://theforeman.org/manuals/1.9/index.html#6.Plugins">Plugins section</a>.</p>

<!-- Generated by hand from `foreman-installer --help | grep enable- -->


<div>
  <table class="table table-bordered table-condensed">
    <thead>
      <tr>
        <th>Option</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman</td>
        <td>Enable 'foreman' puppet module</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-cli</td>
        <td>Enable 'foreman_cli' puppet module</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-compute-ec2</td>
        <td>Enable 'foreman_compute_ec2' puppet module</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-compute-gce</td>
        <td>Enable 'foreman_compute_gce' puppet module</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-compute-libvirt</td>
        <td>Enable 'foreman_compute_libvirt' puppet module</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-compute-openstack</td>
        <td>Enable 'foreman_compute_openstack' puppet module</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-compute-ovirt</td>
        <td>Enable 'foreman_compute_ovirt' puppet module</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-compute-rackspace</td>
        <td>Enable 'foreman_compute_rackspace' puppet module</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-compute-vmware</td>
        <td>Enable 'foreman_compute_vmware' puppet module</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-plugin-bootdisk</td>
        <td>Enable 'foreman_plugin_bootdisk' puppet module (<a href="https://github.com/theforeman/foreman_bootdisk">foreman_bootdisk</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-plugin-chef</td>
        <td>Enable 'foreman_plugin_chef' puppet module (<a href="http://theforeman.org/plugins/foreman_chef/0.1/">foreman_chef</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-plugin-default-hostgroup</td>
        <td>Enable 'foreman_plugin_default_hostgroup' puppet module (<a href="https://github.com/GregSutcliffe/foreman_default_hostgroup">foreman_default_hostgroup</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-plugin-digitalocean</td>
        <td>Enable 'foreman_plugin_digitalocean' puppet module (<a href="https://github.com/theforeman/foreman-digitalocean">foreman_digitalocean</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-plugin-discovery</td>
        <td>Enable 'foreman_plugin_discovery' puppet module (<a href="https://github.com/theforeman/foreman_discovery">foreman_discovery</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-plugin-docker</td>
        <td>Enable 'foreman_plugin_docker' puppet module (<a href="https://github.com/theforeman/foreman-docker">foreman_docker</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-plugin-hooks</td>
        <td>Enable 'foreman_plugin_hooks' puppet module (<a href="https://github.com/theforeman/foreman_hooks">foreman_hooks</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-plugin-openscap</td>
        <td>Enable 'foreman_plugin_openscap' puppet module (<a href="https://github.com/OpenSCAP/foreman_openscap">foreman_openscap</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-plugin-ovirt-provision</td>
        <td>Enable 'foreman_plugin_ovirt_provision' puppet module (<a href="https://github.com/theforeman/ovirt_provision_plugin">ovirt_provision_plugin</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-plugin-puppetdb</td>
        <td>Enable 'foreman_plugin_puppetdb' puppet module (<a href="https://github.com/theforeman/puppetdb_foreman">puppetdb_foreman</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-plugin-salt</td>
        <td>Enable 'foreman_plugin_salt' puppet module (<a href="http://theforeman.org/plugins/foreman_salt/2.0/">foreman_salt</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-plugin-setup</td>
        <td>Enable 'foreman_plugin_setup' puppet module (<a href="https://github.com/theforeman/foreman_setup">foreman_setup</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-plugin-tasks</td>
        <td>Enable 'foreman_plugin_tasks' puppet module (<a href="https://github.com/theforeman/foreman-tasks">foreman-tasks</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-plugin-templates</td>
        <td>Enable 'foreman_plugin_templates' puppet module (<a href="https://github.com/theforeman/foreman_templates">foreman_templates</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-proxy</td>
        <td>Enable 'foreman_proxy' puppet module</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-proxy-plugin-abrt</td>
        <td>Enable 'foreman_proxy_plugin_abrt' puppet module (<a href="https://github.com/theforeman/smart_proxy_abrt">smart_proxy_abrt</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-proxy-plugin-chef</td>
        <td>Enable 'foreman_proxy_plugin_chef' puppet module (<a href="http://theforeman.org/plugins/foreman_chef/0.1/">smart_proxy_chef</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-proxy-plugin-openscap</td>
        <td>Enable 'foreman_proxy_plugin_openscap' puppet module (<a href="https://github.com/OpenSCAP/smart_proxy_openscap">smart_proxy_abrt</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-proxy-plugin-pulp</td>
        <td>Enable 'foreman_proxy_plugin_pulp' puppet module (<a href="https://github.com/theforeman/smart-proxy-pulp">smart_proxy_pulp</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-foreman-proxy-plugin-salt</td>
        <td>Enable 'foreman_proxy_plugin_salt' puppet module (<a href="http://theforeman.org/plugins/foreman_salt/2.0/">smart_proxy_salt</a>)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--[no-]enable-puppet</td>
        <td>Enable 'puppet' puppet module</td>
      </tr>
    </tbody>
  </table>
</div>


<h4>Available options</h4>

<!-- Generated with:
/usr/lib/ruby/gems/*/bin/kafo-export-params -c /etc/foreman/foreman-installer.yaml -f html
-->


<div id="installer-options">
  <table class="table table-bordered table-condensed">
    <thead>
      <tr>
        <th>Option</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="white-space:nowrap">--foreman-admin-email</td>
        <td>E-mail address of the initial admin user</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-admin-first-name</td>
        <td>First name of the initial admin user</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-admin-last-name</td>
        <td>Last name of the initial admin user</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-admin-password</td>
        <td>Password of the initial admin user, default is randomly generated</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-admin-username</td>
        <td>Username for the initial admin user</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-apipie-task</td>
        <td>Rake task to generate API documentation. Use 'apipie:cache' on 1.7 or older, 'apipie:cache:index' on 1.8 or newer.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-app-root</td>
        <td>Name of foreman root directory</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-authentication</td>
        <td>Enable user authentication. Initial credentials are set using admin_username and admin_password.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-configure-brightbox-repo</td>
        <td>Configure the Brightbox PPA for Ubuntu, providing updated Ruby and Passenger packages</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-configure-epel-repo</td>
        <td>If disabled the EPEL repo will not be configured on RedHat family systems.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-configure-ipa-repo</td>
        <td>Enable custom yum repo with packages needed for external authentication via IPA, this may be needed on RHEL 6.5 and older.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-configure-scl-repo</td>
        <td>If disabled the SCL repo will not be configured on Red Hat 
clone systems. (Currently only installs repos for CentOS and Scientific)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-custom-repo</td>
        <td>No need to change anything here by default if set to true, 
no repo will be added by this module, letting you to set it to some 
custom location.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-db-adapter</td>
        <td>Database 'production' adapter</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-db-database</td>
        <td>Database 'production' database (e.g. foreman)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-db-host</td>
        <td>Database 'production' host</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-db-manage</td>
        <td>if enabled, will install and configure the database server on this host</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-db-password</td>
        <td>Database 'production' password (default is random)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-db-pool</td>
        <td>Database 'production' size of connection pool</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-db-port</td>
        <td>Database 'production' port</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-db-sslmode</td>
        <td>Database 'production' ssl mode</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-db-type</td>
        <td>Database 'production' type (valid types: mysql/postgresql/sqlite)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-db-username</td>
        <td>Database 'production' user (e.g. foreman)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-email-conf</td>
        <td>email configuration file, defaults to /etc/foreman/email.yaml</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-email-delivery-method</td>
        <td>can be sendmail or smtp regarding to foreman documentation</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-email-smtp-address</td>
        <td>if delivery_method is smtp, this should contain an valid smtp host</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-email-smtp-authentication</td>
        <td>authentication settings, can be none or login, defaults to none</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-email-smtp-domain</td>
        <td>email domain</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-email-smtp-password</td>
        <td>password for mail server auth, if authentication login</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-email-smtp-port</td>
        <td>smtp port, defaults to 25</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-email-smtp-user-name</td>
        <td>user_name for mail server auth, if authentication login</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-email-source</td>
        <td>template to use for email configuration file</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-environment</td>
        <td>Rails environment of foreman</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-foreman-url</td>
        <td>URL on which foreman is going to run</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-gpgcheck</td>
        <td>turn on/off gpg check in repo files (effective only on RedHat family systems)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-group</td>
        <td>Primary group for the Foreman user</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-http-keytab</td>
        <td>Path to keytab to be used for Kerberos authentication on the WebUI</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-initial-location</td>
        <td>Name of an initial location</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-initial-organization</td>
        <td>Name of an initial organization</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-ipa-authentication</td>
        <td>Enable configuration for external authentication via IPA</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-ipa-manage-sssd</td>
        <td>If ipa_authentication is true, should the installer manage 
SSSD? You can disable it if you use another module for SSSD 
configuration</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-locations-enabled</td>
        <td>Enable locations?</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-loggers</td>
        <td>Enable or disable specific loggers, e.g. {"sql" =&gt; true}</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-logging-level</td>
        <td>Logging level of the Foreman application (valid values: debug, info, warn, error, fatal)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-manage-user</td>
        <td>Controls whether foreman module will manage the user on the system. (default true)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-oauth-active</td>
        <td>Enable OAuth authentication for REST API</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-oauth-consumer-key</td>
        <td>OAuth consumer key</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-oauth-consumer-secret</td>
        <td>OAuth consumer secret</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-oauth-map-users</td>
        <td>Should foreman use the foreman_user header to identify API user?</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-organizations-enabled</td>
        <td>Enable organizations?</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-pam-service</td>
        <td>PAM service used for host-based access control in IPA</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-passenger</td>
        <td>Configure foreman via apache and passenger</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-passenger-interface</td>
        <td>Defines which network interface passenger should listen on, undef means all interfaces</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-passenger-min-instances</td>
        <td>Minimum passenger worker instances to keep when application is idle.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-passenger-prestart</td>
        <td>Pre-start the first passenger worker instance process during httpd start.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-passenger-ruby</td>
        <td>Ruby interpreter used to run Foreman under Passenger</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-passenger-ruby-package</td>
        <td>Package to install to provide Passenger libraries for the active Ruby interpreter</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-passenger-start-timeout</td>
        <td>Amount of seconds to wait for Ruby application boot.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-puppet-home</td>
        <td>Puppet home directory</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-repo</td>
        <td>This can be stable, nightly or a specific version i.e. 1.7</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-selinux</td>
        <td>when undef, foreman-selinux will be installed if SELinux is 
enabled setting to false/true will override this check (e.g. set to 
false on 1.1)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-server-ssl-ca</td>
        <td>Defines Apache mod_ssl SSLCACertificateFile setting in Foreman vhost conf file.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-server-ssl-cert</td>
        <td>Defines Apache mod_ssl SSLCertificateFile setting in Foreman vhost conf file.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-server-ssl-chain</td>
        <td>Defines Apache mod_ssl SSLCertificateChainFile setting in Foreman vhost conf file.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-server-ssl-crl</td>
        <td>Defines the Apache mod_ssl SSLCARevocationFile setting in Foreman vhost conf file.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-server-ssl-key</td>
        <td>Defines Apache mod_ssl SSLCertificateKeyFile setting in Foreman vhost conf file.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-servername</td>
        <td>Server name of the VirtualHost in the webserver</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-ssl</td>
        <td>Enable and set require_ssl in Foreman settings (note: requires passenger, SSL does not apply to kickstarts)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-unattended</td>
        <td>Should foreman manage host provisioning as well</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-use-vhost</td>
        <td>Enclose apache configuration in <virtualhost>...</virtualhost></td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-user</td>
        <td>User under which foreman will run</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-user-groups</td>
        <td>Additional groups for the Foreman user</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-version</td>
        <td>foreman package version, it's passed to ensure parameter of 
package resource can be set to specific version number, 'latest', 
'present' etc.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-websockets-encrypt</td>
        <td>Whether to encrypt websocket connections</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-websockets-ssl-cert</td>
        <td>SSL certificate file to use when encrypting websocket connections</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-websockets-ssl-key</td>
        <td>SSL key file to use when encrypting websocket connections</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-cli-foreman-url</td>
        <td>URL on which Foreman runs</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-cli-manage-root-config</td>
        <td>Whether to manage /root/.hammer configuration.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-cli-password</td>
        <td>Password for authentication</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-cli-refresh-cache</td>
        <td>Check API documentation cache status on each request</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-cli-request-timeout</td>
        <td>API request timeout, set -1 for infinity</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-cli-username</td>
        <td>Username for authentication</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-autosign-location</td>
        <td>Path to autosign configuration file</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-bind-host</td>
        <td>Host to bind ports to, e.g. *, localhost, 0.0.0.0</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-bmc</td>
        <td>Enable BMC feature</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-bmc-default-provider</td>
        <td>BMC default provider.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-bmc-listen-on</td>
        <td>BMC proxy to listen on https, http, or both</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-custom-repo</td>
        <td>No need to change anything here by default if set to true, 
no repo will be added by this module, letting you to set it to some 
custom location.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-customrun-args</td>
        <td>Puppet customrun command arguments</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-customrun-cmd</td>
        <td>Puppet customrun command</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dhcp</td>
        <td>Enable DHCP feature</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dhcp-config</td>
        <td>DHCP config file path</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dhcp-gateway</td>
        <td>DHCP pool gateway</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dhcp-interface</td>
        <td>DHCP listen interface</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dhcp-key-name</td>
        <td>DHCP key name</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dhcp-key-secret</td>
        <td>DHCP password</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dhcp-leases</td>
        <td>DHCP leases file</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dhcp-listen-on</td>
        <td>DHCP proxy to listen on https, http, or both</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dhcp-managed</td>
        <td>DHCP is managed by Foreman proxy</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dhcp-nameservers</td>
        <td>DHCP nameservers</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dhcp-omapi-port</td>
        <td>DHCP server OMAPI port</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dhcp-option-domain</td>
        <td>DHCP use the dhcpd config option domain-name</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dhcp-range</td>
        <td>Space-separated DHCP pool range</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dhcp-vendor</td>
        <td>DHCP vendor</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dir</td>
        <td>Foreman proxy install directory</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dns</td>
        <td>Enable DNS feature</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dns-forwarders</td>
        <td>DNS forwarders</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dns-interface</td>
        <td>DNS interface</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dns-listen-on</td>
        <td>DNS proxy to listen on https, http, or both</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dns-managed</td>
        <td>DNS is managed by Foreman proxy</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dns-provider</td>
        <td>DNS provider</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dns-reverse</td>
        <td>DNS reverse zone name</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dns-server</td>
        <td>Address of DNS server to manage</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dns-tsig-keytab</td>
        <td>Kerberos keytab for DNS updates using GSS-TSIG authentication</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dns-tsig-principal</td>
        <td>Kerberos principal for DNS updates using GSS-TSIG authentication</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dns-ttl</td>
        <td>DNS default TTL override</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-dns-zone</td>
        <td>DNS zone name</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-foreman-base-url</td>
        <td>Base Foreman URL used for REST interaction</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-foreman-ssl-ca</td>
        <td>SSL CA used to verify connections when accessing the Foreman API. When not specified, the ssl_ca is used instead.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-foreman-ssl-cert</td>
        <td>SSL client certificate used when accessing the Foreman API When not specified, the ssl_cert is used instead.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-foreman-ssl-key</td>
        <td>Corresponding key to a foreman_ssl_cert certificate When not specified, the ssl_key is used instead.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-freeipa-remove-dns</td>
        <td>Remove DNS entries from FreeIPA when deleting hosts from realm</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-gpgcheck</td>
        <td>Turn on/off gpg check in repo files (effective only on RedHat family systems)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-http</td>
        <td>Enable HTTP</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-http-port</td>
        <td>HTTP port to listen on (if http is enabled)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-keyfile</td>
        <td>DNS server keyfile path</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-log</td>
        <td>Foreman proxy log file</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-log-level</td>
        <td>Foreman proxy log level, e.g. INFO, DEBUG, FATAL etc.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-manage-sudoersd</td>
        <td>Whether to manage File['/etc/sudoers.d'] or not.  When 
reusing this module, this may be disabled to let a dedicated sudo module
 manage it instead.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-oauth-consumer-key</td>
        <td>OAuth key to be used for REST interaction</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-oauth-consumer-secret</td>
        <td>OAuth secret to be used for REST interaction</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-oauth-effective-user</td>
        <td>User to be used for REST interaction</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-version</td>
        <td>foreman plugins version, it's passed to ensure parameter of 
plugins package resource can be set to 'latest', 'present',  
'installed', 'absent'.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-port</td>
        <td>Port to listen on (deprecated in favor of $ssl_port and $http_port)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppet-cache-location</td>
        <td>Location to store cached puppet classes</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppet-group</td>
        <td>Groups of Foreman proxy user</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppet-ssl-ca</td>
        <td>SSL CA used to verify connections when accessing the Puppet master API</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppet-ssl-cert</td>
        <td>SSL certificate used when accessing the Puppet master API</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppet-ssl-key</td>
        <td>SSL private key used when accessing the Puppet master API</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppet-url</td>
        <td>URL of the Puppet master itself for API requests</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppet-use-cache</td>
        <td>Whether to enable caching of puppet classes</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppet-use-environment-api</td>
        <td>Override use of Puppet's API to list environments.  When unset, the proxy will try to determine this automatically.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppet-user</td>
        <td>Which user to invoke sudo as to run puppet commands</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppetca</td>
        <td>Enable Puppet CA feature</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppetca-cmd</td>
        <td>Puppet CA command to be allowed in sudoers</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppetca-listen-on</td>
        <td>Puppet CA feature to listen on https, http, or both</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppetdir</td>
        <td>Puppet var directory</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppetrun</td>
        <td>Enable puppet run/kick feature</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppetrun-cmd</td>
        <td>Puppet run/kick command to be allowed in sudoers</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppetrun-listen-on</td>
        <td>Puppet run proxy to listen on https, http, or both</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppetrun-provider</td>
        <td>Set puppet_provider to handle puppet run/kick via mcollective</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppetssh-command</td>
        <td>The command used by puppetrun_provider puppetssh</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppetssh-keyfile</td>
        <td>The keyfile for puppetrun_provider puppetssh commands</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppetssh-sudo</td>
        <td>Whether to use sudo before commands when using puppetrun_provider puppetssh</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppetssh-user</td>
        <td>The user for puppetrun_provider puppetssh</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-puppetssh-wait</td>
        <td>Whether to wait for completion of the Puppet command over SSH and return the exit code</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-realm</td>
        <td>Enable realm management feature</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-realm-keytab</td>
        <td>Kerberos keytab path to authenticate realm updates</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-realm-listen-on</td>
        <td>Realm proxy to listen on https, http, or both</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-realm-principal</td>
        <td>Kerberos principal for realm updates</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-realm-provider</td>
        <td>Realm management provider</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-register-in-foreman</td>
        <td>Register proxy back in Foreman</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-registered-name</td>
        <td>Proxy name which is registered in Foreman</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-registered-proxy-url</td>
        <td>Proxy URL which is registered in Foreman</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-repo</td>
        <td>This can be stable, rc, or nightly</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-salt-puppetrun-cmd</td>
        <td>Salt command to trigger Puppet run</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-ssl</td>
        <td>Enable SSL, ensure feature is added with "https://" protocol if true</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-ssl-ca</td>
        <td>SSL CA to validate the client certificates used to access the proxy</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-ssl-cert</td>
        <td>SSL certificate to be used to run the foreman proxy via https.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-ssl-key</td>
        <td>Corresponding key to a ssl_cert certificate</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-ssl-port</td>
        <td>HTTPS port to listen on (if ssl is enabled)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-ssldir</td>
        <td>Puppet CA ssl directory</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-template-url</td>
        <td>URL a client should use for provisioning templates</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-templates</td>
        <td>Enable templates feature</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-templates-listen-on</td>
        <td>Templates proxy to listen on https, http, or both</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-tftp</td>
        <td>Enable TFTP feature</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-tftp-dirs</td>
        <td>Directories to be create in $tftp_root</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-tftp-listen-on</td>
        <td>TFTP proxy to listen on https, http, or both</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-tftp-root</td>
        <td>TFTP root directory</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-tftp-servername</td>
        <td>Defines the TFTP Servername to use, overrides the name in the subnet declaration</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-tftp-syslinux-filenames</td>
        <td>Syslinux files to install on TFTP (full paths)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-tftp-syslinux-files</td>
        <td>Syslinux files to install on TFTP (copied from $tftp_syslinux_root, deprecated, see $tftp_syslinux_filenames)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-tftp-syslinux-root</td>
        <td>Directory that hold syslinux files (deprecated, see $tftp_syslinux_filenames)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-trusted-hosts</td>
        <td>Only hosts listed will be permitted, empty array to disable authorization</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-use-sudoersd</td>
        <td>Add a file to /etc/sudoers.d (true) or uses augeas (false)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-user</td>
        <td>User under which foreman proxy will run</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-version</td>
        <td>foreman package version, it's passed to ensure parameter of 
package resource can be set to specific version number, 'latest', 
'present' etc.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-virsh-network</td>
        <td>Network for virsh DNS/DHCP provider</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-additional-settings</td>
        <td>A hash of additional main settings.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-agent</td>
        <td>Should a puppet agent be installed</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-agent-additional-settings</td>
        <td>A hash of additional agent settings. Example: {stringify_facts =&gt; true}</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-agent-noop</td>
        <td>Run the agent in noop mode.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-agent-restart-command</td>
        <td>The command which gets excuted on puppet service restart</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-agent-template</td>
        <td>Use a custom template for the agent puppet configuration.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-allow-any-crl-auth</td>
        <td>Allow any authentication for the CRL. This is needed on the puppet CA to accept clients from a the puppet CA proxy.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-auth-allowed</td>
        <td>An array of authenticated nodes allowed to access all catalog and node endpoints. default to ['$1']</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-auth-template</td>
        <td>Use a custom template for the auth configuration.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-ca-port</td>
        <td>Puppet CA port</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-ca-server</td>
        <td>Use a different ca server. Should be either a string with the location of the ca_server or 'false'.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-classfile</td>
        <td>The file in which puppet agent stores a list of the classes associated with the retrieved configuration.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-client-package</td>
        <td>Install a custom package to provide the puppet client</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-configtimeout</td>
        <td>How long the client should wait for the configuration to be retrieved before considering it a failure.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-cron-cmd</td>
        <td>Specify command to launch when runmode is set 'cron'.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-dir</td>
        <td>Override the puppet directory.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-dns-alt-names</td>
        <td>Use additional DNS names when generating a certificate.  Defaults to an empty Array.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-environment</td>
        <td>Default environment of the Puppet agent</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-group</td>
        <td>Override the name of the puppet group.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-hiera-config</td>
        <td>The hiera configuration file. Defaults to '$confdir/hiera.yaml'.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-listen</td>
        <td>Should the puppet agent listen for connections.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-listen-to</td>
        <td>An array of servers allowed to initiate a puppet run. If 
$listen = true one of three things will happen: 1) if $listen_to is not 
empty then this array will be used. 2) if $listen_to is empty and 
$puppetmaster is defined then only $puppetmaster will be allowed. 3) if 
$puppetmaster is not defined or empty, $fqdn will be used.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-logdir</td>
        <td>Override the log directory.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-main-template</td>
        <td>Use a custom template for the main puppet configuration.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-module-repository</td>
        <td>Use a different puppet module repository</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-nsauth-template</td>
        <td>Use a custom template for the nsauth configuration.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-package-provider</td>
        <td>The provider used to install the agent. Defaults to chocolatey on Windows Defaults to undef elsewhere</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-pluginfactsource</td>
        <td>URL to retrieve Puppet facts from during pluginsync</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-pluginsource</td>
        <td>URL to retrieve Puppet plugins from during pluginsync</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-pluginsync</td>
        <td>Enable pluginsync.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-port</td>
        <td>Override the port of the master we connect to.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-postrun-command</td>
        <td>A command which gets excuted after each Puppet run</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-prerun-command</td>
        <td>A command which gets excuted before each Puppet run</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-puppetmaster</td>
        <td>Hostname of your puppetmaster (server directive in puppet.conf)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-remove-lock</td>
        <td>Remove the agent lock when running.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-rundir</td>
        <td>Override the PID directory.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-runinterval</td>
        <td>Set up the interval (in seconds) to run the puppet agent.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-runmode</td>
        <td>Select the mode to setup the puppet agent. Can be either 'cron', 'service', or 'none'.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server</td>
        <td>Should a puppet master be installed as well as the client</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-additional-settings</td>
        <td>A hash of additional settings. Example: {trusted_node_data =&gt; true, ordering =&gt; 'manifest'}</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-app-root</td>
        <td>Directory where the application lives</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-ca</td>
        <td>Provide puppet CA</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-ca-proxy</td>
        <td>The actual server that handles puppet CA. Setting this to 
anything non-empty causes the apache vhost to set up a proxy for all 
certificates pointing to the value.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-certname</td>
        <td>The name to use when handling certificates.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-common-modules-path</td>
        <td>Common modules paths (only when $server_git_repo_path and $server_dynamic_environments are false)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-config-version</td>
        <td>How to determine the configuration version. When using git_repo, by default a git describe approach will be installed.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-dir</td>
        <td>Puppet configuration directory</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-directory-environments</td>
        <td>Enable directory environments, defaulting to true with Puppet 3.6.0 or higher</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-dynamic-environments</td>
        <td>Use $environment in the modulepath Deprecated when 
$server_directory_environments is true, set $server_environments to [] 
instead.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-enc-api</td>
        <td>What version of enc script to deploy. Valid values are 'v2' for latest, and 'v1' for Foreman =&lt; 1.2</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-environment-timeout</td>
        <td>Timeout for cached compiled catalogs (10s, 5m, ...)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-environments</td>
        <td>Environments to setup (creates directories). Applies only when $server_dynamic_environments is false</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-environments-group</td>
        <td>The group owning the environments directory</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-environments-mode</td>
        <td>Environments directory mode.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-environments-owner</td>
        <td>The owner of the environments directory</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-envs-dir</td>
        <td>Directory that holds puppet environments</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-external-nodes</td>
        <td>External nodes classifier executable</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-facts</td>
        <td>Should foreman receive facts from puppet</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-foreman</td>
        <td>Should foreman integration be installed</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-foreman-ssl-ca</td>
        <td>SSL CA of the Foreman server</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-foreman-ssl-cert</td>
        <td>Client certificate for authenticating against Foreman server</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-foreman-ssl-key</td>
        <td>Key for authenticating against Foreman server</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-foreman-url</td>
        <td>Foreman URL</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-git-branch-map</td>
        <td>Git branch to puppet env mapping for the default post receive hook</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-git-repo</td>
        <td>Use git repository as a source of modules</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-git-repo-path</td>
        <td>Git repository path</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-group</td>
        <td>Name of the puppetmaster group.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-http</td>
        <td>Should the puppet master listen on HTTP as well as HTTPS. 
Useful for load balancer or reverse proxy scenarios. Note that the HTTP 
puppet master denies access from all clients by default, allowed clients
 must be specified with $server_http_allow.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-http-allow</td>
        <td>Array of allowed clients for the HTTP puppet master. Passed to Apache's 'Allow' directive.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-http-port</td>
        <td>Puppet master HTTP port; defaults to 8139.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-httpd-service</td>
        <td>Apache/httpd service name to notify on configuration 
changes. Defaults to 'httpd' based on the default apache module included
 with foreman-installer.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-implementation</td>
        <td>Puppet master implementation, either "master" (traditional Ruby) or "puppetserver" (JVM-based)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-manifest-path</td>
        <td>Path to puppet site.pp manifest (only when $server_git_repo_path and $server_dynamic_environments are false)</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-package</td>
        <td>Custom package name for puppet master</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-parser</td>
        <td>Sets the parser to use. Valid options are 'current' or 'future'. Defaults to 'current'.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-passenger</td>
        <td>If set to true, we will configure apache with passenger. If 
set to false, we will enable the default puppetmaster service unless 
service_fallback is set to false. See 'Advanced server parameters' for 
more information. Only applicable when server_implementation is 
"master".</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-passenger-max-pool</td>
        <td>The PassengerMaxPoolSize parameter. If your host is low on memory, it may be a good thing to lower this. Defaults to 12.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-port</td>
        <td>Puppet master port</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-post-hook-content</td>
        <td>Which template to use for git post hook</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-post-hook-name</td>
        <td>Name of a git hook</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-puppet-basedir</td>
        <td>Where is the puppet code base located</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-puppetdb-host</td>
        <td>PuppetDB host</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-puppetdb-port</td>
        <td>PuppetDB port</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-puppetdb-swf</td>
        <td>PuppetDB soft_write_failure</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-rack-arguments</td>
        <td>Arguments passed to rack app ARGV in addition to --confdir and --vardir.  The default is an empty array.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-report-api</td>
        <td>What version of report processor to deploy. Valid values are 'v2' for latest, and 'v1' for Foreman =&lt; 1.2</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-reports</td>
        <td>List of report types to include on the puppetmaster</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-request-timeout</td>
        <td>Timeout in node.rb script for fetching catalog from Foreman (in seconds).</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-service-fallback</td>
        <td>If passenger is not used, do we want to fallback to using 
the puppetmaster service? Set to false if you disabled passenger and you
 do NOT want to use the puppetmaster service. Defaults to true.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-ssl-dir</td>
        <td>SSL directory</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-storeconfigs-backend</td>
        <td>Do you use storeconfigs? (note: not required) false if you don't, "active_record" for 2.X style db, "puppetdb" for puppetdb</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-strict-variables</td>
        <td>if set to true, it will throw parse errors when accessing undeclared variables.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-template</td>
        <td>Which template should be used for master configuration</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-user</td>
        <td>Name of the puppetmaster user.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-server-version</td>
        <td>Custom package version for puppet master</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-service-name</td>
        <td>The name of the puppet agent service.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-show-diff</td>
        <td>Show and report changed files with diff output</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-splay</td>
        <td>Switch to enable a random amount of time to sleep before each run.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-splaylimit</td>
        <td>The maximum time to delay before runs. Defaults to being the
 same as the run interval. This setting can be a time interval in 
seconds (30 or 30s), minutes (30m), hours (6h), days (2d), or years 
(5y).</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-srv-domain</td>
        <td>Search domain for SRV records</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-ssldir</td>
        <td>Override where SSL certificates are kept.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-syslogfacility</td>
        <td>Facility name to use when logging to syslog</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-use-srv-records</td>
        <td>Whether DNS SRV records will be used to resolve the Puppet master</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-usecacheonfailure</td>
        <td>Switch to enable use of cached catalog on failure of run.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-user</td>
        <td>Override the name of the puppet user.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-vardir</td>
        <td>Override the puppet var directory.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--puppet-version</td>
        <td>Specify a specific version of a package to install. The 
version should be the exact match for your distro. You can also use 
certain values like 'latest'.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-plugin-discovery-image-name</td>
        <td>tarball with images</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-plugin-discovery-install-images</td>
        <td>should the installer download and setup discovery images for you? the average size is few hundreds of MB</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-plugin-discovery-source-url</td>
        <td>source URL to download from</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-plugin-discovery-tftp-root</td>
        <td>tftp root to install image into</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-plugin-openscap-configure-openscap-repo</td>
        <td>Enable custom yum repo with packages needed for foreman_openscap,</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-compute-ec2-package</td>
        <td>Package name to install, use foreman-compute on Foreman 1.7</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-compute-ec2-version</td>
        <td>Package version to install, defaults to installed</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-compute-gce-version</td>
        <td>Package version to install, defaults to installed</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-compute-libvirt-version</td>
        <td>Package version to install, defaults to installed</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-compute-ovirt-version</td>
        <td>Package version to install, defaults to installed</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-compute-vmware-version</td>
        <td>Package version to install, defaults to installed</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-abrt-abrt-send-log-file</td>
        <td>Log file for the forwarding script.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-abrt-aggregate-reports</td>
        <td>Merge duplicate reports before sending</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-abrt-enabled</td>
        <td>Enables/disables the plugin</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-abrt-faf-server-ssl-cert</td>
        <td>Enable client authentication to FAF server: set ssl certificate</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-abrt-faf-server-ssl-key</td>
        <td>Enable client authentication to FAF server: set ssl key</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-abrt-faf-server-ssl-noverify</td>
        <td>Set to true if FAF server uses self-signed certificate</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-abrt-faf-server-url</td>
        <td>FAF server instance the reports will be forwarded to</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-abrt-group</td>
        <td>group owner of the configuration file</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-abrt-listen-on</td>
        <td>Proxy feature listens on http, https, or both</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-abrt-send-period</td>
        <td>Period (in seconds) after which collected reports are 
forwarded. Meaningful only if smart-proxy-abrt-send is run as a daemon 
(not from cron).</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-abrt-spooldir</td>
        <td>Directory where uReports are stored before they are sent</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-abrt-version</td>
        <td>plugin package version, it's passed to ensure parameter of 
package resource can be set to specific version number, 'latest', 
'present' etc.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-chef-client-name</td>
        <td>chef client name used for authentication of other client requests</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-chef-enabled</td>
        <td>enables/disables the plugin</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-chef-group</td>
        <td>group owner of the configuration file</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-chef-listen-on</td>
        <td>Proxy feature listens on http, https, or both</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-chef-private-key</td>
        <td>path to file containing private key for $client_name client</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-chef-server-url</td>
        <td>chef server url</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-chef-ssl-pem-file</td>
        <td>if $ssl_verify is true you can specify a path to a file 
which contains certificate and related private key if the certificate is
 not globally trusted</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-chef-ssl-verify</td>
        <td>should we perform chef server ssl cert verification? this requires CA certificate installed and trusted</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-chef-version</td>
        <td>plugin package version, it's passed to ensure parameter of 
package resource can be set to specific version number, 'latest', 
'present' etc.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-openscap-enabled</td>
        <td>enables/disables the plugin</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-openscap-listen-on</td>
        <td>Proxy feature listens on http, https, or both</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-openscap-openscap-send-log-file</td>
        <td>Log file for the forwarding script</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-openscap-spooldir</td>
        <td>Directory where OpenSCAP audits are stored before they are forwarded to Foreman</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-pulp-enabled</td>
        <td>enables/disables the pulp plugin</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-pulp-group</td>
        <td>group owner of the configuration file</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-pulp-listen-on</td>
        <td>Proxy feature listens on http, https, or both</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-pulp-pulp-url</td>
        <td>pulp url to use</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-pulp-pulpnode-enabled</td>
        <td>enables/disables the pulpnode plugin</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-pulp-version</td>
        <td>plugin package version, it's passed to ensure parameter of 
package resource can be set to specific version number, 'latest', 
'present' etc.</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-salt-api</td>
        <td>Use Salt API</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-salt-api-auth</td>
        <td>Salt API auth mechanism</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-salt-api-password</td>
        <td>Salt API password</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-salt-api-url</td>
        <td>Salt API URL</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-salt-api-username</td>
        <td>Salt API username</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-salt-autosign-file</td>
        <td>File to use for salt autosign</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-salt-enabled</td>
        <td>Enables/disables the plugin</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-salt-group</td>
        <td>Owner of plugin configuration</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-salt-listen-on</td>
        <td>Proxy feature listens on https, http, or both</td>
      </tr>
      <tr>
        <td style="white-space:nowrap">--foreman-proxy-plugin-salt-user</td>
        <td>User to run salt commands under</td>
      </tr>
    </tbody>
  </table>
</div>


<h4>Answers file</h4>

<p>The answers file describes the classes that will be applied to the host to
install Foreman, along with their parameters.  The foreman-installer package stores it at <code>/etc/foreman/foreman-installer.yaml</code>.  By default, the <em>all-in-one</em> setup will include Foreman, a puppetmaster, Puppet agent, and the Smart Proxy:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="l-Scalar-Plain">foreman</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">custom_repo</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
<span class="l-Scalar-Plain">foreman_proxy</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">custom_repo</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
<span class="l-Scalar-Plain">puppet</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">server</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span></code></pre></div>


<p>Other examples are given in the next section, or <code>/usr/share/foreman-installer/README.md</code>.</p>

<div data-unique="3.2.3InstallationScenarios" name="3.2.3InstallationScenarios"></div><h3>3.2.3 Installation Scenarios</h3>

<p>The Foreman installer can accommodate more complex, multi-host setups when supplied with appropriate parameters.</p>

<h4>Setting up Foreman with external Puppet masters</h4>

<p>Using the scenarios outlined below, a simple scale-out setup can be created as follows:</p>

<ol>
<li>On the Foreman host, run a complete foreman-installer all-in-one 
installation to provide Foreman, a Puppet master and smart proxy.  This 
will be the Puppet CA.</li>
</ol>


<p>For each Puppet master:</p>

<ol>
<li>Generate a new certificate following the steps in the SSL CA section and transfer it to the new Puppet master host</li>
<li>Run the standalone Puppet master installation as detailed below</li>
</ol>


<p>Each Puppet master will register with Foreman as a smart proxy, while
 the instance running on the Foreman host itself will act as a central 
Puppet CA.  These can be selected while adding new hosts or host groups.</p>

<h4>SSL certificate authority setup</h4>

<p>The scenarios below assume a single Puppet CA (certificate authority)
 for all hosts, which is also used for Foreman and smart proxy 
communications, though more complex deployments are possible.  This 
might be the central Foreman host, or a particular Puppet master.</p>

<p>Other systems require certificates to be generated on the central 
Puppet CA host, then distributed to them before running 
foreman-installer (else it may generate a second CA).  To prepare these,
 on the host acting as Puppet CA, run:</p>

<pre><code># puppet cert generate new-puppetmaster.example.com
Notice: new-puppetmaster.example.com has a waiting certificate request
Notice: Signed certificate request for new-puppetmaster.example.com
Notice: Removing file Puppet::SSL::CertificateRequest new-puppetmaster.example.com at '/var/lib/puppet/ssl/ca/requests/new-puppetmaster.example.com.pem'
Notice: Removing file Puppet::SSL::CertificateRequest new-puppetmaster.example.com at '/var/lib/puppet/ssl/certificate_requests/new-puppetmaster.example.com.pem'

# ls /var/lib/puppet/ssl/*/new-puppetmaster.example.com.pem
/var/lib/puppet/ssl/certs/new-puppetmaster.example.com.pem
/var/lib/puppet/ssl/private_keys/new-puppetmaster.example.com.pem
/var/lib/puppet/ssl/public_keys/new-puppetmaster.example.com.pem
</code></pre>

<p>Transfer the following files to the same paths on the new host:</p>

<ul>
<li>/var/lib/puppet/ssl/certs/ca.pem</li>
<li>/var/lib/puppet/ssl/certs/new-puppetmaster.example.com.pem</li>
<li>/var/lib/puppet/ssl/private_keys/new-puppetmaster.example.com.pem</li>
</ul>


<p>This provides the new host a certificate in the same authority, but 
doesn't make it a CA itself.  Certificates will continue to be generated
 on the central Puppet CA host.</p>

<h4>Standalone Puppet master</h4>

<p>A standalone Puppet master can be configured along with a smart proxy
 installation, enabling the Puppet infrastructure to be scaled out.  A 
certificate should be generated and copied to the host first to make it 
part of the same CA, else a new Puppet CA will be generated.</p>

<p>Command line arguments:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">foreman-installer <span class="se">\</span>
  --no-enable-foreman <span class="se">\</span>
  --no-enable-foreman-cli <span class="se">\</span>
  --no-enable-foreman-plugin-bootdisk <span class="se">\</span>
  --no-enable-foreman-plugin-setup <span class="se">\</span>
  --enable-puppet <span class="se">\</span>
  --puppet-server-ca<span class="o">=</span><span class="nb">false</span> <span class="se">\</span>
  --puppet-server-foreman-url<span class="o">=</span>https://foreman.example.com <span class="se">\</span>
  --enable-foreman-proxy <span class="se">\</span>
  --foreman-proxy-puppetca<span class="o">=</span><span class="nb">false</span> <span class="se">\</span>
  --foreman-proxy-tftp<span class="o">=</span><span class="nb">false</span> <span class="se">\</span>
  --foreman-proxy-foreman-base-url<span class="o">=</span>https://foreman.example.com <span class="se">\</span>
  --foreman-proxy-trusted-hosts<span class="o">=</span>foreman.example.com <span class="se">\</span>
  --foreman-proxy-oauth-consumer-key<span class="o">=</span>&lt;key here&gt; <span class="se">\</span>
  --foreman-proxy-oauth-consumer-secret<span class="o">=</span>&lt;secret here&gt;</code></pre></div>


<p>Fill in the OAuth consumer key and secret values from your Foreman instance, retrieve them from <em>Administer &gt; Settings &gt; Auth</em>,
 and set the Foreman URLs appropriately.  These allow the smart proxy to
 register automatically with the Foreman instance, or disable with <code>--foreman-proxy-register-in-foreman=false</code>.</p>

<h4>PuppetDB integration</h4>

<p>An existing PuppetDB server can be integrated into a Puppet master by adding:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">foreman-installer <span class="se">\</span>
  <span class="o">[</span>...<span class="o">]</span>
  --puppet-server-puppetdb-host<span class="o">=</span>puppetdb.example.com <span class="se">\</span>
  --puppet-server-reports<span class="o">=</span>foreman,puppetdb <span class="se">\</span>
  --puppet-server-storeconfigs-backend<span class="o">=</span>puppetdb</code></pre></div>


<p>Be aware that foreman-installer does not setup the PuppetDB server itself.</p>

<h4>Foreman server without the Puppet master</h4>

<p>The default "all-in-one" Foreman installation includes a Puppet 
master, but this can be disabled.  Foreman by default uses Puppet's SSL 
certificates however, so a certificate must be generated and copied to 
the host first, or all SSL communications need to be disabled.</p>

<p>Command line arguments:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">foreman-installer <span class="se">\</span>
  --puppet-server<span class="o">=</span><span class="nb">false</span> <span class="se">\</span>
  --foreman-proxy-puppetrun<span class="o">=</span><span class="nb">false</span> <span class="se">\</span>
  --foreman-proxy-puppetca<span class="o">=</span><span class="nb">false</span></code></pre></div>


<p>This will still configure the Puppet agent, but this too can be disabled with <code>--no-enable-puppet</code> to disable the whole Puppet module.</p>

<h4>Smart proxy for DNS, DHCP etc.</h4>

<p>The smart proxy allows management of various network services, such 
as DNS, DHCP and TFTP.  The installer can set up a basic smart proxy 
service ready to be configured, or it can install and configure BIND or 
ISC DHCP ready to go.   A certificate should be generated and copied to 
the host first so Foreman can contact the proxy server.</p>

<p>Command line arguments for a basic smart proxy installation:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">foreman-installer <span class="se">\</span>
  --no-enable-foreman <span class="se">\</span>
  --no-enable-foreman-cli <span class="se">\</span>
  --no-enable-foreman-plugin-bootdisk <span class="se">\</span>
  --no-enable-foreman-plugin-setup <span class="se">\</span>
  --no-enable-puppet <span class="se">\</span>
  --enable-foreman-proxy <span class="se">\</span>
  --foreman-proxy-tftp<span class="o">=</span><span class="nb">false</span> <span class="se">\</span>
  --foreman-proxy-foreman-base-url<span class="o">=</span>https://foreman.example.com <span class="se">\</span>
  --foreman-proxy-trusted-hosts<span class="o">=</span>foreman.example.com <span class="se">\</span>
  --foreman-proxy-oauth-consumer-key<span class="o">=</span>&lt;key here&gt; <span class="se">\</span>
  --foreman-proxy-oauth-consumer-secret<span class="o">=</span>&lt;secret here&gt;</code></pre></div>


<p>Fill in the OAuth consumer key and secret values from your Foreman instance, retrieve them from <em>Administer &gt; Settings &gt; Auth</em>,
 and set the Foreman URL appropriately.  These allow the smart proxy to 
register automatically with the Foreman instance, or disable with <code>--foreman-proxy-register-in-foreman=false</code>.</p>

<p>Command line arguments for a smart proxy configured with just BIND, 
setting DNS forwarders and overriding the default forward and reverse 
DNS zones:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">foreman-installer <span class="se">\</span>
  --no-enable-foreman <span class="se">\</span>
  --no-enable-foreman-cli <span class="se">\</span>
  --no-enable-foreman-plugin-bootdisk <span class="se">\</span>
  --no-enable-foreman-plugin-setup <span class="se">\</span>
  --no-enable-puppet <span class="se">\</span>
  --enable-foreman-proxy <span class="se">\</span>
  --foreman-proxy-tftp<span class="o">=</span><span class="nb">false</span> <span class="se">\</span>
  --foreman-proxy-puppetca<span class="o">=</span><span class="nb">false</span> <span class="se">\</span>
  --foreman-proxy-puppetrun<span class="o">=</span><span class="nb">false</span> <span class="se">\</span>
  --foreman-proxy-dns<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  --foreman-proxy-dns-interface<span class="o">=</span>eth0 <span class="se">\</span>
  --foreman-proxy-dns-zone<span class="o">=</span>example.com <span class="se">\</span>
  --foreman-proxy-dns-reverse<span class="o">=</span>0.0.10.in-addr.arpa <span class="se">\</span>
  --foreman-proxy-dns-forwarders<span class="o">=</span>8.8.8.8 <span class="se">\</span>
  --foreman-proxy-dns-forwarders<span class="o">=</span>8.8.4.4 <span class="se">\</span>
  --foreman-proxy-foreman-base-url<span class="o">=</span>https://foreman.example.com <span class="se">\</span>
  --foreman-proxy-trusted-hosts<span class="o">=</span>foreman.example.com <span class="se">\</span>
  --foreman-proxy-oauth-consumer-key<span class="o">=</span>&lt;key here&gt; <span class="se">\</span>
  --foreman-proxy-oauth-consumer-secret<span class="o">=</span>&lt;secret here&gt;</code></pre></div>


<p>Ensure the dns-interface argument is updated with the correct network
interface name for the DNS server to listen on. After configuration, make sure
to create Subnet in Foreman under <em>Infrastructure &gt; Subnets</em> for the
particular Smart Proxy which registers automatically.</p>

<p>Command line arguments for a smart proxy configured with just ISC DHCP and a single DHCP subnet:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">foreman-installer <span class="se">\</span>
  --no-enable-foreman <span class="se">\</span>
  --no-enable-foreman-cli <span class="se">\</span>
  --no-enable-foreman-plugin-bootdisk <span class="se">\</span>
  --no-enable-foreman-plugin-setup <span class="se">\</span>
  --no-enable-puppet <span class="se">\</span>
  --enable-foreman-proxy <span class="se">\</span>
  --foreman-proxy-puppetca<span class="o">=</span><span class="nb">false</span> <span class="se">\</span>
  --foreman-proxy-puppetrun<span class="o">=</span><span class="nb">false</span> <span class="se">\</span>
  --foreman-proxy-tftp<span class="o">=</span><span class="nb">false</span> <span class="se">\</span>
  --foreman-proxy-dhcp<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  --foreman-proxy-dhcp-interface<span class="o">=</span>eth0 <span class="se">\</span>
  --foreman-proxy-dhcp-gateway<span class="o">=</span>10.0.0.1 <span class="se">\</span>
  --foreman-proxy-dhcp-range<span class="o">=</span><span class="s2">"10.0.0.100 10.0.0.200"</span> <span class="se">\</span>
  --foreman-proxy-dhcp-nameservers<span class="o">=</span><span class="s2">"10.0.1.2,10.0.1.3"</span> <span class="se">\</span>
  --foreman-proxy-foreman-base-url<span class="o">=</span>https://foreman.example.com <span class="se">\</span>
  --foreman-proxy-trusted-hosts<span class="o">=</span>foreman.example.com <span class="se">\</span>
  --foreman-proxy-oauth-consumer-key<span class="o">=</span>&lt;key here&gt; <span class="se">\</span>
  --foreman-proxy-oauth-consumer-secret<span class="o">=</span>&lt;secret here&gt;</code></pre></div>


<p>Also ensure here that the dhcp-interface argument is updated for the interface
to run DHCP on. After configuration, make sure to create a new Subnet (or
import from existing) in the Foreman interface.</p>

<p>While it is possible to define the same DHCP range in Foreman, it's usually
good practice to select a range from outside the pool defined in the
installer, but still in the subnet. For the example above, it is recommended
to define the DHCP range from 10.0.0.1 to 10.0.0.99 in the Foreman UI which
gives the following IP address distribution:</p>

<ul>
<li>10.0.0.1 - 10.0.0.99 - addresses reserved during bare-metal provisioning by Foreman</li>
<li>10.0.0.100 - 10.0.200 - addresses for dynamic clients in the subnet
(discovered hosts, unmanaged hosts)</li>
</ul>


<div data-unique="3.3InstallFromPackages" name="3.3InstallFromPackages"></div><h2>3.3 Install From Packages</h2>

<p>Packages are available for Red Hat and Debian-based distributions.  
This will install a standalone Foreman service running under WEBrick, 
which has limited scalability.</p>

<p>The Puppet-based Foreman installer is recommended for most 
environments, instead of installing only the packages as it will perform
 full configuration too.</p>

<div data-unique="3.3.1RPMPackages" name="3.3.1RPMPackages"></div><h3>3.3.1 RPM Packages</h3>

<p>Foreman is packaged for the following RPM based distributions:</p>

<ul>
<li>RHEL and derivatives, version 6 and 7</li>
<li>Fedora 19</li>
</ul>


<p>For most users, it's highly recommended to use the <a href="http://theforeman.org/manuals/1.9/index.html#3.2ForemanInstaller">installer</a>
 as the packages only provide the software and a standalone Foreman 
service.  The installer installs these packages, then additionally 
configures Foreman to run under Apache and Passenger with PostgreSQL, 
plus can configure a complete Puppet setup integrated with Foreman.</p>

<h4>Pre-requisites</h4>

<p>All RHEL and derivatives must be <a href="http://fedoraproject.org/wiki/EPEL">subscribed to EPEL</a> to provide additional dependencies.  Install epel-release from <a href="http://fedoraproject.org/wiki/EPEL#How_can_I_use_these_extra_packages.3F">here</a> to automatically configure it.</p>

<p>RHEL 6 and 7 hosts must also be subscribed to the RHEL 6/7 Optional repository or child channel in RHN.</p>

<p>All RHEL and derivatives require Red Hat Software Collections (RHSCL)
 1 or rebuild, e.g. Software Collections for CentOS.  RHSCL is available
 to RHEL customers as a separate repository or child channel.  More 
information on Software Collections for CentOS <a href="http://wiki.centos.org/AdditionalResources/Repositories/SCL">is available here</a>, for Scientific Linux it <a href="http://ftp.scientificlinux.org/linux/scientific/6x/external_products/softwarecollections/">is available here</a> and for Oracle Linux it <a href="http://docs.oracle.com/cd/E37670_01/E59096/html/index.html">is available here</a>.</p>

<div class="alert alert-info">Please note that SCL is not available at 
the time of writing for CentOS,  Scientific Linux or Oracle Linux 7, so 
Foreman cannot yet be installed using packages on these operating 
systems.</div>


<p>To enable both optional and software collections on a RHEL 6 system using subscription-manager, run:</p>

<pre><code>yum-config-manager --enable rhel-6-server-optional-rpms rhel-server-rhscl-6-rpms
</code></pre>

<p>Optionally, the Puppet Labs repository can be configured to obtain 
the latest version of Puppet available, instead of the version on EPEL. 
 See the <a href="http://docs.puppetlabs.com/guides/puppetlabs_package_repositories.html#for-red-hat-enterprise-linux-and-derivatives">Puppet Labs Package Repositories</a> documentation on how to configure these.</p>

<h4>Available repositories</h4>

<p>Three main repos are provided at <a href="http://yum.theforeman.org/">http://yum.theforeman.org</a>:</p>

<ul>
<li><code>/releases/latest</code> or <code>/releases/VERSION</code> (e.g. <code>/releases/1.9</code>) carries the stable releases and updates of Foreman and its dependencies.</li>
<li><code>/rc</code> carries release candidates only in the few weeks 
prior to a release.  Ensure after a release is made that you use the 
main releases repo instead.</li>
<li><code>/nightly</code> carries the latest development builds and as such, may be unstable or occasionally broken.</li>
</ul>


<p>Under each repo are directories for each distribution, then each architecture.</p>

<h4>Release packages</h4>

<p>To set up the repository, foreman-release packages are provided which add a repo definition to <code>/etc/yum.repos.d</code>.  Install the appropriate release RPM from these lists:</p>

<pre><code>yum localinstall http://yum.theforeman.org/releases/1.9/el6/x86_64/foreman-release.rpm
yum localinstall http://yum.theforeman.org/releases/1.9/el7/x86_64/foreman-release.rpm
yum localinstall http://yum.theforeman.org/releases/1.9/f19/x86_64/foreman-release.rpm
</code></pre>

<p>For release candidate or nightly RPMs, change the URL as appropriate based on the above list of available repositories.</p>

<h4>Signing</h4>

<p>Release and release candidate packages are signed by the "Foreman Automatic Signing Key (2014) <a href="mailto:packages@theforeman.org">packages@theforeman.org</a>" (0x1AA043B8).  Nightly packages are not signed.</p>

<p>A copy of the key is available from public keyservers or <a href="http://yum.theforeman.org/RPM-GPG-KEY-foreman">here</a>.</p>

<h4>Available packages</h4>

<p>Install foreman and other foreman-* packages to add functionality:</p>

<pre><code>foreman               Foreman server
foreman-proxy         Foreman Smart Proxy
foreman-compute       OpenStack and Rackspace provisioning support
foreman-debug         Log and debug collection tools
foreman-ec2           Amazon EC2 provisioning support
foreman-libvirt       libvirt provisioning support
foreman-ovirt         oVirt/RHEV provisioning support
foreman-vmware        VMware provisioning support
foreman-cli           Foreman CLI utility
foreman-console       Console additions
foreman-selinux       SELinux targeted policy
foreman-mysql2        MySQL database support
foreman-postgresql    PostgreSQL database support
foreman-sqlite        SQLite database support
</code></pre>

<h4>Setup</h4>

<ol>
<li>Configure by editing <code>/etc/foreman/settings.yaml</code> and <code>/etc/foreman/database.yml</code></li>
<li>After changing the database, migrate it: <code>sudo -u foreman /usr/share/foreman/extras/dbmigrate</code></li>
<li>Start the foreman service or set up passenger: <code>service foreman start</code></li>
</ol>


<h4>Upgrade</h4>

<p>See <a href="http://theforeman.org/manuals/1.9/index.html#3.6Upgrade">upgrade instructions</a></p>

<div data-unique="3.3.2SoftwareCollections" name="3.3.2SoftwareCollections"></div><h3>3.3.2 Software Collections</h3>

<p>The RPMs use a packaging technique called Software Collections, or 
SCL.  This provides Ruby and all dependencies required to run Foreman 
separately from the version of Ruby provided by the distribution.</p>

<p>The current stack is "ruby193", which provides Ruby 1.9.3 and Ruby on
 Rails 3.2.  All packages will have a "ruby193-" prefix, allowing them 
to be easily identified, and will install entirely underneath <code>/opt/rh/ruby193</code>.</p>

<p>The system Ruby version is left alone and will still be used for 
packages provided both by the distribution, and other third parties who 
target the system Ruby (e.g. Puppet packages).</p>

<p>Foreman currently uses SCL only on RHEL and EL clones where a newer 
version of Ruby is desired.  Fedora only uses the distro version of 
Ruby.</p>

<p>In order to run rake commands for Foreman, or scripts that run in the same environment, <code>ruby193-rake</code> and <code>ruby193-ruby</code> wrappers are provided as alternatives for the usual <code>rake</code> or <code>ruby</code>.  In order to run a series of commands or a script directly within the software collection, <code>scl enable ruby193 'other command'</code> can be used.  It is also possible to run <code>scl enable ruby193 bash</code>
 to get a shell within the context of the SCL.  Foreman rake tasks 
should be run with "foreman-rake", which automates this process.</p>

<p>More general information about software collections is available from these links:</p>

<ul>
<li><a href="http://jnovy.fedorapeople.org/scl-utils/scl.pdf">RHEL packaging: Software Collections (SCLs)</a></li>
<li><a href="http://docs.fedoraproject.org/en-US/Fedora_Contributor_Documentation/1/html/Software_Collections_Guide/index.html">Fedora Contributor Documentation: Software Collections Guide</a></li>
</ul>


<h4>Passenger under the SCL</h4>

<p>When running Foreman under Passenger (the default installer setup), a
 specific configuration is needed for SCL (on EL), since Foreman 
operates under the SCL Ruby and other apps such as the puppetmaster will
 use the system Ruby.  Passenger 4 is shipped in the Foreman repos as it
 can be configured with separate Ruby binaries per VirtualHost.  The 
full configuration is described below.</p>

<p>The following packages must be installed:</p>

<ul>
<li>mod_passenger</li>
<li>ruby193-rubygem-passenger</li>
<li>ruby193-rubygem-passenger-native</li>
<li>ruby193-rubygem-passenger-native-libs</li>
<li>rubygem-passenger</li>
<li>rubygem-passenger-native</li>
<li>rubygem-passenger-native-libs</li>
</ul>


<p>Ensure all version numbers match and are at least 4.0.  mod_passenger
 provides the Apache module, while there are two copies of the Ruby 
components, one for the SCL Ruby (<code>ruby193-rubygem-*</code>) and one for the system Ruby (<code>rubygem-*</code>).</p>

<p>The <code>/etc/httpd/conf.d/passenger.conf</code> file is supplied by mod_passenger and should contain:</p>

<pre><code>LoadModule passenger_module modules/mod_passenger.so
&lt;IfModule mod_passenger.c&gt;
   PassengerRoot /usr/lib/ruby/gems/1.8/gems/passenger-4.0.5
   PassengerRuby /usr/bin/ruby
&lt;/IfModule&gt;
</code></pre>

<p>Check for .rpmsave or .rpmnew config backup files if this isn't 
correct.  Note that this refers to the system Ruby paths by default, 
allowing everything except Foreman (i.e. the puppetmaster) to run under 
the system Ruby.</p>

<p>Next, the Foreman config file at <code>/etc/httpd/conf.d/foreman.conf</code> must contain this entry in both HTTP and HTTPS VirtualHost sections:</p>

<pre><code>PassengerRuby /usr/bin/ruby193-ruby
</code></pre>

<p>The full foreman.conf template from the installer is <a href="https://github.com/theforeman/puppet-foreman/blob/master/templates/foreman-vhost.conf.erb">available here</a> for comparison.</p>

<p>Ensure both <code>RailsAutoDetect</code> and <code>RakeAutoDetect</code> config entries are removed from foreman.conf and puppet.conf when using Passenger 4, since they have been deprecated.</p>

<p>When successfully configured, two Passenger RackApp processes will be
 visible and by inspecting the open files, the Ruby version being loaded
 can be confirmed:</p>

<pre><code># ps auxww | grep RackApp
foreman  16627  0.1 15.4 466980 157196 ?       Sl   07:35   0:09 Passenger RackApp: /usr/share/foreman
puppet   16697  0.8 11.3 253080 115720 ?       Sl   07:35   1:13 Passenger RackApp: /etc/puppet/rack
# lsof -p 16697 | grep libruby
ruby    16697 puppet  mem    REG              253,0   951224  272286 /usr/lib64/libruby.so.1.8.7
# lsof -p 16627 | grep libruby
ruby    16627 foreman  mem    REG              253,0  2041096  171190 /opt/rh/ruby193/root/usr/lib64/libruby.so.1.9.1
</code></pre>

<div data-unique="3.3.3DebianPackages" name="3.3.3DebianPackages"></div><h3>3.3.3 Debian Packages</h3>

<p>The Foreman packages should work on the following Debian-based Linux distributions:</p>

<h4>Distributions</h4>

<ul>
<li>Debian Linux 8.0 (Jessie)</li>
<li>Debian Linux 7.0 (Wheezy)</li>
<li>Ubuntu Linux 14.04 LTS (Trusty Tahr)</li>
<li>Ubuntu Linux 12.04 LTS (Precise Pangolin)</li>
</ul>


<p>If you encounter any errors during the installation, <a href="http://theforeman.org/projects/foreman/issues/new">please file a bug report!</a></p>

<h4>Apt Configuration</h4>

<p>Add one of the following lines to your <em>/etc/apt/sources.list</em> (alternatively in a separate file in <em>/etc/apt/sources.list.d/foreman.list</em>):</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Stable packages</span>

<span class="c"># Debian Jessie</span>
deb http://deb.theforeman.org/ jessie 1.9
<span class="c"># Debian Wheezy</span>
deb http://deb.theforeman.org/ wheezy 1.9
<span class="c"># Ubuntu 14.04 Trusty</span>
deb http://deb.theforeman.org/ trusty 1.9
<span class="c"># Ubuntu 12.04 Precise</span>
deb http://deb.theforeman.org/ precise 1.9

<span class="c"># Nightly builds. Beware: HERE BE DRAGONS</span>

<span class="c"># Debian Jessie</span>
deb http://deb.theforeman.org/ jessie nightly
<span class="c"># Debian Wheezy</span>
deb http://deb.theforeman.org/ wheezy nightly
<span class="c"># Ubuntu 14.04 Precise</span>
deb http://deb.theforeman.org/ trusty nightly
<span class="c"># Ubuntu 12.04 Precise</span>
deb http://deb.theforeman.org/ precise nightly</code></pre></div>


<p>You may also want some plugins from the plugin repo (required for the Foreman Installer):</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Plugins compatible with Stable</span>
deb http://deb.theforeman.org/ plugins 1.9
<span class="c"># Plugins compatible with Nightly</span>
deb http://deb.theforeman.org/ plugins nightly</code></pre></div>


<p>The public key for <a href="http://wiki.debian.org/SecureApt">secure APT</a> can be downloaded <a href="http://deb.theforeman.org/pubkey.gpg">here</a></p>

<p>You can add this key with</p>

<pre>apt-key add pubkey.gpg</pre>


<p>or combine downloading and registering:</p>

<pre>wget -q http://deb.theforeman.org/pubkey.gpg -O- | apt-key add -</pre>


<p>The key fingerprint is</p>

<pre>7059 542D 5AEA 367F 7873  2D02 B348 4CB7 1AA0 43B8
Foreman Automatic Signing Key (2014) <packages@theforeman.org>
</packages@theforeman.org></pre>


<p>Remember to update your package lists!</p>

<pre>apt-get update</pre>


<h4>Install packages</h4>

<p>The packages are now split by gem dependencies - there are 11 packages to choose from. These are:</p>

<p>Main package:</p>

<ul>
<li>foreman</li>
</ul>


<p>Database gems - you need at least one of these:</p>

<ul>
<li>foreman-sqlite3</li>
<li>foreman-mysql2</li>
<li>foreman-pgsql</li>
</ul>


<p>Optional functionality:</p>

<ul>
<li>foreman-console</li>
<li>foreman-compute</li>
<li>foreman-debug</li>
<li>foreman-ec2</li>
<li>foreman-gce</li>
<li>foreman-libvirt</li>
<li>foreman-ovirt</li>
<li>foreman-test</li>
<li>foreman-vmware</li>
</ul>


<p>Command line interface:</p>

<ul>
<li>ruby-hammer-cli</li>
<li>ruby-hammer-cli-foreman</li>
</ul>


<p>Installation instructions are:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Install packages  (adjust additional packages as needed)</span>
apt-get install foreman foreman-sqlite3 foreman-libvirt

<span class="c"># Copy sample db config to /etc</span>
cp /usr/share/foreman/config/database.yml.example /etc/foreman/database.yml

<span class="c"># Review settings and DB config</span>
vi /etc/foreman/settings.yaml /etc/foreman/database.yml

<span class="c"># Perform initial DB setup</span>
foreman-rake db:migrate
foreman-rake db:seed</code></pre></div>


<p>The packages should auto-run db:migrate and db:seed if <em>/etc/foreman/database.yml</em> exists. So the initial DB setup is only needed during first install, upgrades should just work.</p>

<h4>Upgrade</h4>

<p>See <a href="http://theforeman.org/manuals/1.9/index.html#3.6Upgrade">upgrade instructions</a></p>

<div data-unique="3.4InstallFromSource" name="3.4InstallFromSource"></div><h2>3.4 Install From Source</h2>

<p>Installing the latest development code:
Foreman has now moved to using Rails 3 and Bundler to get up and 
running. This is the preferred way to get Foreman if you want to benefit
 from the latest improvements. By using the git repository you can also 
upgrade more easily. You will need to have Bundler installed manually 
for now (check your distribution repositories, or install it via 
rubygems).</p>

<p>Foreman will run with the following requirements (aside from rubygem dependencies):</p>

<ul>
<li>Ruby 1.8.7 or 1.9</li>
<li>rubygems</li>
<li>Puppet &gt;= 0.24.4</li>
</ul>


<p>The installation has been successfully tested on RHEL[5,6], 
Fedora[13,14,15,16,17], Debian Linux 6.0 (Squeeze) and Ubuntu Linux 
12.04 (the community has reported varying success with other 
Debian/Ubuntu versions - 12.10 seems fine for example). For older 
operating systems you might need additional packages (e.g. sqlite).  It 
is also known to work on Solaris and Mac.</p>

<p>to get latest "development" version do:</p>

<p>You will want to make sure that you have one of the <em>mysql-devel</em>,
<em>postgresql-devel</em>, and <em>sqlite-devel</em> libraries installed so the database
gems can install properly. Also, you would also need <em>gcc</em>, <em>ruby-devel</em>,
<em>libxml-devel</em>, <em>libxslt-devel</em>, and <em>libvirt-devel</em> packages</p>

<p>For RHEL6 or clones, you can issue the following commands to install <em>all</em>
required packages:</p>

<pre><code>yum groupinstall "Development Tools" "Development Libraries"
yum -y install gcc-c++ git ruby ruby-devel rubygems \
    libvirt-devel mysql-devel postgresql-devel openssl-devel \
    libxml2-devel sqlite-devel libxslt-devel zlib-devel \
    readline-devel tar
</code></pre>

<p>Additionally, it is important that <code>config/database.yml</code> is set to use
the correct database in the "production" block. Rails (and subsequently
Foreman) will use these connection settings under "production" to manage
the database it uses and setup the necessary schema.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">git clone https://github.com/theforeman/foreman.git -b develop
<span class="nb">cd </span>foreman
cp config/settings.yaml.example config/settings.yaml
cp config/database.yml.example config/database.yml
gem install bundler
<span class="c"># depending on database configured in yml file you can skip others</span>
<span class="c"># (we are assuming sqlite to be configured)</span>
bundle install --without mysql2 pg <span class="nb">test</span> --path vendor <span class="c"># or postgresql</span>
<span class="c"># set up database schema, precompile assets and locales</span>
<span class="nv">RAILS_ENV</span><span class="o">=</span>production bundle <span class="nb">exec </span>rake db:migrate
<span class="nv">RAILS_ENV</span><span class="o">=</span>production bundle <span class="nb">exec </span>rake db:seed assets:precompile locale:pack</code></pre></div>


<p>In order to run Foreman you can use the following command inside your git repository:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">./script/rails s -e production</code></pre></div>




<div class="alert alert-info">This manual will recommend <code>foreman-rake &lt;task&gt;</code> to run rake tasks, however when installed from source, replace this with <code>bundle exec rake &lt;task&gt; RAILS_ENV=production</code></div>


<div data-unique="Lateststableversion" name="Lateststableversion"></div><h3>Latest stable version</h3>

<p>to get latest "stable" version do:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">git clone https://github.com/theforeman/foreman.git -b 1.9-stable</code></pre></div>


<p>If you are behind a proxy or firewall and don't have access to Github
using the git protocol, use http protocol instead:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">git clone http://github.com/theforeman/foreman.git foreman -b 1.9-stable</code></pre></div>


<div data-unique="CLI(Hammer)" name="CLI(Hammer)"></div><h3>CLI (Hammer)</h3>

<p>To install hammer from git checkouts, you will just need <code>rake</code> installed on your system.
Clone and install CLI core</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git clone https://github.com/theforeman/hammer-cli.git
<span class="nv">$ </span><span class="nb">cd </span>hammer-cli
<span class="nv">$ </span>rake install
<span class="nv">$ </span><span class="nb">cd</span> ..</code></pre></div>


<p>and clone plugin with foreman commands</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git clone https://github.com/theforeman/hammer-cli-foreman.git
<span class="nv">$ </span><span class="nb">cd </span>hammer-cli-foreman
<span class="nv">$ </span>rake install
<span class="nv">$ </span><span class="nb">cd</span> ..</code></pre></div>


<p>You can install other hammer plugins via any of the methods mentioned above.</p>

<div data-unique="3.5Configuration" name="3.5Configuration"></div><h2>3.5 Configuration</h2>

<p>The following sections detail the configuration steps required to get Foreman working in your environment.
Lets get started!</p>

<div data-unique="3.5.1InitialSetup" name="3.5.1InitialSetup"></div><h3>3.5.1 Initial Setup</h3>

<h4>Configuration</h4>

<p>Foreman configuration is managed from two places; a configuration file
<em>config/settings.yaml</em> and from the <em>SETTINGS/Foreman Settings</em> page. A full
description of the configuration options is given at
<a href="http://theforeman.org/manuals/1.9/index.html#3.5.2ConfigurationOptions">foreman_configuration</a></p>

<h4>Database</h4>

<p>Foreman requires a database of its own to operate - database sharing is
unsupported.  By default, the installer uses PostgreSQL, while a package or
source installation will use SQLite.
If you want to use other database (e.g.
<a href="http://theforeman.org/manuals/1.9/index.html#3.5.3DatabaseSetup">MySQL</a>) please modify the configuration file under <em>config/database.yml</em>.</p>

<p>In all cases, please use the <em>production</em> settings.</p>

<p>to initialize the database schema and content, run:</p>

<pre>foreman-rake db:migrate
foreman-rake db:seed</pre>


<p>For more information please see the database configuration page
<a href="http://theforeman.org/manuals/1.9/index.html#3.5.3DatabaseSetup">here</a></p>

<h4>Import Data from Puppet</h4>

<p>At this point, you might want to go through the [[FAQ]] to see how can you import your data into Foreman.</p>

<h4>Start The Web Server</h4>

<p>if you installed via rpm, just start the foreman service, or start the builtin web server by typing:</p>

<pre>RAILS_ENV=production rails server</pre>


<p>and point your browser to <code>http://foreman:3000</code></p>

<p>If you would like to keep the server running, its recommend to setup
passenger or use the RPM. Example usage with passenger can be found on
<a href="http://github.com/theforeman/puppet-foreman/blob/master/templates/foreman-vhost.conf.erb">GitHub</a>.</p>

<h4>Getting your Puppet Reports into Foreman</h4>

<p>Read <a href="http://theforeman.org/manuals/1.9/index.html#3.5.4PuppetReports">Puppet_Reports</a> to learn how to get your nodes to report to Foreman.</p>

<div data-unique="3.5.2ConfigurationOptions" name="3.5.2ConfigurationOptions"></div><h3>3.5.2 Configuration Options</h3>

<p>Configuration is broken into two parts. The <em>/etc/foreman/settings.yaml</em> file and the <em>Administer &gt; Settings</em>
 page. The configuration file contains a few low-level options that need
 to be set before Foreman starts but the majority of Foreman 
customization is managed from within the web interface on the <em>Settings</em> page.</p>

<p>The configuration file can also override those settings specified in 
the web interface.  Any settings added in the config file that are 
available in the web interface will be made read-only.</p>

<h4>The config/settings.yaml file</h4>

<h5>YAML start</h5>

<p>The first non-comment line of this file must be three dashes.</p>

<pre>---
</pre>


<h5>login</h5>

<p>This boolean option configures whether Foreman requires users to to 
login. If it is set then each user will be expected to authenticate 
themselves and all operations will occur, and be audited, under their 
identity. When this option is <em>false</em> then all activity will be executed under the admin account.</p>

<pre>:login: true
</pre>


<h5>require_ssl</h5>

<p>This boolean option configures whether Foreman insists on using only 
https/ssl encrypted communication channels in the web interface. This 
does not configure the channels used to contact the smart-proxies. Note 
that certain operations will still accept a http connection even if this
 is set, for example, the downloading of a finish script.</p>

<pre>:require_ssl: true
</pre>


<h5>unattended</h5>

<p>This boolean option configures whether Foreman will act as a simple 
node classifier for puppet, or support the full spectrum of operations 
required for managing a host's lifecycle. When set to <em>true</em> then foreman will provide full host building facilities for various operating systems.</p>

<pre>:unattended: true
</pre>


<h5>support_jsonp</h5>

<p>This boolean options configures whether Foreman will provide support 
for the JavaScript object notation with padding. When set to <em>true</em> then Foreman will allow to pass a callback parameter to the API calls.</p>

<pre>:support_jsonp: false
</pre>


<h5>logging</h5>

<p>This options contains a hash of parameters that override the current 
logging configuration.  It supports any of the options that are in <code>logging.yaml</code> (see below), but most usually it's used to change the log level for debugging.</p>

<pre>:logging:
  :level: debug
</pre>


<h5>loggers</h5>

<p>This options contains a hash of config options for specific loggers, 
which cover parts of Foreman functionality.  It's usually used to enable
 additional types of logging.</p>

<p>Available loggers are:</p>

<ul>
<li>app - web requests and all general application logs (default: true)</li>
<li>ldap - high level LDAP queries (e.g. find users in group) and LDAP operations performed (default: false)</li>
<li>permissions - evaluation of user roles, filters and permissions when loading pages (default: false)</li>
<li>sql - SQL queries made through Rails ActiveRecord, only debug (default: true)</li>
</ul>


<p>Uncomment or add a :loggers block to enable or disable loggers:</p>

<pre>:loggers:
  :app:
    :enabled: true
  :ldap:
    :enabled: false
  :permissions:
    :enabled: false
  :sql:
    :enabled: true
</pre>


<p>Some plugins may add their own loggers. See the configuration files 
in /etc/foreman/plugins/ which should list possibilities and enable them
 there.</p>

<h4>The 'email.yaml' file</h4>

<p>This settings file can be found at <code>/etc/foreman/email.yaml</code>, or <code>config/email.yaml</code> on a source installation.</p>

<p>An example settings file can be found at <strong>config/email.yaml.example</strong>, copy this file to <strong>config/email.yaml</strong> if there isn't already a config file.</p>

<h5>Configuration Directives</h5>

<h6>authentication</h6>

<p>The type of authentication method expected by your service provider.</p>

<p>Valid settings:</p>

<pre>:login
:none
</pre>


<p><em>(note: if you set this to :none, you must not include the user_name and password settings)</em></p>

<h6>delivery_method</h6>

<p>The mail transport method to be used.</p>

<p>Valid settings:</p>

<pre>:smtp
:sendmail
</pre>


<h5>Example email.yml Configurations</h5>

<h6>Simple Login Authentication (default settings)</h6>

<pre>production:
  delivery_method: :smtp
  smtp_settings:
    address: smtp.example.net
    port: 25
    domain: example.net
    authentication: :login
    user_name: foreman@example.net
    password: foreman
</pre>


<h6>No Authentication</h6>

<p>Example for an SMTP service provider with no authentication. Note the colon before none.</p>

<pre>production:
  delivery_method: :smtp
  smtp_settings:
    address: smtp.nowhere.net
    port: 25
    domain: nowhere.com
    authentication: :none
</pre>


<h6>Using sendmail command</h6>

<p>Example for a unix system that uses the /usr/sbin/sendmail command.</p>

<pre>production:
  delivery_method: :sendmail
</pre>


<h4>The 'logging.yaml' file</h4>

<p>This settings file can be found at <code>/etc/foreman/logging.yaml</code>, or <code>config/logging.yaml</code> on a source installation.  It controls the default logging locations, formatting and log levels per Rails environment.</p>

<p>In a normal installation, only the "production" environment is 
relevant - development and test are only used in source installations.  
The file has comments for the most common configuration options, which 
can be changed here or overridden from the <code>logging</code> directive in the main <code>settings.yaml</code> config file (see above).</p>

<h4>The 'Administer/Settings' page</h4>

<h5>administrator</h5>

<p>When Foreman needs to mail the administrator then this is the email 
address that it will contact.  The domain is determined from Facter, 
else it will default to the ":domain" setting in 
/etc/foreman/settings.yaml.
Default: root@<your domain="">.</your></p>

<h5>authorize_login_delegation</h5>

<p>mod_proxy and other load balancers will set a REMOTE_USER environment variable. If this is <em>true</em>
 , your users will be able to login through an external service and 
Foreman requests will be authenticated using this REMOTE_USER variable.
Default: false</p>

<h5>authorize_login_delegation_api</h5>

<p>Same as above, but this setting allows REMOTE_USER authentication for API calls as well.
Default: false</p>

<h5>authorize_login_delegation_auth_source_autocreate</h5>

<p>If you have authorize_login_delegation set, new users can be 
autocreated through your external authentication mechanism by changing 
this to the name of the Auth Source you want to use to auto create 
users.
Default: ''</p>

<h5>create_new_host_when_facts_are_uploaded</h5>

<p>When facts are received from Puppet or other configuration management
 systems, a corresponding host will be created in Foreman if the 
certname or hostname is unknown.  When false, this behavior is disabled 
and facts will be discarded from unknown hosts.
Default: true
See also: create_new_host_when_report_is_uploaded</p>

<h5>create_new_host_when_report_is_uploaded</h5>

<p>If a report is received from Puppet or other configuration management
 systems, a corresponding host will be created in Foreman if the 
hostname is unknown.  When false, this behavior is disabled and reports 
will be discarded from unknown hosts.
Default: true
See also: create_new_host_when_facts_are_uploaded</p>

<h5>default_location</h5>

<p>The name of an location that hosts uploading facts into Foreman will 
be assigned to if they are new or missing an location.  This can be used
 when hosts are created through fact uploads to ensure they're assigned 
to the correct location to prevent resource mismatches.  For inherited 
location, the fact should use slash-delimited names, e.g. "USA/New 
York".
Default: ''</p>

<h5>default_organization</h5>

<p>The name of an organization that hosts uploading facts into Foreman 
will be assigned to if they are new or missing an organization.  This 
can be used when hosts are created through fact uploads to ensure 
they're assigned to the correct organization to prevent resource 
mismatches.  For inherited organization, the fact should use 
slash-delimited names, e.g. "ACME Inc/Engineering".
Default: ''</p>

<h5>default_puppet_environment</h5>

<p>When Foreman receives a fact upload from a machine that it has not 
previously come across it will create a host in its database. If the 
facts from that host did not contain information about the puppet 
environment then it will assign the <em>default_puppet_environment</em> environment to this host.
Default: production</p>

<h5>Default_variables_Lookup_Path</h5>

<p>A Smart-variable's match criteria are evaluated in a specific order and if this search order is not provided then <em>Default_variables_Lookup_Path</em> is used.
Default: ["fqdn", "hostgroup", "os", "domain"]</p>

<h5>document_root</h5>

<p>Puppetdoc will create RDoc documents for your manifests if its 
available. This setting allows you to select the directory where you 
want these documents to be created.
Default: foreman_root/public/puppet/rdoc</p>

<h5>email_reply_address</h5>

<p>The return address applied to outgoing emails.
Default: Foreman-noreply@<your domain=""></your></p>

<h5>email_subject_prefix</h5>

<p>The subject line prefix for any emails sent by Foreman.
Default: [foreman]</p>

<h5>enc_environment</h5>

<p>When this is <em>true</em>, Foreman will send the puppet environment 
in the ENC yaml output. This is meant to fix conflicts between a node's 
puppet.conf environment and the environment set in Foreman. On Puppet 
3+, agents will take the environment sent by the ENC. When <em>false</em>, the ENC yaml will not contain the environment, the node will not update its environment and use the one at puppet.conf.
Default: true</p>

<h5>Enable_Smart_Variables_in_ENC</h5>

<p>Whether Smart-variables should be included in the yaml node information provided to puppet.
Default: true</p>

<h5>entries_per_page</h5>

<p>The number of entries that will be shown in the web interface for list operations.
Default: 20</p>

<h5>foreman_url</h5>

<p>Emails may contain embedded references to Foreman's web interface. 
This option allows the URL prefix to be configured.  The FQDN is 
determined from Facter, else it will default to the ":fqdn" setting in 
/etc/foreman/settings.yaml.
Default: https://FQDN/ or http://FQDN/ (depending on require_ssl)
See also: unattended_url</p>

<h5>host_group_matchers_inheritance</h5>

<p>Matchers used in smart variables or class parameters to match host 
groups can be inherited by children of those matching host groups too 
(e.g. a matcher for hostgroup=Base will also apply to Base/Web). Set 
this to false to make matchers only match a particular hostgroup and not
 its children.
Default: true</p>

<h5>idle_timeout</h5>

<p>Users that stay idle (no requests sent to Foreman) for more than this number of minutes will be logged out.
Default: 60</p>

<h5>interpolate_erb_in_parameters</h5>

<p>If <em>true</em>, Foreman variables will be exposed to the ENC. Check <a href="http://projects.theforeman.org/projects/foreman/wiki/TemplateWriting">Template Writing</a> for a more comprehensive guide on how to create and use these variables in your ERB templates.
Default: true</p>

<h5>ignore_puppet_facts_for_provisioning</h5>

<p>If this option is set to <em>true</em> then Foreman will not update 
the IP and MAC addresses stored on a host's network interfaces with the 
values that it receives from facts. It will also include Foreman's 
values for IP and MAC to Puppet in its node/ENC information.
Default: false</p>

<h5>legacy_puppet_hostname</h5>

<p>This setting truncates the hostname of your smart proxy to 'puppet' if it starts with 'puppet'.
Default: false</p>

<h5>libvirt_default_console_access</h5>

<p>The IP address that should be used for the console listen address when provisioning new virtual machines via Libvirt.
Default: 0.0.0.0</p>

<h5>location_fact</h5>

<p>The name of a fact from hosts reporting into Foreman which gives the 
full location name of the host.  This can be used when hosts are created
 through fact uploads to ensure they're assigned to the correct location
 to prevent resource mismatches.  The location of a host will be updated
 to the value of the fact on every fact upload.  For inherited 
locations, the fact should use slash-delimited names, e.g. "USA/New 
York".
Default: foreman_location</p>

<h5>login_delegation_logout_url</h5>

<p>If your external authentication system has a logout URL, redirect 
your users to it here. This setting can be useful if your users sign in 
Foreman through SSO, and you want them to sign out from all services 
when they log out Foreman.
Default: ''</p>

<h5>manage_puppetca</h5>

<p>If this option is set to <em>true</em> then Foreman will manage a host's Puppet certificate signing. If it is set to <em>false</em> then some external mechanism is required to ensure that the host's certificate request is signed.
Default: true</p>

<h5>max_trend</h5>

<p>Days that trend graphs will capture.
Default: 30</p>

<h5>modulepath</h5>

<p>This it the modulepath that foreman uses when processing puppet 
modules. It is usually able to determine this itself at runtime but if 
it is not able to find a value then <em>modulepath</em> is used.
Default: /etc/puppet/modules</p>

<h5>oauth_active</h5>

<p>Enables OAuth authentication for API requests.
Default: false</p>

<h5>oauth_consumer_key</h5>

<p>OAuth consumer key
Default: none</p>

<h5>oauth_consumer_secret</h5>

<p>OAuth consumer secret
Default: none</p>

<h5>oauth_map_users</h5>

<p>This allows OAuth users to specify which user their requests map to. When this is <em>false</em>, OAuth requests will map to admin.
Default: true</p>

<h5>organization_fact</h5>

<p>The name of a fact from hosts reporting into Foreman which gives the 
full organization name of the host.  This can be used when hosts are 
created through fact uploads to ensure they're assigned to the correct 
organization to prevent resource mismatches.  The organization of a host
 will be updated to the value of the fact on every fact upload.  For 
inherited organization, the fact should use slash-delimited names, e.g. 
"ACME Inc/Engineering".
Default: foreman_organization</p>

<h5>outofsync_interval</h5>

<p>Duration in minutes after the Puppet interval for servers to be 
classed as out of sync.  This is added to the puppet_interval setting 
and used in pages such as the host list and dashboard.
Default: 5</p>

<h5>Parametrized_Classes_in_ENC</h5>

<p>In Puppet 2.6.5+, the ENC may send a hash of the class's attributes 
and values. Before then, the ENC used to send just an array of class 
names. Set this to <em>true</em> if you are using any version of Puppet equal to or higher than 2.6.5.
Default: true</p>

<h5>password_hash</h5>

<p>Changes the algorithm and format used to hash root passwords entered 
when creating new hosts or host groups.  This needs to be set to the 
lowest common denominator of operating systems that are provisioned from
 Foreman, but try to set it to the highest level (i.e. SHA-512) that all
 OSes support.  After changing the value, root passwords will need to be
 re-entered on existing hosts or host groups in order to re-hash them 
under the new algorithm.
Default: MD5</p>

<h5>proxy_request_timeout</h5>

<p>Timeout in seconds used when making REST requests to a Smart Proxy, 
e.g. when importing Puppet classes or creating DHCP records.  May be set
 to a larger value when certain operations take a long time.
Default: 60</p>

<h5>puppet_interval</h5>

<p>This is the number of minutes between each run of puppet.
Default: 30</p>

<h5>puppet_server</h5>

<p>The default puppet server hostname. For larger organizations this is often a non fqdn so that a name like <em>puppet</em> can be a different host within each DNS domain.
Default: puppet</p>

<h5>puppetrun</h5>

<p>If this option is set to <em>true</em> then Foreman will be able to trigger a puppet run on any host that it manages.
Default: false</p>

<h5>query_local_nameservers</h5>

<p>If <em>true</em>, Foreman will query the local DNS. When <em>false</em>
 Foreman will query the SOA/NS authority. Warning! Querying a resolver 
can cause Foreman to get false positives when checking presence of DNS 
records due to caching.
Default: false</p>

<h5>remote_addr</h5>

<p>If Foreman is running behind Passenger or a remote load balancer, the
 IP of this load balance should be set here. This is a regular 
expression, so it can support several load balancers, i.e: 
(10.0.0.1|127.0.0.1)
Default: 127.0.0.1</p>

<h5>require_ssl_smart_proxies</h5>

<p>When set to <em>true</em>, Foreman requires a client SSL certificate 
on requests from smart proxies or services on them (e.g. Puppet 
masters), and will verify the CN of the certificate against the known 
smart proxies. If false, it uses the reverse DNS of the IP address 
making the request. require_ssl in <code>config/settings.yaml</code> 
should be enabled too. For more information about securing the 
connection between Puppet masters or smart proxies and Foreman, see <a href="http://theforeman.org/manuals/1.9/index.html#5.4.1SecuringPuppetMasterRequests">Section 5.4.1</a>
Default: true</p>

<h5>restrict_registered_smart_proxies</h5>

<p>When set to <em>true</em>, services such as Puppet masters (or Salt, 
Chef) need to have a smart proxy registered with the appropriate feature
 (e.g. Puppet) to access fact/report importers and ENC output.
Default: true</p>

<h5>root_pass</h5>

<p>If a root password is not provided whilst configuring a host or its 
host group then this encrypted password is used when building the host.
Default: ''
(To generate a new one you should use: <em>openssl passwd -1 "your_password"</em> )</p>

<h5>safemode_render</h5>

<p>The default templating system used within Foreman allows unlimited 
interpolated variables and expressions. This could obviously be abused 
so a evaluation environment is provided that restricts the template 
variables and expressions to a whitelist. When this option is <em>true</em> then only known helper methods and instance variables will be available in template expansion.
Default: true</p>

<h5>send_welcome_email</h5>

<p>New account holders will receive a welcome email when the account is 
created if this is enabled, including their username and a link to 
Foreman.
Default: false</p>

<h5>ssl_client_dn_env</h5>

<p>Environment variable containing the subject DN from a client SSL certificate
Default: SSL_CLIENT_S_DN</p>

<h5>ssl_client_verify_env</h5>

<p>Environment variable containing the verification status of a client SSL certificate
Default: SSL_CLIENT_VERIFY</p>

<h5>ssl_ca_file</h5>

<p>The SSL Certificate Authority file that Foreman will use when connecting to its smart-proxies.
Default: The CA file used by puppet</p>

<h5>ssl_certificate</h5>

<p>The SSL certificate that Foreman will use when connecting to its smart-proxies.
Default: The host certificate used by puppet</p>

<h5>ssl_priv_key</h5>

<p>The SSL private key file that Foreman will use when connecting to its smart-proxies.
Default: The private key file used by puppet</p>

<h5>token_duration</h5>

<p>Time in minutes installation tokens should be valid for, 0 to disable token generation.
Default: 360 (6 hours)</p>

<h5>trusted_puppetmaster_hosts</h5>

<p>Other trusted puppet masters in addition to Smart Proxies to access 
fact/report importers and ENC output. i.e: 
[puppetmaster1.yourdomain.com, puppetmaster2.yourdomain.com]
Default: []</p>

<h5>unattended_url</h5>

<p>This controls the URL prefix used in provisioning templates such as 
TFTP/PXELinux files that refer to the Foreman server.  It is usually 
HTTP rather than HTTPS due to lack of installer support for HTTPS.  The 
FQDN is determined from Facter, else it will default to the ":fqdn" 
setting in /etc/foreman/settings.yaml.
Default: http://FQDN/
See also: foreman_url</p>

<h5>update_environment_from_facts</h5>

<p>If Foreman receives an environment fact from one of its hosts and if this option is <em>true</em>,
 it will update the host's environment with the new value. By default 
this is not the case as Foreman should manage the host's environment.
Default: false</p>

<h5>update_ip_from_built_request</h5>

<p>If <em>true</em>, Foreman will update the host IP with the IP that 
made the 'build' request. This request is made at the end of a 
provisioning cycle to indicate a host has completed the build.
Default: false</p>

<h5>use_shortname_for_vms</h5>

<p>When false, any hosts created on a compute resource will use the FQDN
 of the host for the name of the virtual machine.  When set to the true,
 the short name (i.e. without domain) will be used instead.
Default: false</p>

<h5>use_gravatar</h5>

<p>Display user avatars by matching their emails with emails at Gravatar.com
Default: true</p>

<h5>use_uuid_for_certificates</h5>

<p>When enabled, Foreman will generate UUIDs for each host instead of 
using the hostname as the Puppet certname, which is more reliable with 
changing hostnames.  Note that when disabling this setting, existing 
stored certnames won't be changed or discarded until new certificates 
are requested from a host (i.e. on a rebuild), in order that the 
existing certificate remains known to Foreman and can be revoked.</p>

<h5>websockets_encrypt</h5>

<p>When enabled, virtual machine consoles using NoVNC will always be 
sent over an encrypted WebSocket connection.  When set to 'auto', it 
will be enabled if the session is using HTTPS and both 
websockets_ssl_key and websockets_ssl_cert are set.</p>

<h5>websockets_ssl_cert</h5>

<p>Path to the SSL certificate that will be used for the WebSockets 
server when serving virtual machine consoles.  Should be the same as the
 SSL certificate used for the Foreman web server (e.g. Apache).</p>

<h5>websockets_ssl_key</h5>

<p>Path to the SSL private key that will be used for the WebSockets 
server when serving virtual machine consoles.  Should be the same as the
 SSL key used for the Foreman web server (e.g. Apache).</p>

<div data-unique="3.5.3DatabaseSetup" name="3.5.3DatabaseSetup"></div><h3>3.5.3 Database Setup</h3>

<p>Foreman is a rails application. Therefore, anything that is supported
 under RAILS (sqlite, mysql, postgresql, ...) can be used. See <a href="http://theforeman.org/manuals/1.9/index.html#3.3InstallFromPackages">3.3 Install From Packages</a>
 for a list of packages for connecting foreman to the databse of your 
choice. At this time, Oracle DB is known to not work. Patches are 
welcome!</p>

<p>The database configuration file can be found at:</p>

<pre>/etc/foreman/database.yml</pre>


<h4>SQLite (default)</h4>

<div class="alert alert-info">When using SQLite, you can install the
foreman-sqlite package. See <a href="http://theforeman.org/manuals/1.9/index.html#3.3InstallFromPackages">3.3 Install From Packages</a>.</div>


<p>By default, the database will be created in the db subdirectory.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">production</span><span class="p">:</span>
  <span class="ss">adapter</span><span class="p">:</span> <span class="n">sqlite3</span>
  <span class="ss">database</span><span class="p">:</span> <span class="n">db</span><span class="o">/</span><span class="n">production</span><span class="o">.</span><span class="n">sqlite3</span>
  <span class="ss">pool</span><span class="p">:</span> <span class="mi">5</span>
  <span class="ss">timeout</span><span class="p">:</span> <span class="mi">5000</span></code></pre></div>


<h4>MySQL</h4>

<div class="alert alert-info">When using MySQL, you can install the
foreman-mysql2 package. See <a href="http://theforeman.org/manuals/1.9/index.html#3.3InstallFromPackages">3.3 Install From Packages</a>.</div>


<p>Edit your config/database.yml and modify:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">production</span><span class="p">:</span>
  <span class="ss">adapter</span><span class="p">:</span> <span class="n">mysql2</span>
  <span class="ss">database</span><span class="p">:</span> <span class="n">foreman</span>
  <span class="ss">username</span><span class="p">:</span> <span class="n">foreman</span>
  <span class="ss">password</span><span class="p">:</span> <span class="n">password</span>
  <span class="ss">host</span><span class="p">:</span> <span class="n">localhost</span>
  <span class="ss">socket</span><span class="p">:</span> <span class="s2">"/var/run/mysqld/mysqld.sock"</span></code></pre></div>


<p>Prior to version 1.4, the foreman-mysql package was available, however support
of this and the legacy 'mysql' adapter has been discontinued.</p>

<p>Afterwards you would need to re-populate your database, simply execute:</p>

<pre><code>foreman-rake db:migrate
foreman-rake db:seed
</code></pre>

<h4>PostgreSQL</h4>

<div class="alert alert-info">When using PostgreSQL, you can install the
foreman-postgresql package. See <a href="http://theforeman.org/manuals/1.9/index.html#3.3InstallFromPackages">3.3 Install From Packages</a>.</div>


<p>Edit your config/database.yml and modify:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">production</span><span class="p">:</span>
  <span class="ss">adapter</span><span class="p">:</span> <span class="n">postgresql</span>
  <span class="ss">database</span><span class="p">:</span> <span class="n">foreman</span>
  <span class="ss">username</span><span class="p">:</span> <span class="n">foreman</span>
  <span class="ss">password</span><span class="p">:</span> <span class="n">password</span>
  <span class="ss">host</span><span class="p">:</span> <span class="n">localhost</span></code></pre></div>


<h4>Switching from SQLite to MySQL/PostgreSQL while maintaining existing data</h4>

<p>We have a rake task for this. First setup your database.yml to have the sqlite db as production and the mysql/psql db as dev:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="ss">production</span><span class="p">:</span>
  <span class="ss">adapter</span><span class="p">:</span> <span class="n">sqlite3</span>
  <span class="ss">database</span><span class="p">:</span> <span class="n">db</span><span class="o">/</span><span class="n">production</span><span class="o">.</span><span class="n">sqlite3</span>
  <span class="ss">pool</span><span class="p">:</span> <span class="mi">5</span>
  <span class="ss">timeout</span><span class="p">:</span> <span class="mi">5000</span>

<span class="ss">development</span><span class="p">:</span>
  <span class="ss">adapter</span><span class="p">:</span> <span class="n">postgresql</span>
  <span class="ss">database</span><span class="p">:</span> <span class="n">foreman</span>
  <span class="ss">username</span><span class="p">:</span> <span class="n">foreman</span>
  <span class="ss">password</span><span class="p">:</span> <span class="n">password</span>
  <span class="ss">host</span><span class="p">:</span> <span class="n">localhost</span></code></pre></div>


<p>Now migrate both dbs so they're consistent:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">migrate</span> <span class="no">RAILS_ENV</span><span class="o">=</span><span class="n">production</span>
<span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">migrate</span> <span class="no">RAILS_ENV</span><span class="o">=</span><span class="n">development</span></code></pre></div>


<p>Now move the data to the new db</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="ss">convert</span><span class="p">:</span><span class="n">prod2dev</span></code></pre></div>


<p>(On RPM distros, remove "bundle exec" from the start of these commands.)</p>

<p>Once you've migrated to your new database using prod2dev, you should 
update your database.yml file to point your 'production' environment at 
the new database.
You should also update the 'development' environment to point to an 
alternative location (for example, at SQLite) to ensure you don't 
accidentally overwrite your production database.</p>

<h5>Special notes for migrating to Postgres</h5>

<p>Firstly, the default installer setup doesn't give superuser 
privileges to the 'foreman' user, which then prevents the prod2dev 
script from temporarily disabling foreign keys. You'll need to do</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo -u postgres psql -c <span class="s1">'ALTER USER foreman WITH SUPERUSER'</span></code></pre></div>


<p>before the prod2dev call, and</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo -u postgres psql -c <span class="s1">'ALTER USER foreman WITH NOSUPERUSER'</span></code></pre></div>


<p>after it.</p>

<p>Secondly, the psql sequence numbers will be wrong after the prod2dev execution. You can fix them like this:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">cat <span class="s">&lt;&lt;EOF &gt; reset.sql</span>
<span class="s">SELECT  'SELECT SETVAL(' ||quote_literal(S.relname)|| ', MAX(' ||quote_ident(C.attname)|| ') ) FROM ' ||quote_ident(T.relname)|| ';'</span>
<span class="s">FROM pg_class AS S, pg_depend AS D, pg_class AS T, pg_attribute AS C</span>
<span class="s">WHERE S.relkind = 'S'</span>
<span class="s">    AND S.oid = D.objid</span>
<span class="s">    AND D.refobjid = T.oid</span>
<span class="s">    AND D.refobjid = C.attrelid</span>
<span class="s">    AND D.refobjsubid = C.attnum</span>
<span class="s">ORDER BY S.relname;</span>
<span class="s">EOF</span>
psql -Atq -f reset.sql -o temp foreman
psql -f temp foreman
rm temp reset.sql</code></pre></div>


<p>(big thanks to <a href="http://wiki.postgresql.org/wiki/Fixing_Sequences">Fixing Sequences</a> for the fix)</p>

<div data-unique="3.5.4PuppetReports" name="3.5.4PuppetReports"></div><h3>3.5.4 Puppet Reports</h3>

<p>Foreman uses a custom puppet reports address (similar to tagmail or 
store) which Puppet will use to upload its report into Foreman.  This 
enables you to see the reports through the web interface as soon as the 
client finishes its run.</p>

<h4>Configuration</h4>

<h5>Client</h5>

<p>Ensure that the puppet clients has the following option in their puppet.conf:</p>

<pre>report = true</pre>


<p>Without it, no reports will be sent.</p>

<h5>Puppet master</h5>

<p>First identify the directory containing report processors, e.g.</p>

<ul>
<li>EL6 (e.g. RHEL, CentOS): /usr/lib/ruby/site_ruby/1.8/puppet/reports/</li>
<li>EL7 or Fedora: /usr/share/ruby/vendor_ruby/puppet/reports/</li>
<li>Debian or Ubuntu: /usr/lib/ruby/vendor_ruby/puppet/reports/</li>
<li>other OSes, look for tagmail.rb in the Puppet installation (<code>locate tagmail.rb</code>)</li>
</ul>


<p>Copy <a href="https://raw.githubusercontent.com/theforeman/puppet-foreman/master/files/foreman-report_v2.rb">the report processor source</a> to this report directory and name it <code>foreman.rb</code>.</p>

<p>Create a new configuration file at <code>/etc/puppet/foreman.yaml</code> containing:</p>

<pre>---
# Update for your Foreman and Puppet master hostname(s)
:url: "https://foreman.example.com"
:ssl_ca: "/var/lib/puppet/ssl/certs/ca.pem"
:ssl_cert: "/var/lib/puppet/ssl/certs/puppet.example.com.pem"
:ssl_key: "/var/lib/puppet/ssl/private_keys/puppet.example.com.pem"

# Advanced settings
:puppetdir: "/var/lib/puppet"
:puppetuser: "puppet"
:facts: true
:timeout: 10
:threads: null
</pre>


<p>Edit the URL field to point to your Foreman instance, and the SSL 
fields for the hostname of the Puppet master (which may be the same 
host.)</p>

<p>Lastly add this report processor to your Puppet master configuration.  In your master puppet.conf under the <code>[main]</code> section add:</p>

<pre>reports=log, foreman</pre>


<p>and restart your Puppet master.</p>

<p>You should start seeing reports coming in under the reports link.</p>

<h5>Debugging reports</h5>

<p>If reports aren't showing up in Foreman when an agent is run, there 
can be a number of reasons.  First check through the above configuration
 steps, and then look at these places to narrow down the cause:</p>

<ol>
<li>Puppet master logs may show an issue either loading or executing the
 report processor.  Check syslog (/var/log/messages or syslog) for <code>puppet-master</code> messages.</li>
<li>/var/log/foreman/production.log should show a <code>POST "/api/reports"</code> request each time a report is received, and will end in <code>Completed 201 Created</code> when successful.  Check for errors within the block of log messages.</li>
<li>When viewing reports in Foreman's UI, be aware that the default 
search is for "eventful" reports.  Clear the search ('x') to see reports
 with no changes.</li>
</ol>


<h4>Expire reports automatically</h4>

<p>You will probably want to delete your reports after some time to limit database growth. To do so, you can set a cronjob:</p>

<p>Available conditions:</p>

<ul>
<li>days =&gt; number of days to keep reports (defaults to 7)</li>
<li>status =&gt; status of the report (defaults to 0 --&gt; "reports with no errors")</li>
</ul>


<p>Example:</p>

<ol>
<li><p>Expires all reports regardless of their status</p>

<p> </p><pre>foreman-rake reports:expire days=7</pre><p></p></li>
<li><p>Expires all non interesting reports after one day</p>

<p> </p><pre>foreman-rake reports:expire days=1 status=0</pre><p></p></li>
</ol>


<div data-unique="3.5.5FactsandtheENC" name="3.5.5FactsandtheENC"></div><h3>3.5.5 Facts and the ENC</h3>

<p>Foreman can act as a classifier to Puppet through the External Nodes 
interface. This is a mechanism provided by Puppet to ask for 
configuration data from an external service, via a script on the 
puppetmaster.</p>

<p>The external nodes script we supply also deals with uploading facts 
from hosts to Foreman, so we will discuss the two things together.</p>

<h4>Configuration</h4>

<h5>Puppet master</h5>

<p>Download <a href="https://raw.githubusercontent.com/theforeman/puppet-foreman/2.2.3/files/external_node_v2.rb">the ENC script</a> to to <code>/etc/puppet/node.rb</code> (the name is arbitrary, but must match configuration below) and ensure it's executable by "puppet" with <code>chmod +x /etc/puppet/node.rb</code>.</p>

<p>Unless it already exists from setting up reporting, create a new configuration file at <code>/etc/puppet/foreman.yaml</code> containing:</p>

<pre>---
# Update for your Foreman and Puppet master hostname(s)
:url: "https://foreman.example.com"
:ssl_ca: "/var/lib/puppet/ssl/certs/ca.pem"
:ssl_cert: "/var/lib/puppet/ssl/certs/puppet.example.com.pem"
:ssl_key: "/var/lib/puppet/ssl/private_keys/puppet.example.com.pem"

# Advanced settings
:puppetdir: "/var/lib/puppet"
:puppetuser: "puppet"
:facts: true
:timeout: 10
:threads: null
</pre>


<p>Edit the URL field to point to your Foreman instance, and the SSL 
fields for the hostname of the Puppet master (which may be the same 
host).  More information on SSL certificates is at <a href="http://theforeman.org/manuals/1.9/index.html#5.4SecuringCommunicationswithSSL">Securing communications with SSL</a>.</p>

<p>Add the following lines to the [master] section of puppet.conf:</p>

<pre>[master]
  external_nodes = /etc/puppet/node.rb
  node_terminus  = exec
</pre>


<p>Restart the Puppet master. When the next agent checks in, the script will upload
fact data for this host to Foreman, and download the ENC data.</p>

<p>The <code>--no-environment</code> option can be optionally specified to stop the ENC from
being authoritative about the agent's Puppet environment.  This can be useful
in development setups where the agent may be run against different
environments.</p>

<h5>Client</h5>

<p>No agent configuration is necessary to use this functionality.</p>

<h5>Testing the config</h5>

<p>Make sure that the puppet user can execute the ENC script and it works:</p>

<pre><code>sudo -u puppet /etc/puppet/node.rb [the name of a node, eg agent.local]
</code></pre>

<p>should output something like:</p>

<pre><code>parameters:
  puppetmaster: puppet
  foreman_env: &amp;id001 production
classes:
  helloworld:
environment: *id001
</code></pre>

<p>This output should match the information displayed when you click on the YAML button
on the Host page in Foreman.</p>

<p>For further information see the <a href="http://docs.puppetlabs.com/guides/external_nodes.html">Puppet Labs docs on external nodes</a></p>

<h5>Debugging the ENC</h5>

<ol>
<li>If Puppet agents receive empty catalogs, check the puppet.conf 
master configuration has the ENC script configured.  Also check the 
output of the ENC for the hostname logged by Puppet (which may be 
different) to see if Foreman is reporting the correct configuration.</li>
<li>If the hostname.yaml facts file is missing, this is typically a Puppet misconfiguration.  Check /etc/puppet/rack/config.ru <a href="https://docs.puppetlabs.com/puppet/3/reference/release_notes.html#break-puppet-master-rack-configuration-is-changed">has been updated</a> if Puppet has been upgraded.</li>
<li>Failures to upload facts or download the ENC data may be a network 
issue (check the URL and SSL settings) or an error on the Foreman 
server.  Check /var/log/foreman/production.log for two requests, <code>POST "/api/hosts/facts"</code> and <code>GET "/node/client.example.com?format=yml"</code> and for any errors within the block of log messages.</li>
</ol>


<h4>Assigning data to hosts through the ENC</h4>

<p>Foreman passes all assoicated parameters, classes,and class parameters, to the Host,
including those inherited from host groups, domains, or global settings. See section
<a href="http://theforeman.org/manuals/1.9/index.html#4.2ManagingPuppet">Managing Puppet</a> for
more information on assigning configuration to hosts.</p>

<h4>Creating hosts in Foreman with facts</h4>

<p>By default, Foreman adds hosts to its database that it learns about through facts,
provided the "create_new_host_when_facts_are_uploaded" setting is enabled.</p>

<p>If locations or organizations are enabled, these can be inferred from the
"foreman_location" or "foreman_organization" facts as supplied by the host.  The
names of these facts can be changed with the "location_fact" and
"organization_fact" settings respectively.  Foreman will update hosts on each
fact upload based on the value of these facts.</p>

<p>If these facts aren't supplied, then the "default_location" and
"default_organization" settings can be used to set values globally when a
host doesn't have a location or an organization set.</p>

<p>More information in the <a href="http://theforeman.org/manuals/1.9/index.html#3.5.2ConfigurationOptions">Configuration</a>
section.</p>

<h4>Pushing facts to Foreman when not using the ENC functionality</h4>

<p>There are several options for pushing fact data to Foreman if you are using Foreman
for reporting/inventory only.</p>

<h5>Using node.rb</h5>

<p>The ENC script (node.rb) accepts an option to run in 'batch-mode'. In this mode,
the script iterates over the cached fact data stored on the puppet master, and uploads
all of it to Foreman.</p>

<p>Download and configure the node.rb script as above, and then call it like this:</p>

<pre><code>sudo -u puppet /etc/puppet/node.rb --push-facts
</code></pre>

<p>The following options are available for node.rb's batch mode:</p>

<ul>
<li><code>--push-facts</code> uploads all facts sequentially which have changed since the
last run.</li>
<li><code>--push-facts-parallel</code> uploads all facts in parallel which have changed since
the last run.  The number of threads is specified by the :threads setting or
the number of processors.</li>
<li><code>--watch-facts</code> runs in the foreground and upload facts based on inotify
events, used in conjunction with either --push-facts option.</li>
</ul>


<h5>Direct HTTP upload</h5>

<p>As of Foreman 1.3, the fact-upload API endpoint accepts data in pure JSON. You can
push data to Foreman as a hash containing:</p>

<pre><code>{
  "name": "fqdn-of-host.domain.com",
  "certname": "optional-certname-of-host.domain.com",
  "facts": {
    "fact1": "string",
    "fact2": "true",
    "fact3": "1.2.3.4",
    ...
  }
}
</code></pre>

<p>The 'certname' is optional but will be used to location the Host in Foreman if
supplied. The 'facts' hash must be a flat hash, not nested with other arrays or hashes.
See <em>link-to-API-when-its-updated-here</em> for more details.</p>

<p>This body can be POSTed to '/api/hosts/facts' using Foreman API v2. See the
<a href="https://raw.github.com/theforeman/puppet-foreman/2.1-stable/templates/external_node_v2.rb.erb">node.rb template</a> for an example of constructing and sending data in Ruby.</p>

<div data-unique="3.5.6CLI" name="3.5.6CLI"></div><h3>3.5.6 CLI</h3>

<p>The Command Line Interface is based on the <a href="https://github.com/theforeman/hammer-cli">hammer</a> framework. The foreman-related commands are defined in plugin <code>hammer_cli_foreman</code></p>

<h4>Format and locations</h4>

<p>Configuration is loaded from a set of directories in this order:</p>

<ul>
<li><code>./config/hammer/</code> (config dir in CWD)</li>
<li><code>/etc/hammer/</code>.</li>
<li><code>~/.hammer/</code></li>
<li>custom location specified on command line - <code>-c CONF_FILE_PATH</code></li>
</ul>


<p>In each of these directories hammer tries to load <code>cli_config.yml</code> and anything in the <code>cli.modules.d</code> subdirectory which is the recommended location for configuration of hammer modules.</p>

<p>Later directories and files have precedence if they redefine the same
 option. Files from cli.modules.d are loaded in alphabetical order.</p>

<p>Hammer uses yaml formatting for its configuration. The config file template is contained in the hammer_cli gem.</p>

<pre><code class="`bash">gem contents hammer_cli|grep cli_config.template.yml
</code></pre>

<p>and can be copied to one of the locations above and changed as 
needed. The packaged version of hammer copies the template to /etc for 
you.</p>

<h4>Plugins</h4>

<p>Plugins are disabled by default. You have to edit the config file and enable them manually under <code>modules</code> option, as can be seen in the sample config below.</p>

<p>Plugin specific configuration should be nested under plugin's name.</p>

<h4>Options</h4>

<ul>
<li><code>:log_dir: &lt;path&gt;</code> - directory where the logs are stored. The default is <code>/var/log/hammer/</code> and the log file is named <code>hammer.log</code></li>
<li><code>:log_level: &lt;level&gt;</code> - logging level. One of <code>debug</code>, <code>info</code>, <code>warning</code>, <code>error</code>, <code>fatal</code></li>
<li><code>:log_owner: &lt;owner&gt;</code> - logfile owner</li>
<li><code>:log_group: &lt;group&gt;</code> - logfile group</li>
<li><code>:log_size: 1048576</code> - size in bytes, when exceeded the log rotates. Default is 1MB</li>
<li><code>:watch_plain: false</code> - turn on/off syntax highlighting of data being logged in debug mode</li>
</ul>


<h4>Sample config</h4>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">:modules</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">hammer_cli_foreman</span>

<span class="l-Scalar-Plain">:foreman</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">:host</span><span class="p-Indicator">:</span> <span class="s">'https://localhost/'</span>
    <span class="l-Scalar-Plain">:username</span><span class="p-Indicator">:</span> <span class="s">'admin'</span>
    <span class="l-Scalar-Plain">:password</span><span class="p-Indicator">:</span> <span class="s">'changeme'</span>

<span class="l-Scalar-Plain">:log_dir</span><span class="p-Indicator">:</span> <span class="s">'/var/log/foreman/'</span>
<span class="l-Scalar-Plain">:log_level</span><span class="p-Indicator">:</span> <span class="s">'debug'</span></code></pre></div>


<div data-unique="3.6Upgrade" name="3.6Upgrade"></div><h2>3.6 Upgrade</h2>

<div data-unique="UpgradingtoForeman1.9" name="UpgradingtoForeman1.9"></div><h3>Upgrading to Foreman 1.9</h3>

<h4>Preparation</h4>

<p>Please note the following known issues:</p>

<ul>
<li>Hosts may lose their partition table association on upgrade, affecting rebuilds.
Edit and re-save the host to fix it (<a href="http://projects.theforeman.org/issues/11443">#11443</a>).</li>
</ul>


<p>When upgrading across more than one version it is recommended to upgrade to each
intermediate version and follow all upgrade instructions for the previous versions
before updating to 1.9.</p>

<h4>Step 1 - Backup</h4>

<p>It is recommended that you backup your database and modifications to Foreman
files(config/settings.yaml, unattended installations etc).  Most upgrades are
safe but it never hurts to have a backup just in case.</p>

<p>For more information about how to backup your instance head over to
<a href="http://theforeman.org/manuals/1.9/index.html#5.5.1Backup">Backup</a></p>

<h4>Step 2 - Perform the upgrade</h4>

<p>Before proceeding, it is necessary to shutdown the Foreman instance (e.g.
<code>service httpd stop</code> or <code>service apache2 stop</code> usually).</p>

<p>Now it's time to perform the actual upgrade.  This process if different
depending on how you downloaded Foreman.  You only need to perform <em>one</em> of
the following options.</p>

<h5>Step 2 (A) - Fedora or RHEL package (RPM) and installer setups</h5>

<p>To upgrade an existing Foreman installation, first update with the
appropriate foreman-release package for your operating system:</p>

<pre><code>yum upgrade http://yum.theforeman.org/releases/1.9/el6/x86_64/foreman-release.rpm
yum upgrade http://yum.theforeman.org/releases/1.9/el7/x86_64/foreman-release.rpm
yum upgrade http://yum.theforeman.org/releases/1.9/f19/x86_64/foreman-release.rpm
</code></pre>

<p>Clean up the yum cache:</p>

<pre><code>yum clean all
</code></pre>

<p>Next upgrade all Foreman packages:</p>

<pre><code>yum upgrade ruby\* foreman\*
</code></pre>

<div class="alert alert-info">On EL6, due to some new packages that are only partially available, add <code>--disablerepo=epel</code> to workaround errors regarding rubygem(thor) and rubygem(bundler).</div>


<p>In order to catch all configuration changes and manage them properly you should install and run
rpmconf from the EPEL repository along with vim-enhanced (for vimdiff):</p>

<pre><code>rpmconf -a --frontend=vimdiff
</code></pre>

<p>You can skip to Step 3.</p>

<h5>Step 2 (B) - Debian or Ubuntu package (deb) and installer setups</h5>

<p>Upgrading from the last release to 1.9 has been tested on both
Debian and Ubuntu. Updating the packages will upgrade the application and
automatically migrate the database.</p>

<p>First edit <code>/etc/apt/sources.list.d/foreman.list</code> and change the release
number from the previous release or "stable" to <code>1.9</code>:</p>

<pre><code>deb http://deb.theforeman.org/ wheezy 1.9
deb http://deb.theforeman.org/ plugins 1.9
</code></pre>

<p>Ubuntu 12.04 (Precise) users must ensure the Brightbox Ruby NG PPA is
configured and that the default Ruby version is 1.8:</p>

<pre><code>add-apt-repository ppa:brightbox/ruby-ng
update-alternatives --set ruby /usr/bin/ruby1.8
update-alternatives --set gem /usr/bin/gem1.8
</code></pre>

<p>Next upgrade all Foreman packages:</p>

<pre><code>apt-get update
apt-get --only-upgrade install ruby\* foreman\*
</code></pre>

<p>You can skip to Step 3.</p>

<h5>Step 2 (C) - Downloaded release (tar.bz2)</h5>

<ul>
<li>Uncompress the new program archive in a <em>new directory</em>.</li>
<li>Copy your database settings-file <code>config/database.yml</code> into the new <code>config</code> directory.</li>
<li>If your database is a simple file (e.g. SQLite), don't forget to make it available in the new directory.</li>
</ul>


<p>VERY IMPORTANT: do NOT overwrite <code>config/settings.yml</code> with the old one.</p>

<h5>Step 2 (D) - git checkouts</h5>

<p><em>Please note</em> now that the development branch has moved to Rails 3, you MUST
take care to select a branch and make sure you get the correct one.</p>

<ol>
<li>Go to the Foreman root directory and run the following command:</li>
</ol>


<p>For staying on the stable branch:</p>

<ul>
<li>git checkout 1.9-stable</li>
<li>git pull</li>
</ul>


<p>The following step is the one that could change the contents of your database.
Go to your new Foreman directory (or the git dir), then migrate and update the
contents of your database:</p>

<pre><code>foreman-rake db:migrate
foreman-rake db:seed
</code></pre>

<p>You should compile i18n strings and precompile assets now:</p>

<pre><code>foreman-rake locale:pack
foreman-rake assets:precompile
</code></pre>

<h4>Step 3 - Post-upgrade steps</h4>

<h5>Step 3 (A) - Database migration and cleanup</h5>

<p>The database should be migrated already, but you can make sure by executing the
migration script again, it should produce no errors or output:</p>

<pre><code>foreman-rake db:migrate
foreman-rake db:seed
</code></pre>

<p>You should clear the cache and the existing sessions:</p>

<pre><code>foreman-rake tmp:cache:clear
foreman-rake tmp:sessions:clear
</code></pre>

<h5>Step 3 (B) - Ubuntu 12.04 users, change Ruby version</h5>

<p>The configuration on Ubuntu 12.04 is now that the system-wide, default Ruby
version remains on 1.8 (with the update-alternatives commands earlier), but
that the Foreman app under Apache is changed to run under 1.9.</p>

<p>Edit both /etc/apache2/sites-available/05-foreman.conf and
/etc/apache2/sites-available/05-foreman-ssl.conf and anywhere inside the
<code>&lt;VirtualHost&gt;</code> block, add:</p>

<pre><code>PassengerRuby /usr/bin/ruby1.9.1
</code></pre>

<p>Lastly, install the necessary Passenger package for Ruby 1.9:</p>

<pre><code>apt-get install passenger-common1.9.1
</code></pre>

<h5>Optional Step 3 (C) - Run foreman-installer</h5>

<p>If you used foreman-installer to set up your existing Foreman instance we
recommend running it again after upgrading. Note that the installer can
modify config files so this may overwrite your custom changes. You can run
the installer in noop mode so you can see what would be changed.</p>

<p>To see what would happen</p>

<pre><code>foreman-installer --noop --dont-save-answers --verbose
</code></pre>

<p>You may see ERRORS such as <code>/Stage[main]/Foreman_proxy::Register/Foreman_smartproxy[foreman-hostname.domain]:</code> <code>Could not evaluate: Connection refused - connect(2)</code> due to httpd / apache2 service being stopped.  These can be safely ignored.</p>

<p>To apply these changes, run the installer again without options</p>

<pre><code>foreman-installer
</code></pre>

<h4>Step 4 - Restart</h4>

<p>Restart the application server (e.g. mongrel, thin, passenger).</p>

<p>On RPM installations, run:</p>

<pre><code>service httpd restart
</code></pre>

<p>And on Debian/Ubuntu installations with Passenger, run:</p>

<pre><code>service apache2 restart
</code></pre>

<h4>Common issues</h4>

<p>See
<a href="http://projects.theforeman.org/projects/foreman/wiki/Troubleshooting">Troubleshooting</a></p>

<div data-unique="4.GeneralForeman" name="4.GeneralForeman"></div><h1>4. General Foreman</h1>

<p>This section covers general information on using Foreman to manage 
your infrastructure. It covers the features of the web interface, 
managing puppet, provisioning systems and the installation and 
configuration of Foreman Smart Proxies.</p>

<div data-unique="4.1WebInterface" name="4.1WebInterface"></div><h2>4.1 Web Interface</h2>

<div data-unique="4.1.1LDAPAuthentication" name="4.1.1LDAPAuthentication"></div><h3>4.1.1 LDAP Authentication</h3>

<p>Foreman natively supports LDAP authentication using one or multiple LDAP directories.</p>

<h4>Setting up</h4>

<p>Go to <em>Administer &gt; LDAP Authentication</em>, click on <em>New LDAP Source</em> and enter the following details about the LDAP server:</p>

<ul>
<li><em>Name</em>: an arbitrary name for the directory</li>
<li><em>Server</em>: the LDAP hostname, e.g. <code>ldap.example.com</code></li>
<li><em>LDAPS</em>: check this if you want or need to use LDAPS to access the directory</li>
<li><em>Port</em>: the LDAP port (default is 389, or 636 for LDAPS)</li>
<li><em>Server type</em>: select the implementation if listed, else choose POSIX</li>
</ul>


<p>Under the account tab, the details of an account used to read LDAP 
entries is required if anonymous binds and reads are disabled.  This 
should be a dedicated service account with bind, read and search 
permissions on the user and group entries in the directory server.</p>

<p>This may use the variable <code>$login</code> which will be replaced 
by the login of the authenticating user, however this is deprecated and 
will result in reduced functionality (as it only works at authentication
 time).</p>

<ul>
<li><em>Account</em>: leave this field empty if your LDAP server can be read anonymously, otherwise enter a user name that has read access</li>
<li><em>Account password</em>: password for the account, if defined above and when not using $login</li>
<li><em>Base DN</em>: the top level DN of your LDAP directory tree, e.g. <code>dc=example,dc=com</code></li>
<li><em>Group base DN</em>: the top level DN of your LDAP directory tree that contains groups, e.g. <code>ou=Groups,dc=example,dc=com</code></li>
<li><em>LDAP filter</em> (optional): a filter to restrict your LDAP queries, for instance: <code>(memberOf=cn=foreman-users,ou=Groups,dc=example,dc=com)</code>. Multiple filters can be combined using the syntax <code>(&amp; (filter1) (filter2))</code>.</li>
</ul>


<h4>Trusting SSL certificates</h4>

<p>When configuring an LDAPS connection, the certificate authority needs
 to be trusted.
When using Active Directory Certificate Services, ensure to export the 
Enterprise PKI CA Certificate using the Base-64 encoded X.509 format.</p>

<p>If your LDAP server uses a certificate chain with intermediate CAs, 
all of the root and intermediate certificates in the chain must be 
trusted.</p>

<p>On Red Hat based OSes:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">cp example.crt /etc/pki/tls/certs/
ln -s example.crt /etc/pki/tls/certs/<span class="k">$(</span>openssl x509 -noout -hash -in /etc/pki/tls/certs/example.crt<span class="k">)</span>.0</code></pre></div>


<p>On Debian or Ubuntu, also ensure the file has a .crt extension:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">cp example.crt /usr/local/share/ca-certificates/
update-ca-certificates</code></pre></div>


<h4>On the fly user creation</h4>

<p>By checking <em>Automatically create accounts in Foreman</em>, any LDAP user will have their Foreman account automatically created the first time they log into Foreman.</p>

<p>To use this feature, the relevant LDAP attributes must be specified 
on the next tab (e.g. firstname, lastname, email), as these will be used
 to populate the Foreman account.</p>

<h4>Attribute mappings</h4>

<p>Foreman needs to know how to map internal user account attributes to 
their LDAP counterparts, such as login, name, and e-mail. Examples for 
common directory servers are provided below.</p>

<p>Note that LDAP attribute names are <em>case sensitive</em>.</p>

<p>Foreman also has the ability to use a user's photo stored in LDAP as 
their Foreman avatar, by setting the jpegPhoto attribute mapping.</p>

<p>Additional Information:</p>

<ul>
<li><a href="https://www.dalemacartney.com/2013/12/05/adding-display-picturesavatars-red-hat-idmfreeipa/">Adding Display Pictures/Avatars to Red Hat IDM/FreeIPA</a></li>
<li><a href="http://blogs.technet.com/b/btrst4/archive/2004/08/30/222629.aspx?Redirected=true">Using the jpegPhoto attribute in Active Directory</a></li>
</ul>


<h4>Examples</h4>

<p>All of the examples below use a dedicated service account called 
'foreman'.  This should be set up with bind, read and search permissions
 on the user and group entries and with a strong, random password.</p>

<h5>Active Directory</h5>

<p>Typically either LDAPS on port 636 or LDAP on port 389.</p>

<div>
  <table class="table table-bordered table-condensed">
    <thead>
      <tr>
        <th>Setting</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Account</td>
        <td>DOMAIN\foreman</td>
      </tr>
      <tr>
        <td>Base DN</td>
        <td>CN=Users,DC=example,DC=COM</td>
      </tr>
      <tr>
        <td>Groups base DN</td>
        <td>CN=Users,DC=example,DC=com</td>
      </tr>
      <tr>
        <td>Login name attribute</td>
        <td>sAMAccountName</td>
      </tr>
      <tr>
        <td>First name attribute</td>
        <td>givenName</td>
      </tr>
      <tr>
        <td>Surname attribute</td>
        <td>sn</td>
      </tr>
      <tr>
        <td>Email address attribute</td>
        <td>mail</td>
      </tr>
    </tbody>
  </table>
</div>


<h5>FreeIPA</h5>

<p>Typically either LDAPS on port 636 or LDAP on port 389.</p>

<div>
  <table class="table table-bordered table-condensed">
    <thead>
      <tr>
        <th>Setting</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Account</td>
        <td>uid=foreman,cn=users,cn=accounts,dc=example,dc=com</td>
      </tr>
      <tr>
        <td>Base DN</td>
        <td>cn=users,cn=accounts,dc=example,dc=com</td>
      </tr>
      <tr>
        <td>Groups base DN</td>
        <td>cn=groups,cn=accounts,dc=example,dc=com</td>
      </tr>
      <tr>
        <td>Login name attribute</td>
        <td>uid</td>
      </tr>
      <tr>
        <td>First name attribute</td>
        <td>givenName</td>
      </tr>
      <tr>
        <td>Surname attribute</td>
        <td>sn</td>
      </tr>
      <tr>
        <td>Email address attribute</td>
        <td>mail</td>
      </tr>
    </tbody>
  </table>
</div>


<h5>OpenLDAP</h5>

<p>Typically LDAP on port 389 and with anonymous queries (leave Account blank), unless configured otherwise.</p>

<div>
  <table class="table table-bordered table-condensed">
    <thead>
      <tr>
        <th>Setting</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Account</td>
        <td>uid=foreman,dc=example,dc=com</td>
      </tr>
      <tr>
        <td>Base DN</td>
        <td>dc=example,dc=com</td>
      </tr>
      <tr>
        <td>Groups base DN</td>
        <td>dc=example,dc=com</td>
      </tr>
      <tr>
        <td>Login name attribute</td>
        <td>uid</td>
      </tr>
      <tr>
        <td>First name attribute</td>
        <td>givenName</td>
      </tr>
      <tr>
        <td>Surname attribute</td>
        <td>sn</td>
      </tr>
      <tr>
        <td>Email address attribute</td>
        <td>mail</td>
      </tr>
    </tbody>
  </table>
</div>


<h4>Linking user groups to LDAP</h4>

<p>A Foreman user group can be associated to a group stored in an LDAP 
server, so membership of the LDAP group automatically adds a user to the
 Foreman user group.  User groups can be associated with roles, enabling
 users to log into Foreman and be automatically granted permissions via 
their membership of an LDAP group.  Read more about permissions in the <a href="http://theforeman.org/manuals/1.9/index.html#4.1.2RolesandPermissions">Roles and Permissions</a> section.</p>

<p>To configure the association, create or edit a user group via <em>Administer &gt; User groups</em>.  The group name may be any value (no direct relation to the LDAP group).  Under the <em>Roles</em> tab, select roles granting permissions to Foreman, or tick the <em>Admin</em> checkbox to enable administrator level access.</p>

<p>On the <em>External groups</em> tab, click the <em>Add external user group</em> button to open a new form.  In the <em>Name</em>
 field, enter the exact name of the LDAP group (usually the common 
name/CN) and select the server from the dropdown list of LDAP 
authentication sources.  Click the <em>Submit</em> button to save changes.</p>

<p>When a user logs in for the first time (assuming on the fly account 
creation), the ldap:refresh_usergroups cronjob runs (every 30 minutes by
 default) or the <em>Refresh</em> button is pressed next to the external user group entry, Foreman will synchronize the group membership from LDAP.</p>

<h5>Security Disclaimer</h5>

<p>Please remember your external user groups will only be refreshed 
automatically through the ldap:refresh_usergroups cronjob. There can be a
 lapse of time cronjob runs, in which if the user groups in LDAP change,
 the user will be assigned to the wrong external user groups. This 
situation can be quickly fixed by manually running <code>foreman-rake ldap:refresh_usergroups</code>
 or by refreshing the external user groups in the UI. Otherwise, the 
problem will eventually get fixed when the cronjob runs again.</p>

<h4>Active Directory password changes</h4>

<p>When using Active Directory, please be aware that users will be able 
to log in for up to an hour after a password change using the old 
password. This is a function of the AD domain controller and not 
Foreman.</p>

<p>To change this password expiry period, see <a href="https://support.microsoft.com/en-us/kb/906305">Microsoft KB906305</a> for the necessary registry change.</p>

<h4>Troubleshooting</h4>

<p>If you want to use on the fly user creation, make sure that Foreman 
can fetch from your LDAP all the required information to create a valid 
user.
For example, on-the-fly user creation won't work if you don't have valid
 email adresses in your directory (you will get an 'Invalid 
username/password' error message when trying to log in).</p>

<div data-unique="4.1.2RolesandPermissions" name="4.1.2RolesandPermissions"></div><h3>4.1.2 Roles and Permissions</h3>

<p>A user's access to the features of Foreman are constrained by the <strong>permissions</strong>
 that they are granted. These permissions are also used to restrict the 
set of hosts, host groups and other resources that a user is able to 
access and modify.</p>

<p>Note: a user with global admin enabled is not restricted by the 
authorization system. This is the default for installations that do not 
have :login:true in <em>config/settings.yml</em>.</p>

<p>A logged in user will be granted the <strong>Anonymous</strong> role 
plus one or more additional roles. The permissions and filters 
associated with these roles are aggregated and determine the final 
permission set.</p>

<p>Roles may be administered by users with admin privileges or regular 
users with 'edit_roles' permission. In order to add new filters and 
permissions to a role, regular users must have the 'create_filters' 
permission.</p>

<h4>Roles</h4>

<p>These may be created, deleted and edited on the <strong>Roles</strong>
 page. Each role will contain permission filters, which define the 
actions allowed in a certain resource. Once your role is created, you 
can associate it with one or more users and user groups.</p>

<p>There are two builtin system roles</p>

<ol>
<li><p>Anonymous: This is a set of permissions that every user at your 
installation will be granted, irrespective of any other roles that they 
have.</p></li>
<li><p>Default user: When a new Role is created this set of permissions 
are used as the template for the Role. The name is somewhat misleading 
but basically an ordinary default user who was assigned this Role would 
have these permissions set.</p></li>
</ol>


<h4>Filters</h4>

<p>Filters are defined within the context of a role, clicking on the 
'filters and permissions' link. A filter allows an user to choose a <strong>resource</strong> (Hosts, Host groups, etc...) and the <strong>permissions</strong>
 that should be granted for that resource. After a filter has been 
created, users given a role containing this filter will have the 
permissions for the resource specified at the filter.</p>

<p>If the filter is marked as 'Unlimited?', the permissions created in 
this filter will apply to all objects in the chosen resource. For 
instance, if the resource is Host, and the permissions are 'view' and 
'index', and 'Unlimited?' is checked, users that have a role with this 
filter will be able to 'view' and 'index' all hosts in the system.</p>

<p>When 'Unlimited?' is unchecked, a text box allowing to define more 
granular filtering will be enabled. You can write a search query and 
permissions in this filter will be applied to the results of that query 
only. An example of a query for the resource Host could be 'os = 
RedHat'. In this case, the permissions in this filter will be applied 
only to Hosts whose Operating System is set to Red Hat. You can test 
your search queries at the index page of your resource, in this case 
that would be '/hosts'.</p>

<p>Some example queries for the resource Host:</p>

<ol>
<li><p>Ownership and domain membership: 'owner_id = 95 and domain = 
localdomain' -  Will apply permisisons to hosts owned by User with id 95
 and in the domain 'localdomain'</p></li>
<li><p>Compute resource membership: 'compute_resource = Openstack' - 
Will apply permissions to hosts deployed on compute resource Openstack.</p></li>
<li><p>Fact filtering: 'facts.alarmlevel = high' - Will apply 
permissions to hosts with a fact 'alarmlevel' with value 'high'. As a 
fact is only generated during a puppet run, this filter will only refer 
to machines that have been built and therefore cannot be used to 
restrict the creation of machines.</p></li>
</ol>


<p>These pools of queries can be combined by adding them together or the
 filters can be used to restrict the selected resource to a smaller and 
smaller subset of the total. Think of them as set operations.</p>

<p>Note: If the "Administrator" check box is checked for a user, filtering will not take effect.</p>

<h4>Permissions</h4>

<p>These determine the operations that are allowed to be performed upon 
the resources to which they refer. For a few simple items like 
bookmarks, this operates as expected - it grants permission for all 
bookmarks. But for most resources, such as the hosts a user is able to 
operate on, there is an additional layer of security called filtering.</p>

<p>When editing a filter there is a search field at the bottom that 
narrows the scope of the permissions granted to a subset of the resource
 objects. Most permission types support this search field however there 
are some exceptions. The permission for creating objects can't be 
limited by a search query because the object does not exist during 
creation. Therefore a user is granted the create permission if they are 
associated with any filter containing this permission (limited by search
 or not).</p>

<p>Following table lists some of permissions and their impact:</p>

<table class="table table-bordered table-condensed">
    <tbody><tr>
      <th>Permission</th>
      <th>Description</th>
    </tr>
    <tr>
      <td colspan="2"><strong><em>Permissions for Architectures, 
Authentication providers, environments, External variables, Common 
parameters, Medias, Models, Operating systems, Partition tables, Puppet 
classes and User groups</em></strong></td>
    </tr>
    <tr>
      <td>view</td>
      <td>The user is allowed to see this type of object when listing them on the index page</td>
    </tr>
    <tr>
      <td>create</td>
      <td>The user is allowed to create this type of object </td>
    </tr>
    <tr>
      <td>edit</td>
      <td>The user is allowed to edit this type of object</td>
    </tr>
    <tr>
      <td>destroy</td>
      <td>The user is allowed to destroy this type of object</td>
    </tr>
    <tr>
      <td colspan="2"><strong><em>Permissions for Domains</em></strong></td>
    </tr>
    <tr>
      <td>view</td>
      <td>The user is allowed to see a list of domains when viewing the index page</td>
    </tr>
    <tr>
      <td>create</td>
      <td>The user is allowed to create a new domain and will also be able to create domain parameters </td>
    </tr>
    <tr>
      <td>edit</td>
      <td>The user is allowed to edit a domain and will also be able to 
edit a domain's parameters. If they have domain filtering active in 
their profile then only these domains will be editable</td>
    </tr>
    <tr>
      <td>destroy</td>
      <td>The user is allowed to destroy a domain and will also be able 
to destroy domain parameters. If they have domain filtering active in 
their profile then only these domains will be deletable</td>
    </tr>
    <tr>
      <td colspan="2"><strong><em>Permissions for Host groups</em></strong></td>
    </tr>
    <tr>
      <td>view</td>
      <td>The user is allowed to see a list of host groups when viewing the index page</td>
    </tr>
    <tr>
      <td>create</td>
      <td>The user is allowed to create a new host group and will also be able to create host group parameters </td>
    </tr>
    <tr>
      <td>edit</td>
      <td>The user is allowed to edit a host group and will also be able
 to edit a host group's parameters. If they have host group filtering 
active in their profile then only these host groups will be editable</td>
    </tr>
    <tr>
      <td>destroy</td>
      <td>The user is allowed to destroy a host group and will also be 
able to destroy host group parameters. If they have host group filtering
 active in their profile then only these host groups will be deletable</td>
    </tr>
    <tr>
      <td colspan="2"><strong><em>Permissions for Hosts</em></strong></td>
    </tr>
    <tr>
      <td>view</td>
      <td>The user is allowed to see a list of hosts when viewing the index page. This list may be constrained by the user's host filters</td>
    </tr>
    <tr>
      <td>create</td>
      <td>The user is allowed to create a new host. This operation may be constrained by the user's host filters </td>
    </tr>
    <tr>
      <td>edit</td>
      <td>The user is allowed to edit a host. This operation may be constrained by the user's host filters</td>
    </tr>
    <tr>
      <td>destroy</td>
      <td>The user is allowed to destroy a host. This operation may be constrained by the user's host filters</td>
    </tr>
    <tr>
      <td colspan="2"><strong><em>Permissions for Users</em></strong></td>
    </tr>
    <tr>
      <td>view</td>
      <td>The user is allowed to see a list of users when viewing the 
index page. A user will always be able to see their own account even if 
they do not have this permission</td>
    </tr>
    <tr>
      <td>create</td>
      <td>The user is allowed to create a new user </td>
    </tr>
    <tr>
      <td>edit</td>
      <td>The user is allowed to edit existing users. A user will always be able to edit their own basic account settings and password</td>
    </tr>
    <tr>
      <td>destroy</td>
      <td>The user is allowed to delete users from the system</td>
    </tr>
  </tbody></table>


<div data-unique="4.1.3Trends" name="4.1.3Trends"></div><h3>4.1.3 Trends</h3>

<p>Trends in Foreman allow you to track changes in your infrastructure 
over time. It allows you to track both Foreman related information and 
any puppet facts. The Trend pages give a graph of how the number of 
hosts with that value have changed over time, and the current hosts 
list.</p>

<p>There are two pieces to the Trends area, the Trends to track and 
their corresponding counters. To define trend counters, use the "Add 
Trend Counter" button on the '/trends' page. Optionally set the "Name" 
field to over-ride odd puppet fact names to be more readable. Once 
created you can optionally 'Edit' the Trend to change the display names 
of the underlying values.</p>

<p>Next, to start collecting trend data, set a cron job to execute 
'foreman-rake trends:counter'. Each time the rake task executes it will 
create 1 tick on the graphs, so you can fine tune the granularity with 
your cron job. We recommend using the same as your puppet run interval 
(30 minutes). Here's an example to run once per hour:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="m">0</span> * * * * /usr/sbin/foreman-rake trends:counter</code></pre></div>


<p>Finally note that these trends are the same for all users. So if you 
delete a Trend category you will loose all history for that trend and 
the trackers will start all over again. So please be careful when 
deleting.</p>

<div data-unique="4.1.4Auditing" name="4.1.4Auditing"></div><h3>4.1.4 Auditing</h3>

<p>Foreman supports auditing of almost all changes that happen within 
Foreman, from both the UI and from the API. Auditing is done at a user 
level, and is thus ineffective if <em>:login:</em> is set to <em>false</em>, as all audits will be done as the 'admin' user.</p>

<h4>Basic View</h4>

<p>Go to the Audit tab to see a view of what has changed. This view can 
be
filtered by the type of change or by the object that was altered (e.g. 
search
for a hostname to see all changes relating to that host). You also get 
the
parent object - so if a parameter was modified, you can see what 
host/group that parameter belongs to. The timestamp of the change and 
the user who performed it will be listed.</p>

<h4>Extended Audits for Templates</h4>

<p>Template changes also store a diff of the changes, and the ability to roll back to a previous version of the template.</p>

<div data-unique="4.1.5Searching" name="4.1.5Searching"></div><h3>4.1.5 Searching</h3>

<p>Each page in Foreman has its own search functionality, which is 
centred around the resources that it manages, allowing searching based 
on attributes of the resources in the list or resources that they're 
associated to.  The search box also features powerful auto-completion to
 help build up search queries and free text search on many pages.  The 
search functionality can also be used in the API when listing resources,
 see <a href="http://theforeman.org/manuals/1.9/index.html#5.1.4CustomizeJSONResponses">Customize JSON Responses</a> for details.</p>

<h4>General usage</h4>

<p>Searching is through "field = value" or free text queries, which can 
be combined with logical operators (and, or, not) and parentheses to 
handle more complex logic.  To give some examples:</p>

<ul>
<li><code>name = client.example.com</code> on the host list would show the host(s) whose hostname is client.example.com</li>
<li><code>hostgroup = "Web servers" and domain != lon.example.com</code> would show hosts in the Web servers host group, but not in the lon.example.com domain</li>
<li><code>Web servers</code> would show all hosts with that text anywhere, e.g. as their host group name or in the comment field</li>
</ul>


<p>The fields available depend on the type of resource that's being 
searched, and the names of the attributes vary depending on the context.
  The "name" field on the host groups list is equivalent to the 
"hostgroup" field on the hosts list.  Requests to add additional 
searchable fields are welcome, and may be filed in the "Search" category
 <a href="http://projects.theforeman.org/projects/foreman/issues/new">in the bug tracker</a>.</p>

<p>The search engine is provided by the scoped_search library, which maps search queries directly to SQL queries.  The <a href="https://github.com/wvanbergen/scoped_search/wiki/Query-language">Query Language</a> documentation provides A more complete specification of the syntax available.</p>

<h4>Bookmarks</h4>

<p>Foreman supports the ability to make search bookmarks, allows users 
to quickly jump to predefined search conditions.  Available bookmarks 
can be selected from the dropdown menu to the right of the search box, 
or managed from <em>Administer &gt; Bookmarks</em>.</p>

<p>Some of the bookmarks are provided by default, e.g. to search for active or inactive hosts, or to only view reports with events.</p>

<p>To save a query, Use the dropdown menu to the right of the search box
 and click "Bookmark this search".  When saving, the bookmark can be 
labeled as public, so all other users are able to see and use it too.</p>

<h4>Free text search</h4>

<p>If you ignore the auto-completer and just enter text in the search 
field, Foreman will try searching for that text across multiple fields.</p>

<p>For example, if you just enter <code>12</code> in the the hosts 
search box, the results will include all hosts with 12 in their IP 
address, MAC address or name.  In general the fields used for free text 
search are kept to a minimumfor performance and accuracy reasons.  It's 
preferable to search using a specific field, e.g. when searching for an 
IP address, use <code>ip ~ 12</code> instead of <code>12</code>.</p>

<h4>Searching for present/empty values</h4>

<p>The "has" operator matches values that are present, e.g. to search for hosts that are on a compute resource, use <code>has compute_resource</code>.</p>

<p>Similarly, this can be negated, so to search for hosts without host groups, you can use <code>not has hostgroup</code>.</p>

<h4>Case sensitivity</h4>

<p>When querying using <code>=</code> and <code>!=</code> operators then exact, case sensitive matches will be returned.  When running <code>~</code> (like) and <code>!~</code> (unlike) operators, the matching is case insensitive.</p>

<h4>Quoting</h4>

<p>In search queries, white spaces are used as a delimiter. Here are some examples of the way a query will be interpreted:</p>

<ul>
<li><code>description ~ "created successfully"</code>: list all notifications that contain "created successfully"</li>
<li><code>description ~ created successfully</code>: list all notifications that contain "created" and at least one of its text fields contains "successfully"</li>
<li><code>description !~ created successfully</code>:  list all notifications that doesn't contain "created" and at least one of its text fields contains "successfully"</li>
</ul>


<p>In the second and third example, "successfully" is an additional term that is interpreted as a free text search</p>

<h4>Wildcards ('_', '%', '*')</h4>

<p>The <code>~</code> and <code>!~</code> search operators are translated to the <code>LIKE</code> and <code>NOT LIKE</code> SQL queries respectively, which support two basic wildcards, <code>_</code> and <code>%</code>.</p>

<p><code>_</code> is a wildcard for a single character replacement. For example, the search <code>name ~ fo_</code> will match both "foo" and "for".</p>

<p>The <code>%</code> and <code>*</code> wildcard will replace zero or more characters. For example, the search <code>name ~ corp%</code> will match both "corp" and "corporation". The more common * wildcard is not a SQL wildcard but may be used instead.</p>

<p>When the <code>~</code> or <code>!~</code> search is processed, a %
 wildcard is automatically added at the beginning and end of the value 
if no wildcard is used, so it will by default match at any location 
inside a string.  For example, the search <code>name ~ foo</code> is equivalent to <code>name ~ %foo%</code> and the search <code>name ~ foo%</code> will only match "foo" at the beginning of the value.</p>

<h4>Date-time search query syntax</h4>

<p>Many date and time formats are accepted in search queries.  Here are some examples:</p>

<ul>
<li>"30 minutes ago", "1 hour ago", "2 hours ago", Today, Yesterday</li>
<li>"3 weeks ago", "1 month ago", "6 days ago", "July 10,2011"</li>
</ul>


<p>The date can have different separators, "10-July-2011" will be 
interpreted in the same way as "10/July/2010" or "10 July 2011" Month 
names may be the full English name or a three letter abbreviation, e.g. 
"Jan" will be interpreted as "January".  Many other formats are also 
acceptable, however it is not recommended to use ambiguous formats such 
as "3/4/2011"</p>

<p>The valid date time operators are =, &lt; and &gt; which are 
interpreted as at, before and after respectively. This is how the 
search term interpeted:</p>

<p>The right hand part of a date-time condition is parsed and translated
 into a specific date-time, "30 minutes ago" is translated to "now - 30 
minutes".</p>

<ul>
<li><code>last_report &gt; "2011-07-01 12:57:18 EDT"</code> should be read as created after this time</li>
<li>In the same way, <code>last_report &gt; "30 minutes ago"</code> should be read as "created after 30 minutes ago" and not "created more then 30 minutes ago"</li>
</ul>


<p>A search query like <code>installed_at = Yesterday</code> is 
translated into a period query, it will be translated at runtime to 
match a range of date-times. For example, if running on Jan 1, it would 
be translated into "(installed_at &gt;= Jan 1,2012 00:00) and 
(installed_at &lt; Dec 31,2011 00:00)".</p>

<div data-unique="4.2ManagingPuppet" name="4.2ManagingPuppet"></div><h2>4.2 Managing Puppet</h2>

<p>In this section we'll look at the various ways we can control and interact with Puppet.</p>

<div data-unique="4.2.1Environments" name="4.2.1Environments"></div><h3>4.2.1 Environments</h3>

<p>Puppet environments are mapped directly into Foreman. They can be 
used at various levels throughout the Foreman interface. Puppet 
environments are generally used to separate classes from different types
 of Host, typically allowing changes to a module to tested in one 
environment (e.g. development) before being pushed to another (e.g 
production).</p>

<h4>Defining environments</h4>

<p>There are several ways to create Puppet environments within Foreman.</p>

<h5>Importing from Puppet</h5>

<p>Foreman can detect all the environments and classes contained on a 
Puppet master, and import them automatically. To do this, go to <em>Configure &gt; Environments</em> and click on <em>Import from <proxy-name></proxy-name></em>.
 Foreman will scan the Puppet master via the Smart Proxy, and display a 
confirmation of the detected changes. Select the changes you wish to 
apply and confirm.</p>

<p>More information about configuring the Smart Proxy to read environments and Puppet classes is in the <a href="http://theforeman.org/manuals/1.9/index.html#4.3.6Puppet">Smart Proxy Puppet</a> section.</p>

<p>Note that the Smart Proxy will only detect environments that contain 
one or more Puppet classes, so ensure that at least one Puppet module 
containing a class has been deployed to the Puppet master.</p>

<h5>Manual creation</h5>

<p>To create an environment by hand, simply go to <em>Configure &gt; Environments</em> and click <em>New Puppet Environment</em>.
 Give the new environment a name and save.  Note that if the environment
 doesn't exist on the Puppet master and you subsequently run an import 
(above), Foreman will prompt for the environment to be deleted.</p>

<h4>Assigning environments to hosts</h4>

<p>This is done from the Host Edit page, on the Host tab. Selecting an 
environment will filter the classes visible on the Puppet Classes tab to
 just the classes in the selected environment.</p>

<p>You can also also mass-assign an environment to a group of hosts - 
tick the checkboxes of the required hosts in the Hosts list, and then 
select <em>Change Environment</em> from the <em>Select Action</em> dropdown menu at the top of the page.</p>

<h4>Environments with host groups</h4>

<p>You can assign an environment to a hostgroup as well. This functions 
as a form
of default - a user creating a new host and selecting the hostgroup will
automatically have the environment pre-selected. The user is not 
prevented from changing the environment of the new host, it simply saves
 a few clicks if they are happy with it.</p>

<div data-unique="4.2.2Classes" name="4.2.2Classes"></div><h3>4.2.2 Classes</h3>

<p>Puppet classes are generally imported from the Puppet Master(s) via the Import
button on the Puppet Classes page. They can also be created by hand, and
manually associated with a set of environments (for filtering purposes).</p>

<h4>Importing Classes</h4>

<p>Go to <em>Configure &gt; Puppet Classes</em> and click the Import 
button. This will not be visible unless you have at least one Puppet 
Master with a puppet-enabled Smart Proxy. Only classes from modules will
 be imported, and the Puppet manifests <em>must</em> be valid in order for the Smart Proxy to parse them.  Use <code>puppet parser validate</code> to test the syntax of Puppet manifests.</p>

<p>More information about configuring the Smart Proxy to read environments and Puppet classes is in the <a href="http://theforeman.org/manuals/1.9/index.html#4.3.7Puppet">Smart Proxy Puppet</a> section.</p>

<h5>The "Hosts" Column</h5>

<p>Under <em>Configure &gt; Puppet Classes</em> you will also see a 
column called "Hosts". This column represents the number of hosts the 
given module/class has been assigned to. Clicking this figure will list 
the hosts.</p>

<h5>Ignoring classes on import</h5>

<p>It's often to have a module structure like this:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>tree git/
git/
 manifests
     init.pp
     install.pp
     params.pp
     repo.pp</code></pre></div>


<p>In this situation, Foreman would offer to create:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">git
git::install
git::params
git::repo</code></pre></div>


<p>However, if we know that the subclasses are not intended for direct 
consumption, but are only really part of the internal structure of the 
module, then we would want to exclude those from the import mechanism, 
so that Foreman only offers to import <em>git</em>. We can achieve this via the file <em>/usr/share/foreman/config/ignored_environments.yml</em>.
 This file takes a set of regular expressions - any class which matches 
one of them will not be imported. So, for this example, we might 
configure:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">:filters:
  - !ruby/regexp <span class="s1">'/install$/'</span>
  - !ruby/regexp <span class="s1">'/params$/'</span>
  - !ruby/regexp <span class="s1">'/repo$/'</span></code></pre></div>


<h4>Assigning classes to hosts</h4>

<p>To cause Puppet to apply your classes, you will need to assign them to your
hosts.  This can be achieved in a number of ways - the best method may vary
depending on how many classes you intend to assign and whether any parameters
need to be overridden.</p>

<h5>Individual host assignment</h5>

<p>When editing a host, Puppet clases may be assigned directly under the <em>Puppet
Classes</em> tab.  All classes that are in the Puppet environment selected on the
first <em>Host</em> tab will be listed.</p>

<h5>Via a host group</h5>

<p>Host groups tend to correspond to an infrastructure role as each host may be
assigned to a single host group, and typically inherits most of its Puppet
classes in this way.</p>

<p>Puppet classes can be assigned by editing the host group and selecting them
on the <em>Puppet Classes</em> tab.</p>

<p>Most host group attributes are copied to a host when it is created, however
Puppet class associations remain inherited from the host group throughout its
lifetime.  Any change to a host group's assigned Puppet classes or parameters
will affect any host with that host group set.</p>

<p>The Puppet environment attribute may be different on the host to the host
group, which means that Puppet classes assigned to the host group may not
exist in the host's own Puppet environment.  Any Puppet classes that are
inherited from the host group, but do not exist in the host's environment will
be left out when Foreman renders the ENC (YAML) output.  Check under
<em>Configure &gt; Puppet classes</em> that the classes are available in both the host
group and host environments if they differ.</p>

<p>You can also also mass-assign a host group to a number of hosts - tick the
checkboxes of the required hosts in the Hosts list, and then select <em>Change
Group</em> from the <em>Select Action</em> dropdown menu at the top of the page.</p>

<h5>Using config groups</h5>

<p>A config group provides a one-step method of associating many Puppet classes
to either a host or host group.  Typically this would be used to add a
particular application profile or stack in one step.</p>

<p>To create a config group, click on <em>Configure &gt; Config groups</em>, click <em>New
Config Group</em>, enter a name and select the desired Puppet classes.  When
editing either a host or host group, the new config group can be added at the
top of the <em>Puppet classes</em> tab.</p>

<p>Config groups are not specific to an environment and so only those Puppet
classes that are in the host's environment when rendering the ENC (YAML) will
be listed.  Any classes that are not listed in the environment (as per
<em>Configure &gt; Puppet classes</em>) will be left out.</p>

<p>Note that it isn't possible to use a smart class parameter override with a
config group, as a host may have many config groups with no way to define an
order of precedence.  Overrides should be made on a host group, host or other
attribute.</p>

<h5>Checking the results</h5>

<p>To see how Foreman is passing the classes to Puppet, go to a Host and
 click the YAML button. You will be shown the exact YAML data sent to 
the Puppet master - the classes will be in the "classes" hash.</p>

<div data-unique="4.2.3Parameters" name="4.2.3Parameters"></div><h3>4.2.3 Parameters</h3>

<p>Foreman can pass two types of parameters to Puppet via the ENC (<a href="https://docs.puppetlabs.com/guides/external_nodes.html">External Node Classifier</a>)
 interface - global parameters (accessible from any manifest), and class
 parameters (scoped to a single Puppet class).  These can be added in a 
number of ways through Foreman.</p>

<p>Generally speaking, it's best to use class parameters where possible,
 as this makes designing, using and sharing Puppet modules and classes 
easier.  The class may clearly specify which parameters it expects, 
provide sensible defaults and allow users to override them.  Foreman is 
also able to import information about class parameters automatically, 
making it easier to consume new classes without needing to know and 
enter the precise names of global parameters.</p>

<h4>Types of parameters in Puppet</h4>

<p>In Puppet's DSL, accessing a global parameter or variable is done using <code>$::example</code> (preferred) or <code>$example</code> for a parameter named "example" in Foreman.  More information about accessing variables is available in the <a href="https://docs.puppetlabs.com/puppet/latest/reference/lang_variables.html#syntax">Puppet Language: Variables</a> documentation.  When looking at the ENC (YAML) output from Foreman, a global parameter will look like this:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">parameters</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">example</span><span class="p-Indicator">:</span> <span class="s">"foo</span><span class="nv"> </span><span class="s">bar"</span></code></pre></div>


<p>When using class parameters, a <a href="https://docs.puppetlabs.com/puppet/latest/reference/lang_classes.html#defining-classes">class will first be defined</a> with a parameter and may be accessed either using the local name or fully-qualified, e.g.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="n">example</span><span class="p">(</span><span class="vg">$setting</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">notice</span><span class="p">(</span><span class="vg">$setting</span><span class="p">)</span>
  <span class="n">notice</span><span class="p">(</span><span class="vg">$:</span><span class="ss">:example</span><span class="o">::</span><span class="n">setting</span><span class="p">)</span>  <span class="c1"># fully-qualified</span>
<span class="p">}</span></code></pre></div>


<p>When looking at the ENC (YAML) output from Foreman, a class and class parameter will look like this:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">classes</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">example</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">setting</span><span class="p-Indicator">:</span> <span class="s">"foo</span><span class="nv"> </span><span class="s">bar"</span></code></pre></div>


<h4>Types of parameters in Foreman</h4>

<p>Global parameters in Foreman can be added in the following places:</p>

<ul>
<li>Globally, per-resource (e.g. host group, domain) or per-host</li>
<li><a href="http://theforeman.org/manuals/1.9/index.html#4.2.4SmartVariables">Smart variables</a></li>
</ul>


<p>Class parameters in Foreman can be set in:</p>

<ul>
<li><a href="http://theforeman.org/manuals/1.9/index.html#4.2.5ParameterizedClasses">Puppet classes, as a smart class parameter</a></li>
</ul>


<h4>Global parameters</h4>

<p>Host inherit their list of global parameters from the following locations, in order of increasing precedence:</p>

<ul>
<li>Globally defined parameters, under <em>Configure &gt; Global parameters</em>.  These apply to every host.</li>
<li>Organization-level parameters if organizations are enabled, under <em>Administer &gt; Organizations &gt; edit &gt; Parameters</em>.</li>
<li>Location-level parameters if locations are enabled, under <em>Administer &gt; Locations &gt; edit &gt; Parameters</em>.</li>
<li>Domain-level parameters, under <em>Infrastructure &gt; Domains &gt; edit &gt; Parameters</em>.</li>
<li>Operating system-level parameters, under <em>Hosts &gt; Operating systems &gt; edit &gt; Parameters</em>.</li>
<li>Host group-level parameters, under <em>Configure &gt; Host groups &gt; edit &gt; Parameters</em>.</li>
<li>Host parameters, under <em>Hosts &gt; All hosts &gt; edit &gt; Parameters</em>.</li>
</ul>


<p>The final (most specific) level of global parameters applies only to a single host. Edit a Host and switch to the <em>Parameters</em>,
 and you will see all of its inherited parameters from the previous 
levels.  Note that they will all be marked as "Scope: Global" as this 
refers to the Puppet scope, not the Foreman scope.  You can override any
 of these previously-defined parameters or define new ones here.</p>

<h4>Checking the results</h4>

<p>To see how Foreman is passing the parameters to Puppet, go to a Host 
and click the YAML button. You will be shown the exact YAML data sent to
 the Puppet master - the parameters will be in the "parameters" hash.</p>

<div data-unique="4.2.4SmartVariables" name="4.2.4SmartVariables"></div><h3>4.2.4 Smart Variables</h3>

<p>Smart variables are a tool to provide global parameters (key/value 
data), normally to your Puppet ENC, depending on a set of rules. They 
are intended to be a stepping stone to full parameterized classes, when 
the class hasn't been parameterized or in special cases when a global 
parameter is desired.  The <a href="http://theforeman.org/manuals/1.9/index.html#4.2.6SmartMatchers">same matching/rules technology</a> underpins both smart variables and smart class parameters.  If in doubt, use <a href="http://theforeman.org/manuals/1.9/index.html#4.2.5ParameterizedClasses">smart class parameters</a>.</p>

<p>Smart variables are associated with a Puppet class, but they result 
in a global parameter.  They may have multiple possible values, all 
depending on hierarchical context or various conditions a user can wish 
to apply.  For example:</p>

<p><img src="Foreman%20::%20Manual_archivos/4.png" alt="Example"></p>

<h4>Creating a smart variable</h4>

<p>Start by going to <em>Configure &gt; Puppet classes</em> and then click one of your classes to edit it.</p>

<p>Click on the <em>Smart Variables</em> tab. If you have any existing smart variables, they will be listed at the left side of the tab.</p>

<p>Click New Variable, and you will be presented with a set of input fields:</p>

<table class="table table-bordered table-condensed">
    <tbody>
    <tr>
      <td>Name</td>
      <td>What the parameter will be called in the ENC data</td>
    </tr>
    <tr>
      <td>Description</td>
      <td>A free form text box for your own information</td>
    </tr>
    <tr>
      <td>Default Value</td>
      <td>Value supplied to the ENC if no other criteria is matched</td>
    </tr>
</tbody></table>


<p>Once you've created the defaults for your smart variable, you can 
then add at least one criterion to match against - click the "plus" 
under your variable, and two more input fields will appear:</p>

<table class="table table-bordered table-condensed">
    <tbody>
    <tr>
      <td>Match</td>
      <td>Should state a name = value relationship that Foreman use to match against the entries in searchlist</td>
    </tr>
    <tr>
      <td>Value</td>
      <td>What the parameter should be in the ENC, if this rule is matched</td>
    </tr>
</tbody></table>


<h4>Advanced usage</h4>

<p>Smart variables are based on the smart matchers technology, and have a
 number of advanced features such as validation and multiple data types.
  More about these can be found in the <a href="http://theforeman.org/manuals/1.9/index.html#4.2.6SmartMatchers">Smart Matchers</a> section.</p>

<h4>API usage</h4>

<p>It's also possible to retrieve these values if you're not using a 
ENC, via a custom Puppet function or a http request.. You'll need to 
retrieve the value from</p>

<pre><code>https://foreman/api/v2/hosts/&lt;fqdn&gt;/lookup_keys/&lt;key&gt;
</code></pre>

<p>You can find a ready-made function for your puppet module <a href="https://github.com/theforeman/puppet-foreman/blob/master/lib/puppet/parser/functions/smartvar.rb">here</a></p>

<div data-unique="4.2.5ParameterizedClasses" name="4.2.5ParameterizedClasses"></div><h3>4.2.5 Parameterized Classes</h3>

<p>Parameterized class support permits detecting, importing, and 
supplying parameters direct to classes which support it, via the ENC.  
This requires Puppet 2.6.5 or higher.</p>

<h4>Setup</h4>

<p>By default, parameterized class support is enabled in Foreman.  This can be checked from <em>Administer &gt; Settings &gt; Puppet</em> and ensure <em>Parametrized_Classes_in_ENC</em> is set to <em>true</em>.</p>

<p><img src="Foreman%20::%20Manual_archivos/settings.png" alt="Settings"></p>

<p>Now you'll need to import some parameterized classes from your Puppet master.
If you don't have any parameterized classes in your modules dir, the
foreman-installer has several, you can download a few modules from the Puppet
Forge. Once you have some parameterized modules, import your classes (see
<a href="http://theforeman.org/manuals/1.9/index.html#4.2.2Classes"><strong>4.2.2 Classes</strong></a>)</p>

<p><img src="Foreman%20::%20Manual_archivos/import.png" alt="Import"></p>

<h4>Configure a class</h4>

<p>This example will work with the <em>foreman</em> class from the installer. Click on the class, and you should get a page with 3 tabs, like so:</p>

<p><img src="Foreman%20::%20Manual_archivos/3tabs.png" alt="3 Tabs"></p>

<p>The middle tab, "Smart Class Parameter", is the important one. Click onto that, and you should see something like this:</p>

<p><img src="Foreman%20::%20Manual_archivos/edit.png" alt="Edit"></p>

<p>On the left, we have a list of possible parameters that the class 
supports. On the right, we have the configuration options for the 
parameter selected.</p>

<p>Lets configure the <em>foreman</em> class to change the user the foreman processes run as. Select the <em>user</em> parameter, at the end of the list. Now lets go through the options:</p>

<ul>
<li>Puppet Environments / Name

<ul>
<li>These can't be edited, they're just for information.</li>
</ul>
</li>
<li>Description

<ul>
<li>Purely information textbox for making notes in. Not passed to Puppet, or reused anywhere else</li>
</ul>
</li>
<li>Override (<strong>important</strong>)

<ul>
<li>If this is unchecked, Foreman will not attempt to control this variable, and it will not be passed to Puppet via the ENC.</li>
</ul>
</li>
<li>Type

<ul>
<li>The type of data we want to pass. Most commonly a string, but many 
other data types are supported. There's no easy way to tell what type of
 data Puppet is expecting, so you will need to read through the 
code/documentation that comes with a particular module to find out. 
Changing the type field requires an appropriately set "Default Value" 
field.</li>
</ul>
</li>
<li>Default Value

<ul>
<li>This will be imported from Puppet initially, but if Puppet is using 
any class inheritance, you'll get something unhelpful like 
"${$foreman::params::user}". This is because Foreman won't follow the 
inheritance, so you'll need to set a sensible default value</li>
</ul>
</li>
</ul>


<p>Ok, so let's configure our <em>user</em> parameter. We want to tick Override, set type to "String" and set the default value to "foreman", like so:</p>

<p><img src="Foreman%20::%20Manual_archivos/user-param.png" alt="User Param"></p>

<div class="alert alert-info">Tip: you can set Override on all 
parameters on a class from the Puppet classes list, clicking the 
dropdown menu on the right and clicking "Override all parameters".</div>


<h4>Setting up matchers</h4>

<p>We've configured the default, but that's not very useful. We need to 
be able to override the default for hosts or groups of hosts. To do that
 we need the "Override Value For Specific Hosts" section at the bottom 
of the page.</p>

<p>Let's say that any machine in the "development" Puppet environment 
should use a value of "foremandev" instead of "foreman" for the "user" 
parameter. Add "environment" to the end of the matchers list, then click
 the "New Matcher-Value" button, and fill it out like this:</p>

<p><img src="Foreman%20::%20Manual_archivos/matcher.png" alt="Matcher"></p>

<p>This is a basic configuration - for more complex examples of using matchers,
see the <a href="http://theforeman.org/manuals/1.9/index.html#4.2.6SmartMatchers">Smart Matchers</a> section.</p>

<h4>Overriding a parameter for a host</h4>

<p>If Foreman manages the value of a class parameter ("override = 
true"), it's also possible to update a host-specific override from the 
host itself. That way you don't have to grant access to the Puppet 
Classes page to everyone. From a Host, click Edit, go to the Parameters 
tab, and you'll see the variable, the class-scope, and the current 
value. You can then override the value for that host:</p>

<p><img src="Foreman%20::%20Manual_archivos/hostedit.png" alt="Host Edit"></p>

<p>If you go back and look at the Puppet class, you'll see Foreman has added a matcher for that host:</p>

<p><img src="Foreman%20::%20Manual_archivos/hostmatch.png" alt="Host Matcher"></p>

<p>The same override button is available on a host group's <em>Parameters</em> tab.  For more complex logic, like matching on facts, use the Puppet Class page.</p>

<h4>Advanced usage</h4>

<p>Smart class parameters are based on the smart matchers technology, 
and have a number of advanced features such as validation and multiple 
data types. More about these can be found in the <a href="http://theforeman.org/manuals/1.9/index.html#4.2.6SmartMatchers">Smart Matchers</a> section.</p>

<div data-unique="4.2.6SmartMatchers" name="4.2.6SmartMatchers"></div><h3>4.2.6 Smart Matchers</h3>

<p>The same smart matching technology underpins both smart variables and
 smart class parameters, so is described below.  It provides the 
following features for each parameter:</p>

<ol>
<li>A default value that can be sent if no specific match is found.</li>
<li>An order of precendence for overrides, based on host attributes or facts.</li>
<li>A list of overrides (matchers).</li>
<li>Specifying a data type, allowing strings, integers and data structures to be passed natively to Puppet.</li>
<li>Optional validation of values.</li>
<li>Template processing of values for dynamic content.</li>
</ol>


<h4>Default value</h4>

<p>Most importantly, the <em>Override</em> option has to be enabled for 
Foreman to control this variable, otherwise it will never be managed and
 will not appear in the ENC output.</p>

<p>The <em>Default value</em> will be supplied in the ENC output and 
should be a supported value, such as a string, YAML or JSON structure or
 use template features (see following sections).  When the <em>Use Puppet default</em>
 checkbox is enabled, no default value will be present in the ENC output
 unless an override matches.  Puppet will instead use the class default 
or data binding (Hiera) as usual.</p>

<p>The default will be imported from the Puppet manifest initially, but 
if the class uses an inherited params pattern, it may contain an 
unhelpful string such as <code>${$foreman::params::user}</code>.  
Foreman is unable to parse the actual value in this case as it might 
change when evaluated.  Change the suggested default to the actual 
value, or tick the <em>Use Puppet default</em> checkbox.</p>

<h4>Ordering</h4>

<p>Overrides are processed in the order of precedence set in the <em>Order</em>
 field, from most to least specific (first match wins, unless merging is
 enabled).  This is a list of host attributes and fact names that 
overrides will be checked against.  If no override from this list 
matches, the default value is used.</p>

<p>Example attributes that may be listed are:</p>

<ul>
<li><code>fqdn</code> - host's FQDN ("host.example.com")</li>
<li><code>hostgroup</code> - full name of the host group, including parents ("Europe/Web servers")</li>
<li><code>os</code> - name and version of operating system ("RedHat 6.4")</li>
<li><code>domain</code> - host's domain name ("example.com")</li>
<li><code>location</code> or <code>organization</code> - full name of the location/organization, including parents ("Company/Subsidiary")</li>
<li><code>is_virtual</code> - a fact <a href="https://docs.puppetlabs.com/facter/latest/core_facts.html#isvirtual">supplied by Facter</a></li>
</ul>


<p>The default order is set under <em>Adminster &gt; Settings &gt; Puppet &gt; Default_variables_Lookup_Path</em> and is "fqdn", "hostgroup", "os", "domain".</p>

<p>Note that there's a name conflict between the "operatingsystem" fact 
and Foreman's attribute "operatingsystem" (same as "os" above), and 
Foreman's attribute will be the one that is used, so will include the 
version number.</p>

<h4>Overrides / matchers</h4>

<p>Once defaults have been filled in for your parameter, you can then add criteria to match against - click the <em>Add Matcher-Value</em> button under your parameter, and more input fields will appear:</p>

<table class="table table-bordered table-condensed">
    <tbody>
    <tr>
      <td>Match</td>
      <td>Should state a name = value relationship that Foreman use to match against the entries in the order list</td>
    </tr>
    <tr>
      <td>Value</td>
      <td>What the parameter should be in the ENC, if this rule is matched</td>
    </tr>
    <tr>
      <td>Use Puppet default</td>
      <td>Instead of providing a value, this parameter will not be 
supplied in the ENC output (use to prevent a default value being 
returned)</td>
    </tr>
</tbody></table>


<p>As an example, let's say that any machine in the "development" puppet
 environment should use a value of "foremandev" instead of "foreman" for
 the "user" parameter. Add "environment" to the end of the matchers 
list, then click the <em>Add Matcher-Value</em> button, and fill it out like this:</p>

<p><img src="Foreman%20::%20Manual_archivos/matcher.png" alt="Matcher"></p>

<p>The match field currently supports string equality only, the values must match exactly.</p>

<h5>Merging overrides</h5>

<p>When the data type is a hash or array, ticking <em>Merge overrides</em> will cause values from every override that matches (e.g. an FQDN <em>and</em> domain) to be merged together.</p>

<p>Merging is "deep", so nested hashes and arrays will gain values rather than being overwritten entirely.</p>

<p>When the data type is an array, the <em>Avoid duplicates</em> option will de-duplicate the resulting array.</p>

<h4>Data types</h4>

<p>The type of data we want to pass to Puppet can be set in the <em>Parameter type</em> field.  Most commonly a string, but many other data types are supported:</p>

<ul>
<li>String - Everything is taken as a string.</li>
<li>Boolean - Common representation of boolean values are accepted, including true, false, yes, no etc.</li>
<li>Integer - Integer numbers only, can be negative.</li>
<li>Real - Accept any numerical input.</li>
<li>Array - A valid JSON or YAML input, that must evaluate to an array.</li>
<li>Hash - A valid JSON or YAML input, that must evaluate to an object/map/dict/hash.</li>
<li>YAML - Any valid YAML input.</li>
<li>JSON - Any valid JSON input.</li>
</ul>


<p>There's no easy way to tell what type of data the Puppet manifest is 
expecting, so you will need to read through the code/documentation that 
comes with a particular module to find out.  Changing the type field 
requires an appropriately set "Default Value" field.</p>

<h5>Complex data</h5>

<p>Here's an example of adding an array parameter. Note the use of YAML in the edit box:</p>

<p><img src="Foreman%20::%20Manual_archivos/array.png" alt="Array"></p>

<p>This will be converted to the JSON <code>["a","b"]</code> syntax when you save. You can also use hashes in YAML or JSON as data types too.</p>

<p>Note that the JSON hash syntax is not the same as Puppet's hash syntax: <code>{"example":"value"}</code></p>

<h4>Input validation</h4>

<table class="table table-bordered table-condensed">
    <tbody>
    <tr>
      <td>Validator type</td>
      <td>A combobox of data types. The type applies to the next field, the validator.</td>
    </tr>
    <tr>
      <td>Validator rule</td>
      <td>Used to enforce certain values for the parameter values. See below for examples.</td>
    </tr>
</tbody></table>


<p>The <em>Optional input validator</em> section can be used to restrict
 the allowed values for the parameter.  It is important to note that the
 validation applies to changes made from the Host edit page as well as 
the Puppet Classes edit page.</p>

<p>For example, to restrict the "user" field to either "foreman" or "foremandev", tick the Required checkbox, and then set:</p>

<ul>
<li>Type: List</li>
<li>Rule: foreman,foremandev</li>
</ul>


<h5>String validators</h5>

<p>At present, the string type cannot be validated - leave the validator
 field blank, and all strings in the variable will be considered 
acceptable</p>

<h5>Regexp / List validators</h5>

<p>By entering a list (comma-separated, no spaces) or a regex (no 
delimiter required), the value to be assigned to the parameter will be 
checked against this list. If the value does not match the validator, 
and error will be raised.</p>

<h4>Template variables</h4>

<p>Because Foreman offers templating capabilities, you can utilise 
pre-existing variables, macros and or functions within your 
parameterized classes. This is especially useful if you need to send a 
string to Puppet/Chef, but have a need to embed host specific 
information within the string, such as the host's FQDN.</p>

<p>Let's look a quick example situation: we need to configure RabbitMQ 
and have it use our existing Puppet SSL certs. Using what we've learnt 
above, we jump into the RabbitMQ class and configure the "ssl cert" 
parameter as such:</p>

<p><img src="Foreman%20::%20Manual_archivos/template-variable-rabbit-ssl-cert.png" alt="Template Variable"></p>

<p>As you can see we're utilising a template variable within the 
parameter's string just like we would in a normal template file. The 
important part of this string, as we're sure you've gathered, is the 
"@host.name" element. This pulls the FQDN from Foreman's facts and 
inserts it into the string.</p>

<p>More information regarding templates can be found <a href="http://projects.theforeman.org/projects/foreman/wiki/TemplateWriting"><strong>on the wiki</strong></a>. This page also contains the <a href="http://projects.theforeman.org/projects/foreman/wiki/TemplateWriting#Functions-and-macros"><strong>the pre-existing functions and macros you can use in your templates and parameter classes.</strong></a></p>

<h4>Examples</h4>

<h5>Example 1 - Simple change to a single host</h5>

<p>All our hosts use <em>server.foo</em> for something, except bob.domain.com which uses <em>server2.bar</em>:</p>

<table class="table table-bordered table-condensed">
    <tbody>
    <tr>
      <td>Name</td>
      <td>target</td>
    </tr>
    <tr>
      <td>Description</td>
      <td>The target server to talk to</td>
    </tr>
    <tr>
      <td>Default Value</td>
      <td>server.foo</td>
    </tr>
    <tr>
      <td>Type Validator</td>
      <td>string</td>
    </tr>
    <tr>
      <td>Validator Constraint</td>
      <td></td>
    </tr>
    <tr>
      <td>Order</td>
      <td>fqdn<br>           hostgroup<br>           os<br>           domain</td>
    </tr>
    <tr>
      <td>Match</td>
      <td>fqdn = bob.domain.com</td>
    </tr>
    <tr>
      <td>Value</td>
      <td>server2.bar</td>
    </tr>
</tbody></table>


<h5>Example 2 - Change for a group of hosts (via custom fact) with validation and ordering</h5>

<p>Most hosts need to use a port of <em>80</em> but all machines with a fact <em>region</em> and value <em>europe</em> need to use <em>8080</em>. To do this, you have to add the factname (in this example <em>region</em>) to the searchlist:</p>

<table class="table table-bordered table-condensed">
    <tbody>
    <tr>
      <td>Name</td>
      <td>port</td>
    </tr>
    <tr>
      <td>Description</td>
      <td>The port to use</td>
    </tr>
    <tr>
      <td>Default Value</td>
      <td>80</td>
    </tr>
    <tr>
      <td>Type Validator</td>
      <td>list</td>
    </tr>
    <tr>
      <td>Validator Constraint</td>
      <td>80,443,8080</td>
    </tr>
    <tr>
      <td>Order</td>
      <td>fqdn<br>           region<br>           hostgroup<br>           os<br>           domain</td>
    </tr>
    <tr>
      <td>Match</td>
      <td>region = europe</td>
    </tr>
    <tr>
      <td>Value</td>
      <td>8080</td>
    </tr>
    <tr>
      <td>Match</td>
      <td>fqdn = foo.domain</td>
    </tr>
    <tr>
      <td>Value</td>
      <td>67</td>
    </tr>
</tbody></table>


<p>Note that all machines will get either 80 or 8080 as required, except
 foo.domain which will generate an error, since 67 is not in the list 
validator. Note also that foo.domain will match before region, since it 
is higher in the searchlist. The rule ordering does not matter.</p>

<p>It is also possible to mix conditions, e.g.</p>

<table class="table table-bordered table-condensed">
    <tbody>
    <tr>
      <td>Name</td>
      <td>port</td>
    </tr>
    <tr>
      <td>Description</td>
      <td>The port to use</td>
    </tr>
    <tr>
      <td>Default Value</td>
      <td>80</td>
    </tr>
    <tr>
      <td>Type Validator</td>
      <td>list</td>
    </tr>
    <tr>
      <td>Validator Constraint</td>
      <td>80,443,8080</td>
    </tr>
    <tr>
      <td>Order</td>
      <td>fqdn<br>           region, hostgroup, environment<br>           hostgroup<br>           environment<br>           domain</td>
    </tr>
    <tr>
      <td>Match</td>
      <td>fqdn = foo.domain</td>
    </tr>
    <tr>
      <td>Value</td>
      <td>67</td>
    </tr>
    <tr>
      <td>Match</td>
      <td>region = europe, hostgroup = "web servers", environment = production</td>
    </tr>
    <tr>
      <td>Value</td>
      <td>8080</td>
    </tr>
</tbody></table>


<div data-unique="4.3SmartProxies" name="4.3SmartProxies"></div><h2>4.3 Smart Proxies</h2>

<p>The Smart Proxy is a project which provides a restful API to various sub-systems.</p>

<p>Its goal is to provide an API for a higher level orchestration tools (such as Foreman).
The Smart proxy provides an easy way to add or extended existing subsystems and APIs using plugins.</p>

<p>Currently supported (Click on the links below for more details).</p>

<ul>
<li><a href="http://theforeman.org/manuals/1.9/index.html#4.3.4DHCP"><strong>DHCP</strong></a> - ISC DHCP and MS DHCP Servers</li>
<li><a href="http://theforeman.org/manuals/1.9/index.html#4.3.5DNS"><strong>DNS</strong></a> - Bind and MS DNS Servers</li>
<li><a href="http://theforeman.org/manuals/1.9/index.html#4.3.6Puppet"><strong>Puppet</strong></a> - Any Puppet server from 0.24.x</li>
<li><a href="http://theforeman.org/manuals/1.9/index.html#4.3.7PuppetCA"><strong>Puppet CA</strong></a> - Manage certificate signing, cleaning and autosign on a Puppet CA server</li>
<li><a href="http://theforeman.org/manuals/1.9/index.html#4.3.8Realm"><strong>Realm</strong></a> - Manage host registration to a realm (e.g. FreeIPA)</li>
<li><a href="http://theforeman.org/manuals/1.9/index.html#4.3.9TFTP"><strong>TFTP</strong></a> - any UNIX based tftp server</li>
</ul>


<p>If you require another sub system type or implementation, please add a new feature request or consider writing a plugin.</p>

<p>Once your smart proxy is running, each of the relevant sub systems needs to be configured via the <a href="http://theforeman.org/manuals/1.9/index.html#4.3.2SmartProxySettings">settings.d/*</a> files in the config directory.</p>

<!---[API](#) Reference -->




<!---[Release Notes](#) -->




<!---[Known Issues](#)-->


<div data-unique="4.3.1SmartProxyInstallation" name="4.3.1SmartProxyInstallation"></div><h3>4.3.1 Smart Proxy Installation</h3>

<p>A smart proxy is an autonomous web-based foreman component that is 
placed on a host performing a specific function in the host 
commissioning phase.
It receives requests from Foreman to perform operations that are 
required
during the commissioning process and executes them on its behalf. More 
details
can be found on the <a href="http://theforeman.org/manuals/1.9/index.html#ForemanArchitecture"><strong>Foreman Architecture</strong></a> page.</p>

<p>To fully manage the commissioning process then a smart proxy will 
have to manipulate these services, DHCP, DNS, Puppet CA, Puppet and 
TFTP. These services may exist on separate machines or several of them 
may be hosted on the same machine. As each smart proxy instance is 
capable of managing all the of these services, there is only need for 
one proxy per host.
In the special case of a smart proxy managing a windows DHCP server, the
 host machine must be running Windows and support the <strong>netsh dhcp</strong> utility, it does not need to be the Microsoft DHCP server itself.</p>

<h4>Packages</h4>

<p>RPM and Debian packages are available, see the <a href="http://theforeman.org/manuals/1.9/index.html#3.3InstallFromPackages">Install from Packages</a> section for configuration and install the <code>foreman-proxy</code> package.</p>

<h4>Source code</h4>

<p>You can get the latest stable code from <a href="https://github.com/theforeman/smart-proxy">GitHub</a> (<a href="git://github.com/theforeman/smart-proxy.git">via git</a>).</p>

<pre>git clone git://github.com/theforeman/smart-proxy.git
</pre>


<h4>Configuration file</h4>

<p>Usually can be found at /etc/foreman-proxy/settings.yml or in the config/settings.yml subdirectory.
You can use the <em>settings.yml.example</em> file inside the <em>config</em> directory as a template for your own <em>settings.yml</em>.</p>

<p>Configuration of each subsystem is usually in 
/etc/foreman-proxy/settings.d/ or in the config/settings.d/ 
subdirectory.  If you don't plan to use one of the subsystems, please 
disable them in these configuration files. For more information see <a href="http://theforeman.org/manuals/1.9/index.html#4.3.2SmartProxySettings"><strong>Smartproxy Configuration</strong></a>.</p>

<h4>Start the daemon</h4>

<pre>bin/smart-proxy
</pre>


<p>Or if you installed it via a package simply start the foreman-proxy service.</p>

<pre>service foreman-proxy start
</pre>


<h4>Add the Smart Proxy to Foreman</h4>

<ul>
<li>Go to Foreman, under <em>Infrastructure &gt; Smart proxies</em>, click <em>New Proxy</em></li>
<li>Type in the Name for your Proxy and the URL of your Proxy, with the port used</li>
</ul>


<p>For example:</p>

<ul>
<li>Name: Puppet-Proxy</li>
<li>URL: http://puppet.your-domain.com:8443</li>
</ul>


<div data-unique="4.3.2SmartProxySettings" name="4.3.2SmartProxySettings"></div><h3>4.3.2 Smart Proxy Settings</h3>

<p>The main configuration for the core Smart Proxy is held in the <em>/etc/foreman-proxy/settings.yml</em> or <em>config/settings.yml</em> file.  This includes configuration of ports to listen on, SSL and security settings and logging options.</p>

<p>Each of the modules used in the Smart Proxy have their configuration in the <em>/etc/foreman-proxy/settings.d/</em> or <em>config/settings.d</em> directory.  Modules are enabled or disabled inside their respective configuration files with the <code>:enabled</code> directive, which determines whether the module is available on HTTP, HTTPS, both or is disabled (see below for more details).</p>

<h4>YAML start</h4>

<p>The first non-comment line of all configuration files must be three dashes.</p>

<pre>---</pre>


<h4>Daemon configuration (settings.yml)</h4>

<p>If daemon is present and true then the Smart Proxy will attempt to 
disconnect itself from the controlling terminal and daemonize itself on 
startup, writing its pid (process ID) into the specified file.</p>

<pre>:daemon: true
:daemon_pid: /var/run/foreman-proxy/foreman-proxy.pid
</pre>


<h4>Logging (settings.yml)</h4>

<p>The proxy's output is captured to the the <strong>log_file</strong> and may be filtered via the usual Unix syslog levels:</p>

<ul>
<li><em>WARN</em></li>
<li><em>DEBUG</em></li>
<li><em>ERROR</em></li>
<li><em>FATAL</em></li>
<li><em>INFO</em></li>
<li><em>UNKNOWN</em></li>
</ul>


<p>See Ruby's <a href="http://www.ruby-doc.org/stdlib/libdoc/logger/rdoc/classes/Logger.html">Logger class</a> for details.</p>

<pre>:log_file: /var/log/foreman-proxy/proxy.log
:log_level: DEBUG
</pre>


<p>The log_file setting may be set to "STDOUT" which causes log messages
 to be logged to standard output, for capture by the running process 
(e.g. systemd with journal).</p>

<h4>Listening configuration (settings.yaml)</h4>

<p>By default the Smart Proxy listens on all interfaces, which can be changed to limit access to a network:</p>

<pre># host to bind ports to (possible values: *, localhost, 0.0.0.0)
:bind_host: '*'
:bind_host: private.example.com
:bind_host: 192.168.1.10
</pre>


<p>The Smart Proxy has a number of different modules which can be 
enabled either for HTTP, for HTTPS or for access on both services.  It 
is highly recommended to enable most only on HTTPS and only enable 
modules on HTTP when required (e.g. templates) or if no SSL is desired.</p>

<p>The two port options control which TCP port(s) the Smart Proxy will 
listen on.  At least one must be enabled for the proxy to start.  It is 
recommended to only set https_port unless an HTTP-only module is active,
 which also requires the three ssl_* settings to be set.</p>

<pre>:http_port: 8000
:https_port: 8443
</pre>




<div class="alert alert-info">Be careful when enabling http_port, ensure
 settings.d/ files are enabled only on HTTPS or trusted_hosts is set 
appropriately so modules are not exposed without security on HTTP.</div>


<p>Modules are enabled in their per-module configuration file in <em>/etc/foreman-proxy/settings.d/</em> with the <code>:enabled</code> directive, which can be set to:</p>

<ul>
<li><code>:enabled: false</code> to disable the module entirely</li>
<li><code>:enabled: http</code> to listen on HTTP only</li>
<li><code>:enabled: https</code> to listen on HTTPS only (recommended)</li>
<li><code>:enabled: true</code> to listen on both HTTP and HTTPS if enabled (not recommended)</li>
</ul>


<h4>Security configuration (settings.yml)</h4>

<p>The existence of all the three ssl key entries below requires the use of an SSL connection.</p>

<p><strong>NOTE</strong> that both client certificates need to be signed by the same CA, which must be in the <em>ssl_ca_file</em>, in order for this to work
see <a href="http://theforeman.org/manuals/1.9/index.html#4.3.10SSL"><strong>SSL</strong></a> for more information</p>

<pre>:ssl_certificate: ssl/certs/fqdn.pem
:ssl_ca_file: ssl/certs/ca.pem
:ssl_private_key: ssl/private_keys/fqdn.key
</pre>


<p>This is the list of hosts from which the smart proxy will accept 
connections.  For HTTPS connections, the name must match the common name
 (CN) within the subject DN and for HTTP connections, it must match the 
hostname from reverse DNS.</p>

<pre>:trusted_hosts:
  - foreman.prod.domain
  - foreman.dev.domain
</pre>


<p>For HTTPS connections, the name must match the common name (CN) 
within the subject DN and for HTTP connections, it must match the 
hostname from reverse DNS.  When <code>:forward_verify</code> is enabled
 (default: true) then the reverse lookup is verified against the forward
 lookup of the hostname (aka forward-confirmed reverse DNS/FCrDNS).</p>

<p>Some modules may allow connections from all hosts rather than only 
the trusted_hosts list, particularly if they intend to deal with 
requests directly from managed hosts rather than only from Foreman.</p>

<p>An empty trusted_hosts list will permit no hosts access:</p>

<pre><code>:trusted_hosts: []
</code></pre>

<p>While if the setting is not specified, any host may make requests to 
the smart proxy, which permits management of any enabled modules and 
features.</p>

<h4>Foreman communication (settings.yml)</h4>

<p>Some modules make requests <em>back</em> to Foreman, e.g. when relaying requests from client hosts.  The following setting changes the destination URL:</p>

<pre><code>:foreman_url: https://foreman.example.com
</code></pre>

<p>And the following settings change the SSL certificates used to 
authenticate to Foreman and to verify its certificate.  In a typical 
installation, Foreman and the Smart Proxy may both use certificates 
signed the same certificate authority, so these default to the values of
 the ssl_* settings defined above.</p>

<pre><code># SSL settings for client authentication against Foreman. If undefined, the values
# from general SSL options are used instead. Mainly useful when Foreman uses
# different certificates for its web UI and for smart-proxy requests.
:foreman_ssl_ca: /etc/foreman-proxy/ssl/certs/ca.pem
:foreman_ssl_cert: /etc/foreman-proxy/ssl/certs/fqdn.pem
:foreman_ssl_key: /etc/foreman-proxy/ssl/private_keys/fqdn.pem
</code></pre>

<div data-unique="4.3.3BMC" name="4.3.3BMC"></div><h3>4.3.3 BMC</h3>

<p>Activate the BMC management module within the Smart Proxy instance.  
This allows users to trigger power management commands through the proxy
 to controlled hosts using IPMI or similar.</p>

<pre>:enabled: https
:bmc_default_provider: freeipmi
</pre>


<p>Available providers are:</p>

<ul>
<li><code>freeipmi</code> - for IPMI control using the freeipmi implementation</li>
<li><code>ipmitool</code> - using the ipmitool implementation</li>
<li><code>shell</code> - specialized provider for controlling the proxy server itself (used for Foreman Discovery)</li>
</ul>


<p>The credentials and addresses used to control hosts are passed from 
Foreman itself by adding a new network interface with the type set to 
"BMC" to hosts.</p>

<div data-unique="4.3.4DHCP" name="4.3.4DHCP"></div><h3>4.3.4 DHCP</h3>

<h4>4.3.4.1 dhcp.yml</h4>

<p>Activate the DHCP management module within the Smart Proxy instance. 
 This is used to query for available IP addresses (looking at existing 
leases and reservations), add new and delete existing reservations.  It 
cannot manage subnet declarations, which should be managed by another 
means (e.g. <a href="https://github.com/theforeman/puppet-dhcp">puppet-dhcp</a>).</p>

<pre>:enabled: https
</pre>


<p>If the DHCP server is ISC compliant then set <strong>dhcp_vendor</strong> to <strong>isc</strong>. In this case Smart Proxy must run on the same host as the DHCP server.
If the proxy is managing a Microsoft DHCP server then set <strong>dhcp_vendor</strong> to <strong>native_ms</strong>.
 Smart Proxy must then be run on an NT server so as to access the 
Microsoft native tools, though it does not have to be the same machine 
as the DHCP server. More details can be found in the <a href="http://theforeman.org/manuals/1.9/index.html#ForemanArchitecture">Foreman Architecture</a>.</p>

<pre>:dhcp_vendor: isc
</pre>


<p>The DHCP component needs access to the DHCP configuration file as 
well as the currently allocated leases.  For a Red Hat or Fedora-based 
host, the following values are typical:</p>

<pre>:dhcp_config: /etc/dhcp/dhcpd.conf
:dhcp_leases: /var/lib/dhcpd/dhcpd.leases
</pre>


<p>On a Debian or Ubuntu DHCP server, use the following values instead:</p>

<pre>:dhcp_config: /etc/dhcp3/dhcpd.conf
:dhcp_leases: /var/lib/dhcp3/dhcpd.leases
</pre>




<div class="alert alert-info">The foreman-proxy account must be able to 
read both configuration files.  In particular, check the permissions on 
the parent directory (e.g. /etc/dhcp) permit world read/execute.</div>


<p>If you secured your DHCP with an "omapi_key", add the entries:</p>

<pre>:dhcp_key_name: omapi_key
:dhcp_key_secret: XXXXXXXX
</pre>


<p>If the DHCP server is listening on a non-standard OMAPI port (i.e. not 7911), then change this with:</p>

<pre>:dhcp_omapi_port: 7911
</pre>


<p>Large numbers of subnets can slow the Smart Proxy down when iterating
 over the reservations.  You can request that the Smart Proxy only 
operate on a subset of the subnets managed by the DHCP server.  This 
works with both isc and native_ms providers.</p>

<pre>:dhcp_subnets: [192.168.1.0/255.255.255.0, 192.168.11.0/255.255.255.0]
</pre>


<h4>4.3.4.2 ISC DHCP</h4>

<p>ISC implementation is based on the OMAPI interface, which means:</p>

<ul>
<li>No need for root permissions on your DHCP server</li>
<li>No need to restart (or "sync") your DHCP server after every modifications.</li>
</ul>


<h5>Configuration</h5>

<ul>
<li>dhcpd configuration file:
ensure you have the following line in your dhcpd.conf file (somewhere in the top first lines):</li>
</ul>


<pre>omapi-port 7911;</pre>


<ul>
<li>configure the settings file to point to your dhcpd.conf and 
dhcpd.leases files (make sure they are readable by the smart-proxy user)</li>
<li>make sure the omshell command (/usr/bin/omshell) can be executed by the smart-proxy user.</li>
<li>make sure that /etc/dhcp and /etc/dhcp/dhcpd.conf has group foreman-proxy</li>
</ul>


<h5>Securing the dhcp API</h5>

<p>The dhcpd api server will listen to any host. You might need to add a omapi_key to provide basic security.</p>

<p>Example generating a key (on CentOS):</p>

<pre>yum install bind
dnssec-keygen -r /dev/urandom -a HMAC-MD5 -b 512 -n HOST omapi_key
cat Komapi_key.+*.private |grep ^Key|cut -d ' ' -f2-
</pre>


<ol>
<li><p>Edit your "/etc/dhcpd.conf":</p>

<p> </p><pre> omapi-port 7911;
 key omapi_key {
 algorithm HMAC-MD5;
 secret "XXXXXXXXX"; #&lt;-The output from the generated key above.
 };
 omapi-key omapi_key;
 </pre><p></p></li>
<li><p>Make sure you also add the omapi_key to your proxy's <a href="http://theforeman.org/manuals/1.9/index.html#4.3.4DHCP">dhcp.yml</a></p></li>
<li><p>Restart the dhcpd and foreman-proxy services</p></li>
</ol>


<p><strong>NOTE</strong>: if you don't see DHCP in Smart Proxies Features, choose "Refresh features" from drop-down menu.</p>

<p>The next step is to set up appropriate Subnets in Foreman from the settings menu.</p>

<h5>Sample dhcpd.conf</h5>

<pre>ddns-update-style interim;
ignore client-updates;
authoritative;
allow booting;
allow bootp;

omapi-port 7911;
#Optional key:
key omapi_key {
        algorithm HMAC-MD5;
        secret "2wgoV3yukKdKMkmOzOn/hIsM97QgLTT4CLVzg9Zv0sWOSe1yxPxArmr7a/xb5DOJTm5e/9zGgtzL9FKna0NWis==";
}
omapi-key omapi_key;

subnet 10.1.1.0 netmask 255.255.255.0 {
# --- default gateway
  option routers      10.1.1.254;
  option subnet-mask  255.255.255.0;

  option domain-name    "domain.com";
  option domain-name-servers  10.1.1.1, 8.8.8.8;
  option log-servers    syslog;
  option ntp-servers    ntp;

  range dynamic-bootp 10.1.1.10 10.1.1.250;
  default-lease-time 21600;
  max-lease-time 43200;

}
</pre>


<h4>4.3.4.3 MS DHCP</h4>

<p>The Microsoft smart-proxy installation procedure is very basic compared to the RPM or APT based solution.</p>

<p>It is required that this procedure is executed as an administrator.</p>

<p>It is not required that the smart-proxy be on the same host as the MS
 dhcp server.  The smart-proxy just needs to be on a windows host that 
has netsh commands available.</p>

<ol>
<li>Go to the smart-proxy repository at https://github.com/theforeman/smart-proxy/releases</li>
<li>Just under the tag matching your Foreman version, click the ZIP link in order to download the Smart Proxy source code</li>
<li>Extract the archive to a directory that does not have any spaces in its name</li>
<li>Go to the rubyinstaller web page at http://rubyinstaller.org/downloads/</li>
<li>Download and install the "ruby 1.9.3-p551": (Allow the ruby associations to be installed.)</li>
<li>Download and install the Development Kit For Ruby 1.9.3: (DevKit-tdm-32-4.5.2-20111229-1559-sfx.exe)</li>
<li>Open a CMD window and, install the bundler_ext gem using <em>gem install --platform x86-mingw32 bundler</em></li>
<li>CD to the root of the smart-proxy directory (the one you created in step 3)</li>
<li>Copy the file Gemfile to GemFile.in : <em>copy Gemfile GemFile.in</em></li>
<li><p>Install all the dependencies using bundler : <em>bundle install --without krb5 puppet puppetca</em></p></li>
<li><p>Edit config/settings.yml so that it looks a bit like this</p>

<p><em>Sample config/settings.yml file</em></p>

<pre><code>---
# Web site conf
#:bind_host: 10.10.10.1
:http_port: 8080

# SSL settings
:https_port: 8443
:ssl_certificate: c:\documents\smart-proxy\config\signed.pem
:ssl_private_key: c:\documents\smart-proxy\config\private.pem
:ssl_ca_file:     c:\documents\smart-proxy\config\ca.pem

:trusted_hosts: [ foreman.someware.com]

:daemon: false

# Where our proxy log files are stored
# filename or STDOUT
# Unix setting
#:log_file: log/proxy.log
# Windows setting
:log_file: c:\tmp\proxy.log
# valid options are
# WARN, DEBUG, ERROR, FATAL, INFO, UNKNOWN
#:log_level: DEBUG
:log_level: ERROR
</code></pre></li>
<li><p>Edit config/settings.d/dhcp.yml so that it looks a bit like this</p>

<p><em>Sample config/settings.d/dhcp.yml file</em></p>

<pre><code>---
# Can be true, false, or http/https to enable just one of the protocols
:enabled: true
# Enable DHCP management
:dhcp: true
# The vendor can be either isc or native_ms
:dhcp_vendor: native_ms
# The dhcp_server is only used by the native_ms implementation
:dhcp_server: 10.10.10.1
</code></pre></li>
<li><p>Create the SSL key</p>

<ul>
<li><p>Login to your puppetmaster</p></li>
<li><p>On the command line, type the following command. Take care not to use an alias nor upper case characters.</p>

<pre><code>  puppet ca generate _Smart-proxy FQDN_
</code></pre></li>
<li><p>Copy the private key, the public certificate and the ca.pem from 
/var/lib/puppet/ssl over to the locations that you specified in the 
setting file.</p></li>
</ul>
</li>
<li><p>If needed, you have to create the option 60 on the Windows DHCP (for PXE Boot)</p>

<ul>
<li>Open an administrator command prompt</li>
<li><p>Create the PXE Option using netsh</p>

<pre><code>  C:\Windows\system32&gt;netsh
  netsh&gt;dhcp
  netsh dhcp&gt; server 10.10.45.1
  netsh dhcp server&gt;add optiondef 60 PXEClient String 0 comment= PXE Support
</code></pre></li>
</ul>
</li>
<li><p>Test the installation by running ruby bin\smart-proxy.rb within an administrator cmd.exe prompt.</p></li>
<li><p>Install the program as a service</p>

<ul>
<li><p>Install the dependencies to create the service :</p>

<pre><code>  gem install --platform x86-mingw32-60 win32-service
</code></pre></li>
<li><p>Use the script in extra to create the service</p>

<pre><code>  ruby extra\register-service.rb
</code></pre></li>
</ul>


<p>This may install the service but not run it. If so then try to start 
the service from the Ordinary Microsoft services snapin utility.</p></li>
<li><p>You may test connectivity by running the <em>extra\query.rb</em> utility from your foreman host. (Note that this file comes from the <em>extra</em> directory in the smart-proxy release.)</p></li>
</ol>


<div data-unique="4.3.5DNS" name="4.3.5DNS"></div><h3>4.3.5 DNS</h3>

<h4>4.3.5.1 dns.yml</h4>

<p>Activate the DNS management module within the Smart Proxy instance.  
This is used to update and remove DNS records from existing DNS zones.</p>

<p>The DNS module can manipulate any DNS server that complies with the 
ISC Dynamic DNS Update standard and can therefore be used to manage both
 Microsoft Active Directory and BIND servers.  Updates can also be made 
using GSS-TSIG, see the second section below.  Additional providers are 
available for managing libvirt's embedded DNS server (dnsmasq) and 
Microsoft Active Directory using dnscmd, for static DNS records, 
avoiding scavenging.</p>

<p>Available providers are:</p>

<ul>
<li><code>nsupdate</code> - dynamic DNS update using nsupdate</li>
<li><code>nsupdate_gss</code> - dynamic DNS update with GSS-TSIG</li>
<li><code>virsh</code> - libvirt embedded DNS (dnsmasq)</li>
<li><code>dnscmd</code> - static DNS records in Microsoft Active Directory</li>
</ul>


<p>The <strong>dns_key</strong> specifies a file containing a shared 
secret used to generate a signature for the update request (TSIG 
record). This option should not be used if you plan to use 
Kerberos/GSS-TSIG (for example for DNS servers shipped with FreeIPA or 
Microsoft AD).</p>

<p>If neither the <strong>dns_key</strong> or GSS-TSIG is used then the 
update request is sent without any signature. Unsigned update requests 
are considered insecure. Some DNS servers can be configured to accept 
only signed signatures.</p>

<p>The <strong>dns_server</strong> option is used if the Smart Proxy is 
not located on the same physical host as the DNS server. If it is not 
specified then localhost is presumed.</p>

<pre>:enabled: https
:dns_provider: nsupdate
:dns_key: /home/proxy/keys/Kapi.+157+47848.private
:dns_server: dnsserver.site.domain.com
</pre>




<div class="alert alert-info">If you use a key file or keytab, make sure that the foreman-proxy account can read that file.</div>


<p>The TTL of DNS records added by the Smart Proxy is 86400 seconds (one day).  This can be changed with the dns_ttl setting:</p>

<pre>:dns_ttl: 86400
</pre>


<p>GSS-TSIG authentication is controlled using the following settings, see the second section below for further details.</p>

<pre>:dns_tsig_keytab: /usr/share/foreman-proxy/dns.keytab
:dns_tsig_principal: DNS/host.example.com@EXAMPLE.COM
</pre>


<h4>4.3.5.2 BIND</h4>

<p>Bind configuration manipulation is based on nsupdate, which means 
that in theory could also be used to manipulate other dns servers which 
support nsupdate (such as Microsoft DNS server).</p>

<h4>Configuration</h4>

<p>In order to communicate securely with your dns server, you would need
 a key which will be used by nsupdate and your named daemon using 
ddns-confgen or dnssec-keygen</p>

<h4>example using ddns-confgen</h4>

<p>execute 'ddns-confgen -k foreman -a hmac-md5' - this should output something like the following:</p>

<pre># To activate this key, place the following in named.conf, and
# in a separate keyfile on the system or systems from which nsupdate
# will be run:
key "foreman" {
        algorithm hmac-md5;
        secret "GGd1oNCxaKsh8HA84sP1Ug==";
};

# Then, in the "zone" statement for each zone you wish to dynamically
# update, place an "update-policy" statement granting update permission
# to this key.  For example, the following statement grants this key
# permission to update any name within the zone:
update-policy {
        grant foreman zonesub ANY;
};

# After the keyfile has been placed, the following command will
# execute nsupdate using this key:
nsupdate -k <keyfile>
</keyfile></pre>


<p>You should create a new file (such as /etc/rndc.key or other) and store the key "foreman {...} in it.
in the proxy Settings file you should point to this file location - make sure that the proxy have read permissions to this file.</p>

<p>In your named file, you could add the update-policy statement or something like this <a href="http://theforeman.org/projects/smart-proxy/wiki/Named_example_file">named example file</a> if you need more fine grained permissions.</p>

<h4>4.3.5.3 GSS-TSIG DNS</h4>

<p>Both BIND as configured in FreeIPA and Microsoft AD DNS servers can 
accept DNS updates using GSS-TSIG authentication.  This uses Kerberos 
principals to authenticate to the DNS server.  Under Microsoft AD, this 
is known as "Secure Dynamic Update".</p>

<h4>Pre-requisites</h4>

<ul>
<li>Kerberos principal in the realm/domain that Smart Proxy can use</li>
<li>Kerberos keytab for the above principal</li>
</ul>


<h4>Microsoft AD configuration</h4>

<p>A user has to be created in Active Directory that will be used by the Smart Proxy, e.g. <code>foremanproxy</code>. This will automatically create a service principal, e.g. <code>foremanproxy@EXAMPLE.COM</code>.</p>

<p>Test the Kerberos login with that user on the Smart Proxy using kinit:</p>

<pre><code>kinit foremanproxy@EXAMPLE.COM
</code></pre>

<p>This requires that the /etc/krb5.conf file is setup correctly. By 
default many systems use DNS to locate the Kerberos DC. A KDC can also 
be statically set in this file. There are dozens of documents on how to 
do this on the net.</p>

<p>If login works, the keytab file can be created using <code>ktutil</code>. First clear the Kerberos ticket cache:</p>

<pre><code>kdestroy
</code></pre>

<p>Now create the keytab file with <code>ktutil</code>:</p>

<pre><code>ktutil: addent -password -p foremanproxy@EXAMPLE.COM -k 1 -e RC4-HMAC
ktutil: wkt dns.keytab
ktutil: q
</code></pre>

<p>Once the keytab file has been created, test it using kinit:</p>

<pre><code>kinit foremanproxy@EXAMPLE.COM -k -t dns.keytab
</code></pre>

<p>If this works, clear the Kerberos ticket cache once again using <code>kdestroy</code>.</p>

<p>Store the keytab at <code>/etc/foreman-proxy/dns.keytab</code>, ensure permissions are 0600 and the owner is <code>foreman-proxy</code>.</p>

<p>The DNS zone <code>Dynamic Updates</code> option on the DNS zones can now be set to <code>Secure Only</code>. Now follow the steps below under <code>Proxy Configuration</code>.</p>

<h4>FreeIPA configuration</h4>

<p>A service principal is required for the Smart Proxy, e.g. <code>foremanproxy/proxy.example.com@EXAMPLE.COM</code>.</p>

<p>First of all, create a new principal (FreeIPA service) for Foreman, e.g. <code>ipa service-add foremanproxy/proxy.example.com@EXAMPLE.COM</code>.</p>

<p>Then fetch the keytab, e.g. <code>ipa-getkeytab -p foremanproxy/proxy.example.com@EXAMPLE.COM -s ipa-server.example.com -k /etc/foreman-proxy/dns.keytab</code>.</p>

<p>Store the keytab at <code>/etc/foreman-proxy/dns.keytab</code>, ensure permissions are 0600 and the owner is <code>foreman-proxy</code>.</p>

<p>The ACL on updates to the DNS zone then needs to permit the service 
principal.  In the FreeIPA web UI, under the DNS zone, go to the 
Settings tab, verify that "Dynamic update" for that zone is set to 
"True", and add to the BIND update policy a new grant:</p>

<pre><code>grant foremanproxy\047proxy.example.com@EXAMPLE.COM wildcard * ANY;
</code></pre>

<p>Note the <code>\047</code> is written verbatim, and don't forget the semicolon.  ACLs should be updated for both forward and reverse zones as desired.</p>

<h4>Proxy configuration</h4>

<p>Next, update the proxy configuration file (<code>/etc/foreman-proxy/settings.d/dns.yml</code>) with the following settings:</p>

<pre><code>:dns_provider: nsupdate_gss
:dns_tsig_keytab: /etc/foreman-proxy/dns.keytab
:dns_tsig_principal: foremanproxy/proxy.example.com@EXAMPLE.COM
#:dns_key: false
</code></pre>

<p>To work correctly, <code>:dns_key:</code> must be commented out.</p>

<div data-unique="4.3.6Puppet" name="4.3.6Puppet"></div><h3>4.3.6 Puppet</h3>

<p>Activate the Puppet management module within the Smart Proxy instance.  This module has two functions:</p>

<ul>
<li>reads the Puppet modules and manifests on the Puppet master, 
reporting the environments and classes that are declared, used when 
importing classes into Foreman</li>
<li>optionally triggers immediate Puppet runs on clients using one of a number of implementations</li>
</ul>


<p>It should be activated on Puppet masters that have the environments 
and modules available to import data from.  To use the Puppet run 
functionality, it also needs to be capable of executing <em>puppetrun</em>
 or equivalent implementation listed in the section below.  This works 
independently of the Puppet CA functionality, which may only be one of 
many Puppet masters in the environment. To enable this, make sure these 
lines are present in <code>/etc/foreman-proxy/settings.d/puppet.yml</code>:</p>

<pre>:enabled: https
:puppet_conf: /etc/puppet/puppet.conf
</pre>


<h5>Puppet class/environment imports</h5>

<p>The proxy parses all of the Puppet manifests inside the environments declared from puppet.conf (set by <code>:puppet_conf</code>),
 which generates a list of all Puppet classes and the parameters they 
take.  These are imported by Foreman to generate the list of classes, 
smart class parameters and environments that they belong to.</p>

<div class="alert alert-info">Parsing manifests is done using Puppet 
itself, which means the manifests must be valid and pass syntax checks, 
else they won't show up.  Use <code>puppet parser validate example.pp</code> to validate the content of a manifest.</div>


<p>There are two ways to declare environments within Puppet.  Config 
environments are environments explicitly declared in puppet.conf, either
 with a single "modulepath" setting (which creates a single "production"
 environment or may be a wildcard), or with <code>[development]</code> section headers.  The proxy will parse puppet.conf in the same manner as Puppet to try and determine the known environments.</p>

<p>More information on configuring them is available in the <a href="https://docs.puppetlabs.com/guides/environment.html">Puppet environment docs</a>.  Since Puppet 3.5, these are deprecated in favor of directory environments.</p>

<p>Directory environments are enabled by adding "environmentpath" to 
puppet.conf.  When the proxy finds this setting, it uses this mode too. 
 The <code>:puppet_use_environment_api</code> proxy setting can be used 
to force this mode on or off, but when unset, it follows the presence of
 environmentpath (the default).  More information on configuring 
directory environments is available <a href="http://docs.puppetlabs.com/puppet/latest/reference/environments.html">in the Puppet docs</a>.</p>

<p>To get a list of environments and module paths, the proxy queries the
 Puppet master on its own API.  Typically the defaults will suffice, but
 the URL and settings used for the proxy to Puppet master API query can 
be controlled with the following settings in <code>/etc/foreman-proxy/settings.d/puppet.yml</code>:</p>

<pre># URL of the puppet master itself for API requests
#:puppet_url: https://puppet.example.com:8140
# SSL certificates used to access the puppet master API
#:puppet_ssl_ca: /var/lib/puppet/ssl/certs/ca.pem
#:puppet_ssl_cert: /var/lib/puppet/ssl/certs/puppet.example.com.pem
#:puppet_ssl_key: /var/lib/puppet/ssl/private_keys/puppet.example.com.pem
</pre>


<p>The Puppet master has to permit this API query.  Older installations 
of Puppet that have been upgraded may need a new entry in auth.conf 
prior to the last 'deny' entry:</p>

<pre>path /v2.0/environments
method find
allow *
</pre>


<p>When scanning Puppet manifests, a cache is kept in memory to speed up
 subsequent import calls. It can be enabled/disabled with the following 
setting:</p>

<pre># Cache options
:use_cache: true
</pre>


<h5>Puppet run providers</h5>

<p>For the optional Puppet run functionality, one of a number of implementations can be chosen in <code>/etc/foreman-proxy/settings.d/puppet.yml</code>.</p>

<pre>:puppet_provider: puppetrun
:puppetrun_wait: false
</pre>


<p>Available providers are:</p>

<ul>
<li><code>puppetrun</code> - for puppetrun/kick, deprecated in Puppet 3, see section below</li>
<li><code>mcollective</code> - uses mco puppet, see section below</li>
<li><code>puppetssh</code> - run puppet over ssh</li>
<li><code>salt</code> - uses salt puppet.run</li>
<li><code>customrun</code> - calls a custom command with args</li>
</ul>


<p>Once a provider is configured, in Foreman itself, enable "puppetrun" under <em>Adminster &gt; Settings &gt; Puppet</em> to activate the "Run Puppet" button on individual host pages.</p>

<p>The <code>puppetrun_wait</code> setting controls whether to block on 
completion of the Puppet command, so the result of the Puppet run can be
 returned to Foreman, else it's usually asynchronous.  When true, 
increase <code>proxy_request_timeout</code> under <em>Administer &gt; Settings</em> in Foreman itself to ensure it waits longer for a response, as the Puppet run may take some time to complete.</p>

<h5>puppetrun</h5>

<p><code>puppet kick</code> (or puppetrun in 2.x) can be used to trigger
 an immediate Puppet run on a client by connecting to the agent daemon 
on the client over HTTPS.  This method however is deprecated in Puppet 3
 and isn't recommended for new deployments.</p>

<p>More information can be found in the <a href="https://docs.puppetlabs.com/references/stable/man/kick.html">puppet kick</a> documentation, specifically the <a href="https://docs.puppetlabs.com/references/stable/man/kick.html#USAGE-NOTES">Usage Notes</a> which describe the configuration of the agents to listen and authorize connections.</p>

<p>sudo access for the proxy is required to run the client - in your 
sudoers file ensure you have the following lines (use 
/opt/puppet/bin/puppet for Puppet Enterprise):</p>

<pre>Defaults:foreman-proxy !requiretty
foreman-proxy ALL = NOPASSWD: /usr/bin/puppet kick *
</pre>


<p>If you are using Puppet 2.x, the proxy will use the older <code>puppetrun</code> command instead.  The sudoers entry should be:</p>

<pre>Defaults:foreman-proxy !requiretty
foreman-proxy ALL = NOPASSWD: /usr/sbin/puppetrun
</pre>


<p>The <code>:puppet_user</code> setting controls which user to sudo to, which on some installations (notably PE) may be different.  When unset (<code>:puppet_user:</code>) then sudo will not be used.</p>

<h5>MCollective</h5>

<p>The proxy can trigger Puppet runs using the MCollective "puppet" agent.  To enable this, add this line to <code>/etc/foreman-proxy/settings.d/puppet.yml</code>:</p>

<pre><code>:puppet_provider: mcollective
</code></pre>

<p>And then add a sudoers rule:</p>

<pre><code>Defaults:foreman-proxy !requiretty
foreman-proxy ALL = NOPASSWD: /usr/bin/mco puppet runonce *
</code></pre>

<p>The user that the smart proxy sudos to can be changed, notably for PE:</p>

<pre><code># If you want to override the puppet_user above just for mco commands
:mcollective_user: peadmin
</code></pre>

<p>If <code>:mcollective_user</code> is not specified, the value of <code>:puppet_user</code> will be used.  If both are unset, it will sudo to root.</p>

<h5>puppetssh</h5>

<p>The puppetssh provider uses SSH to connect to the client using SSH 
keys and run the Puppet agent command directly.  It is controlled by the
 following settings in <code>/etc/foreman-proxy/settings.d/puppet.yml</code>:</p>

<pre># whether to use sudo before the ssh command
:puppetssh_sudo: false
# the command which will be sent to the host
:puppetssh_command: /usr/bin/puppet agent --onetime --no-usecacheonfailure
# With which user should the proxy connect
#:puppetssh_user: root
#:puppetssh_keyfile: /etc/foreman-proxy/id_rsa
</pre>


<h4>Salt</h4>

<p>The salt provider uses Salt for remote execution, by executing the 
puppet module's run routine.  It is controlled by the following settings
 in <code>/etc/foreman-proxy/settings.d/puppet.yml</code>:</p>

<pre># Custom salt puppet.run command
# Set :salt_puppetrun_cmd to 'puppet.run agent no-noop' to run in no-noop mode.
# Default command is puppet.run.
:salt_puppetrun_cmd: puppet.run
</pre>


<h5>customrun</h5>

<p>The customrun provider allows configuration of a script that 
implements the Puppet run action in any way you require. Set the 
following configuration in <code>/etc/foreman-proxy/settings.d/puppet.yml</code>:</p>

<pre># Set :customrun_cmd to the full path of the script you want to run, instead of /bin/false
:customrun_cmd: /bin/false
# Set :customrun_args to any args you want to pass to your custom script. The hostname of the
# system to run against will be appended after the custom commands.
:customrun_args: -ay -f -s
</pre>


<div data-unique="4.3.7PuppetCA" name="4.3.7PuppetCA"></div><h3>4.3.7 Puppet CA</h3>

<p>Activate the Puppet CA management module within the Smart Proxy 
instance.  This is used to manage the autosign configuration and handle 
listing, signing and revocation of individual certificates.</p>

<p>This should only be enabled in the Smart Proxy that is hosted on the 
machine responsible for providing certificates to your puppet clients. 
You would expect to see a directory <strong>/var/lib/puppet/ssl/ca</strong> on such a host.</p>

<pre>:enabled: https
</pre>


<p>If your puppet SSL directory is located elsewhere, you'll need to set 'ssldir' as well.</p>

<pre>:ssldir: /etc/puppet/ssl
</pre>


<p>The 'puppetdir' setting is used to find autosign.conf:</p>

<pre>:puppetdir: /etc/puppet
</pre>


<p>The proxy requires write access to the puppet autosign.conf file, 
which is usually owner and group puppet, and has mode 0644 according to 
the puppet defaults.</p>

<p>Ensure the foreman-proxy user is added to the puppet group ( e.g. <code>gpasswd -a foreman-proxy puppet</code> or <code>usermod -aG puppet foreman-proxy</code>)</p>

<p>puppet.conf:</p>

<pre>[master]
autosign = $confdir/autosign.conf {owner = service, group = service, mode = 664 }
</pre>


<p>sudo access for the proxy is required - in your sudoers file ensure you have the following lines:</p>

<pre>foreman-proxy ALL = NOPASSWD: /usr/bin/puppet cert *
Defaults:foreman-proxy !requiretty
</pre>


<p>For older versions of Puppet (2.x) without separate commands:</p>

<pre>foreman-proxy ALL = NOPASSWD: /usr/sbin/puppetca *
Defaults:foreman-proxy !requiretty
</pre>


<div data-unique="4.3.8Realm" name="4.3.8Realm"></div><h3>4.3.8 Realm</h3>

<h4>4.3.8.1 realm.yml</h4>

<p>Activate the realm management module within the Smart Proxy instance.
  This manages Kerberos realms or domains, allowing Foreman to add and 
remove hosts to enable them to join the realm/domain automatically 
during provisioning.</p>

<pre>:enabled: https
:realm_provider: freeipa
</pre>


<p><code>freeipa</code> is the only provider currently available.</p>

<p>The following settings control authentication of the proxy to the realm for management of hosts:</p>

<pre># Authentication for Kerberos-based Realms
:realm_keytab: /etc/foreman-proxy/freeipa.keytab
:realm_principal: realm-proxy@EXAMPLE.COM
</pre>


<h4>4.3.8.2 FreeIPA Realm</h4>

<p>The FreeIPA implementation of the realm proxy is able to add a host 
entry to FreeIPA, send the hostgroup name, and request a one-time 
registration password.</p>

<h5>Configuration of FreeIPA</h5>

<p>In order to create the realm user and keytab to authenticate to FreeIPA, you can use the included <code>foreman-prepare-realm</code> tool. Your Smart Proxy must be registered to the FreeIPA realm already, and have the ipa-admintools package installed.</p>

<p>Simply provide a user with admin rights in FreeIPA, and a target user to create.</p>

<div class="alert alert-info">
Do not use 'foreman-proxy' as the username for this -- this is a local user used for running the Smart Proxy service.
</div>


<pre><code># foreman-prepare-realm admin realm-proxy
Password for admin@EXAMPLE.COM: 
---------------------------------------
Added permission "modify host password"
---------------------------------------
  Permission name: modify host password
  Permissions: write
  Attributes: userpassword
  Type: host
[...]
Keytab successfully retrieved and stored in: freeipa.keytab
Realm Proxy User:    realm-proxy
Realm Proxy Keytab:  /root/freeipa.keytab
</code></pre>

<h5>Configuration of Smart Proxy</h5>

<p>Copy the freeipa.keytab created above to /etc/foreman-proxy/freeipa.keytab and set
the correct permissions:</p>

<pre><code>    chown foreman-proxy /etc/foreman-proxy/freeipa.keytab
    chmod 600 /etc/foreman-proxy/freeipa.keytab
</code></pre>

<p>Then update realm.yml with the relevant settings.</p>

<p>If you're using FreeIPA to manage DNS records, and want them to be 
automatically deleted when the host is deleted in Foreman, set this to 
true:</p>

<pre><code>:freeipa_remove_dns: true
</code></pre>

<p>Finally, trust the IPA Certificate Authority. Ensure you have the most up-to-date version of the <code>ca-certificates</code> package installed.</p>

<pre><code>cp /etc/ipa/ca.crt /etc/pki/ca-trust/source/anchors/ipa.crt
update-ca-trust enable
update-ca-trust
</code></pre>

<p>You will need to disable the DNS proxy for hosts that are provisioned
 with a realm set, as FreeIPA adds the forward record for you. In order 
to support adding a reverse lookup record also, you will need to go into
 the settings for the forward lookup zone on the IPA server and tick <code>Allow PTR sync</code>. This will make sure that FreeIPA creates the PTR records for you.</p>

<h5>Using Automember Rules</h5>

<p>FreeIPA supports the ability to setup automember rules based on 
attributes of a system.  When using the FreeIPA proxy, the Foreman host 
group is available as a parameter in FreeIPA known as <code>userclass</code>.
  Nested host groups are sent as displayed in the Foreman UI, e.g. 
"Parent/Child/Child".  Note that Foreman does send updates to FreeIPA, 
however automember rules are only applied at initial add.  This will be 
coming in a <a href="https://fedorahosted.org/freeipa/ticket/3752">future version of FreeIPA</a>.</p>

<p>First, we create a host group in FreeIPA:</p>

<pre><code># ipa hostgroup-add webservers
Description: web servers
----------------------------
Added hostgroup "webservers" 
----------------------------
  Host-group: webservers
  Description: web servers
</code></pre>

<p>Define an automember rule:</p>

<pre><code># ipa automember-add --type=hostgroup webservers
----------------------------------
Added automember rule "webservers" 
----------------------------------
Automember Rule: webservers
</code></pre>

<p>Create an automember condition based on the <code>userclass</code> attribute:</p>

<pre><code># ipa automember-add-condition --key=userclass --type=hostgroup --inclusive-regex=^webserver webservers
----------------------------------
Added condition(s) to "webservers" 
----------------------------------
  Automember Rule: webservers
  Inclusive Regex: userclass=^webserver
----------------------------
Number of conditions added 1
----------------------------
</code></pre>

<p>When a machine in Foreman is in the "webservers" host group, it will automatically be added to the FreeIPA
"webservers" host group as well.  FreeIPA host groups allow for Host-based access controls (HBAC), sudo policies,
etc.</p>

<div data-unique="4.3.9TFTP" name="4.3.9TFTP"></div><h3>4.3.9 TFTP</h3>

<h4>tftp.yml</h4>

<p>Activate the TFTP management module within the Smart Proxy instance. 
 This is designed to manage files on a TFTP server, e.g. bootloaders for
 OS installation and PXE menu files.</p>

<p>The <em>tftproot</em> value is directory into which TFTP files are 
copied and then served from. The TFTP daemon will also be expected to 
chroot to this location. This component is only supported in a Unix 
environment.</p>

<pre>:enabled: https
:tftproot: /var/lib/tftpboot
:tftp_servername: name of your tftp server (used for next server value in your dhcp reservation) - defaults to the host name of your proxy.
</pre>




<div class="alert alert-info">The foreman-proxy user must have read/write access to the _tftpboot/pxelinux.cfg_ and _tftpboot/boot_ directories.</div>


<h4>Unattended installation</h4>

<p>An essential first step in netbooting a system is preparing the TFTP 
server with the PXE configuration file and boot images.  This document 
assumes that you have already configured your DHCP infrastructure, 
either via manual configuration or through the DHCP smart proxy.</p>

<h5>Setting Up the Proxy Server Host</h5>

<p>Regardless of the filesystem setup is performed, you must also make 
sure you have the wget utility installed and in the default path.  <em>wget</em> is used to download OS specific installation when a given host is enabled for the build process.</p>

<h5>Automatic Setup</h5>

<p>Foreman includes a <a href="https://github.com/theforeman/puppet-foreman_proxy/blob/master/manifests/tftp.pp">TFTP server module</a> that will perform all of the basic setup.  It defaults to TFTP root of <em>/var/lib/tftpboot</em>,
 which may change if necessary.  You will still need to provide the 
basic TFTP load images in your TFTP root directory.  For vanilla PXE 
booting, this includes <em>pxelinux.0</em>, <em>menu.c32</em>, and <em>chain.c32</em>.</p>

<h5>Manual Setup</h5>

<p>The setup is very simple, and may be performed manually if desired.</p>

<ol>
<li>The TFTP root directory must exist (we will use <em>/var/lib/tftpboot</em> in this example).</li>
<li>Populate <em>/var/lib/tftpboot</em> with PXE booting prerequisites. 
These can be taken from syslinux (usually in /usr/share/syslinux on 
RHEL) . At a minimum, this should include:

<ul>
<li><em>pxelinux.0</em></li>
<li><em>menu.c32</em></li>
<li><em>chain.c32</em></li>
</ul>
</li>
<li>Create the directory <em>/var/lib/tftpboot/boot</em> and make it writeable by the foreman proxy user (foreman-proxy, for instance, when installing through a rpm package).</li>
<li><p>Create the directory <em>/var/lib/tftpboot/pxelinux.cfg</em> and make it writeable by the foreman proxy user (foreman-proxy).</p></li>
<li><p>Note: if CentOS 7 is used, please make sure to edit the URL under
 Hosts -&gt; Installation Media, to to exclude the $minor version. For 
example: http://mirror.centos.org/centos/$major/os/$arch</p></li>
</ol>


<h5>Setting Up Foreman</h5>

<p>In most cases, the default templates should work fine.  You do, 
however, need to make sure that a PXELinux or iPXE template is 
associated with your hosts.  See <a href="http://projects.theforeman.org/projects/foreman/wiki/Unattended_installations">Unattended Installations</a> for details.  The template will be used to define the PXE configuration file when a host is enabled for build.</p>

<h5>Workflow</h5>

<p>This is a rough outline of the steps triggered on the TFTP smart proxy host when you click on the "Build" link for a host.</p>

<ol>
<li>Call <em>mkdir -p /var/lib/tftpboot/pxelinux.cfg</em> if it does not already exist.</li>
<li>Create a host-specific TFTP configuration file in <em>/var/lib/tftpboot/pxelinux.cfg/01-XX-XX-XX-XX-XX-XX</em>, named based off of the MAC address, using the associated PXE template.</li>
<li>Call <em>mkdir -p /var/lib/tftpboot/boot</em> if it does not already exist.</li>
<li>Download the OS specific kernel and initrd files using wget.

<ol>
<li>The download URLs are derived from the installation media path, and OS specific log (see <em>app/models/redhat.rb</em> and <em>debian.rb</em> in foreman for examples of the gory details).</li>
<li>The <em>debian.rb</em> file tries to guess if you want Ubuntu or 
Debian, based on the Name you give to your OS in the UI. If the name 
does not contain 'ubuntu' or 'debian', it may default to debian, hence 
fail to fetch the kernel/initrd.</li>
<li>cd into /var/lib/tftpboot/boot and check that the filesizes are not 
zero. Check /var/log/foreman-proxy/proxy.log for possible errors.</li>
</ol>
</li>
<li>The exact wget command is
 <pre>wget --no-check-certificate -nv -c <src> -O "<destination>"</destination></src></pre></li>
<li>At this point, the TFTP state is ready for the installation process.</li>
<li>Once the host has completed installation, the OS specific installation script should inform foreman by retrieving the built URL.</li>
<li>The host-specific TFTP configuration file is deleted.</li>
<li>The kernel and initrd are not deleted, but left in place for future 
installs of the same OS and architecture combination.  Please note that 
in the unlikely case that these files are modified, the simplistic 
freshness check of wget will likely get confused, corrupting the 
downloaded versions of the files.  If this happens, you should simply 
delete the files and let them be re-downloaded from scratch.</li>
</ol>


<p><strong>To make sure that you trigger the above workflow make sure you've satisfied these requirements:</strong></p>

<ol>
<li>at least 1 host is put in build mode</li>
<li>the host is using a subnet with a TFTP proxy</li>
</ol>


<h5>Limitations</h5>

<p>At the moment, the proxy is not able to fetch boot files using NFS.
As a workaround, expose your installation medium (or use a public 
mirror) over http/ftp to configure one machine with the require boot 
files.
this would be resolved as part of #992.</p>

<div data-unique="4.3.10SSL" name="4.3.10SSL"></div><h3>4.3.10 SSL</h3>

<p>The smart proxy can work in SSL mode, where both sides verify and 
trust each other.  Requests from Foreman will only be accepted if the 
SSL certificate can be verified.  Since proxies abstract a high level of
 control over your infrastructure, the configuration and security of 
keys and certificates is important.</p>

<h4>Using Puppet CA certificates</h4>

<p>Since Foreman integrates with Puppet heavily, it is recommended to 
use the Puppet Certificate Authority (CA) to secure proxy access.  See 
the <em>Security Communciations with SSL</em> section for more advanced installations (multiple or internal CAs).</p>

<p>If the smart proxy host is not managed by Puppet, you will need to 
generate a certificate - skip forward to the generate section.</p>

<p>When using Puppet's certificates, the following lines will be required in puppet.conf to relax permissions to the <code>puppet</code> group.  The <code>foreman</code> and/or <code>foreman-proxy</code> users should then be added to the <code>puppet</code> group.</p>

<pre>[main]
privatekeydir = $ssldir/private_keys { group = service }
hostprivkey = $privatekeydir/$certname.pem { mode = 640 }
</pre>


<h5>Configuring the proxy</h5>

<p>Configure the locations to the SSL files in <code>/etc/foreman-proxy/settings.yml</code>, plus the list of trusted Foreman hosts:</p>

<pre>:ssl_certificate: /var/lib/puppet/ssl/certs/FQDN.pem
:ssl_ca_file: /var/lib/puppet/ssl/certs/ca.pem
:ssl_private_key: /var/lib/puppet/ssl/private_keys/FQDN.pem

:trusted_hosts:
- foreman.corp.com
#- foreman.dev.domain
</pre>


<h5>Generating a certificate</h5>

<p>To generate a certificate for a proxy host that isn't managed by Puppet, do the following:</p>

<ol>
<li>Generate a new certificate on your puppetmaster: <code>puppet cert --generate &lt;proxy-FQDN&gt;</code></li>
<li>Copy the certificates and key from the puppetmaster to the smart proxy in <code>/etc/foreman-proxy</code>:<ol>
<li>/var/lib/puppet/ssl/certs/ca.pem</li>
<li>/var/lib/puppet/ssl/certs/proxy-FQDN.pem</li>
<li>/var/lib/puppet/ssl/private_keys/proxy-FQDN.pem</li></ol></li>
</ol>


<p>Follow the configuration section above, however use the <code>/etc/foreman-proxy</code> paths instead of the Puppet defaults.</p>

<h5>Configuring Foreman</h5>

<p>For Foreman to connect to an SSL-enabled smart proxy, it needs 
configuring with SSL certificates in the same way.  If the Foreman 
system is managed by Puppet, it will already have these, else 
certificates can be generated following the above instructions.</p>

<p>The locations of the certificates are managed in the <em>Settings</em> page, under <em>Provisioning</em> with the <em>ssl_ca_file</em>, <em>ssl_certificate</em> and <em>ssl_priv_key</em>
 settings.  By default these will point to the Puppet locations - for 
manually generated certificates, or non-standard locations, they may 
have to be changed.</p>

<p>Lastly, when adding the smart proxy in Foreman, ensure the URL begins with <code>https://</code> rather than <code>http://</code>.</p>

<div data-unique="4.3.11Libvirt" name="4.3.11Libvirt"></div><h3>4.3.11 Libvirt</h3>

<p>In this chapter, we will describe how to setup DHCP and DNS for use with the
virsh provider for libvirt.</p>

<p>This provider is able to change DHCP and DNS settings in libvirt with dnsmasq.
This is done via the virsh command. These settings can be for only a single
session, or persistent on the libvirt instance.</p>

<p>The provider is intended for development setups where libvirt is usually used.
With simple steps, one can configure full provisioning on a box with libvirt.</p>

<p><em>This provider is not recommended for production use</em>.</p>

<h4>Configuration of libvirt</h4>

<p>Define the TFTP root first. Edit 'default' virtual network and add 'tftp', 'bootp'
and 'domain' elements.</p>

<pre><code>&lt;network&gt;
 &lt;name&gt;default&lt;/name&gt;
 &lt;uuid&gt;16b7b280-7462-428c-a65c-5753b84c7545&lt;/uuid&gt;
 &lt;forward mode='nat'/&gt;
 &lt;bridge name='virbr0' stp='on' delay='0' /&gt;
 &lt;domain name="local.lan"/&gt;
 &lt;dns&gt;
 &lt;/dns&gt;
 &lt;mac address='52:54:00:a6:01:5d'/&gt;
 &lt;ip address='192.168.122.1' netmask='255.255.255.0'&gt;
   &lt;tftp root='/var/tftproot' /&gt;
   &lt;dhcp&gt;
     &lt;range start='192.168.122.2' end='192.168.122.254' /&gt;
     &lt;bootp file='pxelinux.0' /&gt;
   &lt;/dhcp&gt;
 &lt;/ip&gt;
&lt;/network&gt;
</code></pre>

<p>Create a TFTP root directory, make sure it is writeable by the foreman proxy
user (<code>foreman-proxy</code> for instance) and accessible to the account
dnsmasq is running on (in Fedora this is <code>nobody</code>), set gid flag for newly
copied files and copy necessary files to the new TFTP root directory:</p>

<pre><code>mkdir -p /var/tftproot/{boot,pxelinux.cfg}
yum -y install syslinux
cp /usr/share/syslinux/{pxelinux.0,menu.c32,chain.c32} /var/tftproot
chown -R foreman-proxy:nobody /var/tftproot
find /var/tftproot/ -type d | xargs chmod g+s
</code></pre>

<h4>Configuration of smart-proxy</h4>

<p>Configure smart-proxy in <code>config/settings.yaml</code> file:</p>

<ul>
<li>enable tftp</li>
<li>set correct tftp boot and set explicit tftp_servername</li>
<li>enable dns virsh provider</li>
<li>enable dhcp virsh provider</li>
<li>check virsh_network name (<code>default</code> in our case)</li>
</ul>


<p>Important configuration values are (examples):</p>

<pre><code>:tftp: true
:tftproot: /var/tftproot
:tftp_servername: 192.168.122.1
:dns: true
:dns_provider: virsh
:dhcp: true
:dhcp_vendor: virsh
:virsh_network: default
</code></pre>

<p>Make sure the user foreman proxy will be running with has <code>sudo</code> and <code>virsh</code>
commands available and password is not required for virsh command. Also make
sure sudo does not require tty. An example <code>/etc/sudoers</code> configuration:</p>

<pre><code>Defaults !requiretty
foreman-proxy ALL = NOPASSWD : /usr/bin/virsh
</code></pre>

<p>Or for those who are running foreman-proxy under different user:</p>

<pre><code>%users ALL = NOPASSWD : /usr/bin/virsh
</code></pre>

<h4>Additional steps</h4>

<p>Make sure the DNS server is configured with the foreman instance by setting
<code>/etc/resolv.conf</code> file or changing this in NetworkManager or dnsmasq
configuration. Example:</p>

<pre><code>cat /etc/resolv.conf
nameserver 8.8.8.8
nameserver 8.8.4.4
nameserver 192.168.122.1
</code></pre>

<p>Foreman is now configured for libvirt provisioning, this is the recommended
setup for git development checkouts. There is one limitation though, reverse
DNS entries are not created (libvirt XML does not support them).</p>

<div data-unique="4.4Provisioning" name="4.4Provisioning"></div><h2>4.4 Provisioning</h2>

<p>This chapter details the configuration of the required UI components necessary to provision an OS onto a host.</p>

<div data-unique="4.4.1OperatingSystems" name="4.4.1OperatingSystems"></div><h3>4.4.1 Operating Systems</h3>

<p>The Operating Systems page (<em>Hosts -&gt; Operating Systems</em>) details the OSs known to Foreman, and is the central point that the other required components tie into.</p>

<h4>Creating an Operating System</h4>

<p>Simply click <em>New Operating system</em> on the main page. You will
 be taken to a screen where you can create the bare essentials of a new 
OS. Not everything required for a successful provision is on this page 
(yet) - the remaining components will appear for selection as we create 
them.</p>

<p>You will need to fill in the first few parts of the form (Name, 
Major, Minor, Family, and possibly some family-dependant information). 
In the case of OSs like Fedora, it is fine to leave Minor blank.</p>

<p>If the default Partition Tables &amp; Installation media are 
suitable, then you can assign them now. If not, return here after each 
step in this chapter to assign the newly created objects to your 
Operating System</p>

<h4>Auto-created Operating Systems</h4>

<p>Foreman does not come with any Operating Systems by default. However,
 Foreman will detect the Operating System of any host which reports in 
via Puppet - if the OS of that Host is supported, it will be created 
(with very basic settings) and assigned to the Host. Thus you may find 
some OSs already created for you.</p>

<div data-unique="4.4.2InstallationMedia" name="4.4.2InstallationMedia"></div><h3>4.4.2 Installation Media</h3>

<p>The Installation Media represents the web URL from where the 
installation packages can be retrieved (i.e the OS mirror). Some OS 
Media is pre-created for you when Foreman is first installed. However, 
it is best to edit the media you are going to use and ensure the Family 
is set.</p>

<h4>New Installation Media</h4>

<p>If your OS of choice does not have a mirror pre-created for you, click the <em>New Medium</em> button to create one. There are a few variables which can be used to pad out the URL. For example:</p>

<pre><code>http://mirror.averse.net/centos/$major.$minor/os/$arch
</code></pre>

<p>Be sure to set the Family for the Media</p>

<h4>Assign to Operating System</h4>

<p>If you have not already done so, return to the Operating System page for your OS and assign the Media to it now.</p>

<div data-unique="4.4.3ProvisioningTemplates" name="4.4.3ProvisioningTemplates"></div><h3>4.4.3 Provisioning Templates</h3>

<p>The Provision Templates is the core of Foreman's flexibility to 
deploy the right OS with the right options. There are several types of 
template, along with a flexible matching system to deliver different 
templates to different Hosts.</p>

<p>Foreman comes with pre-created templates for the more common OSs, but you will need to review these.</p>

<h4>Template Kinds</h4>

<p>There are 6 template kinds:</p>

<ul>
<li>PXELinux  - Deployed to the TFTP server to ensure the Host boots the correct installer with the correct kernel options</li>
<li>Provision - The main unattended installation file; e.g. Kickstart or Preseed</li>
<li>Finish    - A post-install script used to take custom actions after the main provisioning is complete</li>
<li>user_data - Similar to a Finish script, this can be assigned to 
hosts built on user_data-capable images (e.g. Openstack, EC2, etc)</li>
<li>Script    - An arbitrary script, not used by default, useful for certain custom tasks</li>
<li>iPXE      - Used in {g,i}PXE environments in place of PXELinux</li>
</ul>


<p>In practice, most environments only make use of the first 3. The <em>Create Host</em>
 action deploys the PXELinux template to the TFTP server. The PXELinux 
template directs the host to retrieve the Provision template. The 
Provision template will direct the installer to retrieve and run the 
Finish template at the end of the install, and the Finish template will 
notify Foreman the build is complete just before reboot.</p>

<h5>Editing Templates</h5>

<p>Clicking a template will take you to the edit page. All templates are
ERB-enabled, and you can access many variables about the to-be-installed-host
within the template. See <a href="http://theforeman.org/projects/foreman/wiki/TemplateWriting"><strong>Template Writing</strong></a> for ideas.</p>

<p>As noted in <a href="http://theforeman.org/manuals/1.9/index.html#4.1.4Auditing"><strong>4.1.4 Auditing</strong></a>,
 changes to the templates are logged as diffs - you can browse the 
history of changes to the templates from the History tab within the Edit
 Template page. You can also revert changes here.</p>

<h4>Template Association</h4>

<p>When editing a Template, you must assign a list of Operating Systems 
which this Template can be used with. Optionally, you can restrict a 
template to a list of Hostgroups and/or Environments</p>

<p>When a Host requests a template (e.g. during provisioning), Foreman 
will select the best match from the available templates of that type, in
 the following order:</p>

<ul>
<li>Host-group and Environment</li>
<li>Host-group only</li>
<li>Environment only</li>
<li>Operating system default</li>
</ul>


<p>The final entry, Operating System default, can be set by editing the Operating System page.</p>

<h5>Associating an Operating System default template</h5>

<p>You will need to associate at least one PXELinux, Provision, and 
Finish template to your Operating System, and this must be done in two 
steps. First edit each of the templates, switch to the Association tab, 
and ensure the appropriate OSs are checked. Then edit the Operating 
System, switch to the Templates tab, and choose a default template for 
each template kind.</p>

<div data-unique="4.4.4PartitionTables" name="4.4.4PartitionTables"></div><h3>4.4.4 Partition Tables</h3>

<p>Partition templates are a subset of normal Provisioning Templates. 
They are handled separately because it is frequently the case that an 
admin wants to deploy the same host template (packages, services, etc) 
with just a different harddisk layout to account for different servers' 
capabilities.</p>

<p>Foreman comes with pre-created templates for common Operating 
Systems, but it is good to edit the template, check it's content and 
it's Family setting. If the Family is wrong, be sure to go back to 
Operating Systems and associate it with your Operating System.</p>

<h4>Dynamic Partition tables</h4>

<p>When creating a new Host, you will be given the option to create a 
Dynamic Partition table. This is essentially a 'one-off' partition table
 that is stored with the host and used only for that host. It replaces 
the choice of Partition Table from the normal list of those associated 
with the selected OS.</p>

<div data-unique="4.4.5Architectures" name="4.4.5Architectures"></div><h3>4.4.5 Architectures</h3>

<p>Architectures are simple objects, usually created by Foreman 
automatically when Hosts check in via Puppet. However, none are created 
by default, so you may need to create them if you're not using Foreman 
for reporting.</p>

<h4>Creating a new Architecture</h4>

<p>Simply click <em>New Architecture</em> to create a new one. This should match the Facter fact <em>:architecture</em>
 e.g. "x86_64". If you've already created some Operating Systems, you 
can associate the Architecture with the OS now; if not, the list of 
Architectures will be present when you create an OS.</p>

<div data-unique="4.4.6Workflow" name="4.4.6Workflow"></div><h3>4.4.6 Workflow</h3>

<p>Foreman performs a number of orchestration steps when performing 
unattended installation or provisioning, which vary depending on the 
integration options chosen - e.g. use of <a href="http://theforeman.org/manuals/1.9/index.html#5.2ComputeResources">compute resources</a>, configuration management tool and provisioning method (network/PXE/image).</p>

<h4>4.4.6.1 Example: PXE booting an instance with Salt configuration</h4>

<p>The following example uses:</p>

<ul>
<li>Compute resource (oVirt), also applicable to Libvirt and VMware</li>
<li>Network (PXE) provisioning with DHCP and TFTP orchestration</li>
<li>DNS orchestration</li>
<li>Salt configuration management, also applicable to Puppet</li>
</ul>


<p><img src="Foreman%20::%20Manual_archivos/foreman_workflow_final.jpg" alt="Example A workflow diagram"></p>

<h5>Steps</h5>

<ol>
<li>On the New Host page, the default VM configuration is shown and compute profiles can be applied.</li>
<li>An unused IP address is requested from the DHCP smart proxy associated with the subnet.</li>
<li>The IP address field is filled in on the New Host page.</li>
<li>n/a</li>
<li>The New Host page is submitted.</li>
<li>Foreman contacts the compute resource to create the virtual machine.</li>
<li>The compute resource creates a virtual machine on a hypervisor.</li>
<li>The VM's MAC address is returned from the compute resource and stored on the host.</li>
<li>A reservation is created on the DHCP smart proxy associated with the subnet.</li>
<li>DNS records are set up:

<ol>
<li>A forward DNS record is created on the smart proxy associated with the domain.</li>
<li>A reverse DNS record is created on the DNS smart proxy associated with the subnet.</li>
</ol>
</li>
<li>A PXELinux menu is created for the host in the TFTP smart proxy associated with the subnet.</li>
<li>Foreman contacts the compute resource to power on the VM.</li>
<li>The compute resource powers up the virtual machine.</li>
<li>The host requests a DHCP lease from the DHCP server.</li>
<li>The DHCP lease response is returned with TFTP options (next-server, filename) set.</li>
<li>The host requests the bootloader and menu from the TFTP server.</li>
<li>The PXELinux menu and OS installer for the host is returned over TFTP.</li>
<li>The installer requests the "provision" template/script from Foreman.</li>
<li>Foreman renders the template and returns the resulting kickstart/preseed to the host.</li>
<li>Autosigning configuration for Salt (or Puppet) is added on the Salt or Puppet CA smart proxy.</li>
<li>The installer notifies Foreman of a successful build in the postinstall script.</li>
<li>The PXELinux menu is reverted to a "local boot" template.</li>
<li>The host requests its configuration from Salt or Puppet.</li>
<li>The host receives appropriate configuration using data defined in Foreman.</li>
<li>Configuration reports and facts are sent from Salt or Puppet to Foreman and stored.</li>
</ol>


<h4>4.4.6.2 Example: Cloud-based provisioning via cloud-init</h4>

<p>This example shows workflow of cloud-based provisioning on IaaS (e.g.
OpenStack) via cloud-init which configures Puppet agent to finish off the
configuration.</p>

<p><img src="Foreman%20::%20Manual_archivos/cloud_init_workflow.png" alt="Cloud-based via cloud-init"></p>

<h4>4.4.6.3 Example: Cloud-based provisioning via ssh</h4>

<p>This example shows workflow of cloud-based provisioning on IaaS (e.g.
OpenStack) via ssh finish template for Puppet agent configuration.</p>

<p><img src="Foreman%20::%20Manual_archivos/cloud_ssh_workflow.png" alt="Cloud-based via ssh"></p>

<h4>4.4.6.4 Example: Image-based provisioning via ssh</h4>

<p>This example shows workflow of image-based provisioning on virtualization
(e.g. oVirt, RHEV or VMware via ssh finish template for Puppet agent
configuration.</p>

<p><img src="Foreman%20::%20Manual_archivos/image_workflow.png" alt="Image-based via ssh"></p>

<h4>4.4.6.5 Example: Anaconda PXE-based provisioning</h4>

<p>This example shows workflow of PXE booting into Anaconda installer with
Puppet agent configuration.</p>

<p><img src="Foreman%20::%20Manual_archivos/pxe_workflow.png" alt="Anaconda"></p>

<div data-unique="4.4.7Networking" name="4.4.7Networking"></div><h3>4.4.7 Networking</h3>

<p>Foreman can store information about the networking setup of a host 
that it's provisioning, which can be used to configure the virtual 
machine, assign the correct IP addresses and network resources, then 
configure the OS correctly during the provisioning process.</p>

<p>This section details the options available for network interfaces in the <em>New Host</em> form and how they're used.</p>

<h4>Host interface options</h4>

<ul>
<li><em>Primary:</em> each host must have a single primary interface, 
which is used as the name of the host itself.  This should be considered
 the main hostname and would usually also carry the default route.</li>
<li><em>Provision:</em> the interface on which provisioning of the 
operating system should be carried out.  This will be used for PXE (if 
applicable) with TFTP menus, running SSH finish scripts etc.  This may 
be different to the primary interface and should have access to Foreman 
and other provisioning systems.</li>
<li><em>Managed:</em> whether Foreman orchestrates creation of DNS 
entries, DHCP reservations and configuration of the interface during 
provisioning.  Unmanaged interfaces would be used for informational 
purposes only.</li>
</ul>


<p>A simple, single-homed host would have one network interface with a 
DNS name set matching the hostname, then managed, primary and provision 
flags all ticked.  This would create one interface with DNS and DHCP 
records (if configured) over which the OS would be set up.</p>

<p>A dual or multi-homed host could have one interface with primary 
enabled ("host.example.com") and another network with provision enabled 
("host-build.example.com").  If both are also managed, Foreman will 
create DNS and DHCP records for both, but on the provision interface, 
the next-server/filename options for PXE will also be set.  A TFTP 
(PXELinux) menu would also be created for the provision interface's MAC 
address so the host can PXE boot on that physical interface, while its 
hostname would be assigned from the primary interface.</p>

<h4>Virtual machines and interfaces</h4>

<p>When Foreman deploys a host onto a compute resource, it creates a new
 interface on the VM for each interface specified when creating the 
host.</p>

<p>After creation, Foreman reads back the network information and 
matches the created interfaces to the list of interfaces given for the 
host and stores the assigned MAC and IP addresses (depending on the 
compute resource type) in its database.  It then continues with 
orchestration, creating DNS and DHCP records etc. for the addresses 
retrieved from the new VM.  Once orchestration of these is complete, it 
powers up the VM.</p>

<p>This design alleviates the need to supply MAC addresses for hosts being created on compute resources.</p>

<h4>Subnet options</h4>

<p>Subnets are defined in Foreman under <em>Infrastructure &gt; Subnets</em>, and have a few options that affect how hosts are provisioned.</p>

<ul>
<li><em>IPAM:</em> DHCP will use a DHCP-enabled smart proxy, checking 
for assigned leases and reservations and suggesting a new IP from the 
range.  Internal DB will use Foreman's list of already-assigned IPs and 
doesn't rely on a DHCP smart proxy.  None disables auto-suggestion of IP
 addresses.</li>
<li><em>Boot mode:</em> during OS provisioning, the template will 
configure the interface with either a static IP address or to use DHCP 
depending on the value of this setting.</li>
</ul>


<p>Various combinations of the <em>IPAM</em> and <em>Boot mode</em> settings make sense, but the most common are <em>DHCP (IPAM)</em> with <em>DHCP (Boot mode)</em> and <em>Internal DB</em> with <em>Static</em>.</p>

<h4>Use within provisioning templates and Puppet</h4>

<p>Provisioning templates (such as kickstart, preseed or finish scripts)
 can make use of the interfaces data stored in Foreman for the host to 
configure the network.</p>

<p>A snippet ("kickstart_networking_setup") is supplied by default in 
Foreman for kickstart-based OSes, which configures all managed network 
interfaces after the main OS installation is complete.  This can be used
 in the %post kickstart section.  No template is currently available for
 preseed-based OSes (<a href="https://github.com/theforeman/community-templates/issues/173">ticket</a>)</p>

<p>A hash of interfaces data is also made available to Puppet via a 
global ENC parameter called "foreman_interfaces".  This can be used to 
fully configure the network from a Puppet run.</p>

<div data-unique="4.4.8OSSpecificNotes" name="4.4.8OSSpecificNotes"></div><h3>4.4.8 OS Specific Notes</h3>

<p>This chapter contains information about provisioning specific operating systems.</p>

<div data-unique="4.4.8.1FreeBSD" name="4.4.8.1FreeBSD"></div><h3>4.4.8.1 FreeBSD</h3>

<p>As the FreeBSD installer itself does not support a kickstart-like 
pulling of a response file, a custom mfsBSD image with zfsinstall is 
used. Prebuilt images are available <a href="http://downloads.theforeman.org/FreeBSD/">for download</a> to be placed into the boot directory of your TFTP server.</p>

<p>However, these images can also be built from scratch as described below:</p>

<h5>Building an installer image</h5>

<p>This is an example how to build an image for FreeBSD 10.2-RELEASE. For other releases, simply replace the version accordingly.</p>

<pre><code># fetch the necessary FreeBSD components
mkdir /tmp/basefiles
cd /tmp/basefiles
fetch ftp://ftp.freebsd.org/FreeBSD/releases/amd64/10.2-RELEASE/base.txz
fetch ftp://ftp.freebsd.org/FreeBSD/releases/amd64/10.2-RELEASE/kernel.txz

# clone the git repository
git clone https://github.com/theforeman/mfsbsd.git
cd mfsbsd

# build the image (you need to be root for this to succeed)
make BASE=/tmp/basefiles RELEASE=10.2-RELEASE ARCH=amd64

# copy the image into the TFTP server directory
cp mfsbsd-10.2-RELEASE-amd64.img /tftpboot/boot/FreeBSD-x86_64-10.2-mfs.img
</code></pre>

<div data-unique="4.4.8.2SLES" name="4.4.8.2SLES"></div><h3>4.4.8.2 SLES</h3>

<p>The installation media URL has to contain the contents of the first 
SLES DVD, it's easiest to loopback mount the ISO image on a webserver. 
For Puppet, the <code>systemsmanagement:puppet</code> repository on OBS is used.</p>

<h5>SLES 11</h5>

<p>For Puppet, in addition to <code>systemsmanagement:puppet</code> also the <code>devel:languages:ruby:backports</code>
 repository on OBS and the SLES SDK DVD is used. The placeholder in the 
AutoYaST SLES template has to be updated with the actual SDK URL.</p>

<div data-unique="4.5CommandLineInterface" name="4.5CommandLineInterface"></div><h2>4.5 Command Line Interface</h2>

<p>The framework used for implementation of command line client for 
foreman provides many features common for modern CLI applications. The 
task of managing Foreman from command line is quite complex so the 
commands have to be  organized in more levels of subcommands. There is 
help available for each level to make it easy to use. Some other 
features for greater comfort are option validation, logging and 
customizable output formatting.</p>

<div data-unique="4.5.1UsageExamples" name="4.5.1UsageExamples"></div><h3>4.5.1 Usage Examples</h3>

<p>Basic help and list of supported commands:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">$ hammer -h
Usage:
    hammer [OPTIONS] SUBCOMMAND [ARG] ...

Parameters:
    SUBCOMMAND                    subcommand
    [ARG] ...                     subcommand arguments

Subcommands:
    architecture                  Manipulate architectures.
    auth                          Foreman connection login/logout.
    compute-resource              Manipulate compute resources.
    domain                        Manipulate domains.
    environment                   Manipulate environments.
    fact                          Search facts.
    filter                        Manage permission filters.
    global-parameter              Manipulate global parameters.
    host                          Manipulate hosts.
    hostgroup                     Manipulate hostgroups.
    location                      Manipulate locations.
    medium                        Manipulate installation media.
    model                         Manipulate hardware models.
    organization                  Manipulate organizations.
    os                            Manipulate operating system.
    partition-table               Manipulate partition tables.
    proxy                         Manipulate smart proxies.
    puppet-class                  Search puppet modules.
    report                        Browse and read reports.
    role                          Manage user roles.
    sc-param                      Manipulate smart class parameters.
    shell                         Interactive shell
    subnet                        Manipulate subnets.
    template                      Manipulate config templates.
    user                          Manipulate users.
    user-group                    Manage user groups.

Options:
    -v, --verbose                 be verbose
    -c, --config CFG_FILE         path to custom config file
    -u, --username USERNAME       username to access the remote system
    -p, --password PASSWORD       password to access the remote system
    --version                     show version
    --show-ids                    Show ids of associated resources
    --csv                         Output as CSV (same as --adapter=csv)
    --output ADAPTER              Set output format. One of [base, table, silent, csv]
    --csv-separator SEPARATOR     Character to separate the values
    -P, --ask-pass                Ask for password
    --autocomplete LINE           Get list of possible endings
    -h, --help                    print help</code></pre></div>


<p>First level command help:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">$ hammer architecture -h
Usage:
    hammer architecture [OPTIONS] SUBCOMMAND [ARG] ...

Parameters:
    SUBCOMMAND                    subcommand
    [ARG] ...                     subcommand arguments

Subcommands:
    list                          List all architectures.
    info                          Show an architecture.
    create                        Create an architecture.
    delete                        Delete an architecture.
    update                        Update an architecture.
    add_operatingsystem           Associate a resource
    remove_operatingsystem        Disassociate a resource

Options:
    -h, --help                    print help</code></pre></div>


<p>Second level command help:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">$ hammer architecture create -h
Usage:
    hammer architecture create [OPTIONS]

Options:
    --name NAME                    
    --operatingsystem-ids OPERATINGSYSTEM_IDS 
                                  Operatingsystem IDs
    -h, --help                    print help</code></pre></div>


<div data-unique="4.5.2SuccessStory" name="4.5.2SuccessStory"></div><h3>4.5.2 Success Story</h3>

<p>There was a set of common commands identified as necessary for basic Foreman management, we called it "success story" and <a href="http://projects.theforeman.org/issues/3297">track</a> the progres of its implementation. The commands could also serve as a basic hammer cookbook.</p>

<p>The goal is to provision bare metal host on a clean install of Foreman. The following steps are necessary:</p>

<ul>
<li>create smart proxy</li>
</ul>


<pre>hammer proxy create --name myproxy --url https://proxy.my.net:8443
</pre>


<ul>
<li>create architecture</li>
</ul>


<pre>hammer architecture create --name x86_64
</pre>


<ul>
<li>create new subnet</li>
</ul>


<pre>hammer subnet create --name "My Net" --network "192.168.122.0" --mask "255.255.255.0" --gateway "192.168.122.1" --dns-primary "192.168.122.1"
</pre>


<ul>
<li><p>import existing subnet from a proxy</p>

<p>  missing, see <a href="http://projects.theforeman.org/issues/3355">#3355</a></p></li>
<li>create new domain</li>
</ul>


<pre>hammer domain create --name "my.net" --fullname "My network"
</pre>


<ul>
<li>associate domain with proxy</li>
</ul>


<pre>hammer domain update --id 1 --dns-id 1
</pre>


<ul>
<li>associate subnet with domain</li>
</ul>


<pre>hammer subnet update --id 1 --domain-ids 1
</pre>


<ul>
<li>associate subnet with proxy (DHCP, TFTP, DNS)</li>
</ul>


<pre>hammer subnet update --id 1 --dhcp-id 1 --tftp-id 1 --dns-id 1
</pre>


<ul>
<li>create new partition table</li>
</ul>


<pre>hammer partition_table create --name "Redhat test" --file /tmp/rh_test.txt
</pre>


<ul>
<li>create new OS</li>
</ul>


<pre>hammer os create --name RHEL --major 6 --minor 4
</pre>


<ul>
<li>create new template</li>
</ul>


<pre>hammer template create --name "kickstart mynet" --type provision --file /tmp/ks.txt
</pre>


<ul>
<li>edit existing pre-defined template</li>
</ul>


<pre>hammer template dump --id 4 &gt; /tmp/ks.txt
    vim /tmp/ks.txt
hammer template update --id 4 --file /tmp/ks.txt
</pre>


<ul>
<li>associate applicable OS with pre-defined template</li>
</ul>


<pre>hammer template update --id 1 --operatingsystem-ids 1
</pre>


<p>   Listing associated OS's is still missing - see <a href="http://projects.theforeman.org/issues/3360">#3360</a></p>

<ul>
<li>associate OS with architecture</li>
</ul>


<pre>hammer os update --id 1 --architecture-ids 1
</pre>


<ul>
<li>associate OS with part table</li>
</ul>


<pre>hammer os update --id 1 --ptable-ids 1
</pre>


<ul>
<li>associate OS with install media</li>
</ul>


<pre>hammer os update --id 1 --medium-ids 1
</pre>


<ul>
<li><p>associate OS with install provision and pxelinux templates</p>

<p>  Missing, needs investigation, may be related to <a href="http://projects.theforeman.org/issues/3360">#3360</a></p></li>
<li>create libvirt compute resource</li>
</ul>


<pre>hammer compute_resource create --name libvirt --url "qemu:///system" --provider Libvirt
</pre>


<ul>
<li><p>import puppet classes</p>

<p>  missing - see <a href="http://projects.theforeman.org/issues/3035">#3035</a></p></li>
<li><p>and finally create a bare metal host entry</p>

<p>  works with some options, needs improvements - see <a href="http://projects.theforeman.org/issues/3063">#3063</a></p></li>
</ul>


<div data-unique="4.6EmailManagement" name="4.6EmailManagement"></div><h2>4.6 Email Management</h2>

<p>Foreman is also able to send out a variety of email notifications 
either on an event, or summary messages on a regular schedule.  Plugins 
are also able to extend this with their own summaries and notifications.</p>

<p>To send email requires a configured SMTP server or local MTA (e.g. sendmail), which is set up in <code>/etc/foreman/email.yml</code> as per <a href="http://theforeman.org/manuals/1.9/index.html#3.5.2ConfigurationOptions">Configuration Options</a>.</p>

<p>Scheduled emails are sent through rake tasks (reports:daily, 
reports:weekly, reports:monthly) run from cronjobs, which are configured
 in <code>/etc/cron.d/foreman</code>.</p>

<div data-unique="4.6.1EmailPreferences" name="4.6.1EmailPreferences"></div><h3>4.6.1 Email Preferences</h3>

<h4>Users</h4>

<p>Email messages are sent to individual users registered to Foreman, to
 the email address configured on the account if present.  Users can edit
 the email address by clicking on their name in the top-right hand 
corner of the web page and selecting <em>My account</em>.</p>

<p>To change which message subscriptions are received by an individual user, the <em>Mail Preferences</em>
 tab under the user account lists all available message types and the 
frequency at which each message should be received.  A global checkbox 
to disable all email messages from Foreman is also available.</p>

<p>Event-based notifications can either be enabled or disabled, and 
these are sent from Foreman at the same time as the event occurring.  
Scheduled notifications can be sent either daily, weekly or monthly.</p>

<h4>Hosts</h4>

<p>Notifications relating to hosts can be disabled on a per-host basis, useful when errors are expected.  On the host's <em>Additional Information</em> tab, untick <em>Enabled</em>
 to disable notifications and remove the host from reports.  Enabling 
and disabling notifications can also be done from the host list by using
 the tickboxes and selecting <em>Enable/Disable Notifications</em> from the <em>Select Action</em> dropdown menu.</p>

<p>Event notifications for a host are sent to the host's registered owner.  This is selected on the <em>Additional Information</em>
 tab of the host, and may be either an individual user or a user group. 
 When set to a user group, all group members who are subscribed to the 
email type will receive a message.</p>

<div data-unique="4.6.2AccountNotifications" name="4.6.2AccountNotifications"></div><h3>4.6.2 Account Notifications</h3>

<h4>New account welcome email</h4>

<p>When the <code>send_welcome_email</code> setting is enabled (<a href="http://theforeman.org/manuals/1.9/index.html#3.5.2ConfigurationOptions">Configuration Options</a>), new account holders will receive an email providing their username and a link to Foreman.</p>

<div data-unique="4.6.3HostNotifications" name="4.6.3HostNotifications"></div><h3>4.6.3 Host Notifications</h3>

<h4>Build complete</h4>

<p>When a host has completed its build process, either notifying Foreman
 of completion via a request at the end of its unattended installation 
or after Foreman has run a script remotely, this email notification will
 be sent to owners of the host.</p>

<h4>Puppet error state</h4>

<p>When a Puppet report is received that puts the host into a red error 
state, a corresponding email notification is sent to owners of the host.</p>

<div data-unique="4.6.4ScheduledEmails" name="4.6.4ScheduledEmails"></div><h3>4.6.4 Scheduled Emails</h3>

<h4>Audit summary</h4>

<p>A regular summary email of all changes to objects in Foreman that triggered audit events (see <a href="http://theforeman.org/manuals/1.9/index.html#4.1.4Auditing">Auditing</a>), including the user that made the change, the time of the change and a link to further details.</p>

<h4>Puppet summary</h4>

<p>A regular overview of all hosts that a user has access to, and their 
Puppet status.  This includes the number of Puppet events over the 
reporting period, such as applied, skipped and failed resources.</p>

<div data-unique="4.7ManagingSalt" name="4.7ManagingSalt"></div><h2>4.7 Managing Salt</h2>

<p>Please refer to the <a href="http://theforeman.org/plugins/foreman_salt/2.0/">foreman_salt plugin documentation</a>.</p>

<div data-unique="4.8ManagingChef" name="4.8ManagingChef"></div><h2>4.8 Managing Chef</h2>

<p>Please refer to the <a href="http://theforeman.org/plugins/foreman_chef/0.1/">foreman_chef plugin documentation</a>.</p>

<div data-unique="5.AdvancedForeman" name="5.AdvancedForeman"></div><h1>5. Advanced Foreman</h1>

<div data-unique="5.1API" name="5.1API"></div><h2>5.1 API</h2>

<p><a href="http://theforeman.org/api/1.9/index.html">API v2</a> is the 
default, stable and recommended version for Foreman 1.9.  API v1 is also
 available, but future versions of Foreman will eventually deprecate and
 remove it.</p>

<p>This section documents the JSON API conventions for the Foreman API 
v2 and Katello API v2. To explicitly select the API version, see <a href="http://theforeman.org/manuals/1.9/index.html#5.1.6APIVersioning">Section 5.1.6</a>.</p>

<div data-unique="5.1.1CRUDRequestExamples" name="5.1.1CRUDRequestExamples"></div><h3>5.1.1 CRUD Request Examples</h3>

<p>The following examples show the basic CRUD operations (Create, Read, Update, Delete) using the JSON API.</p>

<p>&nbsp;</p>

<h4>Show a Collection of Objects</h4>

<p>Get of a collection of domains: <code>GET /api/domains</code></p>

<p>Send a HTTP <strong>GET</strong> request. No JSON data hash is required.</p>

<pre><code>$ curl -k -u admin:changeme -H "Accept: version=2,application/json" https://foreman.example.com/api/domains
</code></pre>

<p>This returns a collection JSON response. The format for a collection response is described in <a href="http://theforeman.org/manuals/1.9/index.html#5.1.2JSONResponseFormatforCollections">Section 5.1.2</a>.</p>

<p>&nbsp;</p>

<h4>Show a Single Object</h4>

<p>Get a single domain: <code>GET /api/domains/:id</code> or <code>GET /api/domains/:name</code></p>

<p>Send a HTTP <strong>GET</strong> request with the object's unique identifer, either <code>:id</code> or <code>:name</code>. No JSON data hash is required.</p>

<pre><code>$ curl -k -u admin:changeme -H "Accept: version=2,application/json" \
    https://foreman.example.com/api/domains/42
# or
$ curl -k -u admin:changeme -H "Accept: version=2,application/json" \
    https://foreman.example.com/api/domains/foo
</code></pre>

<p>This returns a single object in JSON format. The format for a single object response is described in <a href="http://theforeman.org/manuals/1.9/index.html#5.1.3JSONResponseFormatforSingleObjects">Section 5.1.3</a>.</p>

<p>&nbsp;</p>

<h4>Create an Object</h4>

<p>Create a new domain: <code>POST /api/domains</code></p>

<p>Send a HTTP <strong>POST</strong> request with a JSON data hash containing the required fields to create the object. In this example, a domain is being created.</p>

<pre><code>$ curl -k -u admin:changeme -H "Accept: version=2,application/json" -H "Content-Type: application/json" \
    -X POST -d '{ "name":"foo.bar.com","fullname":"foo.bar.com description" }' \
    https://foreman.example.com/api/domains
</code></pre>

<p>This returns the newly created object in JSON format. The format for a single object response is described in <a href="http://theforeman.org/manuals/1.9/index.html#5.1.3JSONResponseFormatforSingleObjects">Section 5.1.3</a>.</p>

<p>&nbsp;</p>

<h4>Update an Object</h4>

<p>Update a domain: <code>PUT /api/domains/:id</code> or <code>PUT /api/domains/:name</code></p>

<p>Send a HTTP <strong>PUT</strong> request with the object's unique identifer, either <code>:id</code> or <code>:name</code>, plus a JSON data hash containing only the data to be updated. In this example, only the domain name is being updated.</p>

<pre><code>$ curl -k -u admin:changeme -H "Accept: version=2,application/json" -H "Content-Type: application/json" \
    -X PUT -d '{ "name": "a new name" }' https://foreman.example.com/api/domains/12
# or
$ curl -k -u admin:changeme -H "Accept: version=2,application/json" -H "Content-Type: application/json" \
    -X PUT -d '{ "name": "a new name" }' https://foreman.example.com/api/domains/foo
</code></pre>

<p>This returns the newly updated object in JSON format. The format for a single object response is described in <a href="http://theforeman.org/manuals/1.9/index.html#5.1.3JSONResponseFormatforSingleObjects">Section 5.1.3</a>.</p>

<p>&nbsp;</p>

<h4>Delete an Object</h4>

<p>Delete a domain: <code>DELETE /api/domains/:id</code> or <code>DELETE /api/domains/:name</code></p>

<p>Send a HTTP <strong>DELETE</strong> request with the object's unique identifer, either <code>:id</code> or <code>:name</code>. No JSON data hash is required.</p>

<pre><code>$ curl -k -u admin:changeme -H "Accept: version=2,application/json" -X DELETE \
    https://foreman.example.com/api/domains/17
# or
$ curl -k -u admin:changeme -H "Accept: version=2,application/json" -X DELETE \
    https://foreman.example.com/api/domains/foo
</code></pre>

<p>This returns the deleted object in JSON format. The format for a single object response is described in <a href="http://theforeman.org/manuals/1.9/index.html#5.1.3JSONResponseFormatforSingleObjects">Section 5.1.3</a>.</p>

<div data-unique="5.1.2JSONResponseFormatforCollections" name="5.1.2JSONResponseFormatforCollections"></div><h3>5.1.2 JSON Response Format for Collections</h3>

<p>Collections are a list of objects (i.e. hosts, domains, etc). The format for a collection JSON response consists of a <code>results</code> root node and metadata fields <code>total, subtotal, page, per_page</code>. Note: for Katello objects, the metadata includes <code>limit, offset</code> instead of <code>page, per_page</code>.</p>

<p>Below is an example of the format for a collection JSON response for a list of domains: <code>GET /api/domains</code></p>

<pre><code>{
    "total": 3,
    "subtotal": 3,
    "page": 1,
    "per_page": 20,
    "search": null,
    "sort": {
        "by": null,
        "order": null
    },
    "results": [
        {
            "id": 23,
            "name": "qa.lab.example.com",
            "fullname": "QA",
            "dns_id": 10,
            "created_at": "2013-08-13T09:02:31Z",
            "updated_at": "2013-08-13T09:02:31Z"
        },
        {
            "id": 25,
            "name": "sat.lab.example.com",
            "fullname": "SATLAB",
            "dns_id": 8,
            "created_at": "2013-08-13T08:32:48Z",
            "updated_at": "2013-08-14T07:04:03Z"
        },
        {
            "id": 32,
            "name": "hr.lab.example.com",
            "fullname": "HR",
            "dns_id": 8,
            "created_at": "2013-08-16T08:32:48Z",
            "updated_at": "2013-08-16T07:04:03Z"
        }
    ]
}
</code></pre>

<p>The response metadata fields are described below:</p>

<ul>
<li><code>total</code> - total number of objects without any search parameters</li>
<li><code>subtotal</code> - number of objects returned with given search parameters (if there is no search, then <code>subtotal</code> equals <code>total</code>)</li>
<li><code>page</code> (Foreman only) - page number</li>
<li><code>per_page</code> (Foreman only) - maximum number of objects returned per page</li>
<li><code>limit</code> - (Katello only) specified number of objects to return in collection response</li>
<li><code>offset</code> - (Katello only) number of objects skipped before beginning to return collection.</li>
<li><code>search</code> - search string (based on scoped_scoped syntax)</li>
<li><code>sort</code>

<ul>
<li><code>by</code> - the field that the collection is sorted by</li>
<li><code>order</code> - sort order, either ASC for ascending or DESC for descending</li>
</ul>
</li>
<li><code>results</code> - collection of objects. See <a href="http://theforeman.org/manuals/1.9/index.html#5.1.4CustomizeJSONResponses">Section 5.1.4</a> for how to change the root name from 'results' to something else.</li>
</ul>


<div data-unique="5.1.3JSONResponseFormatforSingleObjects" name="5.1.3JSONResponseFormatforSingleObjects"></div><h3>5.1.3 JSON Response Format for Single Objects</h3>

<p>Single object JSON responses are used to show a single object. The object's unique identifier <code>:id</code> or <code>:name</code> is required in the <strong>GET</strong> request. Note that <code>:name</code> may not always be used as a unqiue identifier, but <code>:id</code> can always be used. The format for a single object JSON response consists of only the object's attributes. There is <strong>no root node</strong> and <strong>no metadata</strong> by default. See <a href="http://theforeman.org/manuals/1.9/index.html#5.1.4CustomizeJSONResponses">Section 5.1.4</a> for how to add a root name.</p>

<p>Below is an example of the format for a single object JSON response: <code>GET /api/domains/23</code> or <code>GET /api/domains/qa.lab.example.com</code></p>

<pre><code>{
    "id": 23,
    "name": "qa.lab.example.com",
    "fullname": "QA",
    "dns_id": 10,
    "created_at": "2013-08-13T09:02:31Z",
    "updated_at": "2013-08-13T09:02:31Z"
}
</code></pre>

<div data-unique="5.1.4CustomizeJSONResponses" name="5.1.4CustomizeJSONResponses"></div><h3>5.1.4 Customize JSON Responses</h3>

<h4>Customize Root Node for Collections</h4>

<p>The default root node name for collections is <code>results</code> but can be changed.</p>

<p>To change the root node name per API request, pass <code>root_name=</code> as a URL parameter. See example below:</p>

<pre><code>$ curl -k -u admin:changeme -H "Accept: version=2,application/json" \
    https://foreman.example.com/api/domains?root_name=data
</code></pre>

<p>&nbsp;</p>

<h4>Customize Root Node for Single Object</h4>

<p>There is no root node as the default for single object JSON responses, but it can be added.</p>

<p>To change the object's root node name per API request, pass <code>object_name=</code> as a URL parameter. See example below:</p>

<pre><code>$ curl -k -u admin:changeme -H "Accept: version=2,application/json" \
    https://foreman.example.com/api/domains/23?object_name=record
</code></pre>

<p>&nbsp;</p>

<h4>Customize Partial Response Attributes</h4>

<p>Currently, there is no option to change or customize which attributes
 are returned for collections or single objects. In the future, 
customized partial responses such as <code>fields=field1,field2,field3</code> or <code>fields=all</code> may be implemented (<a href="http://projects.theforeman.org/issues/3019">#3019</a>).
 Similarly, there is currently no option to specify child nodes in an 
API call or to remove child nodes if they are returned by default.</p>

<p>&nbsp;</p>

<h4>Custom Number of Objects in Collection Per Response</h4>

<p>Foreman paginates all collections in the JSON response. The number of objects returned per request is defined in <em>Administer &gt; Settings &gt; General &gt; entries_per_page</em>.  The default is 20.  Thus, if there are 27 objects in a collection, only 20 will be returned for the default page=1.</p>

<p>To view the next page, pass <code>page=</code> as a URL parameter. See example below:</p>

<pre><code>$ curl -k -u admin:changeme -H "Accept: version=2,application/json" \
    https://foreman.example.com/api/domains?page=2
</code></pre>

<p>The example above will show the remaining 7 objects in our example of 27 objects in the collection.</p>

<p>To increase or decrease the number of objects per response, pass <code>per_page=</code> as a URL parameter. See example below:</p>

<pre><code>$ curl -k -u admin:changeme -H "Accept: version=2,application/json" \
    https://foreman.example.com/api/domains?per_page=1000
</code></pre>

<p>This will return all the objects in one request since 27 is less than the <code>per_page</code> parameter set to 1000.</p>

<p>&nbsp;</p>

<h4>Custom Search of Collections Per Response</h4>

<p>Foreman uses the scoped_search library for searching and filtering 
which allows all query search parameters to be specified in one string. 
 The syntax is described in the <a href="http://theforeman.org/manuals/1.9/index.html#4.1.5Searching">Searching</a>
 section, and matches exactly the syntax used for the web UI search 
boxes.  This allows you use of the auto-completer and to test a query in
 the UI before reusing it in the API.</p>

<p>To filter results of a collection, pass <code>search=</code> as a URL
 parameter, ensuring that it is fully URL-escaped to prevent search 
operators being misinterpreted as URL separators. See example below:</p>

<pre><code>$ curl -k -u admin:changeme -H "Accept: version=2,application/json" \
    https://foreman.example.com/api/domains?search=name%3Dexample.com
</code></pre>

<p>The number of objects returned will be shown in the <code>subtotal</code> metadata field, and the query string will be shown in the <code>search</code> metadata field.</p>

<p>&nbsp;</p>

<h4>Custom Sort of Collections Per Response</h4>

<p>Custom sort order per collection can be specified by passing <code>order=</code> as a URL parameter. See example below:</p>

<pre><code>$ curl -k -u admin:changeme -H "Accept: version=2,application/json" \
    https://foreman.example.com/api/domains?order=name+DESC
</code></pre>

<p>The default sort order is ascending (ASC) if only a field name is passed.  The sort parameters will be shown in <code>sort</code> <code>by</code> and <code>order</code> metadata fields.</p>

<div data-unique="5.1.5NestedAPIroutes" name="5.1.5NestedAPIroutes"></div><h3>5.1.5 Nested API routes</h3>

<p>The goal is to implement nested routes for all objects as an alternative to filtering collections.</p>

<p>For example, rather then filtering subnets by a specified domain using a search string</p>

<pre><code>$ GET /api/subnets?search=name%3Dqa.lab.example.com
</code></pre>

<p>the alternative nested route below returns the same result as the above.</p>

<pre><code>$ GET /api/domains/qa.lab.example.com/subnets
</code></pre>

<p>All actions will be accessible in the nested route as in the main route.</p>

<div data-unique="5.1.6APIVersioning" name="5.1.6APIVersioning"></div><h3>5.1.6 API Versioning</h3>

<p>The default API version is v2 for Foreman 1.9, however explicitly 
requesting the version is recommended.  Both API v1 and v2 are currently
 shipped.</p>

<p>There are two methods of selecting an API version:</p>

<ol>
<li><p>In the <strong>header</strong>, pass <code>Accept: application/json,version=2</code></p></li>
<li><p>In the <strong>URL</strong>, pass /v2/ such as <code>GET /api/v2/hosts</code></p></li>
</ol>


<p>Similarly, v1 can still be used by passing <code>Accept: application/json,version=1</code> in the header or <code>api/v1/</code> in the URL.</p>

<div data-unique="5.1.7HandlingAssociations" name="5.1.7HandlingAssociations"></div><h3>5.1.7 Handling Associations</h3>

<p>Updating and creating associations are done in a few different ways in the API
depending on the type of association.</p>

<h4>One-to-One and One-to-Many</h4>

<p>To update a one-to-one or a one-to-many association, simply set the name or id
on the object. For example, to set a host group for a host, simply set the
hostgroup_name or hostgroup_id of the host.</p>

<pre><code>$ curl -k -u admin:changeme -H "Accept: version=2,application/json" \
    -H "Content-Type: application/json" -X POST \
    -d '{ "hostgroup_name": "telerin" }' \
    https://foreman.example.com/api/hosts/celeborn.firstage

$ curl -k -u admin:changeme -H "Accept: version=2,application/json" \
    -H "Content-Type: application/json" -X POST \
    -d '{ "hostgroup_id": 42 }' \
    https://foreman.example.com/api/hosts/celeborn.firstage
</code></pre>

<h4>Many-to-One and Many-to-Many</h4>

<p>To update an association for an object that contains a collection of other
objects, there are a few options. First you can set the names or ids:</p>

<pre><code>$ curl -k -u admin:changeme -H "Accept: version=2,application/json" \
    -H "Content-Type: application/json" -X POST \
    -d '{ "host_names": ["enel.first", "celeborni.first", "elwe.first"] }' \
    https://foreman.example.com/api/hostgroups/telerin

$ curl -k -u admin:changeme -H "Accept: version=2,application/json" \
    -H "Content-Type: application/json" -X POST \
    -d '{ "host_ids": [4, 5, 6] }' \
    https://foreman.example.com/api/hostgroups/telerin
</code></pre>

<p>This will set the host group's hosts to enel, celeborn, and elwe (or 4, 5, 6)
and only those.</p>

<p>Alternatively, you can pass in a set of objects:</p>

<pre><code>$ curl -k -u admin:changeme -H "Accept: version=2,application/json" \
    -H "Content-Type: application/json" -X POST \
    -d '{ "domains": [{ "name": "earendil", "id": 1}, { "name": "turgon", "id": 3 }] }' \
    https://foreman.example.com/api/subnets/iluvatar
</code></pre>

<p>This would set the domains for the subnet to be earendil and turgon. If another
domain for example belonged to the subnet before the request, it would be
removed.</p>

<div data-unique="5.2ComputeResources" name="5.2ComputeResources"></div><h2>5.2 Compute Resources</h2>

<p>Foreman supports creating and managing hosts on a number of 
virtualization and cloud services - referred to as "compute resources" -
 as well as bare metal hosts.</p>

<p>The capabilities vary between implementations, depending on how the 
compute resource provider deploys new hosts and what features are 
available to manage currently running hosts.  Some providers are able to
 support unattended installation using PXE, while others are 
image-based.  Some providers have graphical consoles that Foreman 
interfaces to, and most have power management features.  A summary of 
all providers and their support features is given below, and more 
detailed sections follow with specific notes.</p>

<table class="table table-bordered table-condensed">
  <tbody><tr>
    <th>Provider</th>
    <th>Package</th>
    <th>Unattended installation</th>
    <th>Image-based</th>
    <th>Console</th>
    <th>Power management</th>
  </tr>
  <tr>
    <td><a href="http://theforeman.org/manuals/1.9/index.html#5.2.3EC2Notes">EC2</a></td>
    <td>foreman-ec2</td>
    <td>no</td>
    <td>yes</td>
    <td>read-only</td>
    <td>yes</td>
  </tr>
  <tr>
    <td><a href="http://theforeman.org/manuals/1.9/index.html#5.2.4GoogleComputeEngineNotes">Google Compute Engine</a></td>
    <td>foreman-gce</td>
    <td>no</td>
    <td>yes</td>
    <td>no</td>
    <td>yes</td>
  </tr>
  <tr>
    <td><a href="http://theforeman.org/manuals/1.9/index.html#5.2.5LibvirtNotes">Libvirt</a></td>
    <td>foreman-libvirt</td>
    <td>yes</td>
    <td>yes</td>
    <td>VNC or SPICE</td>
    <td>yes</td>
  </tr>
  <tr>
    <td><a href="http://theforeman.org/manuals/1.9/index.html#5.2.6OpenStackNotes">OpenStack Nova</a></td>
    <td>foreman-compute</td>
    <td>no</td>
    <td>yes</td>
    <td>no</td>
    <td>yes</td>
  </tr>
  <tr>
    <td><a href="http://theforeman.org/manuals/1.9/index.html#5.2.7oVirt/RHEVNotes">oVirt / RHEV</a></td>
    <td>foreman-ovirt</td>
    <td>yes</td>
    <td>yes</td>
    <td>VNC or SPICE</td>
    <td>yes</td>
  </tr>
  <tr>
    <td><a href="http://theforeman.org/manuals/1.9/index.html#5.2.8RackspaceNotes">Rackspace</a></td>
    <td>foreman-compute</td>
    <td>no</td>
    <td>yes</td>
    <td>no</td>
    <td>yes</td>
  </tr>
  <tr>
    <td><a href="http://theforeman.org/manuals/1.9/index.html#5.2.9VMwareNotes">VMware</a></td>
    <td>foreman-vmware</td>
    <td>yes</td>
    <td>yes</td>
    <td>VNC</td>
    <td>yes</td>
  </tr>
</tbody></table>


<p>Support for these features is aimed at being as transparent as 
possible, allowing the same configuration to be applied to hosts 
irrespective of the provider in use (compute resource or not).  The 
selection of compute resource is made when creating a new host and the 
host in Foreman's database remains associated to the VM that's created, 
allowing it to be managed throughout the lifetime of the host.</p>

<div data-unique="5.2.1UsingComputeResources" name="5.2.1UsingComputeResources"></div><h3>5.2.1 Using Compute Resources</h3>

<p>The following steps describe how to configure a compute resource and provision new hosts on it.</p>

<ol>
<li><p>Ensure the necessary package for the provider (from the above table) is installed, e.g. <code>yum -y install foreman-ovirt</code>.  Restart the Foreman application to complete installation.</p></li>
<li><p>Add a compute resource under <em>Infrastructure &gt; Compute Resources &gt; New Compute Resource</em>.
  Select the provider type from the menu and appropriate configuration 
options will be displayed.  Check the notes sections below for any 
provider-specific setup instructions.</p></li>
<li><p>Click the <em>Test Connection</em> button after entering the configuration.  If no error is displayed, the test was successful.</p></li>
<li><p>After saving the compute resource, existing virtual machines can be browsed by clicking on the compute resource and the <em>Virtual Machines</em> tab.</p></li>
<li><p>For providers that use images, click on the compute resource, then the <em>Images</em> tab, where known images are listed.  To register images that Foreman can use, click <em>New Image</em> and enter the details.</p></li>
<li><p>To provision a new host on this compute resource, from <em>Hosts</em>, click <em>New Host</em> and select the compute resource from the <em>Deploy to</em> menu.</p></li>
</ol>


<p>Also note the following features:</p>

<ol>
<li><p>When viewing a host, power management controls and the console access button are in the top right hand corner of the page.</p></li>
<li><p>If a host provisioned on a compute resource is deleted, the VM 
and associated storage on the compute resource will also be deleted.</p></li>
<li><p>Users in Foreman can have access restricted to hosts present on 
certain compute resources.  For more information, see Filtering in <a href="http://theforeman.org/manuals/1.9/index.html#4.1.2RolesandPermissions">4.1.2 Roles and Permissions</a>.</p></li>
</ol>


<div data-unique="5.2.2UsingComputeProfiles" name="5.2.2UsingComputeProfiles"></div><h3>5.2.2 Using Compute Profiles</h3>

<p>A compute profile is a way of expressing a set of defaults for VMs created on a
specific compute resource that can be mapped to an operator-defined label. This
means an administrator can express, for example, what "Small", Medium" or
"Large" means on all of the individual compute resources present for a given
installation.</p>

<p>In combination with host groups, this allows a user to completely define a new
host from just the <em>Host</em> tab of the <em>New Host</em> form.</p>

<p>You can find the configuration for compute profiles at <em>Infrastructure &gt;
Compute Profiles</em></p>

<h4>Default Profiles</h4>

<p>By default, Foreman comes with 3 predefined profiles; "1-Small", "2-Medium",
and "3-Large" (the numbers are just to make them sort nicely). They come with
no associated configuration for any particular compute resource, and as such,
they can be deleted or renamed as required.</p>

<p><img src="Foreman%20::%20Manual_archivos/profile-list.png" alt="Profile List"></p>

<h4>Assigning information to a Profile</h4>

<p>This walkthrough will define what "1-Small" means for a particular
installation. It will also assume there are two compute resources; one Libvirt
and one EC2 (these make a good example as they are very different).</p>

<p>Start by editing the compute profile, by clicking its name in the profile
list. This leads to a list of all your current compute resources. Later,
once the configuration is done, this list will also display the current
defaults configured for each compute resource.</p>

<p><img src="Foreman%20::%20Manual_archivos/profile-edit.png" alt="Profile Edit"></p>

<h5>EC2</h5>

<p>Clicking on the EC2 resource will bring up a page very similar to the one used
when provisioning a single host. Here an administrator can set what "1-Small"
means on this specific EC2 resource. For this example, "m1.small" is selected
as the size. Defaults can also be specified for the image choice, the security
groups, and so on.</p>

<p><img src="Foreman%20::%20Manual_archivos/ec2.png" alt="EC2"></p>

<p>The changes are submitted, and on returning to the profile list, the new EC2
defaults will be shown.</p>

<h5>Libvirt</h5>

<p>In a very similar manner, the Libvirt resource can be clicked upon, and some
defaults assigned. For this example, since this is the "1-Small" profile, 1
CPU, 512MB of RAM, a single bridged network device, and a 5GB disk are
selected.</p>

<p><img src="Foreman%20::%20Manual_archivos/libvirt.png" alt="Libvirt"></p>

<p>Again, the changes are submitted.</p>

<h4>Applying a Compute Profile</h4>

<p>Now visit <em>Hosts &gt; New Host</em>. At first, things look exactly as before, but once
a compute resource is selected which has at least one compute profile, a new
combo-box will appear. This permits the user to select a profile to apply to
this host. For this example, the Libvirt resource is selected, followed by the
"1-Small" profile.</p>

<p><img src="Foreman%20::%20Manual_archivos/host-primary.png" alt="Primary Tab"></p>

<p>Once the profile is selected, the <em>Virtual Machine</em> tab will automatically
update to use the defaults configured in the "1-Small" profile.</p>

<p><img src="Foreman%20::%20Manual_archivos/host-vm.png" alt="VM Tab"></p>

<p>Assuming the defaults are suitable, the host has now been defined solely by
selecting a host group and a profile. It's also possible to associate a profile
with a host group in the host group edit page, which will automatically select
that profile when the host group is selected.</p>

<div data-unique="5.2.3EC2Notes" name="5.2.3EC2Notes"></div><h3>5.2.3 EC2 Notes</h3>

<ul>
<li>Add a provisioning template of either type <em>finish</em> or <em>user_data</em> which will be executed on the new image.

<ul>
<li>'finish' templates complete the provisioning process via SSH - this 
requires Foreman to be able to reach the IP of the new host, and that 
SSH is allowing connections from Foreman. This uses the SSH key which 
Foreman uploaded to your compute resource when it was added to Foreman.</li>
<li>'user_data' templates instead provision by cloud-init (or similar 
meta-data retrieving scripts). This will not require Foreman to be able 
to reach the host, but the host must be able to reach Foreman (since 
user_data execution is asynchronous, the host must notify Foreman that 
the build is complete).</li>
</ul>
</li>
<li>Ensure AMIs are added under the <em>Images</em> tab on the compute resource

<ul>
<li>Ensure the correct username is set for Foreman to SSH into the image (if using SSH provisioning).</li>
<li>Tick the user_data box if the image is capable of using user_data scripts (usually because it has cloud-init installed).</li>
</ul>
</li>
<li>Enabling <em>use_uuid_for_certificates</em> in <em>Administer &gt; Settings</em> is recommended for consistent Puppet certificate IDs instead of hostnames.</li>
<li>VPC subnets and security groups can be selected on the <em>Network</em> tab when creating a host.</li>
<li>The <em>Managed IP</em> dropdown menu allows selection between using the public and private IP address for communication from Foreman to the instance.</li>
<li>Ensure that the selected template is associated to the OS (on the <em>Associations</em> tab) and is set as the default for the operating system too.</li>
</ul>


<p>A finish-based example for configuring EC2 provisioning is given on the Foreman blog: <a href="http://blog.theforeman.org/2012/05/ec2-provisioning-using-foreman.html">EC2 provisioning using Foreman</a>.</p>

<div data-unique="5.2.4GoogleComputeEngineNotes" name="5.2.4GoogleComputeEngineNotes"></div><h3>5.2.4 Google Compute Engine Notes</h3>

<ul>
<li>Requires client e-mail address of an authorised Google Cloud Console
 client ID is entered in the new compute resource screen and its 
associated .p12 private key file is manually transferred to the foreman 
server.</li>
<li>The certificate must be stored in a location the foreman user account has permission to read.</li>
<li>If your server enforces SELinux ensure the context is suitable or relabel it using restorecon -vv /usr/share/foreman/gce.p12</li>
<li>Specify the location <em>on the foreman server</em> as the certificate path value e.g /usr/share/foreman/gce.p12</li>
<li>Ensure images are associated under the <em>Images</em> tab on the compute resource.</li>
<li>Add a provisioning template of type <em>finish</em> which will be executed over SSH on the new image.</li>
<li>Ensure the finish template is associated to the OS (on the <em>Associations</em> tab) and is set as the default for the operating system too.</li>
<li>Enabling <em>use_uuid_for_certificates</em> in <em>Administer &gt; Settings</em> is recommended for consistent Puppet certificate IDs instead of hostnames.</li>
<li>The <em>External IP</em> checkbox means the public IP address (rather than private IP) will be used for communication with the instance from Foreman.</li>
</ul>


<h4>Setting up the cloud project</h4>

<p>All Google Compute Engine access is contained within a "project" set up via the Google Developers Console.  Access <a href="https://console.developers.google.com/">the Google Developers Console</a>, and click <em>Create Project</em>.</p>

<p><img src="Foreman%20::%20Manual_archivos/create_project.png" alt="Create Project"></p>

<p>In the project settings, enable the Compute Engine feature by clicking one of the sections below <em>Compute Engine</em> in the left hand pane.  This will trigger an initialization job.</p>

<p><img src="Foreman%20::%20Manual_archivos/enable_compute.png" alt="Initializing Compute Engine"></p>

<p>Next, under <em>APIs &amp; auth</em>, then <em>APIs</em>, click the <em>Enable API</em> button.</p>

<p><img src="Foreman%20::%20Manual_archivos/enable_api.png" alt="Enable API"></p>

<p>Under <em>Credentials</em>, click <em>Create new Client ID</em> in the OAuth section and select <em>Service account</em> in the popup box.  A new account will be created for Foreman to use.</p>

<p><img src="Foreman%20::%20Manual_archivos/create_account.png" alt="Service account"></p>

<p>Click <em>Generate new P12 key</em> and save the new .p12 file.  This
 should be uploaded to the Foreman server to a location that the 
'foreman' user can read, such as <code>/usr/share/foreman/gce.p12</code>.</p>

<div class="alert alert-info">Change the .p12 file owner to 'foreman' 
and chmod 0600 for security.  If your server uses SELinux ensure the 
context is suitable or relabel it using restorecon -vv 
/usr/share/foreman/gce.p12</div>


<h4>Adding the compute resource</h4>

<p>In Foreman, under <em>Infrastructure &gt; Compute resources &gt; New compute resource</em>, select <em>Google</em> from the provider dropdown menu and fill in the GCE-specific fields as follows:</p>

<ul>
<li><em>Google Project ID:</em> shown on the project overview page in the GCE console, e.g. "nomadic-rite-396"</li>
<li><em>Client Email:</em> shown on the <em>Credentials</em> page after creating the service account as <em>Email address</em>, e.g. "543...@developer.gserviceaccount.com"</li>
<li><em>Certificate path:</em> full path of the .p12 file stored on the Foreman server, e.g. /usr/share/foreman/gce.p12</li>
</ul>


<div data-unique="5.2.5LibvirtNotes" name="5.2.5LibvirtNotes"></div><h3>5.2.5 Libvirt Notes</h3>

<ul>
<li>Currently only supports KVM hypervisors.</li>
<li>VM consoles will be configured by default to listen on 0.0.0.0, change this via <em>libvirt_default_console_address</em> in <em>Administer &gt; Settings &gt; Provisioning</em>.</li>
<li>libvirt's DNS and DHCP server (dnsmasq) can be disabled and replaced
 by BIND and ISC DHCPD (managed by Foreman) by creating a new virtual 
network and disabling DHCP support.</li>
</ul>


<h4>Connections</h4>

<p>To connect to the hypervisor using SSH:</p>

<ol>
<li>Configure SSH keys (ssh-keygen) for the 'foreman' user on the 
Foreman host to connect fully automatically to the remote hypervisor 
host.</li>
<li>Change to the 'foreman' user, test the connection and ensure the remote host has been trusted.</li>
<li>If connecting to the hypervisor as a non-root user, set up PolicyKit
 to permit access to libvirt.  Note that different versions of PolicyKit
 have different configuration formats.  <a href="http://libvirt.org/auth.html#ACL_server_polkit">1</a>, <a href="http://wiki.libvirt.org/page/SSHPolicyKitSetup">2</a>.</li>
<li>Add the compute resource with a URL following one of these examples:

<ul>
<li><code>qemu+ssh://root@hypervisor.example.com/system</code> to use the remote 'root' account</li>
<li><code>qemu+ssh://hypervisor.example.com/system</code> to use the remote 'foreman' account</li>
</ul>
</li>
</ol>


<p>The first two steps above can be done with something like:</p>

<pre><code>root# mkdir /usr/share/foreman/.ssh
root# chmod 700 /usr/share/foreman/.ssh
root# chown foreman:foreman /usr/share/foreman/.ssh
</code></pre>

<p>When using distribution packages, the directory should already be created for
you so you could skip the above. Although following is necessary:</p>

<pre><code>root# su foreman -s /bin/bash
foreman$ ssh-keygen
foreman$ ssh-copy-id root@hostname.com
foreman$ ssh root@hostname.com
exit
</code></pre>

<p>When using SELinux make sure the directory and the files have correct labels
of <code>ssh_home_t</code>:</p>

<pre><code>ls /usr/share/foreman/.ssh -Zd
drwx------. foreman foreman system_u:object_r:ssh_home_t:s0  /usr/share/foreman/.ssh
ls /usr/share/foreman/.ssh -Z
-rw-------. foreman foreman unconfined_u:object_r:ssh_home_t:s0 id_rsa
-rw-r--r--. foreman foreman unconfined_u:object_r:ssh_home_t:s0 id_rsa.pub
-rw-r--r--. foreman foreman unconfined_u:object_r:ssh_home_t:s0 known_hosts
</code></pre>

<p>If not, restore the context:</p>

<pre><code>restorecon -RvF /usr/share/foreman/.ssh
</code></pre>

<p>To connect to the hypervisor over TCP without authentication or encryption (not recommended):</p>

<ol>
<li>Set the following options in libvirtd.conf:

<ul>
<li><code>listen_tls = 0</code></li>
<li><code>listen_tcp = 1</code></li>
<li><code>auth_tcp = "none"</code></li>
</ul>
</li>
<li>Enable libvirtd listening, e.g. set <code>LIBVIRTD_ARGS="--listen"</code> in /etc/sysconfig/libvirtd</li>
<li>Add the compute resource with a URL following this example:

<ul>
<li><code>qemu+tcp://hypervisor.example.com:16509/system</code></li>
</ul>
</li>
</ol>


<p>If you have difficulty connecting, test access using the virsh 
command under the 'foreman' account on the Foreman host first, e.g. <code>virsh -c qemu+ssh://hypervisor.example.com/system list</code>.</p>

<h4>Image provisioning</h4>

<p>Image based provisioning can be used by provisioning a VM with a 
backing image and then running a finish script over SSH, in the same 
manner as the EC2 provider.  The type of provisioning method can be 
selected under the "Operating system" tab when creating a new host.  To 
configure image/template-based provisioning:</p>

<ul>
<li>Images refer to backing disks (usually qcow2) - create a disk containing the OS image in the libvirt storage pool.</li>
<li>Add the image by navigating to the compute resource and clicking <em>New Image</em>, enter the full path to the backing image in the <em>Image path</em> field.</li>
<li>Ensure the image is not modified as long as hosts exists that are using it, or they will suffer data corruption.</li>
</ul>


<p>Two methods to complete provisioning are supported.  Either by SSHing into the newly created VM and running a script:</p>

<ul>
<li>The template needs to have a username and password set up for Foreman to SSH in after provisioning and run the finish script.</li>
<li>This requires some form of DHCP orchestration for SSH access to the newly created host to work.</li>
<li>A finish template to perform any post-build actions (e.g. setting up
 Puppet) must also be associated to the host, usually by changing the OS
 default finish template.</li>
</ul>


<p>Or select the userdata checkbox when adding the image to Foreman, and
 a cloud-init compatible disk will be attached to the VM containing the 
userdata:</p>

<ul>
<li>The template will need cloud-init installed and set to run on boot.</li>
<li>A userdata template to perform any post-build actions (e.g. setting 
up Puppet) must also be associated to the host, usually by associating 
the <code>UserData default</code> template.</li>
<li>The template will need to "phone home" to mark the host as built.</li>
</ul>


<div data-unique="5.2.6OpenStackNotes" name="5.2.6OpenStackNotes"></div><h3>5.2.6 OpenStack Notes</h3>

<ul>
<li>Supports OpenStack Nova for creating new compute instances.</li>
<li>Add a provisioning template of either type <em>finish</em> or <em>user_data</em> which will be executed on the new image.

<ul>
<li>'finish' templates complete the provisioning process via SSH - this 
requires Foreman to be able to reach the IP of the new host, and that 
SSH is allowing connections from Foreman. This uses the SSH key which 
Foreman uploaded to your compute resource when it was added to Foreman.</li>
<li>'user_data' templates instead provision by cloud-init (or similar 
meta-data retrieving scripts). This will not require Foreman to be able 
to reach the host, but the host must be able to reach Foreman (since 
user_data execution is asynchronous, the host must notify Foreman that 
the build is complete).</li>
</ul>
</li>
<li>Ensure Glance Images are added under the <em>Images</em> tab on the compute resource.

<ul>
<li>Ensure the correct username is set for Foreman to SSH into the image (if using SSH provisioning).</li>
<li>Tick the user_data box if the image is capable of using user_data scripts (usually because it has cloud-init installed).</li>
</ul>
</li>
<li>Security groups can be selected on the <em>Virtual Machine</em> tab when creating a host.</li>
<li>The <em>Floating IP Network</em> dropdown menu allows selection of 
the network Foreman should request a public IP on. This is required when
 using SSH provisioning.</li>
<li>Ensure that the selected template is associated to the OS (on the <em>Associations</em> tab) and is set as the default for the operating system too.</li>
</ul>


<p>A finish-based example for configuring image-based provisioning is given on the Foreman blog, also applicable to OpenStack: <a href="http://blog.theforeman.org/2012/05/ec2-provisioning-using-foreman.html">EC2 provisioning using Foreman</a>.</p>

<div data-unique="5.2.7oVirt/RHEVNotes" name="5.2.7oVirt/RHEVNotes"></div><h3>5.2.7 oVirt / RHEV Notes</h3>

<ul>
<li>SPICE consoles are displayed using an HTML5 client, so no native XPI extension is necessary.</li>
</ul>


<h4>Image provisioning</h4>

<p>Image based provisioning can be used by provisioning a VM with a 
template and then running a finish script over SSH, in the same manner 
as the EC2 provider.  The type of provisioning method can be selected 
under the "Operating system" tab when creating a new host.  To configure
 image/template-based provisioning:</p>

<ul>
<li>Images refer to templates and can be added by navigating to the compute resource and clicking <em>New Image</em>.</li>
<li>The template needs to have a username and password set up for Foreman to SSH in after provisioning and run the finish script.</li>
<li>This requires some form of DHCP orchestration for SSH access to the newly created host to work.</li>
<li>A finish template to perform any post-build actions (e.g. setting up
 Puppet) must also be associated to the host, usually by changing the OS
 default finish template.</li>
</ul>


<div data-unique="5.2.8RackspaceNotes" name="5.2.8RackspaceNotes"></div><h3>5.2.8 Rackspace Notes</h3>

<ul>
<li>The compute resource URL refers to the identity API URL, e.g. <code>https://identity.api.rackspacecloud.com/v2.0</code></li>
</ul>


<p>A full example for configuring image-based provisioning is given on the Foreman blog, also applicable to Rackspace: <a href="http://blog.theforeman.org/2012/05/ec2-provisioning-using-foreman.html">EC2 provisioning using Foreman</a>.</p>

<div data-unique="5.2.9VMwareNotes" name="5.2.9VMwareNotes"></div><h3>5.2.9 VMware Notes</h3>

<ul>
<li>Only VMware clusters using vSphere are supported, not standalone ESX or ESXi servers (<a href="http://projects.theforeman.org/issues/1945">#1945</a>).</li>
</ul>


<h4>Image provisioning</h4>

<p>Image based provisioning can be used by provisioning a new VM from a 
template and then running a finish script over SSH, in the same manner 
as the EC2 provider.  The type of provisioning method can be selected 
under the "Operating system" tab when creating a new host.  To configure
 image/template-based provisioning:</p>

<ul>
<li>Images refer to templates stored in vSphere which will be used as the basis for a new VM.</li>
<li>Add the image by navigating to the compute resource and clicking <em>New Image</em>, enter the relative path and name of the template on the vSphere server, e.g. <code>My templates/RHEL 6</code> or <code>RHEL 6</code> if it isn't in a folder.  Do not include the datacenter name.</li>
<li>The template needs to have a username and password set up for Foreman to SSH in after provisioning and run the finish script.</li>
<li>This requires some form of DHCP orchestration for SSH access to the newly created host to work.</li>
<li>A finish template to perform any post-build actions (e.g. setting up
 Puppet) must also be associated to the host, usually by changing the OS
 default finish template.</li>
</ul>


<h4>Image provisioning without SSH</h4>

<p>The same process can also be done using a user_data template. To 
configure image/template-based provisioning without SSH, make the 
following adjustments for the former procedure:</p>

<ul>
<li>Enable user_data checking the proper checkbox in the compute resource definition</li>
<li>Associate a user_data template to the host, using cloud-init syntax</li>
<li>Note that the images dont need cloudinit installed, as the cloudinit
 is converted under the hood to a CustomisationSpec object that VMware 
can process</li>
</ul>


<h4>Console access</h4>

<p>Consoles are provided using VNC connections from Foreman to the ESX 
server, which requires a firewall change to open the respective ports 
(TCP 5901 to 5964)</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">ssh root@esx-srv
vi /etc/vmware/firewall/vnc.xml</code></pre></div>


<p>Add the following file content:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;ConfigRoot&gt;</span>
<span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">'0032'</span><span class="nt">&gt;</span>
 <span class="nt">&lt;id&gt;</span>VNC<span class="nt">&lt;/id&gt;</span>
 <span class="nt">&lt;rule</span> <span class="na">id =</span> <span class="s">'0000'</span><span class="nt">&gt;</span>
  <span class="nt">&lt;direction&gt;</span>inbound<span class="nt">&lt;/direction&gt;</span>
  <span class="nt">&lt;protocol&gt;</span>tcp<span class="nt">&lt;/protocol&gt;</span>
  <span class="nt">&lt;porttype&gt;</span>dst<span class="nt">&lt;/porttype&gt;</span>
  <span class="nt">&lt;port&gt;</span>
   <span class="nt">&lt;begin&gt;</span>5901<span class="nt">&lt;/begin&gt;</span>
   <span class="nt">&lt;end&gt;</span>5964<span class="nt">&lt;/end&gt;</span>
  <span class="nt">&lt;/port&gt;</span>
 <span class="nt">&lt;/rule&gt;</span>
 <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
<span class="nt">&lt;/service&gt;</span>
<span class="nt">&lt;/ConfigRoot&gt;</span></code></pre></div>


<p>Apply and check the firewall rule:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">esxcli network firewall refresh
esxcli network firewall ruleset list <span class="p">|</span> grep VNC</code></pre></div>


<p>Lastly, make the rule persistent.</p>

<p>With ESX:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">cp /etc/vmware/firewall/vnc.xml /vmfs/volumes/datastore1/vnc.xml
vi /etc/rc.local
<span class="c"># At end of file :</span>
cp /vmfs/volumes/datastore1/vnc.xml /etc/vmware/firewall/
esxcli network firewall refresh</code></pre></div>


<p>With ESXi:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">cp /etc/vmware/firewall/vnc.xml /vmfs/volumes/datastore1/vnc.xml
vi /etc/rc.local.d/local.sh
<span class="c"># At end of file, just before exit 0 :</span>
cp /vmfs/volumes/datastore1/vnc.xml /etc/vmware/firewall/
esxcli network firewall refresh</code></pre></div>


<p>If permanent shared storage is available (direct-attach SAN, etc): 
rather than doing a file copy on each server, use a symlink instead.  
Once it's changed on the shared storage, run a loop to refresh the 
firewall services. The local.sh file still needs to be created.</p>

<p>Example:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">ln -s /vmfs/volumes/<span class="o">{</span>uuid of shared storage<span class="o">}</span>/firewall.rules/vnc.xml /etc/vmware/firewall/vnc.xml</code></pre></div>


<h4>Required Permissions</h4>

<p>The minimum permissions to properly provision new virtual machines are:</p>

<ul>
<li>All Privileges -&gt; Datastore -&gt; Allocate Space</li>
<li>All Privileges -&gt; Network -&gt; Assign Network</li>
<li>All Privileges -&gt; Resource -&gt; Assign virtual machine to resource pool</li>
<li>All Privileges -&gt; Virtual Machine -&gt; Configuration (All)</li>
<li>All Privileges -&gt; Virtual Machine -&gt; Interaction</li>
<li>All Privileges -&gt; Virtual Machine -&gt; Inventory</li>
<li>All Privileges -&gt; Virtual Machine -&gt; Provisioning</li>
</ul>


<h4>Notes</h4>

<ul>
<li>Log in to the VMware vSphere Server that represents the Compute 
Resource. Create a role with the above permissions. Add the appropriate 
account to the role. To create user accounts, roles or for complete 
details on administration of VMware vSphere, please consult your VMware 
vSphere Server documentation.</li>
<li>The account that foreman uses to communicate with VCenter is assumed
 to have the ability to traverse the entire inventory in order to locate
 a given datacenter.  A patch is required to instruct foreman to 
navigate directly to the appropriate datacenter to avoid permission 
issues (<a href="http://projects.theforeman.org/issues/5006">#5006</a>).</li>
<li>Reference in the <a href="http://kb.vmware.com/selfservice/microsites/search.do?cmd=displayKC&amp;docType=kc&amp;externalId=2043564&amp;sliceId=1&amp;docTypeID=DT_KB_1_1&amp;dialogID=458724081&amp;stateId=1%200%20458722496">VMWare KB 2043564</a>.</li>
<li>For debugging purpose, read the <a href="http://theforeman.org/manuals/1.9/index.html#7.1NoVNC">troubleshooting guide about NoVNC</a>.</li>
</ul>


<div data-unique="5.2.10PasswordEncryption" name="5.2.10PasswordEncryption"></div><h3>5.2.10 Password Encryption</h3>

<p>Compute resource passwords and secrets are stored on the Foreman 
database using a secret - the encryption key - and ciphered using 
AES-256-CBC.
The encryption key can usually be found in <code>/etc/foreman/encryption_key.rb</code>, which is symlinked to <code>/usr/share/foreman/config/initializers/encryption_key.rb</code>. The value of the ENCRYPTION_KEY variable must be at least 32 bytes long.</p>

<p>If you want to regenerate the key, you can run <code>foreman-rake security:generate_encryption_key</code>.
 Please remember that previously encrypted passwords cannot be decrypted
 with a different encryption key, so decrypt all passwords before 
changing your encryption key.</p>

<p>After you make sure you have a valid encryption key, you can encrypt your Compute Resource secrets in the database by running <code>foreman-rake db:compute_resources:encrypt</code>.
To unencrypt them, run the task <code>foreman-rake db:compute_resources:decrypt</code>.</p>

<p>Keep in mind passwords are encrypted in the Foreman database, but 
Foreman will decrypt them and use unencrypted credentials to 
authenticate to Compute Resources.</p>

<div data-unique="5.3InstallLocations" name="5.3InstallLocations"></div><h2>5.3 Install Locations</h2>

<p><span style="color: #cd5c5c;">Missing content. Consider contributing, you kind soul!</span></p>

<div data-unique="5.4SecuringCommunicationswithSSL" name="5.4SecuringCommunicationswithSSL"></div><h2>5.4 Securing Communications with SSL</h2>

<p>The Foreman web application needs to communicate securely with 
associated smart proxies and puppet masters, plus users and applications
 connecting to the web interface.  This section details recommended SSL 
configurations.</p>

<div data-unique="5.4.1SecuringPuppetMasterRequests" name="5.4.1SecuringPuppetMasterRequests"></div><h3>5.4.1 Securing Puppet Master Requests</h3>

<p>In a typical ENC-based setup with reporting, puppet masters require access to Foreman for three tasks:</p>

<ol>
<li>Retrieval of external nodes information (classes, parameters)</li>
<li>Uploading of host facts</li>
<li>Uploading of host reports</li>
</ol>


<p>All traffic here is initiated by the puppet master itself.  Other 
traffic from Foreman to the puppet master for certificate signing etc. 
is handled via smart proxies (SSL configuration covered in the next 
section).</p>

<h4>Configuration options</h4>

<p>The Foreman interface authorizes access to puppet master interfaces based on its list of registered smart proxies with the <em>Puppet</em> feature, and identifies hosts using client SSL certificates.</p>

<p>Five main settings control the authentication, the first are in Foreman under <em>Settings</em>, <em>Auth</em>:</p>

<ul>
<li><em>require_ssl_smart_proxies</em> (default: true), requires a 
client SSL certificate on the puppet master requests, and will verify 
the CN of the certificate against the smart proxies.  If false, it uses 
the reverse DNS of the IP address making the request.</li>
<li><em>restrict_registered_smart_proxies</em> (default: true), only permits access to hosts that have a registered smart proxy with the <em>Puppet</em> feature.</li>
<li><em>trusted_puppetmaster_hosts</em>, a whitelist of hosts that overrides the check for a registered smart proxy</li>
</ul>


<p>And two in <code>config/settings.yaml</code>:</p>

<ul>
<li><em>login</em> (default: true), must be enabled to prevent anonymous access to Foreman.</li>
<li><em>require_ssl</em> (default: false), should be enabled to require 
SSL for all communications, which in turn will require client SSL 
certificates if <em>require_ssl_smart_proxies</em> is also enabled.  If false, host-based access controls will be available for HTTP requests.</li>
</ul>


<h4>Enabling full SSL communications</h4>

<p>Using Apache HTTP with mod_ssl and mod_passenger is recommended.  For
 simple setups, the Puppet certificate authority (CA) can be used, with 
Foreman and other hosts using certificates generated by <code>puppet cert</code>.</p>

<ol>
<li>Set Foreman's <em>require_ssl_smart_proxies</em>, <em>restrict_registered_smart_proxies</em> and <em>require_ssl</em> to <em>true</em>.</li>
<li>The mod_ssl configuration must contain:
<ol><li><em>SSLCACertificateFile</em> set to the Puppet CA</li>
<li><em>SSLVerifyClient optional</em></li>
<li><em>SSLOptions +StdEnvVars</em></li></ol></li>
<li>ENC script (e.g. <code>/etc/puppet/node.rb</code>) should have these settings:
<ol><li><em>:ssl_ca</em> set to the Puppet CA</li>
<li><em>:ssl_cert</em> set to the puppet master's certificate</li>
<li><em>:ssl_key</em> set to the puppet master's private key</li></ol></li>
<li>Report processor (e.g. <code>/usr/lib/ruby/site_ruby/1.8/puppet/reports/foreman.rb</code>) should have these settings:
<ol><li><em>$foreman_ssl_ca</em> set to the Puppet CA</li>
<li><em>$foreman_ssl_cert</em> set to the puppet master's certificate</li>
<li><em>$foreman_ssl_key</em> set to the puppet master's private key</li></ol></li>
</ol>


<h5>Troubleshooting</h5>

<p>Warning messages will be printed to Foreman's log file (typically <code>/var/log/foreman/production.log</code>) when SSL-based authentication fails.</p>

<ul>
<li><em>No SSL cert with CN supplied</em> indicates no client SSL 
certificate was supplied, or the CN wasn't present on a certificate.  
Check the client script has the certificate and key configured and that 
mod_ssl has <em>SSLVerifyClient</em> set.</li>
<li><em>SSL cert has not been verified</em> indicates the client SSL 
certificate didn't validate with the SSL terminator's certificate 
authority.  Check the client SSL certificate is signed by the CA set in 
mod_ssl's <em>SSLCACertificateFile</em> and is still valid.  More information might be in error logs.</li>
<li><em>SSL is required</em> indicates the client is using an HTTP URL instead of HTTPS.</li>
<li><em>No smart proxy server found on $HOST</em> indicates Foreman has 
no smart proxy registered for the source host, add it to the Smart 
Proxies page in Foreman.  A common cause of this issue is the hostname 
in the URL doesn't match the hostname seen here in the log file - change
 the registered proxy URL to match.  If no smart proxy is available or 
can be installed, use <em>trusted_puppetmaster_hosts</em> and add this hostname to the whitelist.</li>
</ul>


<h5>Advanced SSL notes</h5>

<p>A typical small setup will use a single Puppet CA and certificates it
 provides for the Foreman host and puppet master hosts.  In larger 
setups with multiple CAs or an internal CA, this will require more 
careful configuration to ensure all hosts can trust each other.</p>

<ul>
<li>Ensure the Common Name (CN) is present in certificates used by 
Foreman (as clients will validate it) and puppet master clients (used to
 verify against smart proxies).</li>
<li>Foreman's SSL terminator must be able to validate puppet master client SSL certificates.  In Apache with mod_ssl, the <em>SSLCACertificateFile</em> option must point to the CA used to validate clients and <em>SSLVerifyClient</em> set to <em>optional</em>.</li>
<li>Environment variables from the SSL terminator are used to get the client certificate's DN and verification status.  mod_ssl's <em>SSLOptions +StdEnvVars</em> setting enables this.  Variable names are defined by <em>ssl_client_dn_env</em> and <em>ssl_client_verify_env</em> settings in Foreman.</li>
</ul>


<h4>Reduced security: HTTP host-based authentication</h4>

<p>In non-SSL setups, host-based authentication can be performed, so any
 connection from a host running a puppet smart proxy is able to access 
the interfaces.</p>

<ol>
<li>Set <em>restrict_registered_smart_proxies</em> to <em>true</em>.</li>
<li>Set <em>require_ssl_smart_proxies</em> and <em>require_ssl</em> to <em>false</em>.</li>
</ol>


<h4>No security: disable authentication</h4>

<p>Entirely disabling authentication isn't recommended, since it can 
lead to security exploits through YAML import interfaces and expose 
sensitive host information, however it may be useful for 
troubleshooting.</p>

<ol>
<li>Set <em>require_ssl_smart_proxies</em>, <em>restrict_registered_smart_proxies</em> and <em>require_ssl</em> to <em>false</em>.</li>
</ol>


<div data-unique="5.4.2SecuringSmartProxyRequests" name="5.4.2SecuringSmartProxyRequests"></div><h3>5.4.2 Securing Smart Proxy Requests</h3>

<p>Foreman makes HTTP requests to smart proxies for a variety of 
orchestration tasks.  In a production setup, these should use SSL 
certificates so the smart proxy can verify the identity of the Foreman 
host.</p>

<p>In a simple setup, a single Puppet Certificate Authority (CA) can be 
used for authentication between Foreman and proxies.  In more advanced 
setups with multiple CAs or an internal CA, the services can be 
configured as follows.</p>

<h4>Proxy configuration options</h4>

<p><code>/etc/foreman-proxy/settings.yml</code> contains the locations to the SSL certificates and keys:</p>

<pre>---
# SSL Setup

# if enabled, all communication would be verified via SSL
# NOTE that both certificates need to be signed by the same CA in order for this to work
# see http://theforeman.org/projects/smart-proxy/wiki/SSL for more information
:ssl_certificate: /var/lib/puppet/ssl/certs/FQDN.pem
:ssl_ca_file: /var/lib/puppet/ssl/certs/ca.pem
:ssl_private_key: /var/lib/puppet/ssl/private_keys/FQDN.pem
</pre>


<p>In this example, the proxy is sharing Puppet's certificates, but it could equally use its own.</p>

<p>In addition it contains a list of hosts that connections will be accepted from, which should be the host(s) running Foreman:</p>

<pre># the hosts which the proxy accepts connections from
# commenting the following lines would mean every verified SSL connection allowed
:trusted_hosts:
- foreman.corp.com
#- foreman.dev.domain
</pre>


<h5>Configuring Foreman</h5>

<p>For Foreman to connect to an SSL-enabled smart proxy, it needs configuring with SSL certificates in the same way.</p>

<p>The locations of the certificates are managed in the <em>Settings</em> page, under <em>Provisioning</em> - the <em>ssl_ca_file</em>, <em>ssl_certificate</em> and <em>ssl_priv_key</em>
 settings.  By default these will point to the Puppet locations - for 
manually generated certificates, or non-standard locations, they may 
have to be changed.</p>

<p>Lastly, when adding the smart proxy in Foreman, ensure the URL begins with <code>https://</code> rather than <code>http://</code>.</p>

<h5>Sharing Puppet certificates</h5>

<p>If using Puppet's certificates, the following lines will be required in puppet.conf to relax permissions to the <code>puppet</code> group.  The <code>foreman</code> and/or <code>foreman-proxy</code> users should then be added to the <code>puppet</code> group.</p>

<pre>[main]
privatekeydir = $ssldir/private_keys { group = service }
hostprivkey = $privatekeydir/$certname.pem { mode = 640 }
</pre>


<p>Note that the "service" keyword will be interpreted by Puppet as the "puppet" service group.</p>

<div data-unique="5.5Backup,RecoveryandMigration" name="5.5Backup,RecoveryandMigration"></div><h2>5.5 Backup, Recovery and Migration</h2>

<p>This chapter will provide you with information how to backup and recover
your instance. All commands presented here are just examples and should be
considered as a template command for your own backup script which differs from
one environment to other.</p>

<p>It is possible to perform a <em>migration</em> by doing backup one one host and
recovery on a different host, but in this case pay attention to different
configuration between the two hosts.</p>

<p>This can be applied to the Foreman application itself, but pay attention when
migrating smart-proxy and services because things like different IP addresses
or hostnames will need manual intervention.</p>

<div data-unique="5.5.1Backup" name="5.5.1Backup"></div><h3>5.5.1 Backup</h3>

<p>This chapter will provide you with information how to backup a Foreman
instance.</p>

<div data-unique="Database" name="Database"></div><h3>Database</h3>

<h4>PostgreSQL, MySQL, SQLite</h4>

<p>Run <code>foreman-rake db:dump</code>. It will print a message when it finishes with the dump
file location relative to the Foreman root.</p>

<h5>SQLite disclaimer</h5>

<p>SQLite databases are all contained in a single file, so you can back them up
by copying the file to another location, but it is recommended to shut down
the instance first, or at least verify the integrity of the created archive
using sqlite3 command. The dump command above is preferred.</p>

<div data-unique="Configuration" name="Configuration"></div><h3>Configuration</h3>

<p>On Red Hat compatible systems issue the following command to backup whole /etc
directory structure:</p>

<pre><code>tar --selinux -czvf etc_foreman_dir.tar.gz /etc/foreman
</code></pre>

<p>For all other distribution do similar command:</p>

<pre><code>tar -czvf etc_foreman_dir.tar.gz /etc/foreman
</code></pre>

<div data-unique="Puppetmaster" name="Puppetmaster"></div><h3>Puppet master</h3>

<p>On the puppet master node, issue the following command to backup Puppet
certificates on Red Hat compatible systems</p>

<pre><code>tar --selinux -czvf var_lib_puppet_dir.tar.gz /var/lib/puppet/ssl
</code></pre>

<p>For all other distribution do similar command:</p>

<pre><code>tar -czvf var_lib_puppet_dir.tar.gz /var/lib/puppet/ssl
</code></pre>

<div data-unique="DHCP,DNSandTFTPservices" name="DHCP,DNSandTFTPservices"></div><h3>DHCP, DNS and TFTP services</h3>

<p>Depending on used software packages, perform backup of important data and
configuration files according to the documentation. For ISC DHCP and DNS
software, these are located within /etc and /var directories depending on your
distribution as well as TFTP service.</p>

<div data-unique="5.5.2Recovery" name="5.5.2Recovery"></div><h3>5.5.2 Recovery</h3>

<p>Recovery process is supposed to be performed on the same host the backup was
created on on the same distribution and version.</p>

<p>If you planning to <em>migrate</em> Foreman instance, please read remarks in the
beginning of this chapter.</p>

<p>Note: Foreman instance must be stopped before proceeding.</p>

<h4>PostgreSQL, MySQL, SQLite</h4>

<p>Run <code>foreman-rake db:import_dump file=/your/db/dump/location</code>. This will load your
dump into the current database for your environment. It will print a message
to notify you when it has finished importing the dump.</p>

<p>Remember to stop the Foreman instance and any other process consuming data from the
database temporarily during the import and turn it back on after it ends.</p>

<div data-unique="Configuration117" name="Configuration"></div><h3>Configuration</h3>

<p>On Red Hat compatible systems issue the following command to restore whole /etc
directory structure:</p>

<pre><code>tar --selinux -xzvf etc_foreman_dir.tar.gz -C /
</code></pre>

<p>For all other distribution do similar command:</p>

<pre><code>tar -xzvf etc_foreman_dir.tar.gz -C /
</code></pre>

<p>It is recommended to extract files to an empty directory first and inspect the
content before overwriting current files (change -C option to an empty
directory).</p>

<div data-unique="Puppetmaster118" name="Puppetmaster"></div><h3>Puppet master</h3>

<p>On the puppet master node, issue the following command to restore Puppet
certificates on Red Hat compatible systems</p>

<pre><code>tar --selinux -xzvf var_lib_puppet_dir.tar.gz -C /
</code></pre>

<p>For all other distribution do similar command:</p>

<pre><code>tar -xzvf var_lib_puppet_dir.tar.gz -C /
</code></pre>

<p>It is recommended to inspect the content of the restore first (see above).</p>

<div data-unique="DHCP,DNSandTFTPservices119" name="DHCP,DNSandTFTPservices"></div><h3>DHCP, DNS and TFTP services</h3>

<p>Depending on used software packages, perform recovery of important data and
configuration files according to the documentation. This depends on the
software and distribution that is in use.</p>

<div data-unique="5.6RailsConsole" name="5.6RailsConsole"></div><h2>5.6 Rails Console</h2>

<p>Foreman is a Ruby on Rails application, which provides an interactive
 console for advanced debugging and troubleshooting tasks.  Using this 
allows easy bypass of authorization and security mechanisms, and can 
easily lead to loss of data or corruption unless care is taken.</p>

<p>To access the Rails console, choose the method below appropriate to the installation method.</p>

<h5>RPM and Debian installations</h5>

<p>As root, execute:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">yum install foreman-console
foreman-rake console</code></pre></div>


<h5>Source installations</h5>

<p>As the user running Foreman and in the source directory, execute:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">RAILS_ENV</span><span class="o">=</span>production bundle <span class="nb">exec </span>rails c</code></pre></div>


<h5>Set up</h5>

<p>To assume full admin permissions in order to modify objects, enter in the console:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">User</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">only_admin</span><span class="o">.</span><span class="n">visible</span><span class="o">.</span><span class="n">first</span></code></pre></div>


<p><a name="5.7SPNEGOauthentication"></a></p>

<div data-unique="5.7ExternalAuthentication" name="5.7ExternalAuthentication"></div><h2>5.7 External Authentication</h2>

<p>The following tutorial explains how to set up Foreman authentication 
against FreeIPA (or Identity Management) server. First part of the 
tutorial describes how to configure Foreman machine via Foreman 
installer options. The second one shows how to achieve the same result 
without using these options.</p>

<div data-unique="5.7.1ConfigurationviaForemaninstaller" name="5.7.1ConfigurationviaForemaninstaller"></div><h3>5.7.1 Configuration via Foreman installer</h3>

<p>We assume the Foreman machine is FreeIPA-enrolled:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">ipa-client-install</code></pre></div>


<p>On the FreeIPA server, we create the service.
(Please make sure you have obtained Kerberos ticket before this step - for example, by using <em>kinit</em>.)</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">ipa service-add HTTP/&lt;the-foreman-fqdn&gt;</code></pre></div>


<p>Then we install Foreman.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">foreman-installer --foreman-ipa-authentication<span class="o">=</span><span class="nb">true</span></code></pre></div>


<p>This option can be used for the reconfiguration of existing installation as well.</p>

<p>Some of required packages may not be available in older RHEL 
versions. You can get them from Jan Pazdziora's copr yum repo at 
http://copr.fedoraproject.org/coprs/adelton/identity_demo/ .</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">foreman-installer --foreman-ipa-authentication<span class="o">=</span><span class="nb">true</span> --foreman-configure-ipa-repo<span class="o">=</span><span class="nb">true</span></code></pre></div>


<p>In case you want to use IPA server's host-based access control (HBAC) features (make sure <em>allow_all</em> rule is disabled), the default PAM service name (which would be matched by HBAC service name) is <em>foreman</em>. You can override the default name with:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">foreman-installer --foreman-ipa-authentication<span class="o">=</span><span class="nb">true</span> --foreman-pam-service<span class="o">=</span>&lt;pam_service_name&gt;</code></pre></div>


<p>For more information about HBAC configuration see section below.</p>

<div data-unique="5.7.2HBACconfiguration" name="5.7.2HBACconfiguration"></div><h3>5.7.2 HBAC configuration</h3>

<p>We suppose that the Foreman machine is FreeIPA-enrolled and <code>HTTP/&lt;the-foreman-fqdn&gt;</code> service has been created on FreeIPA server.</p>

<p>At first we create HBAC (host-based access control) service and rule 
on the FreeIPA server. In the following examples, we will use the PAM 
service name <em>foreman-prod</em>.</p>

<p>On the FreeIPA server, we define the HBAC service and rule and link them together:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">ipa hbacsvc-add foreman-prod
ipa hbacrule-add allow_foreman_prod
ipa hbacrule-add-service allow_foreman_prod --hbacsvcs<span class="o">=</span>foreman-prod</code></pre></div>


<p>Then we add user we wish to have access to the service <em>foreman-prod</em>, and the hostname of our Foreman server:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">ipa hbacrule-add-user allow_foreman_prod --user<span class="o">=</span>&lt;username&gt;
ipa hbacrule-add-host allow_foreman_prod --hosts<span class="o">=</span>&lt;the-foreman-fqdn&gt;</code></pre></div>


<p>Alternatively, host groups and user groups could be added to the <em>allow_foreman_prod</em> rule.</p>

<p>At any point of the configuration, we can check the status of the rule:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">ipa hbacrule-find foreman-prod
ipa hbactest --user<span class="o">=</span>&lt;username&gt; --host<span class="o">=</span>&lt;the-foreman-fqdn&gt; --service<span class="o">=</span>foreman-prod</code></pre></div>


<p>Chances are there will be HBAC rule <em>allow_all</em> matching besides our new <em>allow_foreman_prod</em> rule. See http://www.freeipa.org/page/Howto/HBAC_and_allow_all for steps to disable the catchall <em>allow_all</em> HBAC rule while maintaining the correct operation of your FreeIPA server and enrolled clients. The goal is only <em>allow_foreman_prod</em> matching when checked with <code>ipa hbactest</code>.</p>

<div data-unique="5.7.3KerberosSingleSign-On" name="5.7.3KerberosSingleSign-On"></div><h3>5.7.3 Kerberos Single Sign-On</h3>

<p>In this part of the tutorial we will show how to set up Foreman authentication manually (without using installer option).</p>

<p>At first we enroll Foreman machine and define <code>HTTP/&lt;the-foreman-fqdn&gt;</code>
 service in the FreeIPA server. Then we define HBAC service and rules 
(for more information see the previous section). In the following steps 
we will use the HBAC service name <em>foreman-prod</em>.</p>

<p>Next step is to define matching PAM service on the Foreman machine. We create file <code>/etc/pam.d/foreman-prod</code> with the following content:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">auth    required   pam_sss.so
account required   pam_sss.so</code></pre></div>


<p>We will also want to enable two SELinux booleans on the Foreman machine:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">setsebool -P allow_httpd_mod_auth_pam on
setsebool -P httpd_dbus_sssd on</code></pre></div>


<p>Until all the packages are part of your operation system 
distribution, you can get them from Jan Pazdziora's copr yum repo. At 
http://copr.fedoraproject.org/coprs/adelton/identity_demo/ choose the 
correct .repo file. For example, for Foreman on RHEL 6, the following 
command will configure yum:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">wget -O /etc/yum.repos.d/adelton-identity_demo.repo <span class="se">\</span>
  https://copr.fedoraproject.org/coprs/adelton/identity_demo/repo/epel-6/adelton-identity_demo-epel-6.repo</code></pre></div>


<p>Get the keytab for the service and set correct permissions (we assume the FreeIPA server is <em>ipa.example.com</em>, adjust to match your setup):</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">kinit admin
ipa-getkeytab -s <span class="k">$(</span>awk <span class="s1">'/^server =/ {print $3}'</span> /etc/ipa/default.conf<span class="k">)</span> -k /etc/http.keytab -p HTTP/<span class="k">$(</span> hostname <span class="k">)</span>
chown apache /etc/http.keytab
chmod <span class="m">600</span> /etc/http.keytab</code></pre></div>


<p>Install mod_auth_kerb and mod_authnz_pam:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">yum install -y mod_auth_kerb mod_authnz_pam</code></pre></div>


<p>Configure the module to be used by Apache (we assume the realm is <em>EXAMPLE.COM</em>, adjust to match your setup):</p>

<div class="highlight"><pre><code class="language-text" data-lang="text"># add to /etc/httpd/conf.d/auth_kerb.conf
LoadModule auth_kerb_module modules/mod_auth_kerb.so
LoadModule authnz_pam_module modules/mod_authnz_pam.so
&lt;Location /users/extlogin&gt;
  AuthType Kerberos
  AuthName "Kerberos Login"
  KrbMethodNegotiate On
  KrbMethodK5Passwd Off
  KrbAuthRealms EXAMPLE.COM
  Krb5KeyTab /etc/http.keytab
  KrbLocalUserMapping On
  # require valid-user
  require pam-account foreman-prod
  ErrorDocument 401 '&lt;html&gt;&lt;meta http-equiv="refresh" content="0; URL=/users/login"&gt;&lt;body&gt;Kerberos authentication did not pass.&lt;/body&gt;&lt;/html&gt;'
  # The following is needed as a workaround for https://bugzilla.redhat.com/show_bug.cgi?id=1020087
  ErrorDocument 500 '&lt;html&gt;&lt;meta http-equiv="refresh" content="0; URL=/users/login"&gt;&lt;body&gt;Kerberos authentication did not pass.&lt;/body&gt;&lt;/html&gt;'
&lt;/Location&gt;</code></pre></div>


<p>We tell Foreman that it is OK to trust the authentication done by Apache by adding to <code>/etc/foreman/settings.yml</code> or under <em>Administer &gt; Settings &gt; Auth</em>:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">:authorize_login_delegation</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span></code></pre></div>


<p>We restart Apache:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">service httpd restart</code></pre></div>


<p>The machine on which you run the browser to access Foreman's WebUI 
needs to be either FreeIPA-enrolled to the FreeIPA server or at least 
configured (typically in <code>/etc/krb5.conf</code>) to know about the 
FreeIPA server Kerberos services. The browser needs to have the 
Negotiate Authentication enabled; for example in Firefox, in the <code>about:config</code> settings, <em>network.negotiate-auth.trusted-uris</em> needs to include the Foreman server FQDN or its domain. If you then <code>kinit</code>
 as existing Foreman user to obtain Kerberos ticket-granting ticket, 
accessing Foreman's WebUI should not ask for login/password and should 
display the authenticated dashboard directly.</p>

<p>Please note that we use directive <code>require pam-account foreman-prod</code>
 to also check the access against FreeIPA's HBAC rule. If you do not see
 Kerberos authentication passing, check that the user is allowed access 
in FreeIPA (in the section about HBAC configuration we've named the HBAC
 rule <em>allow_forman_prod</em>).</p>

<div data-unique="5.7.4PAMAuthentication" name="5.7.4PAMAuthentication"></div><h3>5.7.4 PAM Authentication</h3>

<p>The FreeIPA server can be used as an authentication provider for 
Foreman's standard logon form. We assume the Foreman machine is already 
FreeIPA-enrolled so sssd is configured to be able to facilitate the 
authentication, and we have PAM service <em>foreman-prod</em> configured.</p>

<p>We will install the necessary Apache modules:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">yum install -y mod_intercept_form_submit mod_authnz_pam</code></pre></div>


<p>We will then configure Apache to perform PAM authentication (and access control check) using the PAM service <em>foreman-prod</em>, for example in configuration file <code>/etc/httpd/conf.d/intercept_form_submit.conf</code>:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">LoadModule intercept_form_submit_module modules/mod_intercept_form_submit.so
LoadModule authnz_pam_module modules/mod_authnz_pam.so
&lt;Location /users/login&gt;
  InterceptFormPAMService foreman-prod
  InterceptFormLogin login[login]
  InterceptFormPassword login[password]
&lt;/Location&gt;</code></pre></div>


<p>After restarting Apache with <code>service httpd restart</code>, you should be able to log in to Foreman's WebUI as existing user, using password from the FreeIPA server. Please note that <strong>intercept_form_submit_module</strong> uses <strong>authnz_pam_module</strong>
 to run not just the authentication, but access check as well. If the 
authentication does not pass and you are sure you use the correct 
password, check also that the user is allowed access in FreeIPA HBAC 
rules.</p>

<div data-unique="5.7.5Populateusersandattributes" name="5.7.5Populateusersandattributes"></div><h3>5.7.5 Populate users and attributes</h3>

<p>So far we have tried external authentication for existing Foreman users.</p>

<p>However, it is also possible to have the user's records in Foreman 
created automatically, on the fly when they first log in using external 
authentication (single sign-on, PAM).</p>

<p>The first step to enable this feature is to add</p>

<p>:authorize_login_delegation_auth_source_user_autocreate: External</p>

<p>to <code>/etc/foreman/settings.yaml</code> or under <em>Administer &gt; Settings &gt; Auth</em>.</p>

<p>Since we will want the newly created user records to have valid name and email address, we need to set up <strong>sssd</strong> to provide these attributes and <strong>mod_lookup_identity</strong> to pass them to Foreman. We start by installing the packages:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">yum install -y sssd-dbus mod_lookup_identity</code></pre></div>


<p>Amend the configuration of sssd in <code>/etc/sssd/sssd.conf</code>:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text"># /etc/sssd/sssd.conf, the [domain/...] section, add:
ldap_user_extra_attrs = email:mail, firstname:givenname, lastname:sn

# /etc/sssd/sssd.conf, the [sssd] section, amend the services line to include ifp:
services = nss, pam, ssh, ifp

# /etc/sssd/sssd.conf, add new [ifp] section:
[ifp]
allowed_uids = apache, root
user_attributes = +email, +firstname, +lastname</code></pre></div>


<p>Configure Apache to retrieve these attributes, for example in <code>/etc/httpd/conf.d/lookup_identity.conf</code>:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">LoadModule lookup_identity_module modules/mod_lookup_identity.so
&lt;LocationMatch ^/users/(ext)?login$&gt;
  LookupUserAttr email REMOTE_USER_EMAIL " "
  LookupUserAttr firstname REMOTE_USER_FIRSTNAME
  LookupUserAttr lastname REMOTE_USER_LASTNAME
  LookupUserGroupsIter REMOTE_USER_GROUP
&lt;/LocationMatch&gt;</code></pre></div>


<p>Restart both sssd and Apache:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">service sssd restart
service httpd restart</code></pre></div>


<p>Now when you log in either using Kerberos ticket or using user's 
FreeIPA password (make sure the user has access allowed in FreeIPA HBAC 
rule), even if the user did not log in to Foreman before, their record 
will be populated with name and email address from the FreeIPA server 
(you can check in the top right corner that the full name is there) and 
they will also be updated upon every subsequent 
externally-authentication logon.</p>

<p>You might notice that the newly created user does not have many 
access right. To fully use the central identity provider like FreeIPA, 
it can be useful to link group membership of externally-authenticated 
Foreman users to the group membership of users in FreeIPA, and then set 
Foreman roles to these user groups. That way when a new network 
administrator has their record created in FreeIPA with proper user 
groups and then logs in to Foreman for the first time, their Foreman 
account will automatically get group memberships in Foreman groups, 
giving them appropriate roles and access rights.</p>

<p>The prerequisite is obviously to have the user groups and mamberships set appropriately for your organization in FreeIPA.</p>

<p>For each FreeIPA user group that should have some semantics in 
Foreman, we create new user groups in Foreman, and then use the tab <em>External groups</em> and <em>Add external user group</em> to add name of the user group in FreeIPA, for Auth source <strong>EXTERNAL</strong>. We can then assign roles to this Foreman user group to match the desired role for users from the given FreeIPA user group.</p>

<p>Upon their first login, externally-authenticated users will get their
 group membership in Foreman set to match the mapping to FreeIPA groups 
and their group membership in FreeIPA. Upon subsequent 
externally-authenticated logons, the membership in these mapped groups 
will be updated to match the current membership in FreeIPA.</p>

<div data-unique="5.7.6Namespaceseparation" name="5.7.6Namespaceseparation"></div><h3>5.7.6 Namespace separation</h3>

<p>If clear namespace separation of internally and externally 
authenticated users is desired, we can distinguish the externally 
authenticated (and populated) users by having @REALM part in their user 
names.</p>

<p>For the Kerberos authentication, using <code>KrbLocalUserMapping Off</code> will keep the REALM part of the logon name:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text"># in /etc/httpd/conf.d/auth_kerb.conf
&lt;Location /users/extlogin&gt;
  AuthType Kerberos
  ...
  KrbLocalUserMapping Off
&lt;/Location&gt;</code></pre></div>


<p>For the PAM authentication, using <code>InterceptFormLoginRealms EXAMPLE.COM</code> will make the user's login include this @REALM part (even if the
user did not explicitly specify it), thus matching the username seen by Foreman when authenticated via Kerberos ticket:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text"># in /etc/httpd/conf.d/intercept_form_submit.conf
&lt;Location /users/login&gt;
  ...
  InterceptFormLoginRealms EXAMPLE.COM
&lt;/Location&gt;</code></pre></div>


<p>With this configuration, the @REALM will be part of the username and it would be clear that <strong>bob</strong> is INTERNAL-authenticated and <strong>bob@EXAMPLE.COM</strong> is different user, EXTERNAL-authenticated. The admin then can manually create another <strong>admin@EXAMPLE.COM</strong> user (with administrator privileges) and even the admin can use Kerberos or PAM authentication in this setup.</p>

<div data-unique="6.Plugins" name="6.Plugins"></div><h1>6. Plugins</h1>

<p>Please refer to the <a href="http://theforeman.org/plugins/">plugins manual</a>.</p>

<div data-unique="7.Troubleshooting" name="7.Troubleshooting"></div><h1>7. Troubleshooting</h1>

<div data-unique="7.1NoVNC" name="7.1NoVNC"></div><h2>7.1 NoVNC</h2>

<p>Foreman uses the excellent javascript VNC library <a href="https://kanaka.github.com/noVNC/noVNC/vnc.html">noVNC</a>,
 which allows clientless VNC within a web browser. When a console is 
opened by the user's web browser, Foreman opens a connection to TCP Port
 5910 (and up) on the hypervisor and redirects that itself.</p>

<div data-unique="Requirements" name="Requirements"></div><h3>Requirements</h3>

<ul>
<li>Recent web browser</li>
<li>Open network connection from the workstation where the web browser 
runs on to your Foreman server and from your Foreman server to the 
hypervisor on TCP ports 5910 - 5930.</li>
</ul>


<div data-unique="EncryptedWebSockets" name="EncryptedWebSockets"></div><h3>Encrypted Web Sockets</h3>

<p>For VNC only, encrypted connections are the default on new 
installations.  If you have an older installation of Foreman, you can 
configure encrypted websockets by adding these lines to <code>/etc/foreman/settings.yml</code>, and configuring the correct path to the same SSL certificates apache uses:</p>

<pre><code>:websockets_encrypt: on
:websockets_ssl_key: /var/lib/puppet/ssl/private_keys/foreman.example.com
:websockets_ssl_cert: /var/lib/puppet/ssl/certs/foreman.example.com
</code></pre>

<div data-unique="Knownissues" name="Knownissues"></div><h3>Known issues</h3>

<ul>
<li>SPICE connections are not encrypted.</li>
<li>For encrypted connections, you will need to trust the Foreman CA. 
This is typically stored in /var/lib/puppet/ssl/certs/ca.pem, you may 
wish to copy this to something like /var/www/html/pub/ca.crt so that 
users may easily find it.</li>
<li>Keyboard mappings are currently fixed to English only.</li>
<li>When using Firefox, if you use Foreman via HTTPS, Firefox might block the connection. To fix it, go to <code>about:config</code> and enable <code>network.websocket.allowInsecureFromHTTPS</code>.</li>
<li>When using Chrome, browse to <code>chrome://flags/</code> and enable
 allow-insecure-websocket-from-https-origin.  Recent versions of Chrome 
(e.g. 44) have removed the flag.  An alternative workaround is to launch
 Chrome with a command-line argument like this <code>$ google-chrome-stable --allow-running-insecure-content &amp;</code></li>
</ul>


<div data-unique="TroubleshootingSteps" name="TroubleshootingSteps"></div><h3>Troubleshooting Steps</h3>

<ul>
<li>Check for a "websockify.py" process on your Foreman server when opening the console page in Foreman</li>
<li>If websockify.py is missing, check /var/log/foreman/production.log for stderr output with logging increased to debug</li>
<li>Look at the last argument of the process command line, it will have 
the hypervisor hostname and port - ensure you can resolve and ping this 
hostname</li>
<li>Try a telnet/netcat connection from the Foreman host to the hypervisor hostname/port</li>
<li>The penultimate argument of websockify.py is the listening port number, check if your web client host can telnet to it</li>
<li>If using Firefox, check the known issues above and set the config appropriately</li>
</ul>


<div data-unique="7.2Debugging" name="7.2Debugging"></div><h2>7.2 Debugging</h2>

<div data-unique="Foremandebugging" name="Foremandebugging"></div><h3>Foreman debugging</h3>

<p>Edit <code>/etc/foreman/settings.yaml</code> and either uncomment or add these lines:</p>

<pre><code>:logging:
  :level: debug
</code></pre>

<p>And reload Foreman:</p>

<pre><code>touch ~foreman/tmp/restart.txt
</code></pre>

<h4>Enabling more specific logs</h4>

<p>More types of log messages can be enabled from settings.yaml:</p>

<ul>
<li>app - web requests and all general application logs (default: true)</li>
<li>ldap - high level LDAP queries (e.g. find users in group) and LDAP operations performed (default: false)</li>
<li>permissions - evaluation of user roles, filters and permissions when loading pages (default: false)</li>
<li>sql - SQL queries made through Rails ActiveRecord, only debug (default: true)</li>
</ul>


<p>Uncomment or add a :loggers block to enable or disable loggers:</p>

<pre><code>:loggers:
  :ldap:
    :enabled: true
</code></pre>

<p>Plugins may add their own logs too, see /etc/foreman/plugins/ for their possible configuration.</p>

<p>Also see <a href="http://theforeman.org/manuals/1.9/index.html#3.5.2ConfigurationOptions">Configuration Options</a> for more information.</p>

<div data-unique="Smartproxydebugging" name="Smartproxydebugging"></div><h3>Smart proxy debugging</h3>

<p>Edit <code>/etc/foreman-proxy/settings.yml</code> and change or add :log_level:</p>

<pre><code># WARN, DEBUG, Error, Fatal, INFO, UNKNOWN
:log_level: DEBUG
</code></pre>

<p>And restart the smart proxy:</p>

<pre><code>service foreman-proxy restart
</code></pre>

<p>Also see <a href="http://theforeman.org/manuals/1.9/index.html#4.3.2SmartProxySettings">Smart Proxy Settings</a> for more information.</p>

<div data-unique="7.3GettingHelp" name="7.3GettingHelp"></div><h2>7.3 Getting Help</h2>

<p>Please check the <a href="http://projects.theforeman.org/projects/1/wiki/Troubleshooting">Troubleshooting wiki page</a>
 for solutions to the most common problems.  Otherwise, there are two 
primary methods of getting support for the Foreman: IRC and mailing 
lists.</p>

<div data-unique="IRC" name="IRC"></div><h3>IRC</h3>

<p>We work on the <a href="http://webchat.freenode.net/">irc.freenode.net</a> servers. You can get general support in #theforeman, while development chat takes place in #theforeman-dev.</p>

<div data-unique="Mailinglists" name="Mailinglists"></div><h3>Mailing lists</h3>

<p>Mailing lists are available via Google Groups. Much like IRC, we have
 a general users (support, Q/A, etc) lists and a development list:</p>

<ul>
<li><a href="https://groups.google.com/forum/?fromgroups#%21forum/foreman-users">foreman-users</a></li>
<li><a href="https://groups.google.com/forum/?fromgroups#%21forum/foreman-dev">foreman-dev</a></li>
</ul>


<div data-unique="Gatheringinformation" name="Gatheringinformation"></div><h3>Gathering information</h3>

<p>In order to troubleshoot and get relevant data use foreman-debug 
which collects information about your OS, Foreman and related 
components.
If you installed from packages, the command is available to root:</p>

<pre><code># foreman-debug
</code></pre>

<p>If you installed from git, you can find it in the Foreman directory:</p>

<pre><code># script/foreman-debug
</code></pre>

<p>If you run it without any options, it will collect data, filter out possible
passwords or tokens and create a tarball which can be safely handed over to
us.</p>

<p>To upload the tarball to our public server via rsync use:</p>

<pre><code># foreman-debug -u
</code></pre>

<p>This is a write-only directory (readable only by Foreman core 
developers), please note that the rsync transmission is UNENCRYPTED.</p>

			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
  $(function() {
    //Calls the tocify method on your HTML div.
    $("#toc").tocify({context: '#doc', scrollTo: '60', selectors: "h1,h2,h3"});
  });
</script>
<section id="latest-news" class="center">
	<div class="container">
		<div class="latest-news col-md-offset-3 col-md-6">
			<p>Foreman 1.8.4 is now available with security and bug fixes.  <a href="http://theforeman.org/manuals/1.8/index.html#Releasenotesfor1.8.4">Read more in the release notes.</a></p>
<p>The latest major release is out! Foreman 1.9 brings <a href="http://theforeman.org/manuals/1.9/index.html#Headlinefeatures">UI enhancements and a host of small features</a>.</p>

		</div>
	</div>
</section>
<div class="footer">
  <div class="container">
    <p>This web site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_GB">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.  Source available: <a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/theforeman/theforeman.org" rel="dct:source">github/theforeman/theforeman.org</a></p>
    <p>Thanks to <a href="http://theforeman.org/sponsors.html">our sponsors</a> for hosting this website and our project services.</p>
		<a style="visibility:hidden;" href="https://plus.google.com/102496134326414788199" rel="publisher">Google+ community</a>
  </div>
</div>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2134730-5']);
  _gaq.push(['_trackPageview']);

  (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>




</body></html>